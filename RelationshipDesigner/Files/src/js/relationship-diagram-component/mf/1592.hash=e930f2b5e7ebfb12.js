(self.webpackChunkapp_studio_enterprise_relationship_diagram=self.webpackChunkapp_studio_enterprise_relationship_diagram||[]).push([[1592,3308,927,8546,6165,2832,451,8070,5689,4260,1879,9211],{9211:(D,M,o)=>{o.r(M),o.d(M,{EXPRESSION_SCHEMA_VARIABLE_PATTERN:()=>N,EntityRecordColumnType:()=>i,EntityRecordPrimaryValueType:()=>c,ExpressionEngineType:()=>x,ExpressionSchema:()=>S,ExpressionSchemaModule:()=>u,ExpressionSchemaParameter:()=>p,ExpressionSchemaRecordVariableConfig:()=>v,ExpressionSchemaSourceValueConfig:()=>y,ExpressionSchemaVariable:()=>w,ExpressionSchemaVariableConfig:()=>n,ExpressionVariableAggregationType:()=>C,ExpressionVariableType:()=>E,RecordExpressionVariableType:()=>T});var V=o(40297),g=o(59131);class u{static{this.\u0275fac=function(a){return new(a||u)}}static{this.\u0275mod=g.\u0275\u0275defineNgModule({type:u})}static{this.\u0275inj=g.\u0275\u0275defineInjector({imports:[V.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&g.\u0275\u0275setNgModuleScope(u,{imports:[V.CommonModule]})})();var h=o(73308),s=o(38495),d=o(28399);class l{constructor(e){this.uId=e?.uId??(0,s.generateGuid)(),this.name=e?.name??this.getDefaultName(),this.resourcesProvider=e?.resourcesProvider}getDefaultName(){return this._defaultName}fromMetadata(e){this.uId=e?.uId??(0,s.generateGuid)(),this.name=e?.name??this.getDefaultName()}toMetadata(){return{typeName:this._typeName,uId:this.uId,name:this.name}}getCaption(e){return this.resourcesProvider?.getCaption(e)??Promise.resolve(e)}}class p extends l{get _typeName(){return"Terrasoft.Core.ExpressionEngine.Schema.Parameters.ExpressionSchemaParameter"}get _defaultName(){return"Parameter"}constructor(e){super(e),this.dataValueType=e?.dataValueType??s.DataValueType.Text}fromMetadata(e){super.fromMetadata(e),this.dataValueType=s.DataValueType[e?.dataValueType??"Text"]}clone(){return new p(this)}toMetadata(){if(this.dataValueType==null)throw new Error("Data value type not specified");return{...super.toMetadata(),dataValueType:s.DataValueType[this.dataValueType]}}accept(e){var a=this;return(0,h.A)(function*(){yield e.visitParameter?.(a)})()}}class f{static create(e){if(!e)throw new Error("typeName is null or empty");if(e==="Terrasoft.Core.ExpressionEngine.Schema.Parameters.ExpressionSchemaParameter")return new p;throw new Error(`ExpressionSchemaParameter with type '${e}' not found`)}static createFromMetadata(e){const a=e.typeName,r=this.create(a);return r.fromMetadata(e),r}}class n extends l{get _typeName(){return"Terrasoft.Core.ExpressionEngine.Schema.Variables.ExpressionSchemaVariableConfig"}get _defaultName(){return"VariableConfig"}constructor(e){super(e),this.value=e?.value??""}fromMetadata(e){super.fromMetadata(e),this.value=e?.value??""}clone(){return new n(this)}toMetadata(){return{...super.toMetadata(),value:this.value}}getBoundParametersNames(){return[]}}var i;(function(t){t.Column="Column",t.AggregationColumn="AggregationColumn"})(i||(i={}));var c;(function(t){t.Constant="Constant",t.Parameter="Parameter",t.SysSetting="SysSetting",t.SysValue="SysValue"})(c||(c={}));var x;(function(t){t.PowerFx="PowerFx"})(x||(x={}));var E;(function(t){t.SysSetting="SysSetting",t.SysValue="SysValue",t.Parameter="Parameter",t.Record="Record",t.Collection="Collection",t.EsqAggregation="EsqAggregation"})(E||(E={}));var T;(function(t){t.Entity="Entity",t.Custom="Custom"})(T||(T={}));var C;(function(t){t.None="None",t.Count="Count",t.Sum="Sum",t.Avg="Avg",t.Min="Min",t.Max="Max",t.TopOne="TopOne"})(C||(C={}));class y{constructor(e){this.type=e?.type??c.Constant,this.value=e?.value??""}fromMetadata(e){this.type=e?.type??c.Constant,this.value=e?.value??""}clone(){return new y(this)}toMetadata(){if(!this.type)throw new Error("Type not specified");return{type:this.type,value:this.value}}getBoundParametersNames(){return this.type===c.Parameter?[this.value]:[]}}class v extends n{get _typeName(){return"Terrasoft.Core.ExpressionEngine.Schema.Variables.ExpressionSchemaRecordVariableConfig"}get _defaultName(){return"VariableConfig"}constructor(e){super(e),this.recordType=e?.recordType??T.Entity,this.primaryValue=e?.primaryValue.clone()??new y,this.fieldValues=e?.fieldValues.clone()??new y}fromMetadata(e){super.fromMetadata(e),this.recordType=e?.recordType??T.Entity;const a=new y;e?.primaryValue&&a.fromMetadata(e.primaryValue),this.primaryValue=a;const r=new y;e?.fieldValues&&r.fromMetadata(e.fieldValues),this.fieldValues=r}clone(){return new v(this)}toMetadata(){if(!this.recordType)throw new Error("Record type not specified");return{...super.toMetadata(),recordType:this.recordType,primaryValue:this.primaryValue.toMetadata(),fieldValues:this.fieldValues.toMetadata()}}getBoundParametersNames(){const e=[...super.getBoundParametersNames(),...this.primaryValue.getBoundParametersNames(),...this.fieldValues.getBoundParametersNames()];return[...new Set(e)]}}class I{static create(e){if(!e)throw new Error("typeName is null or empty");switch(e){case"Terrasoft.Core.ExpressionEngine.Schema.Variables.ExpressionSchemaVariableConfig":return new n;case"Terrasoft.Core.ExpressionEngine.Schema.Variables.ExpressionSchemaRecordVariableConfig":return new v;default:throw new Error(`ExpressionSchemaVariableConfig with type '${e}' not found`)}}static createFromMetadata(e){const a=e.typeName,r=this.create(a);return r.fromMetadata(e),r}}class w extends l{get _typeName(){return"Terrasoft.Core.ExpressionEngine.Schema.Variables.ExpressionSchemaVariable"}get _defaultName(){return"Variable"}constructor(e){super(e),this.dataValueType=e?.dataValueType??s.DataValueType.Text,this.variableType=e?.variableType??E.Parameter,this.config=e?.config.clone()??new n}fromMetadata(e){super.fromMetadata(e),this.dataValueType=s.DataValueType[e?.dataValueType??"Text"],this.variableType=e?.variableType??E.Parameter,this.config=e?.config?I.createFromMetadata(e.config):new n}clone(){return new w(this)}toMetadata(){if(this.dataValueType==null)throw new Error("Data value type not specified");if(!this.variableType)throw new Error("Variable type not specified");return{...super.toMetadata(),dataValueType:s.DataValueType[this.dataValueType],variableType:this.variableType,config:this.config.toMetadata()}}accept(e){var a=this;return(0,h.A)(function*(){yield e.visitVariable?.(a)})()}getBoundParametersNames(){return this.config.getBoundParametersNames()}}class A{static create(e){if(!e)throw new Error("typeName is null or empty");if(e==="Terrasoft.Core.ExpressionEngine.Schema.Variables.ExpressionSchemaVariable")return new w;throw new Error(`ExpressionSchemaVariable with type '${e}' not found`)}static createFromMetadata(e){const a=e?.typeName,r=this.create(a);return r.fromMetadata(e),r}}const N="#(?<name>\\w+?)(?:\\.(?<path>.+?))*?#";class S{constructor(e){this.uId=e?.uId??(0,s.generateGuid)(),this.name=e?.name??"",this.engineType=e?.engineType??x.PowerFx,this.expression=e?.expression??"",this.resultDataValueType=e?.resultDataValueType??s.DataValueType.Text,this.expressionVariables=(e?.expressionVariables??[]).map(a=>a.clone()),this.parameters=(e?.parameters??[]).map(a=>a.clone())}static fromMetadata(e){const a=new S;return a.fromMetadata(e),a}accept(e){var a=this;return(0,h.A)(function*(){yield e.visitSchema?.(a);for(const r of a.expressionVariables)yield r.accept(e);for(const r of a.parameters)yield r.accept(e)})()}fromMetadata(e){this.uId=e?.uId??(0,s.generateGuid)(),this.name=e?.name??"",this.engineType=e?.engineType??x.PowerFx,this.expression=e?.expression??"",this.resultDataValueType=s.DataValueType[e?.resultDataValueType??"Text"],this.expressionVariables=(e?.expressionVariables??[]).map(a=>A.createFromMetadata(a)),this.parameters=(e?.parameters??[]).map(a=>f.createFromMetadata(a))}findExpressionVariable(e){return this.expressionVariables.find(a=>a.name===e)??null}getExpressionVariable(e){const a=this.findExpressionVariable(e);if(a==null)throw new Error(`Can not find expression variable: ${e}`);return a}findExpressionParameter(e){return this.parameters.find(a=>a.name===e)??null}getExpressionParameter(e){const a=this.findExpressionParameter(e);if(a==null)throw new Error(`Can not find parameter: ${e}`);return a}addExpressionVariable(e){this.expressionVariables.push(e)}addExpressionParameter(e){this.parameters.push(e)}removeExpressionParameterByName(e){const a=this.getExpressionParameter(e),r=this.parameters.indexOf(a);return this.parameters.splice(r,1),a}removeExpressionVariableByName(e){const a=this.getExpressionVariable(e),r=this.expressionVariables.indexOf(a);return this.expressionVariables.splice(r,1),a}clone(){return new S(this)}toMetadata(){const e=this.expressionVariables.map(r=>r.toMetadata()),a=this.parameters.map(r=>r.toMetadata());return{uId:this.uId,name:this.name,engineType:this.engineType,expression:this.expression,resultDataValueType:s.DataValueType[this.resultDataValueType],expressionVariables:e,parameters:a}}getExpressionVariablesPaths(e=null){const a=this.expression??"",r=new RegExp(N,"g"),F=[...a.matchAll(r)].map(m=>{const P=m.groups?.path,b=m.groups?.name;return{path:P,variableName:b}}).filter(({variableName:m})=>e?this.expressionVariables.find(b=>b.name===m).variableType===e:!0);return Object.entries((0,d.groupBy)(F,m=>m.variableName)).map(([m,P])=>({variableName:m,paths:(0,d.uniq)(P.map(b=>b.path))}))}}},73308:(D,M,o)=>{o.d(M,{A:()=>g});function V(u,h,s,d,l,p,f){try{var n=u[p](f),i=n.value}catch(c){s(c);return}n.done?h(i):Promise.resolve(i).then(d,l)}function g(u){return function(){var h=this,s=arguments;return new Promise(function(d,l){var p=u.apply(h,s);function f(i){V(p,d,l,f,n,"next",i)}function n(i){V(p,d,l,f,n,"throw",i)}f(void 0)})}}}}]);
