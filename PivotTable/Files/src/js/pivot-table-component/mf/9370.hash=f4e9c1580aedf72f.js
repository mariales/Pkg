(self.webpackChunkapp_studio_enterprise_pivot_table=self.webpackChunkapp_studio_enterprise_pivot_table||[]).push([[9370],{39370:(Hi,en,d)=>{d.r(en),d.d(en,{ARITHMETIC_OPERATOR_ORDER_VALIDATOR:()=>jn,AggregationSubQueryOperandDefinition:()=>nn,ArithmeticOperator:()=>me,ArithmeticOperatorDataTypeValidator:()=>Te,ArithmeticOperatorDefinition:()=>O,BaseFormulaConverter:()=>Ge,BaseFormulaItem:()=>Ct,BinaryOperatorOrderValidator:()=>Yt,CHECK_NOT_ONLY_COLUMN_FORMULA_VALIDATOR:()=>An,COLUMN_FUNCTION_NAME:()=>Gt,COMMA_ORDER_VALIDATOR:()=>Ln,CONST_FUNCTION_NAME:()=>Ut,CheckNotOnlyColumnFormulaValidator:()=>_n,ColumnOperand:()=>Pe,ColumnOperandDefinition:()=>pe,CommaOperator:()=>Ft,CommaOperatorDefinition:()=>Le,CommaOrderValidator:()=>wn,ConstantOperand:()=>z,DECIMAL_SEPARATOR_VALIDATOR:()=>Wn,DIVISION_BY_ZERO_VALIDATOR:()=>zn,DecimalSeparatorValidator:()=>xn,DefaultFormulaItemDefinitionProvider:()=>ke,DivisionByZeroError:()=>hn,DivisionByZeroValidator:()=>vn,EXPRESSION_VALIDATOR:()=>Qt,EXPRESSION_VALIDATORS_COLLECTION:()=>Qe,ExpressionToFormulaConverter:()=>x,ExpressionToFormulaConverterMock:()=>Li,FORMULA_ITEMS_VALIDATOR:()=>Bt,FORMULA_ITEMS_VALIDATORS_COLLECTION:()=>Jt,FUNCTION_DEFINITIONS:()=>Rt,FUNCTION_STRUCTURE_VALIDATOR:()=>Pn,Formula:()=>Ue,FormulaAdvancedToolbarComponentModule:()=>R,FormulaDefinitionToItemConversionVisitor:()=>v,FormulaDefinitionsToItemsConversionVisitorDecorator:()=>q,FormulaDesignerComponent:()=>se,FormulaDesignerModule:()=>ce,FormulaInputModelsConverter:()=>ae,FormulaItem:()=>nt,FormulaItemConverterExpressionVisitor:()=>Y,FormulaItemDefinition:()=>je,FormulaItemDefinitionMock:()=>ci,FormulaItemDefinitionProvider:()=>M,FormulaItemDefinitionProviderMock:()=>cn,FormulaItemDefinitionVisitor:()=>L,FormulaItemDefinitionVisitorMock:()=>un,FormulaItemValidationError:()=>F,FormulaItemVisitor:()=>Nt,FormulaItemsDefinitionsVisitor:()=>ze,FormulaMock:()=>Mt,FormulaModule:()=>Be,FormulaToExpressionConverter:()=>We,Function:()=>xt,FunctionArgumentsCountValidator:()=>ye,FunctionArgumentsDataTypeValidator:()=>Me,FunctionDefinition:()=>m,FunctionParameterDefinition:()=>qn,FunctionReturnDefinition:()=>ei,FunctionStructureValidator:()=>Mn,FunctionType:()=>u,InvalidFunctionArgumentDataTypeError:()=>mn,InvalidFunctionArgumentsCountError:()=>pn,ItemDefinitionGroup:()=>jt,MAX_NUMBER_LENGTH_VALIDATOR:()=>Gn,MathjsExpressionTextConverter:()=>re,MathjsFormulaConverter:()=>Oe,MathjsFormulaItemVisitor:()=>w,MaxNumberLengthError:()=>Vt,MaxNumberLengthValidator:()=>Tn,MissingOperandError:()=>kt,MissingParenthesesError:()=>zt,NUMBER_CORRECTNESS_VALIDATOR:()=>Un,NotSupportedOnlyColumnError:()=>dn,NumberCorrectnessValidator:()=>Cn,OPERAND_ORDER_VALIDATOR:()=>Vn,Operand:()=>Ae,OperandDefinition:()=>rt,OperandOrderValidator:()=>_e,Operator:()=>le,OperatorDefinition:()=>de,PARENTHESES_COUNT_VALIDATOR:()=>kn,PARENTHESES_ORDER_VALIDATOR:()=>Rn,ParenthesesCountValidator:()=>Fn,ParenthesesOperator:()=>it,ParenthesesOperatorDefinition:()=>fe,ParenthesesOrderValidator:()=>Sn,ParenthesesType:()=>p,PointOperator:()=>St,PointOperatorDefinition:()=>Re,RELATION_OPERATOR_ORDER_VALIDATOR:()=>Ti,REQUIRED_FORMULA_VALIDATOR:()=>bn,RelationOperator:()=>Et,RelationOperatorDefinition:()=>rn,RequiredError:()=>En,RequiredFormulaValidator:()=>Nn,SubQueryOperandDefinition:()=>bt,SysSettingOperand:()=>wt,SysSettingOperandDefinition:()=>At,SysVariableOperand:()=>vt,SysVariableOperandDefinition:()=>Pt,UnexpectedDecimalSeparatorError:()=>fn,UnexpectedItemError:()=>_,UnexpectedParenthesesError:()=>In,UnsupportedBinaryOperatorDataTypeError:()=>gn,additionOperator:()=>Ht,additionOperatorDefinition:()=>Je,aggregationSubQueryDefinition:()=>ht,aggregationSubQueryOperand:()=>Ui,closingParenthesesOperator:()=>Kt,closingParenthesesOperatorDefinition:()=>Xe,columnDefinition:()=>dt,columnOperand:()=>Zn,commaOperator:()=>$n,commaOperatorDefinition:()=>Ot,divisionOperator:()=>Kn,divisionOperatorDefinition:()=>Ke,equalOperator:()=>Ji,equalOperatorDefinition:()=>yt,formulaItemDefinitionProviderMock:()=>Xn,formulaItemDefinitionVisitResultMock:()=>ui,functionDefinitions:()=>Qn,functionsDefinitions:()=>ki,generateConstant:()=>qe,getDesignTimeFunctionConfig:()=>Ve,getMetadataFunctionConfig:()=>an,groupFunctions:()=>sn,multiplicationOperator:()=>Qi,multiplicationOperatorDefinition:()=>Ze,openingParenthesesOperator:()=>Zt,openingParenthesesOperatorDefinition:()=>$e,operandDefinitions:()=>Bn,operandsDefinitions:()=>Vi,operatorDefinitions:()=>Jn,operatorsDefinitions:()=>Ri,pointOperator:()=>Bi,pointOperatorDefinition:()=>Dt,subQueryDefinition:()=>ft,subQueryOperand:()=>zi,subtractionOperator:()=>Yi,subtractionOperatorDefinition:()=>He,sumFunction:()=>Hn,sumFunctionDefinition:()=>pt,sysSettingDefinition:()=>It,sysSettingOperand:()=>Gi,sysVariableDefinition:()=>gt,sysVariableOperand:()=>Wi});var f=d(40297),C=d(23023),Q=d(67047),B=d(57475),tn=d(56711),ue=d(6675),_t=d(52989),et=d(4091),Tt=d(70987),tt=d(73479),be=d(88763),n=d(59131),a=d(21018),J=d(28399),u;(function(r){r[r.Logic=0]="Logic",r[r.String=1]="String",r[r.DateTime=2]="DateTime",r[r.Math=3]="Math"})(u||(u={}));var c=d(38495),p;(function(r){r.Opening="(",r.Closing=")"})(p||(p={}));class Ct{constructor(e,t){this.type=e,this.caption=t}}class nt extends Ct{constructor(e,t,i){super(t,i),this._id=e}get id(){return this._id}checkVisitorAndVisitFormulaItem(e,t){return c.ValidationUtilities.checkArgumentEmpty("visitor",e),t(e)}}class xt extends nt{constructor(e,t){super(e,a.ExpressionType.Function,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitFunctionFormulaItem(this))}}class Ae extends nt{constructor(e,t,i){super(e,a.ExpressionType.Operand,i),this.operandType=t}}class Pe extends Ae{constructor(e,t){super(e,a.OperandType.Column,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitColumnOperand(this))}}class z extends Ae{constructor(e,t,i,o){super(i,a.OperandType.Const,o||z._getSafeValue(e)),this.dataType=t,this.value=z._getSafeValue(e),this.dataType=t??a.ConstantOperandDataTypeResolver.getResultDataType(e)}static _getSafeValue(e){return e!=null?String(e):""}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitConstantOperand(this))}}class wt extends Ae{constructor(e,t){super(e,a.OperandType.SysSetting,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitSysSettingOperand(this))}}class vt extends Ae{constructor(e,t){super(e,a.OperandType.SysVariable,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitSysVariableOperand(this))}}class le extends nt{constructor(e,t,i){super(e,a.ExpressionType.Operator,i),this.operatorType=t}}class me extends le{constructor(e,t,i){super(e,a.OperatorType.Arithmetic,i),this.arithmeticOperatorType=t}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitArithmeticOperator(this))}}class Ft extends le{constructor(e,t){super(e,a.OperatorType.Comma,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitCommaOperator(this))}}class it extends le{constructor(e,t,i){super(e,a.OperatorType.Parentheses,i),this.parenthesesType=t}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitParenthesesOperator(this))}}class St extends le{constructor(e,t){super(e,a.OperatorType.Point,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitPointOperator(this))}}class Et extends le{constructor(e,t,i){super(e,a.OperatorType.Relation,i),this.relationOperationType=t}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitRelationOperator(this))}}class Nt{}class je extends Ct{constructor(e,t){super(e,t)}checkVisitorAndVisitDefinition(e,t){return c.ValidationUtilities.checkArgumentEmpty("visitor",e),t(e)}}class m extends je{constructor(e,t,i,o,s){super(a.ExpressionType.Function,e),this.code=t,this.functionType=i,this.parameterDefinitions=o,this.returnDefinition=s}get id(){return this.code}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitFunctionDefinition(this))}}class qn{}class ei{}class rt extends je{constructor(e,t,i){super(a.ExpressionType.Operand,i),this.operandType=e,this.dataType=t}}class pe extends rt{constructor(e,t,i){super(a.OperandType.Column,e,i||t),this.columnPath=t}get id(){return(0,a.getColumnDefinitionId)(this)}get columnType(){return a.ColumnOperandType.SchemaColumn}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitColumnOperandDefinition(this))}}class bt extends pe{constructor(e,t,i,o){super(e,t,o),this.subFilters=i}get id(){return(0,a.getSubQueryColumnDefinitionId)(this)}get columnType(){return a.ColumnOperandType.SubQuery}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitSubQueryOperandDefinition(this))}}class nn extends bt{constructor(e,t,i,o,s){super(e,t,o,s),this.aggregationType=i}get id(){return(0,a.getAggregationSubQueryColumnDefinitionId)(this)}get columnType(){return a.ColumnOperandType.Aggregation}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitAggregationSubQueryOperandDefinition(this))}}class At extends rt{constructor(e,t,i){super(a.OperandType.SysSetting,t,i||e),this.code=e}get id(){return this.code}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitSysSettingOperandDefinition(this))}}class Pt extends rt{constructor(e,t,i){super(a.OperandType.SysVariable,t,i||e),this.name=e}get id(){return this.name}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitSysVariableOperandDefinition(this))}}class de extends je{constructor(e,t){super(a.ExpressionType.Operator,t),this.operatorType=e}}class O extends de{constructor(e,t){super(a.OperatorType.Arithmetic,t||(0,a.convertArithmeticOperatorTypeToString)(e)),this.arithmeticOperatorType=e}get id(){return(0,a.convertArithmeticOperatorTypeToString)(this.arithmeticOperatorType)}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitArithmeticOperatorDefinition(this))}}class Le extends de{constructor(e){super(a.OperatorType.Comma,e)}get id(){return","}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitCommaOperatorDefinition(this))}}class fe extends de{constructor(e,t){super(a.OperatorType.Parentheses,t||e),this.parenthesesType=e}get id(){return this.parenthesesType}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitParenthesesOperatorDefinition(this))}}class Re extends de{constructor(e){super(a.OperatorType.Point,e)}get id(){return"."}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitPointOperatorDefinition(this))}}class rn extends de{constructor(e,t){super(a.OperatorType.Relation,t||(0,a.convertRelationOperatorTypeToString)(e)),this.relationOperationType=e}get id(){return(0,a.convertRelationOperatorTypeToString)(this.relationOperationType)}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitRelationOperatorDefinition(this))}}class jt{constructor(e,t){this.captionKey=e,this.items=t}}var H=d(79772);class M{getById(e){const t=this.findWhere({id:e});if(!t)throw new Error(`definition with id:${e} not found`);return t}findWhere(e){const t=this.getDefinitions();return(0,J.find)(t,e)}}const E="DATEDIFF",N="DATEADD",Z="DATEPART",D=[c.DataValueType.Date,c.DataValueType.DateTime],K=[c.DataValueType.Time,c.DataValueType.DateTime],Lt=[c.DataValueType.Date,c.DataValueType.Time,c.DataValueType.DateTime],b=r=>[{name:"date1",dataTypes:r,description:"The first date to calculate the difference."},{name:"date2",dataTypes:r,description:"The second date to calculate the difference."}],A={dataType:c.DataValueType.Integer,description:"Result date."},ti=[new m("localizableStrings.FunctionDateDiffYearsCaption",E+"YEARS",u.DateTime,b(D),A),new m("localizableStrings.FunctionDateDiffQuartersCaption",E+"QUARTERS",u.DateTime,b(D),A),new m("localizableStrings.FunctionDateDiffMonthsCaption",E+"MONTHS",u.DateTime,b(D),A),new m("localizableStrings.FunctionDateDiffWeeksCaption",E+"WEEKS",u.DateTime,b(D),A),new m("localizableStrings.FunctionDateDiffDaysCaption",E+"DAYS",u.DateTime,b(D),A),new m("localizableStrings.FunctionDateDiffHoursCaption",E+"HOURS",u.DateTime,b(K),A),new m("localizableStrings.FunctionDateDiffMinutesCaption",E+"MINUTES",u.DateTime,b(K),A),new m("localizableStrings.FunctionDateDiffSecondsCaption",E+"SECONDS",u.DateTime,b(K),A)],P=r=>[{name:"date",dataTypes:r,description:"The date that will be modified."},{name:"number",dataTypes:[c.DataValueType.Integer],description:"The number of interval to add to date."}],j={dataType:c.DataValueType.DateTime,description:"Result date."},ni=[new m("localizableStrings.FunctionDateAddYearsCaption",N+"YEARS",u.DateTime,P(D),j),new m("localizableStrings.FunctionDateAddQuartersCaption",N+"QUARTERS",u.DateTime,P(D),j),new m("localizableStrings.FunctionDateAddMonthsCaption",N+"MONTHS",u.DateTime,P(D),j),new m("localizableStrings.FunctionDateAddWeeksCaption",N+"WEEKS",u.DateTime,P(D),j),new m("localizableStrings.FunctionDateAddDaysCaption",N+"DAYS",u.DateTime,P(D),j),new m("localizableStrings.FunctionDateAddHoursCaption",N+"HOURS",u.DateTime,P(K),j),new m("localizableStrings.FunctionDateAddMinutesCaption",N+"MINUTES",u.DateTime,P(K),j),new m("localizableStrings.FunctionDateAddSecondsCaption",N+"SECONDS",u.DateTime,P(K),j)],$=r=>[{name:"date",dataTypes:r,description:"The date form which to take part."}],X={dataType:c.DataValueType.Integer,description:"Result date."},ii=[new m("localizableStrings.FunctionDatePartYearsCaption",Z+"YEARS",u.DateTime,$(D),X),new m("localizableStrings.FunctionDatePartMonthsCaption",Z+"MONTHS",u.DateTime,$(D),X),new m("localizableStrings.FunctionDatePartWeeksCaption",Z+"WEEKS",u.DateTime,$(D),X),new m("localizableStrings.FunctionDatePartDaysWeeksCaption",Z+"DAYSWEEKS",u.DateTime,$(D),X),new m("localizableStrings.FunctionDatePartDaysCaption",Z+"DAYS",u.DateTime,$(D),X),new m("localizableStrings.FunctionDatePartHoursCaption",Z+"HOURS",u.DateTime,$(K),X)],ri={dataType:c.DataValueType.DateTime,description:"Result date."},oi=[new m("localizableStrings.FunctionGetDateTimeCaption","GETDATE",u.DateTime,[],ri)],Rt=[...ti,...ni,...ii,...oi],ot=new m("localizableStrings.FunctionDateDiffYearsCaption",E,u.DateTime,b(Lt).concat({name:"interval",dataTypes:[c.DataValueType.Integer],description:"The time/date interval to add."}),A),at=new m("localizableStrings.FunctionDatePartCaption",Z,u.DateTime,$(Lt).concat({name:"interval",dataTypes:[c.DataValueType.Integer],description:"The time/date interval to add."}),X),st=new m("localizableStrings.FunctionDateAddCaption",N,u.DateTime,P(Lt).concat({name:"interval",dataTypes:[c.DataValueType.Integer],description:"The time/date interval to add."}),j);function on(r){const e=r.code;return e.startsWith(ot.code)?{fnCode:ot.code,fnDefinitionId:ot.id}:e.startsWith(st.code)?{fnCode:st.code,fnDefinitionId:st.id}:e.startsWith(at.code)?{fnCode:at.code,fnDefinitionId:at.id}:{fnCode:e,fnDefinitionId:r.id}}function ai(r){let e="";switch(r){case"DATEPARTYEARS":case"DATEDIFFYEARS":case"DATEADDYEARS":{e="Y";break}case"DATEPARTQUARTERS":case"DATEDIFFQUARTERS":case"DATEADDQUARTERS":{e="Q";break}case"DATEPARTMONTHS":case"DATEDIFFMONTHS":case"DATEADDMONTHS":{e="M";break}case"DATEPARTWEEKS":case"DATEADDWEEKS":case"DATEDIFFWEEKS":{e="W";break}case"DATEPARTDAYS":case"DATEDIFFDAYS":case"DATEADDDAYS":{e="D";break}case"DATEPARTHOURS":case"DATEDIFFHOURS":case"DATEADDHOURS":{e="H";break}case"DATEPARTMINUTES":case"DATEDIFFMINUTES":case"DATEADDMINUTES":{e="Mi";break}case"DATEPARTDAYSWEEKS":case"DATEDIFFDAYSWEEKS":case"DATEADDDAYSWEEKS":{e="DW";break}case"DATEDIFFSECONDS":case"DATEPARTSECONDS":case"DATEADDSECONDS":{e="S";break}default:return[]}return[new a.ConstOperandExpression(e,c.DataValueType.Text)]}function an(r,e){const t=ai(r.code),i=e.concat(t),o=on(r);return{fnArgs:i,fnCode:o.fnCode,fnDefinitionId:o.fnDefinitionId}}function sn(r){return J.chain(r).map(t=>t).groupBy(t=>on(t).fnCode).map((t,i)=>t.length>1?new jt(`localizableStrings.${i}FunctionsMenuCaption`,t):t[0]).value()}function Ve(r){const e=r.arguments;switch(r.code){case ot.code:case at.code:case st.code:{const t=si(r);return{fnArgs:e.slice(0,e.length-1),fnCode:t?.code||r.code,fnDefinitionId:t?.id||r.definitionId}}default:return{fnArgs:e,fnCode:r.code,fnDefinitionId:r.definitionId}}}function si(r){const e=r.arguments,t=e[e.length-1];let i=r.code;switch(t.value){case"Y":i+="YEARS";break;case"Q":i+="QUARTERS";break;case"M":i+="MONTHS";break;case"D":i+="DAYS";break;case"W":i+="WEEKS";break;case"H":i+="HOURS";break;case"Mi":i+="MINUTES";break;case"DW":i+="DAYSWEEKS";break;case"S":i+="SECONDS";break}return Rt.find(o=>o.code===i)}class ke extends M{constructor(e){super(),this._translateService=e,this._defaultPinnedOperatorsDefinitions=[new O(a.ArithmeticOperatorType.Addition,"+"),new O(a.ArithmeticOperatorType.Subtraction,"\u2212"),new O(a.ArithmeticOperatorType.Multiplication,"\u2217"),new O(a.ArithmeticOperatorType.Division,"/"),new fe(p.Opening,"("),new fe(p.Closing,")")],this._defaultOperatorsDefinitions=[...this._defaultPinnedOperatorsDefinitions,new Re("."),new Le(",")],this.definitions=new Map,this._defaultFunctionDefinitions=this.getDefaultFunctionDefinitions()}get functionDefinitions(){return this._defaultFunctionDefinitions}get operandDefinitions(){return[]}get operatorDefinitions(){return this._defaultOperatorsDefinitions}getDefaultFunctionDefinitions(){return(0,J.cloneDeep)(Rt).map(e=>{const t=e;return new m(this._translateService.instant(t.caption),t.code,t.functionType,t.parameterDefinitions,t.returnDefinition)})}addDefinition(e){e&&this.definitions.set(e.id,e)}getDefinitions(){return[...this.definitions.values(),...this.functionDefinitions,...this.operandDefinitions,...this.operatorDefinitions]}getPinnedDefinitions(){return[...this._defaultPinnedOperatorsDefinitions]}addDefinitions(e){e&&e.length>0&&e.forEach(t=>this.addDefinition(t))}clearDefinitions(){this.definitions.clear()}static{this.\u0275fac=function(t){return new(t||ke)(n.\u0275\u0275inject(H.TranslateService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ke,factory:ke.\u0275fac})}}class L{}class v extends L{_checkDefinitionIsDefined(e){c.ValidationUtilities.checkArgumentEmpty("definition",e)}_createColumnOperand(e){return this._checkDefinitionIsDefined(e),new Pe(e.id,e.caption)}visitFunctionDefinition(e){return this._checkDefinitionIsDefined(e),new xt(e.id,e.caption)}visitAggregationSubQueryOperandDefinition(e){return this._createColumnOperand(e)}visitColumnOperandDefinition(e){return this._createColumnOperand(e)}visitSubQueryOperandDefinition(e){return this._createColumnOperand(e)}visitSysSettingOperandDefinition(e){return this._checkDefinitionIsDefined(e),new wt(e.id,e.caption)}visitSysVariableOperandDefinition(e){return this._checkDefinitionIsDefined(e),new vt(e.id,e.caption)}visitArithmeticOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new me(e.id,e.arithmeticOperatorType,e.caption)}visitCommaOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new Ft(e.id,e.caption)}visitParenthesesOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new it(e.id,e.parenthesesType,e.caption)}visitPointOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new St(e.id,e.caption)}visitRelationOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new Et(e.id,e.relationOperationType,e.caption)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(v)))(i||v)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac,providedIn:"root"})}}class q extends L{constructor(e,t){super(),this._formulaDefinitionToItemConversionVisitor=e,this._formulaItemDefinitionProvider=t}_getFormulaItem(e){return this._formulaItemDefinitionProvider.findWhere(e).accept(this._formulaDefinitionToItemConversionVisitor)}_visitDefinition(e){return[e.accept(this._formulaDefinitionToItemConversionVisitor)]}visitFunctionDefinition(e){const t=[this._formulaDefinitionToItemConversionVisitor.visitFunctionDefinition(e)],i=this._getFormulaItem({parenthesesType:p.Opening});t.push(i);const o=e.parameterDefinitions.length-1;for(let l=0;l<o;l++){const I=this._getFormulaItem({operatorType:a.OperatorType.Comma});t.push(I)}const s=this._getFormulaItem({parenthesesType:p.Closing});return t.push(s),t}visitAggregationSubQueryOperandDefinition(e){return this._visitDefinition(e)}visitColumnOperandDefinition(e){return this._visitDefinition(e)}visitSubQueryOperandDefinition(e){return this._visitDefinition(e)}visitSysSettingOperandDefinition(e){return this._visitDefinition(e)}visitSysVariableOperandDefinition(e){return this._visitDefinition(e)}visitArithmeticOperatorDefinition(e){return this._visitDefinition(e)}visitCommaOperatorDefinition(e){return this._visitDefinition(e)}visitParenthesesOperatorDefinition(e){return this._visitDefinition(e)}visitPointOperatorDefinition(e){return this._visitDefinition(e)}visitRelationOperatorDefinition(e){return this._visitDefinition(e)}static{this.\u0275fac=function(t){return new(t||q)(n.\u0275\u0275inject(v),n.\u0275\u0275inject(M))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac,providedIn:"root"})}}class ci extends je{constructor(e,t,i){super(t,i),this._id=e}get id(){return this._id}accept(e){throw new Error("Method not implemented.")}}class cn extends M{constructor(e=[]){super(),this._definitions=e}getDefinitions(){return this._definitions}getPinnedDefinitions(){return[]}addDefinitions(e){e&&e.length>0&&(this._definitions=this._definitions.concat(e))}clearDefinitions(){this._definitions=[]}}const ui={id:(0,c.generateGuid)()};class un{visitFunctionDefinition(e){throw new Error("Method not implemented.")}visitAggregationSubQueryOperandDefinition(e){throw new Error("Method not implemented.")}visitColumnOperandDefinition(e){throw new Error("Method not implemented.")}visitSubQueryOperandDefinition(e){throw new Error("Method not implemented.")}visitSysSettingOperandDefinition(e){throw new Error("Method not implemented.")}visitSysVariableOperandDefinition(e){throw new Error("Method not implemented.")}visitArithmeticOperatorDefinition(e){throw new Error("Method not implemented.")}visitCommaOperatorDefinition(e){throw new Error("Method not implemented.")}visitParenthesesOperatorDefinition(e){throw new Error("Method not implemented.")}visitPointOperatorDefinition(e){throw new Error("Method not implemented.")}visitRelationOperatorDefinition(e){throw new Error("Method not implemented.")}}const ze=new n.InjectionToken(`An injection token for visiting an array of Fomula
		items`);function li(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",10),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(o.filteringValue="")}),n.\u0275\u0275element(1,"mat-icon",11),n.\u0275\u0275elementEnd()}}function mi(r,e){r&1&&n.\u0275\u0275element(0,"mat-icon",12)}function pi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"mat-list-item",16),n.\u0275\u0275listener("click",function(){const o=n.\u0275\u0275restoreView(t).$implicit,s=n.\u0275\u0275nextContext(3);return n.\u0275\u0275resetView(s.onFormulaItemSelected(o))}),n.\u0275\u0275elementStart(1,"div"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()}if(r&2){const t=e.$implicit;n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function di(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),n.\u0275\u0275text(3),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(4,"mat-action-list"),n.\u0275\u0275template(5,pi,3,1,"mat-list-item",15),n.\u0275\u0275elementEnd()()),r&2){const t=e.$implicit;n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",t.key," "),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngForOf",t.value)}}function fi(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"mat-accordion",13),n.\u0275\u0275template(1,di,6,2,"mat-expansion-panel",14),n.\u0275\u0275pipe(2,"keyvalue"),n.\u0275\u0275elementEnd()),r&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("ngForOf",n.\u0275\u0275pipeBind1(2,1,t.functionItems))}}function hi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"mat-list-item",16),n.\u0275\u0275listener("click",function(){const o=n.\u0275\u0275restoreView(t).$implicit,s=n.\u0275\u0275nextContext(3);return n.\u0275\u0275resetView(s.onFormulaItemSelected(o))}),n.\u0275\u0275elementStart(1,"div"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()}if(r&2){const t=e.$implicit;n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function Ii(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),n.\u0275\u0275text(3),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(4,"mat-action-list"),n.\u0275\u0275template(5,hi,3,1,"mat-list-item",15),n.\u0275\u0275elementEnd()()),r&2){const t=e.$implicit;n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",t.key," "),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngForOf",t.value)}}function gi(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"mat-accordion",13),n.\u0275\u0275template(1,Ii,6,2,"mat-expansion-panel",14),n.\u0275\u0275pipe(2,"keyvalue"),n.\u0275\u0275elementEnd()),r&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("ngForOf",n.\u0275\u0275pipeBind1(2,1,t.operandItems))}}class he{constructor(){this.filteringValue="",this.formulaItems=[],this.formulaItemSelected=new n.EventEmitter}get functionItems(){if(this._groupedFunctionItems)return this._groupedFunctionItems;const e=J.filter(this.formulaItems,t=>t.type===a.ExpressionType.Function);return this._groupedFunctionItems=J.chain(e).map(t=>t).groupBy(t=>Object.keys(u).find(i=>u[i]===t.functionType)).value(),this._groupedFunctionItems}get operandItems(){if(this._groupedOperandItems)return this._groupedOperandItems;const e=J.filter(this.formulaItems,t=>t.type===a.ExpressionType.Operand);return this._groupedOperandItems=J.chain(e).map(t=>t).groupBy(t=>Object.keys(u).find(i=>u[i]===t.operandType)).value(),this._groupedOperandItems}onFormulaItemSelected(e){this.formulaItemSelected.emit(e)}onFilteringValueChanged(e){this.filteringValue=e}static{this.\u0275fac=function(t){return new(t||he)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:he,selectors:[["ts-formula-advanced-toolbar"]],inputs:{formulaItems:"formulaItems"},outputs:{formulaItemSelected:"formulaItemSelected"},decls:13,vars:3,consts:[["searchIcon",""],[1,"formula-advanced-toolbar"],[1,"filter-input-container"],["floatLabel","never"],["matInput","","type","text","spellcheck","false","autocomplete","off","placeholder","Search","data-qa","search-input",3,"input","value"],["matSuffix","","mat-icon-button","","aria-label","Clear","data-qa","clear-filter-btn",3,"click",4,"ngIf","ngIfElse"],[1,"toolbar-items"],["label","Functions"],["matTabContent",""],["label","Operands"],["matSuffix","","mat-icon-button","","aria-label","Clear","data-qa","clear-filter-btn",3,"click"],["matSuffix","","title","Clear",1,"clear-icon"],["matSuffix","",1,"search-icon"],["multi",""],[4,"ngFor","ngForOf"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(t,i){if(t&1){const o=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"mat-form-field",3)(3,"input",4),n.\u0275\u0275listener("input",function(l){return n.\u0275\u0275restoreView(o),n.\u0275\u0275resetView(i.onFilteringValueChanged(l.target.value))}),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(4,li,2,0,"button",5)(5,mi,1,0,"ng-template",null,0,n.\u0275\u0275templateRefExtractor),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(7,"div",6)(8,"mat-tab-group")(9,"mat-tab",7),n.\u0275\u0275template(10,fi,3,3,"ng-template",8),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(11,"mat-tab",9),n.\u0275\u0275template(12,gi,3,3,"ng-template",8),n.\u0275\u0275elementEnd()()()()}if(t&2){const o=n.\u0275\u0275reference(6);n.\u0275\u0275advance(3),n.\u0275\u0275property("value",i.filteringValue),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.filteringValue)("ngIfElse",o)}},dependencies:[f.NgForOf,f.NgIf,C.MatLegacyButton,ue.MatAccordion,ue.MatExpansionPanel,ue.MatExpansionPanelHeader,ue.MatExpansionPanelTitle,et.MatLegacyFormField,et.MatLegacySuffix,_t.MatIcon,Tt.MatLegacyInput,tt.MatLegacyList,tt.MatLegacyListItem,be.MatLegacyTabGroup,be.MatLegacyTab,be.MatLegacyTabContent,f.KeyValuePipe],styles:[".formula-advanced-toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]   .mat-list.mat-list-base.mat-action-list[_ngcontent-%COMP%]   .mat-list-item[_ngcontent-%COMP%]{font-size:13px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{font-size:16px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]{display:flex;flex-direction:row}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{font-size:13px;width:100%}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:Open Sans,Regular,sans-serif;color:#444}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-input-element[_ngcontent-%COMP%]{vertical-align:middle}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-ripple[_ngcontent-%COMP%]{top:1px;height:1px;background:#006ce0}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-underline[_ngcontent-%COMP%]{border-bottom:1px #c8c8c8 solid;background-color:transparent;margin-top:3px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%]{padding-top:5px;margin-bottom:-1.25em}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-empty.mat-form-field-label[_ngcontent-%COMP%]{padding-top:2px;color:#999}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-infix[_ngcontent-%COMP%]{border-top:none}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%], .formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;margin-right:8px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#999;vertical-align:middle}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon.search-icon[_ngcontent-%COMP%]{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiPjxnIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzgwOTViMyIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCI+PGNpcmNsZSBjeD0iNiIgY3k9IjYiIHI9IjQuNSIvPjxwYXRoIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTSA5LjQsOS40IDE0LDE0Ii8+PC9nPjwvc3ZnPg==)}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon.clear-icon[_ngcontent-%COMP%]{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4NCiAgPGcgaWQ9Ikdyb3VwXzIzNTUiIGRhdGEtbmFtZT0iR3JvdXAgMjM1NSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTk0MyAtMjEzNCkiPg0KICAgIDxsaW5lIGlkPSJMaW5lXzE0NiIgZGF0YS1uYW1lPSJMaW5lIDE0NiIgeTE9IjEwIiB4Mj0iMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk0Ni41IDIxMzcuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzc1NzU3NSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgICA8bGluZSBpZD0iTGluZV8xNDciIGRhdGEtbmFtZT0iTGluZSAxNDciIHgyPSIxMCIgeTI9IjEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5NDYuNSAyMTM3LjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM3NTc1NzUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV8xMDkyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSAxMDkyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk0MyAyMTM0KSIgZmlsbD0ibm9uZSIvPg0KICA8L2c+DQo8L3N2Zz4NCg==)}"]})}}class R{static{this.\u0275fac=function(t){return new(t||R)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:R})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[f.CommonModule,tn.FormsModule,C.MatLegacyButtonModule,ue.MatExpansionModule,et.MatLegacyFormFieldModule,_t.MatIconModule,Tt.MatLegacyInputModule,tt.MatLegacyListModule,be.MatLegacyTabsModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(R,{declarations:[he],imports:[f.CommonModule,tn.FormsModule,C.MatLegacyButtonModule,ue.MatExpansionModule,et.MatLegacyFormFieldModule,_t.MatIconModule,Tt.MatLegacyInputModule,tt.MatLegacyListModule,be.MatLegacyTabsModule],exports:[he]})})();var ln=d(59564);class F{constructor(e,t,i){this.code=e,this.itemIndex=t,this.item=i}get invalidItemIndex(){return(this.itemIndex||0)+1}get invalidItemCaption(){return this.item?.caption||""}get interpolateParams(){return[this.invalidItemIndex,this.invalidItemCaption]}}class mn extends F{constructor(e,t,i,o,s){super("invalidFunctionArgumentDataType",e,t),this.argumentIndex=i,this.actualArgumentDataType=o,this.expectedArgumentDataTypes=s,this.message=`Position: ${this.itemIndex}. Invalid data type for argument ${this.argumentIndex} of the '${this.invalidItemCaption}' function. Expected one of '${this._expectedArgumentDataTypesName}' data types, but got '${this._actualArgumentDataTypeName}' data type.`}get _actualArgumentDataTypeName(){return c.DataValueType[this.actualArgumentDataType]}get _expectedArgumentDataTypesName(){return this.expectedArgumentDataTypes.map(e=>c.DataValueType[e]).join(", ")}get interpolateParams(){const e=(this.argumentIndex??0)+1;return[this.invalidItemIndex,e,this.invalidItemCaption,this._actualArgumentDataTypeName,this._expectedArgumentDataTypesName]}}class pn extends F{constructor(e,t,i,o){super("invalidFunctionArgumentsCount",e,t),this.actualArgumentsCount=i,this.expectedArgumentsCount=o,this.message=`Position: ${this.itemIndex}. Wrong number of arguments of the '${this.invalidItemCaption}' function. Expected ${this.expectedArgumentsCount} arguments, but got ${this.actualArgumentsCount} arguments.`}get interpolateParams(){return[this.invalidItemIndex,this.invalidItemCaption,this.actualArgumentsCount,this.expectedArgumentsCount]}}class Vt extends F{constructor(e,t,i){super(e,t),this.maxSupportedNumerLength=i,this.message=this.code==="maxNumberLength"?`Position: ${this.itemIndex}. Maximum number length should not exceed ${this.maxSupportedNumerLength} digits.`:`Position: ${this.itemIndex}. Number precision should not exceed ${this.maxSupportedNumerLength} digits.`}get interpolateParams(){return[this.invalidItemIndex,this.maxSupportedNumerLength]}}class dn{constructor(){this.code="notSupportedOnlyColumn",this.message="Formula expression cannot have one column."}}class _ extends F{constructor(e,t){super("unexpectedItem",e,t),this.message=`Position: ${this.itemIndex}. Unexpected formula item '${this.invalidItemCaption}'.`}}class fn extends _{constructor(e,t){super(e,t),this.code="unexpectedDecimalSeparator",this.message=`Position: ${this.invalidItemIndex}. Unexpected formula item '${this.invalidItemCaption}'. The decimal separator is a '.'.`}}class hn extends F{constructor(e,t){super("divisionByZero",e,t),this.message=`Position: ${this.itemIndex}. Unexpected division by zero.`}}class kt extends F{constructor(e,t){super("missingOperand",e,t),this.message=`Position: ${this.itemIndex}. Missing operand near '${this.invalidItemCaption}'.`}}class zt extends F{constructor(e,t){super(e,t)}}class In extends F{constructor(e,t){super(e,t)}}class gn extends F{constructor(e,t,i,o){super("unsupportedBinaryOperandDataType",e,t),this.leftOperandDataType=i,this.rightOperandDataType=o,this.message=`Position: ${this.itemIndex}. Unsupported operator '${this.invalidItemCaption}' between operand types '${this._leftOperandDataTypeName}' and '${this._rightOperandDataTypeName}'.`}get _leftOperandDataTypeName(){return c.DataValueType[this.leftOperandDataType]}get _rightOperandDataTypeName(){return c.DataValueType[this.rightOperandDataType]}get interpolateParams(){return[this.invalidItemIndex,this.invalidItemCaption,this._leftOperandDataTypeName,this._rightOperandDataTypeName]}}class Ue{constructor(e,t,i){this._formulaDefinitionToItemConverter=e,this._formulaItems=t,this._cursorPosition=i,this.FUNCTION_CURSOR_OFFSET=2}get formulaItems(){return this._formulaItems||[]}set cursorPosition(e){this._cursorPosition=e}get cursorPosition(){const e=this._cursorPosition,t=this.formulaItems.length,i=e<0||e>t;return e&&i?t:e}_insertFormulaItems(e,t){const i=this.cursorPosition;this._formulaItems.splice(i,0,...e),this.cursorPosition=i+t}addItem(e){const t=e.accept(this._formulaDefinitionToItemConverter);let i=t.length;e.type===a.ExpressionType.Function&&(i=e?.parameterDefinitions?.length>0?this.FUNCTION_CURSOR_OFFSET:i),this._insertFormulaItems(t,i)}}class x{constructor(e,t){this._expressionToFormulaItemsConverter=e,this._formulaDefinitionsToItemsConverter=t}toFormula(e){c.ValidationUtilities.checkArgumentEmpty("expression",e);const t=e.accept(this._expressionToFormulaItemsConverter);return new Ue(this._formulaDefinitionsToItemsConverter,t)}static{this.\u0275fac=function(t){return new(t||x)(n.\u0275\u0275inject(a.ExpressionVisitor),n.\u0275\u0275inject(ze))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}class Ge{constructor(e){this._formulaItemsPipe=e}pipeFormulaItems(e){return this._formulaItemsPipe.transform(e)}}class T extends Nt{visitFunctionFormulaItem(e){return{success:!1}}visitConstantOperand(e){return{success:!1}}visitColumnOperand(e){return{success:!1}}visitSysSettingOperand(e){return{success:!1}}visitSysVariableOperand(e){return{success:!1}}visitArithmeticOperator(e){return{success:!1}}visitCommaOperator(e){return{success:!1}}visitParenthesesOperator(e){return{success:!1}}visitPointOperator(e){return{success:!1}}visitRelationOperator(e){return{success:!1}}}class ee extends T{visitFunctionFormulaItem(e){return{success:!0,formulaItem:e}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(ee)))(i||ee)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac})}}class U extends T{visitConstantOperand(e){return{success:!0,formulaItem:e}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(U)))(i||U)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac})}}class V extends U{constructor(){super(...arguments),this._numberDataTypes=[c.DataValueType.Integer,c.DataValueType.Float,c.DataValueType.Money,c.DataValueType.FLOAT1,c.DataValueType.FLOAT2,c.DataValueType.FLOAT3,c.DataValueType.FLOAT4,c.DataValueType.FLOAT8]}visitConstantOperand(e){return this._numberDataTypes.includes(e.dataType)?{success:!0,formulaItem:e}:{success:!1}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(V)))(i||V)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}class Ie extends T{_createSuccessParseResult(e){return{success:!0,formulaItem:e}}visitConstantOperand(e){return this._createSuccessParseResult(e)}visitColumnOperand(e){return this._createSuccessParseResult(e)}visitSysSettingOperand(e){return this._createSuccessParseResult(e)}visitSysVariableOperand(e){return this._createSuccessParseResult(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(Ie)))(i||Ie)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Ie,factory:Ie.\u0275fac})}}class te extends T{visitArithmeticOperator(e){return{success:!0,formulaItem:e}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(te)))(i||te)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac})}}class ge extends T{_createSuccessParseResult(e){return{success:!0,formulaItem:e}}visitArithmeticOperator(e){return this._createSuccessParseResult(e)}visitCommaOperator(e){return this._createSuccessParseResult(e)}visitParenthesesOperator(e){return this._createSuccessParseResult(e)}visitPointOperator(e){return this._createSuccessParseResult(e)}visitRelationOperator(e){return this._createSuccessParseResult(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(ge)))(i||ge)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac})}}class y extends T{visitParenthesesOperator(e){return{success:!0,formulaItem:e}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(y)))(i||y)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac})}}class S extends T{visitPointOperator(e){return{success:!0,formulaItem:e}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(S)))(i||S)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac})}}class De extends T{visitRelationOperator(e){return{success:!0,formulaItem:e}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(De)))(i||De)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac})}}class ne extends T{visitCommaOperator(e){return{success:!0,formulaItem:e}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=n.\u0275\u0275getInheritedFactory(ne)))(i||ne)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}}class ct{constructor(){this._resultStack=[],this._operatorsStack=[],this._operatorsPriority={[a.ArithmeticOperatorType.Addition]:1,[a.ArithmeticOperatorType.Subtraction]:1,[a.ArithmeticOperatorType.Multiplication]:2,[a.ArithmeticOperatorType.Division]:2}}_visitOperand(e){this._resultStack.push(e)}_visitOpeningParenthesesOperator(e){this._resultStack.push(e),this._operatorsStack.push(e)}_visitClosingParenthesesOperator(e){for(;this._hasSavedOperators();){const t=this._operatorsStack.pop();if(this._isOpeningParenthesesOperator(t))break;this._resultStack.push(t)}this._resultStack.push(e)}_hasSavedOperators(){return this._operatorsStack.length>0}_isOpeningParenthesesOperator(e){return(this._isParenthesesOperator(e)&&e).parenthesesType===p.Opening}_isParenthesesOperator(e){return e.operatorType===a.OperatorType.Parentheses}_isArithmeticOperator(e){return e.operatorType===a.OperatorType.Arithmetic}_isHigherPriorityOperator(e,t){return this._operatorsPriority[e.arithmeticOperatorType]>=this._operatorsPriority[t.arithmeticOperatorType]}visitFunctionFormulaItem(e){throw new Error("Method not implemented.")}visitConstantOperand(e){this._visitOperand(e)}visitColumnOperand(e){this._visitOperand(e)}visitSysSettingOperand(e){this._visitOperand(e)}visitSysVariableOperand(e){this._visitOperand(e)}visitArithmeticOperator(e){for(;this._hasSavedOperators();){const t=this._operatorsStack.pop();if(this._isArithmeticOperator(t)&&this._isHigherPriorityOperator(t,e))this._resultStack.push(t);else{this._operatorsStack.push(t);break}}this._operatorsStack.push(e)}visitCommaOperator(e){throw new Error("Method not implemented.")}visitParenthesesOperator(e){e.parenthesesType===p.Opening?this._visitOpeningParenthesesOperator(e):this._visitClosingParenthesesOperator(e)}visitPointOperator(e){}visitRelationOperator(e){throw new Error("Method not implemented.")}toPostfixNotation(e){for(this._resultStack=[],this._operatorsStack=[],e.forEach(t=>t.accept(this));this._hasSavedOperators();)this._resultStack.push(this._operatorsStack.pop());return this._resultStack}static{this.\u0275fac=function(t){return new(t||ct)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ct,factory:ct.\u0275fac})}}class Di{}class ut{constructor(e){this._formulaItemDefinitions=e.getDefinitions()}_getFormulaItemDefinition(e){return this._formulaItemDefinitions.find(t=>t.id===e)}_createAggregationSubQueryOperandExpression(e){return new a.AggregationSubQueryOperandExpression(e.columnPath,e.dataType,e.aggregationType,e.subFilters)}_createColumnOperandExpression(e){return new a.ColumnOperandExpression(e.columnPath,e.dataType)}_createSubQueryOperandExpression(e){return new a.SubQueryOperandExpression(e.columnPath,e.dataType,e.subFilters)}visitFunctionFormulaItem(e){throw new Error("Method not implemented.")}visitConstantOperand(e){const t=new a.ConstOperandExpression(e.value,e.dataType);this._treeStack.push(t)}visitColumnOperand(e){const t=this._getFormulaItemDefinition(e.id);let i;switch(t.columnType){case a.ColumnOperandType.Aggregation:i=this._createAggregationSubQueryOperandExpression(t);break;case a.ColumnOperandType.SchemaColumn:i=this._createColumnOperandExpression(t);break;case a.ColumnOperandType.SubQuery:i=this._createSubQueryOperandExpression(t);break;default:throw new Error(`The '${t.columnType}' column type is not supported.`)}this._treeStack.push(i)}visitSysSettingOperand(e){const t=e.id,i=this._getFormulaItemDefinition(t),o=new a.SysSettingOperandExpression(i.code,i.dataType);this._treeStack.push(o)}visitSysVariableOperand(e){const t=e.id,i=this._getFormulaItemDefinition(t),o=new a.SysVariableOperandExpression(i.name,i.dataType);this._treeStack.push(o)}visitArithmeticOperator(e){const t=this._treeStack.pop(),i=this._treeStack.pop(),o=e.arithmeticOperatorType;if(!t||!i)throw new Error(`Cound to find left or(and) right operands for the '${o}' arithmetic operation.`);const s=new a.ArithmeticOperatorExpression(o,i,t);this._treeStack.push(s)}visitCommaOperator(e){throw new Error("Method not implemented.")}visitParenthesesOperator(e){if(e.parenthesesType===p.Opening)return;const t=this._treeStack.pop();if(!t)throw new Error("Cound not found expression inside parentheses.");const i=new a.ParenthesesOperatorExpression(t);this._treeStack.push(i)}visitPointOperator(e){throw new Error("Method not implemented.")}visitRelationOperator(e){throw new Error("Method not implemented.")}toTree(e){return this._treeStack=[],e.forEach(t=>t.accept(this)),this._treeStack.pop()}static{this.\u0275fac=function(t){return new(t||ut)(n.\u0275\u0275inject(M))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ut,factory:ut.\u0275fac})}}class Oi{}class lt{setNext(e){return this.next=e}transform(e){const t=this.internalTransform(e);return this.next?this.next.transform(t):t}}class yi extends lt{constructor(e,t){super(),this._pointOperantorParser=e,this._constantOperandParser=t}_isNumberOrPoint(e){return this._isPointOperator(e)||e.accept(this._constantOperandParser).success}_isPointOperator(e){const{success:t}=e.accept(this._pointOperantorParser);return t}_createNumericConstant(e){const t=e.map(i=>i.caption).join("");return new z(t)}internalTransform(e){const t=[];let i=[];if(e.forEach(o=>{if(this._isNumberOrPoint(o))i.push(o);else{if(i.length>0){const s=this._createNumericConstant(i);t.push(s),i=[]}t.push(o)}}),i.length>0){const o=this._createNumericConstant(i);t.push(o)}return t}}class We extends Ge{constructor(e,t,i){super(i),this._postfixNotationConverter=e,this._postfixNotationToExpressionConverter=t}toExpression(e){c.ValidationUtilities.checkArgumentEmpty("formula",e);const t=this.pipeFormulaItems(e.formulaItems),i=this._postfixNotationConverter.toPostfixNotation(t);return this._postfixNotationToExpressionConverter.toTree(i)}static{this.\u0275fac=function(t){return new(t||We)(n.\u0275\u0275inject(Di),n.\u0275\u0275inject(Oi),n.\u0275\u0275inject(lt))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac})}}var Mi=d(23648);const Ut="CONST",Gt="COLUMN";class w extends Nt{static _toStringFromOperator(e){return e.id}constructor(e){super(),this._formulaItemDefinitionProvider=e}toString(e){return e.accept(this)}visitArithmeticOperator(e){return w._toStringFromOperator(e)}visitColumnOperand(e){return`${Gt}("${e.id}")`}visitCommaOperator(e){return w._toStringFromOperator(e)}visitConstantOperand(e){return`${Ut}("${e.value}", "${e.dataType}")`}visitFunctionFormulaItem(e){return this._formulaItemDefinitionProvider.getById(e.id).code}visitParenthesesOperator(e){return w._toStringFromOperator(e)}visitPointOperator(e){return w._toStringFromOperator(e)}visitRelationOperator(e){throw new Error("method visitRelationOperator not implemented")}visitSysSettingOperand(e){throw new Error("method visitSysSettingOperand not implemented")}visitSysVariableOperand(e){throw new Error("method visitSysVariableOperand not implemented")}static{this.\u0275fac=function(t){return new(t||w)(n.\u0275\u0275inject(M))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac})}}var ie;(function(r){r.OperatorNode="OperatorNode",r.ConstantNode="ConstantNode",r.SymbolNode="SymbolNode",r.ParenthesisNode="ParenthesisNode",r.FunctionNode="FunctionNode"})(ie||(ie={}));class _i{_createAggregationSubQueryOperandExpression(e){return new a.AggregationSubQueryOperandExpression(e.columnPath,e.dataType,e.aggregationType,e.subFilters)}_createColumnOperandExpression(e){return new a.ColumnOperandExpression(e.columnPath,e.dataType)}_createSubQueryOperandExpression(e){return new a.SubQueryOperandExpression(e.columnPath,e.dataType,e.subFilters)}createFromDefinition(e){switch(e.columnType){case a.ColumnOperandType.Aggregation:return this._createAggregationSubQueryOperandExpression(e);case a.ColumnOperandType.SchemaColumn:return this._createColumnOperandExpression(e);case a.ColumnOperandType.SubQuery:return this._createSubQueryOperandExpression(e);default:throw new Error(`The '${e.columnType}' column type is not supported.`)}}}class re{constructor(e){this._formulaItemDefinitionProvider=e}_fromConstant(e){const t=e.value;let i=c.DataValueType.Text;return typeof t=="number"&&(i=Number(t)===t&&t%1===0?c.DataValueType.Integer:c.DataValueType.Float),new a.ConstOperandExpression(`${e.value}`,i)}_fromOperator(e){const t=e.op,i=(0,a.getArithmeticOperatorTypeFromString)(t),o=e.args[0],s=e.args[1];if(!s)throw new Error(`operator: "${t} with only one node not supporting`);return new a.ArithmeticOperatorExpression(i,this._fromMathjsNode(o),this._fromMathjsNode(s))}_fromSymbol(e){return new a.ConstOperandExpression(e.name,c.DataValueType.Text)}_fromParenthesis(e){return new a.ParenthesesOperatorExpression(this._fromMathjsNode(e.content))}_fromFunction(e){if(e.name===Gt)return this._fromColumnFunction(e);if(e.name===Ut)return this._fromConstantFunction(e);const t=e.name,i=this._formulaItemDefinitionProvider.findWhere({code:t}),o=e.args.map(l=>this._fromMathjsNode(l)),s=an(i,o);return new a.FunctionExpression(s.fnCode,i.returnDefinition.dataType,s.fnArgs)}_fromColumnFunction(e){const i=e.args[0].value,o=this._formulaItemDefinitionProvider.getById(i);return new _i().createFromDefinition(o)}_fromConstantFunction(e){const t=e.args[0],i=e.args[1],o=t.value,s=parseInt(i.value.toString(),10);return new a.ConstOperandExpression(`${o}`,s)}_fromMathjsNode(e){switch(e.type){case ie.OperatorNode:return this._fromOperator(e);case ie.ConstantNode:return this._fromConstant(e);case ie.SymbolNode:return this._fromSymbol(e);case ie.ParenthesisNode:return this._fromParenthesis(e);case ie.FunctionNode:return this._fromFunction(e);default:throw new Error(`Mathjs node:'${e}' not supported`)}}toExpression(e){const t=(0,Mi.parse)(e);return this._fromMathjsNode(t)}static{this.\u0275fac=function(t){return new(t||re)(n.\u0275\u0275inject(M))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac})}}class Oe extends Ge{constructor(e,t,i){super(e),this._mathjsExpressionTextConverter=t,this._mathjsFormulaItemVisitor=i}toExpression(e){const i=this.pipeFormulaItems(e.formulaItems).map(o=>this._mathjsFormulaItemVisitor.toString(o)).join("");return this._mathjsExpressionTextConverter.toExpression(i)}static{this.\u0275fac=function(t){return new(t||Oe)(n.\u0275\u0275inject(lt),n.\u0275\u0275inject(re),n.\u0275\u0275inject(w))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac})}}class Dn extends a.AbstractValidator{get formulaItems(){return this._formulaItems||[]}get currentItem(){return this.formulaItems[this.currentItemIndex]}get currentItemIndex(){return this._currentItemIndex??0}set currentItemIndex(e){this._currentItemIndex=e}constructor(e){super(),this._expressionToFormulaConverter=e}_validateExpression(e){return e?e.accept(this):a.ValidationResult.createSuccess()}validateFunctionExpression(e){return a.ValidationResult.createSuccess()}validateFunctionArgumentExpression(e,t,i){return this._validateExpression(t)}validateAggregationSubQueryOperandExpression(e){return a.ValidationResult.createSuccess()}validateColumnOperandExpression(e){return a.ValidationResult.createSuccess()}validateConstOperandExpression(e){return a.ValidationResult.createSuccess()}validateSubQueryOperandExpression(e){return a.ValidationResult.createSuccess()}validateArithmeticOperatorExpression(e){return a.ValidationResult.createSuccess()}visitFunctionExpression(e){const t=this.validateFunctionExpression(e);this.currentItemIndex++,this.currentItemIndex++;const{fnArgs:i}=Ve(e),o=i.length,s=i.map((l,I)=>{const k=this.validateFunctionArgumentExpression(e,l,I);return I<o-1&&this.currentItemIndex++,k});return this.currentItemIndex++,a.ValidationResult.unionResults(t,...s)}visitAggregationSubQueryOperandExpression(e){const t=this.validateAggregationSubQueryOperandExpression(e);return this.currentItemIndex++,t}visitColumnOperandExpression(e){const t=this.validateColumnOperandExpression(e);return this.currentItemIndex++,t}visitConstOperandExpression(e){const t=this.validateConstOperandExpression(e);return this.currentItemIndex+=String(e.value).length,t}visitSubQueryOperandExpression(e){const t=this.validateSubQueryOperandExpression(e);return this.currentItemIndex++,t}visitSysSettingOperandExpression(e){throw new Error("Method not implemented.")}visitSysVariableOperandExpression(e){throw new Error("Method not implemented.")}visitArithmeticOperatorExpression(e){const t=this._validateExpression(e.leftExpression),i=this.validateArithmeticOperatorExpression(e);this.currentItemIndex++;const o=this._validateExpression(e.rightExpression);return a.ValidationResult.unionResults(t,i,o)}visitParenthesesOperatorExpression(e){this.currentItemIndex++;const t=this._validateExpression(e.expression);return this.currentItemIndex++,t}visitRelationOperatorExpression(e){throw new Error("Method not implemented.")}visitTernaryOperatorExpression(e){throw new Error("Method not implemented.")}validate(e){return e?(this._formulaItems=this._expressionToFormulaConverter.toFormula(e)?.formulaItems,this._currentItemIndex=0,e.accept(this)):a.ValidationResult.createSuccess()}}class On extends Dn{constructor(e,t,i){super(e),this._formulaItemDefinitionProvider=t,this._formulaItemDefinitionConverter=i}getFunctionItem(e){return e&&e.accept(this._formulaItemDefinitionConverter)}getFunctionDefinition(e){const{fnDefinitionId:t}=Ve(e);return this._formulaItemDefinitionProvider.findWhere({id:t})}getParameterDefinition(e,t){return(e&&e.parameterDefinitions||[])[t]}validateFunctionExpression(e){const t=this.getFunctionDefinition(e);return t?this.validateFunctionExpressionByDefinition(e,t):a.ValidationResult.createSuccess()}validateFunctionArgumentExpression(e,t,i){const o=this.getFunctionDefinition(e),s=o?this.validateFunctionArgumentExpressionByDefinition(t,i,o):a.ValidationResult.createSuccess(),l=super.validateFunctionArgumentExpression(e,t,i);return a.ValidationResult.unionResults(s,l)}validateFunctionExpressionByDefinition(e,t){return a.ValidationResult.createSuccess()}validateFunctionArgumentExpressionByDefinition(e,t,i){return a.ValidationResult.createSuccess()}}class ye extends On{constructor(e,t,i){super(e,t,i)}validateFunctionExpressionByDefinition(e,t){const{fnArgs:i}=Ve(e),o=i.length,s=t.parameterDefinitions.length;return o===s?a.ValidationResult.createSuccess():a.ValidationResult.createError([new pn(this.currentItemIndex,this.getFunctionItem(t),o,s)])}static{this.\u0275fac=function(t){return new(t||ye)(n.\u0275\u0275inject(x),n.\u0275\u0275inject(M),n.\u0275\u0275inject(L))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac})}}class Me extends On{constructor(e,t,i){super(e,t,i)}validateFunctionArgumentExpressionByDefinition(e,t,i){const o=this.getParameterDefinition(i,t);if(!o)return a.ValidationResult.createSuccess();const s=e.dataType,l=o.dataTypes;return l.includes(s)?a.ValidationResult.createSuccess():a.ValidationResult.createError([new mn(this.currentItemIndex,this.getFunctionItem(i),t,s,l)])}static{this.\u0275fac=function(t){return new(t||Me)(n.\u0275\u0275inject(x),n.\u0275\u0275inject(M),n.\u0275\u0275inject(L))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Me,factory:Me.\u0275fac})}}class mt extends a.AbstractValidator{validate(e){if(!e)return a.ValidationResult.createSuccess();try{this.validateFormulaItems(e)}catch(t){return a.ValidationResult.createError([t])}return a.ValidationResult.createSuccess()}}class yn extends mt{constructor(e){super(),this.formulaItemParser=e}get formulaItems(){return this._formulaItems}validateFormulaItems(e){this._formulaItems=e,this._formulaItems.forEach((t,i)=>{const{success:o,formulaItem:s}=t.accept(this.formulaItemParser);o&&this.validateFormulaItemNeighbors(s,i)})}}class Ye extends yn{constructor(e,t){super(e),this._parenthesesParser=t}isParenthesesOperator(e,t){const{success:i,formulaItem:o}=e.accept(this._parenthesesParser);return i&&o.parenthesesType===t}}class Mn extends Ye{constructor(e,t){super(e,t)}validateFormulaItemNeighbors(e,t){const i=t+1,o=this.formulaItems[i];if(!o)throw new zt("missingOpeningParentheses",i);if(!this.isParenthesesOperator(o,p.Opening))throw new _(i,o)}}class _n extends mt{constructor(e){super(),this._constantOperandParser=e}validateFormulaItems(e){if(e.length!==1)return;const t=e[e.length-1];if(!t)return;const i=t.type===a.ExpressionType.Operand,{success:o}=t.accept(this._constantOperandParser);if(i&&!o)throw new dn}}class Wt extends mt{constructor(e,t){super(),this._pointOperatorParser=e,this._numericConstantOperandParser=t}isPointOperator(e){const{success:t}=e.accept(this._pointOperatorParser);return t}isNumericConstant(e){const{success:t}=e.accept(this._numericConstantOperandParser);return t}}class Tn extends Wt{constructor(e,t,i,o){super(e,t),this.MAX_NUMBER_LENGTH=i,this.MAX_NUMBER_PRECISION_LENGTH=o}_createMaxNumberLenghtError(e){return new Vt("maxNumberLength",e,this.MAX_NUMBER_LENGTH)}_createMaxNumberPrecisionLenghtError(e){return new Vt("maxNumberPrecisionLength",e,this.MAX_NUMBER_PRECISION_LENGTH)}validateFormulaItems(e){let t=-1,i=!1,o=0,s=0;e.forEach((l,I)=>{if(this.isPointOperator(l)){i=!0;return}if(!this.isNumericConstant(l)){i=!1,o=0,s=0;return}if(o===0&&s===0&&(t=I),i){if(++o>this.MAX_NUMBER_PRECISION_LENGTH)throw this._createMaxNumberPrecisionLenghtError(t)}else if(++s>this.MAX_NUMBER_LENGTH)throw this._createMaxNumberLenghtError(t)})}}class Cn extends Wt{constructor(e,t){super(e,t)}validateFormulaItems(e){let t=!1,i=!1,o=!1;if(e.forEach((I,k)=>{const $t=this.isPointOperator(I),Xt=this.isNumericConstant(I);if($t){if(t||!o)throw new _(k,I);t=!0}else if(Xt)i=t,o=o||!t;else{if(t&&!i)throw new _(k,I);t=!1,i=!1,o=!1}}),i||!t)return;const s=e.length-1,l=e[s];throw new _(s,l)}}class _e extends Ye{constructor(e,t,i){super(e,t),this._operatorParser=i}_isSupportedNextOperand(e,t){const{success:i,formulaItem:o}=t.accept(this.formulaItemParser);if(!i)return!1;const s=o.operandType===a.OperandType.Const;return e.operandType===a.OperandType.Const&&s}_isSupportedNextOperator(e,t){const{success:i,formulaItem:o}=t.accept(this._operatorParser);if(!i||this.isParenthesesOperator(t,p.Opening))return!1;const l=e.operandType===a.OperandType.Const;return!(o.operatorType===a.OperatorType.Point)||l}validateFormulaItemNeighbors(e,t){const i=t+1,o=this.formulaItems[i];if(!o)return;const s=!this._isSupportedNextOperand(e,o),l=!this._isSupportedNextOperator(e,o);if(s&&l)throw new _(i,o)}static{this.\u0275fac=function(t){return new(t||_e)(n.\u0275\u0275inject(T),n.\u0275\u0275inject(T),n.\u0275\u0275inject(T))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac})}}var g;(function(r){r[r.SimpleExpressionWaitsForOperand=0]="SimpleExpressionWaitsForOperand",r[r.FunctionDeclarationWaitsForOpeningParenthesis=1]="FunctionDeclarationWaitsForOpeningParenthesis",r[r.FunctionWaitsForOperand=2]="FunctionWaitsForOperand",r[r.FunctionWaitsForDelimiterOrOperand=3]="FunctionWaitsForDelimiterOrOperand"})(g||(g={}));class xn extends Wt{constructor(e,t,i,o,s){super(e,t),this.commaOperatorParser=i,this.functionParser=o,this.parenthesesParser=s}_processFormulaItem(e,{whenFunctionOperandDelimiter:t,whenFunctionDeclaration:i,whenOpeningParenthesis:o,whenClosingParenthesis:s,whenAnotherItem:l}){return this.isCommaOperator(e)?t():this.isFunction(e)?i():this.isParenthesesOperator(e,p.Opening)?o():this.isParenthesesOperator(e,p.Closing)?s():l()}_throwError(e){const t=e.previousValue&&this.isNumericConstant(e.previousValue),i=e.nextValue&&this.isNumericConstant(e.nextValue);throw t&&i?new fn(e.currentIndex,e.currentValue):new _(e.currentIndex,e.currentValue)}_processSimpleExpressionWaitsForOperandState(e,t){const i={whenFunctionOperandDelimiter:()=>{this._throwError(e)},whenFunctionDeclaration:()=>(t.push(g.FunctionDeclarationWaitsForOpeningParenthesis),t),whenOpeningParenthesis:()=>(t.push(g.SimpleExpressionWaitsForOperand),t),whenClosingParenthesis:()=>(t.length>1&&t.pop(),t),whenAnotherItem:()=>t};return this._processFormulaItem(e.currentValue,i)}_processFunctionDeclarationWaitsForOpeningParenthesisState(e,t){const i={whenFunctionOperandDelimiter:()=>t,whenFunctionDeclaration:()=>t,whenOpeningParenthesis:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t),whenClosingParenthesis:()=>(t.pop(),t),whenAnotherItem:()=>(t.pop(),t)};return this._processFormulaItem(e.currentValue,i)}_processFunctionWaitsForOperandState(e,t){const i={whenFunctionOperandDelimiter:()=>{this._throwError(e)},whenFunctionDeclaration:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t.push(g.FunctionDeclarationWaitsForOpeningParenthesis),t),whenOpeningParenthesis:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t.push(g.SimpleExpressionWaitsForOperand),t),whenClosingParenthesis:()=>(t.pop(),t),whenAnotherItem:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t)};return this._processFormulaItem(e.currentValue,i)}_processFunctionWaitsForDelimiterOrOperandState(e,t){const i={whenFunctionOperandDelimiter:()=>(t[t.length-1]=g.FunctionWaitsForOperand,t),whenFunctionDeclaration:()=>(t.push(g.FunctionDeclarationWaitsForOpeningParenthesis),t),whenOpeningParenthesis:()=>(t.push(g.SimpleExpressionWaitsForOperand),t),whenClosingParenthesis:()=>(t.pop(),t),whenAnotherItem:()=>t};return this._processFormulaItem(e.currentValue,i)}_processSingleState(e,t){switch(t[t.length-1]){case g.SimpleExpressionWaitsForOperand:return this._processSimpleExpressionWaitsForOperandState(e,t);case g.FunctionDeclarationWaitsForOpeningParenthesis:return this._processFunctionDeclarationWaitsForOpeningParenthesisState(e,t);case g.FunctionWaitsForOperand:return this._processFunctionWaitsForOperandState(e,t);case g.FunctionWaitsForDelimiterOrOperand:return this._processFunctionWaitsForDelimiterOrOperandState(e,t);default:return null}}isCommaOperator(e){const{success:t}=e.accept(this.commaOperatorParser);return t}isFunction(e){const{success:t}=e.accept(this.functionParser);return t}isParenthesesOperator(e,t){const{success:i,formulaItem:o}=e.accept(this.parenthesesParser);return i&&o.parenthesesType===t}validateFormulaItems(e){const t=[g.SimpleExpressionWaitsForOperand];e.reduce((i,o,s,l)=>this._processSingleState({currentValue:o,currentIndex:s,previousValue:l[s-1],nextValue:l[s+1]},i),t)}}class Te extends Dn{constructor(e){super(e)}validateArithmeticOperatorExpression(e){if(e.dataType!=null)return a.ValidationResult.createSuccess();const t=e.leftExpression?.dataType,i=e.rightExpression?.dataType;return t==null||i==null?a.ValidationResult.createSuccess():a.ValidationResult.createError([new gn(this.currentItemIndex,this.currentItem,t,i)])}static{this.\u0275fac=function(t){return new(t||Te)(n.\u0275\u0275inject(x))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Te,factory:Te.\u0275fac})}}class Yt extends Ye{_checkIsOperandsExist(e,t){const i=this.formulaItems[t-1],o=this.formulaItems[t+1];if(!i||!o)throw new kt(t,e)}_validateNextOperand(e){const t=e+1,i=this.formulaItems[t],o=i.type===a.ExpressionType.Operator,s=!this.isParenthesesOperator(i,p.Opening);if(o&&s)throw new _(t,i)}validateFormulaItemNeighbors(e,t){this._checkIsOperandsExist(e,t),this._validateNextOperand(t)}}class wn extends Ye{constructor(e,t){super(e,t)}_checkIsOperandsExist(e,t){const i=this.formulaItems[t-1],o=this.formulaItems[t+1];if(!i||!o)throw new kt(t,e)}_validateNextOperand(e){const t=e+1,i=this.formulaItems[t],o=i.type===a.ExpressionType.Operator,s=!this.isParenthesesOperator(i,p.Opening);if(o&&s)throw new _(t,i)}validateFormulaItemNeighbors(e,t){this._checkIsOperandsExist(e,t),this._validateNextOperand(t)}}class vn extends yn{constructor(e,t,i){super(e),this._pointOperatorParser=t,this._numericConstantOperandParser=i}_isNextFormulaItemsZero(e){let t=!1;for(let i=e;i<this.formulaItems.length;i++){const o=this.formulaItems[i];if(this._isPointOperator(o))continue;if(!this._isNumericConstant(o)||(t=this._isZeroNumericConstant(o),!t))break}return t}_isPointOperator(e){const{success:t}=e.accept(this._pointOperatorParser);return t}_isNumericConstant(e){const{success:t}=e.accept(this._numericConstantOperandParser);return t}_isZeroNumericConstant(e){const{success:t,formulaItem:i}=e.accept(this._numericConstantOperandParser);return t&&i.value===String(0)}validateFormulaItemNeighbors(e,t){const i=e.arithmeticOperatorType===a.ArithmeticOperatorType.Division,o=this._isNextFormulaItemsZero(t+1);if(i&&o)throw new hn(t,e)}}class Fn extends mt{constructor(e){super(),this._parenthesesOperatorParser=e}validateFormulaItems(e){let t=0;if(e.forEach((i,o)=>{const{success:s,formulaItem:l}=i.accept(this._parenthesesOperatorParser);if(s)if(l.parenthesesType===p.Opening)t++;else{if(t===0)throw new In("unexpectedClosingParentheses",o);t--}}),t>0)throw new zt("missingClosingParentheses",e.length)}}class Sn extends Ye{constructor(e){super(e,e)}_validateOpeningParentheseNextItem(e,t){const o=this.formulaItems[t-2]?.type===a.ExpressionType.Function,s=this.isParenthesesOperator(e,p.Closing);if(o&&s)return;const l=e.type===a.ExpressionType.Operator,I=!this.isParenthesesOperator(e,p.Opening);if(l&&I)throw new _(t,e)}_validateClosingParentheseNextItem(e,t){const i=e.type!==a.ExpressionType.Operator,o=this.isParenthesesOperator(e,p.Opening);if(i||o)throw new _(t,e)}validateFormulaItemNeighbors(e,t){const i=t+1,o=this.formulaItems[i];o&&(e.parenthesesType===p.Opening?this._validateOpeningParentheseNextItem(o,i):this._validateClosingParentheseNextItem(o,i))}}class En{constructor(){this.code="required",this.message="Formula expression cannot be empty."}}class Nn extends a.AbstractValidator{validate(e){return e&&e.length>0?a.ValidationResult.createSuccess():a.ValidationResult.createError([new En])}}const bn=new Nn,An=new _n(new U),Pn=new Mn(new ee,new y),jn=new Yt(new te,new y),Ln=new wn(new ne,new y),Ti=new Yt(new De,new y),Rn=new Sn(new y),Vn=new _e(new Ie,new y,new ge),kn=new Fn(new y),zn=new vn(new te,new S,new U),Un=new Cn(new S,new V),Gn=(r,e)=>new Tn(new S,new V,r,e),Wn=new xn(new S,new V,new ne,new ee,new y),Qt=new n.InjectionToken("Represents an expression validator"),Qe=new n.InjectionToken("Represents a collection of expression validators"),Bt=new n.InjectionToken("Represents a formula items validator"),Jt=new n.InjectionToken("Represents a collection of formula items validators");class oe{get iconClassName(){switch((this.operatorItemDefinition||{}).operatorType){case a.OperatorType.Arithmetic:case a.OperatorType.Parentheses:return this.operatorItemDefinition.id;default:return null}}static{this.\u0275fac=function(t){return new(t||oe)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:oe,selectors:[["ts-operator-item"]],inputs:{operatorItemDefinition:"operatorItemDefinition"},decls:3,vars:3,consts:[["mat-button","","disableRipple","",1,"operator-item"]],template:function(t,i){t&1&&(n.\u0275\u0275elementStart(0,"button",0)(1,"span"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()),t&2&&(n.\u0275\u0275attribute("data-qa",i.operatorItemDefinition==null?null:i.operatorItemDefinition.caption),n.\u0275\u0275advance(),n.\u0275\u0275attribute("icon",i.iconClassName),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate(i.operatorItemDefinition==null?null:i.operatorItemDefinition.caption))},dependencies:[C.MatLegacyButton],styles:[`ts-operator-item .mat-button.operator-item{color:#54657d;border-radius:0}ts-operator-item .mat-button.operator-item .mat-button-wrapper{text-overflow:ellipsis;display:flex;overflow:hidden}ts-operator-item .mat-button.operator-item [icon]{font-size:0;width:16px;height:16px;display:inline-block;background-position:center;background-repeat:no-repeat}ts-operator-item .mat-button.operator-item [icon="+"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a,.b{fill:none;}.a{stroke:rgba(84, 101, 125, 1);stroke-miterlimit:10;}<\\/style></defs><g transform="translate(2.5 2.5)"><line class="a" x2="12" transform="translate(0 6)"/><line class="a" y1="12" transform="translate(6)"/></g><rect class="b" width="16" height="16"/></svg>')}ts-operator-item .mat-button.operator-item [icon="-"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a,.b{fill:none;}.a{stroke:rgba(84, 101, 125, 1);stroke-miterlimit:10;}<\\/style></defs><g transform="translate(2.5 8.5)"><line class="a" x2="12"/></g><rect class="b" width="16" height="16"/></svg>')}ts-operator-item .mat-button.operator-item [icon="*"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:none;}.b{fill:rgba(84, 101, 125, 1);}<\\/style></defs><rect class="a" width="16" height="16"/><path class="b" d="M5.133-12.156,4.8-9.07l3.109-.867.2,1.422-2.977.242L7.07-5.727l-1.344.734L4.352-7.82,3.1-4.992,1.727-5.727,3.617-8.273.672-8.516.9-9.937l3.055.867-.336-3.086Z" transform="translate(3.328 16.156)"/></svg>')}ts-operator-item .mat-button.operator-item [icon="/"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:none;}.b{fill:rgba(84, 101, 125, 1);}<\\/style></defs><rect class="a" width="16" height="16"/><path class="b" d="M5.711-11.422,1.453,0H.156L4.414-11.422Z" transform="translate(4.844 13.422)"/></svg>')}ts-operator-item .mat-button.operator-item [icon="("]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:rgba(84, 101, 125, 1);}.b{fill:none;}<\\/style></defs><path class="a" d="M.641-4.383a12.106,12.106,0,0,1,.605-3.875,9.633,9.633,0,0,1,1.746-3.164H4.258A11.015,11.015,0,0,0,2.566-8.109,12.32,12.32,0,0,0,2-4.4,11.844,11.844,0,0,0,2.578-.734,11.375,11.375,0,0,0,4.242,2.531H2.992a9.207,9.207,0,0,1-1.75-3.1A11.793,11.793,0,0,1,.641-4.383Z" transform="translate(5.359 12.422)"/><rect class="b" width="16" height="16"/></svg>')}ts-operator-item .mat-button.operator-item [icon=")"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:rgba(84, 101, 125, 1);}.b{fill:none;}<\\/style></defs><path class="a" d="M.641-4.383a12.106,12.106,0,0,1,.605-3.875,9.633,9.633,0,0,1,1.746-3.164H4.258A11.015,11.015,0,0,0,2.566-8.109,12.32,12.32,0,0,0,2-4.4,11.844,11.844,0,0,0,2.578-.734,11.375,11.375,0,0,0,4.242,2.531H2.992a9.207,9.207,0,0,1-1.75-3.1A11.793,11.793,0,0,1,.641-4.383Z" transform="translate(10.641 3.578) rotate(180)"/><rect class="b" width="16" height="16" transform="translate(16 16) rotate(180)"/></svg>')}ts-operator-item:hover{background-color:#f2f5ff}ts-operator-item:active{background-color:#e3e9f9}
`],encapsulation:2})}}function Ci(r,e){if(r&1&&n.\u0275\u0275element(0,"span"),r&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275classMapInterpolate1("",t.iconClassName," button-icon")}}function xi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-operator-item",15),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext().$implicit,s=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275elementEnd()}if(r&2){const t=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275property("operatorItemDefinition",t)}}function wi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",16),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext().$implicit,s=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()}if(r&2){const t=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275attribute("data-qa",t.caption),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function vi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",16),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext().$implicit,s=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()}if(r&2){const t=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275attribute("data-qa",t.caption),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function Fi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",16),n.\u0275\u0275listener("click",function(){const o=n.\u0275\u0275restoreView(t).$implicit,s=n.\u0275\u0275nextContext(4);return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()}if(r&2){const t=e.$implicit;n.\u0275\u0275attribute("data-qa",t.caption),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function Si(r,e){if(r&1&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275elementStart(1,"button",17),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(5,"mat-menu",18,2),n.\u0275\u0275template(7,Fi,2,2,"button",19),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementContainerEnd()),r&2){const t=n.\u0275\u0275reference(6),i=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275advance(),n.\u0275\u0275property("matMenuTriggerFor",t),n.\u0275\u0275attribute("data-qa",n.\u0275\u0275pipeBind1(2,4,i.captionKey)),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(4,6,i.captionKey)," "),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngForOf",i.items)}}function Ei(r,e){if(r&1&&(n.\u0275\u0275elementContainerStart(0)(1,11),n.\u0275\u0275template(2,xi,1,1,"ts-operator-item",12)(3,wi,2,2,"button",13)(4,vi,2,2,"button",13),n.\u0275\u0275elementContainerEnd(),n.\u0275\u0275template(5,Si,8,8,"ng-container",14),n.\u0275\u0275elementContainerEnd()),r&2){const t=e.$implicit,i=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitch",t.type),n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitchCase",i.expressionType.Operator),n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitchCase",i.expressionType.Operand),n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitchCase",i.expressionType.Function),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",i.isGroupItem(t))}}function Ni(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",4)(1,"button",5,0),n.\u0275\u0275template(3,Ci,1,3,"span",6),n.\u0275\u0275elementStart(4,"span",7),n.\u0275\u0275text(5),n.\u0275\u0275elementEnd(),n.\u0275\u0275element(6,"span",8),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(7,"mat-menu",9,1),n.\u0275\u0275template(9,Ei,6,5,"ng-container",10),n.\u0275\u0275elementEnd()()),r&2){const t=n.\u0275\u0275reference(8),i=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("matMenuTriggerFor",t),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",i.iconClassName),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(i.caption),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngForOf",i.formulaItemsDefinitions)}}class Ce{constructor(){this.formulaItemsDefinitions=[],this.caption="",this.iconClassName="",this.formulaItemSelected=new n.EventEmitter,this.expressionType=a.ExpressionType}isGroupItem(e){return e instanceof jt}static{this.\u0275fac=function(t){return new(t||Ce)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:Ce,selectors:[["ts-formula-items-drop-down"]],inputs:{formulaItemsDefinitions:"formulaItemsDefinitions",caption:"caption",iconClassName:"iconClassName"},outputs:{formulaItemSelected:"formulaItemSelected"},decls:1,vars:1,consts:[["menuTrigger","matMenuTrigger"],["menu","matMenu"],["secondLevelMenu","matMenu"],["class","formula-item-drop-down",4,"ngIf"],[1,"formula-item-drop-down"],["mat-button","",3,"matMenuTriggerFor"],[3,"class",4,"ngIf"],[1,"caption"],[1,"menu-icon","button-icon"],["yPosition","below",1,"formula-mat-menu"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"operatorItemDefinition","click",4,"ngSwitchCase"],["mat-menu-item","",3,"click",4,"ngSwitchCase"],[4,"ngIf"],[3,"click","operatorItemDefinition"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor"],[1,"formula-mat-menu","second-mat-menu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"]],template:function(t,i){t&1&&n.\u0275\u0275template(0,Ni,10,4,"div",3),t&2&&n.\u0275\u0275property("ngIf",(i.formulaItemsDefinitions==null?null:i.formulaItemsDefinitions.length)>0)},dependencies:[f.NgForOf,f.NgIf,f.NgSwitch,f.NgSwitchCase,C.MatLegacyButton,Q.MatLegacyMenu,Q.MatLegacyMenuItem,Q.MatLegacyMenuTrigger,oe,H.TranslatePipe],styles:[`.formula-item-drop-down{display:inline-block}.formula-item-drop-down:hover{background-color:#f2f5ff}.formula-item-drop-down:active{background-color:#e3e9f9}.formula-item-drop-down .button-icon{display:inline-block;height:16px;width:16px;background-position:center;background-repeat:no-repeat;margin-top:-2px}.formula-item-drop-down .caption{padding:0 8px;font-size:13px}.formula-item-drop-down .mat-menu-trigger{padding:0 10px 0 8px}.formula-item-drop-down .menu-icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojNTQ2NTdkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQgNykiPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTc4Ny43NzktNjcuNDU1bDQsNCw0LTRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTc4Ny43NzkgNjcuNDU1KSIvPjwvZz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+)}.formula-item-drop-down .mat-button{font-size:13px}.formula-item-drop-down .mat-button .mat-button-wrapper{display:flex;align-items:center}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu{border-radius:0}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu.mat-menu-panel{min-height:auto;max-height:200px;width:min-content;margin-top:1px}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu.second-mat-menu{margin:2px 7px 0;max-height:225px}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content:empty{margin:0}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content{padding:0;margin:6px}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content ts-operator-item{display:block;width:100%}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content ts-operator-item .operator-item{width:100%}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item{font-family:Open Sans,Regular,sans-serif;font-size:13px;width:100%;text-align:left;padding:0 32px;line-height:30px;height:30px;color:#444}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button:hover,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item:hover{background-color:#f2f5ff}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button:active,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item:active{background-color:#e3e9f9}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button .mat-button-wrapper,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item .mat-button-wrapper{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block}
`],encapsulation:2})}}function bi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-formula-items-drop-down",5),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275listener("formulaItemSelected",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275elementEnd()}if(r&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(1,2,"localizableStrings.OperatorsMenuCaption"))("formulaItemsDefinitions",t.operators)}}function Ai(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-operator-item",6),n.\u0275\u0275listener("click",function(){const o=n.\u0275\u0275restoreView(t).$implicit,s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275elementEnd()}if(r&2){const t=e.$implicit;n.\u0275\u0275property("operatorItemDefinition",t),n.\u0275\u0275attribute("data-qa",t.caption)}}class xe{constructor(){this.formulaItemsDefinitions=[],this.pinnedFormulaItemsDefinitions=[],this.formulaItemSelected=new n.EventEmitter,this.operands=[],this.functions=[],this.operators=[]}_getFormulaItemDefinitionByType(e){return this.formulaItemsDefinitions.filter(t=>t.type===e)}ngOnInit(){const e=this._getFormulaItemDefinitionByType(a.ExpressionType.Function);this.functions=sn(e),this.operands=this._getFormulaItemDefinitionByType(a.ExpressionType.Operand),this.operators=this._getFormulaItemDefinitionByType(a.ExpressionType.Operator)}static{this.\u0275fac=function(t){return new(t||xe)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:xe,selectors:[["ts-formula-toolbar"]],inputs:{formulaItemsDefinitions:"formulaItemsDefinitions",pinnedFormulaItemsDefinitions:"pinnedFormulaItemsDefinitions"},outputs:{formulaItemSelected:"formulaItemSelected"},decls:7,vars:10,consts:[[1,"formula-toolbar"],["iconClassName","operand-icon","data-qa","operands",3,"formulaItemSelected","caption","formulaItemsDefinitions"],["iconClassName","function-icon","data-qa","functions",3,"formulaItemSelected","caption","formulaItemsDefinitions"],["iconClassName","operator-icon","data-qa","operators",3,"caption","formulaItemsDefinitions","formulaItemSelected",4,"ngIf"],["class","pinned-item",3,"operatorItemDefinition","click",4,"ngFor","ngForOf"],["iconClassName","operator-icon","data-qa","operators",3,"formulaItemSelected","caption","formulaItemsDefinitions"],[1,"pinned-item",3,"click","operatorItemDefinition"]],template:function(t,i){t&1&&(n.\u0275\u0275elementStart(0,"div",0)(1,"ts-formula-items-drop-down",1),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275listener("formulaItemSelected",function(s){return i.formulaItemSelected.emit(s)}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"ts-formula-items-drop-down",2),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275listener("formulaItemSelected",function(s){return i.formulaItemSelected.emit(s)}),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(5,bi,2,4,"ts-formula-items-drop-down",3)(6,Ai,1,2,"ts-operator-item",4),n.\u0275\u0275elementEnd()),t&2&&(n.\u0275\u0275advance(),n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(2,6,"localizableStrings.OperandsMenuCaption"))("formulaItemsDefinitions",i.operands),n.\u0275\u0275advance(2),n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(4,8,"localizableStrings.FunctionsMenuCaption"))("formulaItemsDefinitions",i.functions),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",i.pinnedFormulaItemsDefinitions.length===0),n.\u0275\u0275advance(),n.\u0275\u0275property("ngForOf",i.pinnedFormulaItemsDefinitions))},dependencies:[f.NgForOf,f.NgIf,Ce,oe,H.TranslatePipe],styles:[`.formula-toolbar{display:flex;flex-wrap:wrap;background-color:#fff;border-bottom:1px solid #e7e7e7;border-left:1px solid #e7e7e7;border-right:1px solid #e7e7e7}.formula-toolbar .operator-item,.formula-toolbar .mat-menu-trigger{height:32px;line-height:32px;border-radius:0;color:#444;font-size:13px;font-family:Open Sans,Regular,sans-serif}.formula-toolbar .mat-menu-trigger{border-right:1px solid #e7e7e7}.formula-toolbar .pinned-item .operator-item{max-width:100px;min-width:45px;font-size:20px}.formula-toolbar .operand-icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzU0NjU3ZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9LmN7c3Ryb2tlOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEgMSkiPjxnIGNsYXNzPSJhIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDExKSI+PHJlY3QgY2xhc3M9ImMiIHdpZHRoPSIzIiBoZWlnaHQ9IjMiLz48cmVjdCBjbGFzcz0iYiIgeD0iMC41IiB5PSIwLjUiIHdpZHRoPSIyIiBoZWlnaHQ9IjIiLz48L2c+PGcgY2xhc3M9ImEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYgMTEpIj48cmVjdCBjbGFzcz0iYyIgd2lkdGg9IjMiIGhlaWdodD0iMyIvPjxyZWN0IGNsYXNzPSJiIiB4PSIwLjUiIHk9IjAuNSIgd2lkdGg9IjIiIGhlaWdodD0iMiIvPjwvZz48ZyBjbGFzcz0iYSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTIgMTEpIj48cmVjdCBjbGFzcz0iYyIgd2lkdGg9IjMiIGhlaWdodD0iMyIvPjxyZWN0IGNsYXNzPSJiIiB4PSIwLjUiIHk9IjAuNSIgd2lkdGg9IjIiIGhlaWdodD0iMiIvPjwvZz48ZyBjbGFzcz0iYSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiAwKSI+PHJlY3QgY2xhc3M9ImMiIHdpZHRoPSIzIiBoZWlnaHQ9IjMiLz48cmVjdCBjbGFzcz0iYiIgeD0iMC41IiB5PSIwLjUiIHdpZHRoPSIyIiBoZWlnaHQ9IjIiLz48L2c+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMjIwOS44MTMsMjE5LjU5di00Ljg2NGgxMnY0Ljg2NCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjIxMS4zMTMgLTIwOC4yMjUpIi8+PGxpbmUgY2xhc3M9ImEiIHkyPSI5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3LjUgMi41MDEpIi8+PC9nPjxyZWN0IGNsYXNzPSJiIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48L3N2Zz4=)}.formula-toolbar .operator-icon{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyNC4zLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAxNiAxNiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTYgMTY7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOm5vbmU7fQ0KCS5zdDF7ZmlsbDpub25lO3N0cm9rZTojNTQ2NTdEO3N0cm9rZS1taXRlcmxpbWl0OjEwO30NCjwvc3R5bGU+DQo8ZyBpZD0iR3JvdXBfNzcyMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjIxMi44MTMgLTMyOS45NDgpIj4NCgk8ZyBpZD0iUmVjdGFuZ2xlXzY3MjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMjEwLjgxMyAzMjkuOTQ4KSI+DQoJCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xLDBoMTBjMC41NSwwLDEsMC40NSwxLDF2MTRjMCwwLjU1LTAuNDUsMS0xLDFIMWMtMC41NSwwLTEtMC40NS0xLTFWMUMwLDAuNDUsMC40NSwwLDEsMHoiLz4NCgkJPHBhdGggY2xhc3M9InN0MSIgZD0iTTEsMC41aDEwYzAuMjgsMCwwLjUsMC4yMiwwLjUsMC41djE0YzAsMC4yOC0wLjIyLDAuNS0wLjUsMC41SDFjLTAuMjgsMC0wLjUtMC4yMi0wLjUtMC41VjENCgkJCUMwLjUsMC43MiwwLjcyLDAuNSwxLDAuNXoiLz4NCgk8L2c+DQoJPGcgaWQ9IlJlY3RhbmdsZV82NzI3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjIwOC44MTMgMzMxLjk0OCkiPg0KCQk8cmVjdCBjbGFzcz0ic3QwIiB3aWR0aD0iOCIgaGVpZ2h0PSI0Ii8+DQoJCTxyZWN0IHg9IjAuNSIgeT0iMC41IiBjbGFzcz0ic3QxIiB3aWR0aD0iNyIgaGVpZ2h0PSIzIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjcyOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDMzNi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjcyOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDMzNi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDMzNi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDMzOC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDMzOC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDMzOC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDM0MC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDM0MC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDM0MC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDM0Mi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDM0Mi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDM0Mi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KPC9nPg0KPHJlY3QgaWQ9IlJlY3RhbmdsZV82NzQwIiBjbGFzcz0ic3QwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz4NCjwvc3ZnPg0K)}.formula-toolbar .function-icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojNTQ2NTdkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuNTU4IDEuNTg1KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMjQwOS4zNjcsMjk0LjkxOWwtLjEzMS40ODNoLTEuMDdsLS44LDMuMmExOS4xNzEsMTkuMTcxLDAsMCwxLTEuMDc3LDMuMjc0LDUuNjUzLDUuNjUzLDAsMCwxLTEuNjU1LDIuMjU1LDIuMzIzLDIuMzIzLDAsMCwxLTEuMzQ4LjQ3NiwxLjEwNiwxLjEwNiwwLDAsMS0uNzQ3LS4yNjMuNTgxLjU4MSwwLDAsMS0uMjI3LS40NzYuNTM0LjUzNCwwLDAsMSwuMTg3LS40MDcuNjQ4LjY0OCwwLDAsMSwuNDU3LS4xNzIuNDc3LjQ3NywwLDAsMSwuMzM0LjEyNS4zNzguMzc4LDAsMCwxLC4xMzUuMjg1LjQuNCwwLDAsMS0uMTU0LjNxLS4xMTcuMS0uMTE3LjE1M2EuMTIuMTIsMCwwLDAsLjA1MS4xLjMzNi4zMzYsMCwwLDAsLjIuMDUxLDEuMzQ1LDEuMzQ1LDAsMCwwLC42NjMtLjIsMS45LDEuOSwwLDAsMCwuNjE5LS41ODksNC40ODcsNC40ODcsMCwwLDAsLjUxMy0xLjEzMnEuMS0uMzA4LjU0OS0yLjAyOWwxLjI3NS00Ljk1OGgtMS4yNzVsLjEtLjQ4M2EyLjg4OCwyLjg4OCwwLDAsMCwuODQ5LS4wODUsMS4wMjQsMS4wMjQsMCwwLDAsLjQ0My0uMzIyLDQuODM0LDQuODM0LDAsMCwwLC41MjQtLjg5LDcuMTg5LDcuMTg5LDAsMCwxLC44MjgtMS4zNjIsNCw0LDAsMCwxLDEuMTM4LS45NzgsMi4zNjUsMi4zNjUsMCwwLDEsMS4xMjUtLjMyNiwxLjM0NiwxLjM0NiwwLDAsMSwuODkzLjI4Mi44LjgsMCwwLDEsLjMzNy42MTIuNi42LDAsMCwxLS4xNjguNDMyLjU3MS41NzEsMCwwLDEtLjQzMi4xNzYuNTIyLjUyMiwwLDAsMS0uMzctLjEzMi40MTUuNDE1LDAsMCwxLS4xNDMtLjMxNS42MzMuNjMzLDAsMCwxLC4wOTUtLjI4OS42NDcuNjQ3LDAsMCwwLC4xLS4yMzEuMTg1LjE4NSwwLDAsMC0uMDY2LS4xNTQuNDUzLjQ1MywwLDAsMC0uMjc5LS4wNzMsMS4yOSwxLjI5LDAsMCwwLS44MjguMjkzLDMuMywzLjMsMCwwLDAtLjg3OCwxLjIxNnEtLjIuNDMyLS43MjUsMi4xNDZaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDE2LjQyNyAtMjkwLjk1NikiLz48cGF0aCBjbGFzcz0iYSIgZD0iTS0yNDA3LjA0NSwyOTQuNzQzYTMuMDgyLDMuMDgyLDAsMCwxLC41NDIuNzYxLDEwLjE1NCwxMC4xNTQsMCwwLDEsLjQzMiwxLjM4NWwuNjQ1LS45NjdhNC4wNzgsNC4wNzgsMCwwLDEsLjYyMi0uNjcsMi41MjIsMi41MjIsMCwwLDEsLjY0NS0uNDM2Ljk5Mi45OTIsMCwwLDEsLjM4OC0uMDczLjcyNC43MjQsMCwwLDEsLjUuMTY4LjUzMi41MzIsMCwwLDEsLjE4Ni40MS41MTUuNTE1LDAsMCwxLS4xMDkuMzgxLjY4NS42ODUsMCwwLDEtLjQ2OS4xODMuOTQ0Ljk0NCwwLDAsMS0uMzMtLjA2NiwxLjgzNiwxLjgzNiwwLDAsMC0uNDYxLS4xMTcuNzA4LjcwOCwwLDAsMC0uNDE4LjIwNSw1Ljg0Miw1Ljg0MiwwLDAsMC0xLjA4NCwxLjQ3MmwuNiwyLjUyYTIuMjQyLDIuMjQyLDAsMCwwLC4yMzQuNjkyLjI2MS4yNjEsMCwwLDAsLjE5MS4xMTQuNjEuNjEsMCwwLDAsLjM1OS0uMTY5LDIuODU2LDIuODU2LDAsMCwwLC42ODgtLjg3OWwuMjU2LjEzMmE0LjU4OSw0LjU4OSwwLDAsMS0xLjE3MSwxLjQzNiwxLjE5MiwxLjE5MiwwLDAsMS0uNjgyLjMyMi43MjguNzI4LDAsMCwxLS42NTEtLjQ2MSwxNy45NzIsMTcuOTcyLDAsMCwxLS42MzgtMi40NjEsMTAuMzg4LDEwLjM4OCwwLDAsMS0xLjgzMSwyLjU1NiwxLjM4MiwxLjM4MiwwLDAsMS0uODY0LjM2Ni44LjgsMCwwLDEtLjUzNS0uMjEyLjU2LjU2LDAsMCwxLS4xNzUtLjQzMy41NDIuNTQyLDAsMCwxLC4xNjEtLjQuNTM1LjUzNSwwLDAsMSwuNC0uMTYyLjc3OC43NzgsMCwwLDEsLjUuMjM1LjU0My41NDMsMCwwLDAsLjI5My4xNjguNC40LDAsMCwwLC4yMjctLjExNyw1LjUzOSw1LjUzOSwwLDAsMCwuOTM4LTEuMiwxMS44NzksMTEuODc5LDAsMCwwLC43NzYtMS4zMzNxLS40NTQtMS43OC0uNDkxLTEuODgyYTEuMzY5LDEuMzY5LDAsMCwwLS40MzktLjY3NCwxLjM0NiwxLjM0NiwwLDAsMC0uOC0uMmMtLjExMywwLS4yNDIuMDA1LS4zODkuMDE1di0uMjY0WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjQxNi40MjcgLTI5MC45NTYpIi8+PC9nPjxyZWN0IGNsYXNzPSJiIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48L3N2Zz4=)}
`],encapsulation:2})}}var h=d(50456);class ae{constructor(e,t,i){this._formulaDefinitionToItemConverter=t,this._formulaDefinitionsToItemsConverter=i,this._formulaItemDefinitions=e.getDefinitions()}_convertFormulaItemsToAnotherFormulaItems(e){const t=[];return e&&e.forEach(i=>{switch(i.type){case a.ExpressionType.Operand:t.push(this._convertFormulaOperandToFormulaItem(i));break;case a.ExpressionType.Operator:t.push(this._convertFormulaOperatorToFormulaItem(i));break;case a.ExpressionType.Function:t.push(this._convertFormulaFunctionToFormulaItem(i));break}}),t}_convertFormulaOperandToFormulaItem(e){let t,i;switch(e.operandType){case a.OperandType.Const:t=h.FormulaItemType.Number,i=e?.value;break;case a.OperandType.Column:t=h.FormulaItemType.ColumnOperand;break;default:throw new Error(`not supporting operand type: ${e.operandType}`)}return new h.FormulaItem({id:e.id,type:t,value:i&&i.toString(),caption:e.caption})}_convertFormulaOperatorToFormulaItem(e){switch(e.operatorType){case a.OperatorType.Point:case a.OperatorType.Comma:return new h.FormulaItem({id:e.id,type:h.FormulaItemType.Number,value:e.caption,caption:e.caption});case a.OperatorType.Arithmetic:case a.OperatorType.Parentheses:return new h.FormulaItem({id:e.id,type:h.FormulaItemType.Operator,caption:e.caption});default:throw new Error(`The '${e.operatorType}' operator type is not supported.`)}}_convertFormulaFunctionToFormulaItem(e){return new h.FormulaItem({id:e.id,type:h.FormulaItemType.Function,caption:e.caption})}_convertAnotherFormulaItemsToFormulaItems(e){const t=[];for(const i of e)switch(i.type){case h.FormulaItemType.Operator:case h.FormulaItemType.ColumnOperand:case h.FormulaItemType.Function:const o=this._convertAnotherFormulaItemToFormulaItem(i);t.push(o);break;case h.FormulaItemType.Number:const s=i.value;s==="."?t.push(this._createFormulaItemByDefinitionType(Re,"Point definition not found. Need provide it.")):s===","?t.push(this._createFormulaItemByDefinitionType(Le,"Comma definition not found. Need provide it.")):t.push(this._createNumericConstantOperand(i));break}return t}_createFormulaItemByDefinitionType(e,t){const i=this._formulaItemDefinitions.find(o=>o instanceof e);if(i)return i.accept(this._formulaDefinitionToItemConverter);throw new Error(t)}_createNumericConstantOperand(e){return new z(Number(e.value),c.DataValueType.Integer,e.id,e.caption)}_convertAnotherFormulaItemToFormulaItem(e){const t=e.id||e.caption;let i=this._formulaItemDefinitions.find(o=>o.id===t);if(i||(i=this._formulaItemDefinitions.find(o=>o.caption===e.caption)),!i)throw new Error(`Could not found formula item definition with '${e.id}' id or '${e.caption}' caption.`);return i.accept(this._formulaDefinitionToItemConverter)}convertFormulaToFormulaItems(e){const t=e&&e.formulaItems,i=this._convertFormulaItemsToAnotherFormulaItems(t),o=new h.FormulaItem({type:h.FormulaItemType.Cursor}),s=e&&e.cursorPosition;return i.splice(s,0,o),i}convertFormulaItemsToFormula(e){e=e||[];const t=this._convertAnotherFormulaItemsToFormulaItems([...e]),i=e.findIndex(o=>o.type===h.FormulaItemType.Cursor);return new Ue(this._formulaDefinitionsToItemsConverter,t,i)}static{this.\u0275fac=function(t){return new(t||ae)(n.\u0275\u0275inject(M),n.\u0275\u0275inject(L),n.\u0275\u0275inject(ze))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac})}}class we{constructor(e){this._formulaInputModelsConverter=e,this.formulaChanged=new n.EventEmitter}get formulaItems(){return this._formulaInputModelsConverter.convertFormulaToFormulaItems(this.formula)}onFormulaChanged(e){const t=this._formulaInputModelsConverter.convertFormulaItemsToFormula(e);this.formulaChanged.emit(t)}static{this.\u0275fac=function(t){return new(t||we)(n.\u0275\u0275directiveInject(ae))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:we,selectors:[["ts-formula-input-editor"]],inputs:{formula:"formula"},outputs:{formulaChanged:"formulaChanged"},features:[n.\u0275\u0275ProvidersFeature([ae])],decls:1,vars:2,consts:[[3,"itemsChanged","formulaData","focusFormulaInputOnFormulaDataChange"]],template:function(t,i){t&1&&(n.\u0275\u0275elementStart(0,"ts-formula-editor",0),n.\u0275\u0275listener("itemsChanged",function(s){return i.onFormulaChanged(s)}),n.\u0275\u0275elementEnd()),t&2&&n.\u0275\u0275property("formulaData",i.formulaItems)("focusFormulaInputOnFormulaDataChange",!0)},dependencies:[h.FormulaEditorComponent],styles:[`ts-formula-editor{display:flex}ts-formula-editor .formula-input{padding:0 16px 3px}
`],encapsulation:2})}}class ve{constructor(){this.formulaItems=[],this.pinnedFormulaItems=[],this.formulaChanged=new n.EventEmitter}_emitFormulaChanged(){this.formulaChanged.emit(this.formula)}onFormulaChanged(e){this.formula=e,this._emitFormulaChanged()}onFormulaItemSelected(e){this.formula.addItem(e),this._emitFormulaChanged()}static{this.\u0275fac=function(t){return new(t||ve)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:ve,selectors:[["ts-advanced-formula-editor"]],inputs:{formula:"formula",formulaItems:"formulaItems",pinnedFormulaItems:"pinnedFormulaItems"},outputs:{formulaChanged:"formulaChanged"},decls:5,vars:3,consts:[[1,"editor"],[3,"formulaChanged","formula"],[1,"toolbar"],[3,"formulaItemSelected","formulaItemsDefinitions","pinnedFormulaItemsDefinitions"]],template:function(t,i){t&1&&(n.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"ts-formula-input-editor",1),n.\u0275\u0275listener("formulaChanged",function(s){return i.onFormulaChanged(s)}),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(3,"div",2)(4,"ts-formula-toolbar",3),n.\u0275\u0275listener("formulaItemSelected",function(s){return i.onFormulaItemSelected(s)}),n.\u0275\u0275elementEnd()()()),t&2&&(n.\u0275\u0275advance(2),n.\u0275\u0275property("formula",i.formula),n.\u0275\u0275advance(2),n.\u0275\u0275property("formulaItemsDefinitions",i.formulaItems)("pinnedFormulaItemsDefinitions",i.pinnedFormulaItems))},dependencies:[xe,we],styles:[".editor[_ngcontent-%COMP%]{padding-top:8px;border-top:1px solid #e7e7e7;border-left:1px solid #e7e7e7;border-right:1px solid #e7e7e7;background-color:#fff;overflow-y:auto;max-height:300px;display:flex;flex-direction:column-reverse}"]})}}function Pi(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275elementStart(1,"mat-drawer-container")(2,"mat-drawer",3,1)(4,"ts-formula-advanced-toolbar",4),n.\u0275\u0275listener("formulaItemSelected",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.onFormulaItemSelected(o))}),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"mat-drawer-content",5)(6,"button",6),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275reference(3);return n.\u0275\u0275resetView(o.toggle())}),n.\u0275\u0275text(7),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(8,"ts-advanced-formula-editor",7),n.\u0275\u0275listener("formulaChanged",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.onFormulaChanged(o))}),n.\u0275\u0275elementEnd()()(),n.\u0275\u0275elementContainerEnd()}if(r&2){const t=n.\u0275\u0275reference(3),i=n.\u0275\u0275nextContext();n.\u0275\u0275advance(2),n.\u0275\u0275property("mode","side"),n.\u0275\u0275advance(2),n.\u0275\u0275property("formulaItems",i.formulaItemDefinitions),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",t.opened?"<":">"," "),n.\u0275\u0275advance(),n.\u0275\u0275property("formula",i.formula)("formulaItems",i.formulaItemDefinitions)("pinnedFormulaItems",i.pinnedFormulaItemDefinitions)}}function ji(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-advanced-formula-editor",7),n.\u0275\u0275listener("formulaChanged",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.onFormulaChanged(o))}),n.\u0275\u0275elementEnd()}if(r&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275property("formula",t.formula)("formulaItems",t.formulaItemDefinitions)("pinnedFormulaItems",t.pinnedFormulaItemDefinitions)}}class se{constructor(e,t,i,o,s,l,I,k){this._formulaValidator=t,this._expressionValidator=i,this._expressionFactoryMediator=o,this._expressionToFormulaConverter=s,this._formulaConverter=l,this._formulaDefinitionsToItemsConverter=I,this._dialogService=k,this._formulaCursorPosition=-1,this._formulaItemDefinitions=[],this._pinnedFormulaItemDefinitions=[],this.advancedFormulaToolbarVisible=!1,this.showFunctions=!0,this.expressionChanged=new n.EventEmitter,this.expressionValidated=new n.EventEmitter,this._formulaItemDefinitions=e.getDefinitions(),this._pinnedFormulaItemDefinitions=e.getPinnedDefinitions()}set expression(e){this._formula=e?this._initFormulaFromExpression(e):this._initEmptyFormula(),this._formula.cursorPosition=this._formulaCursorPosition}get formula(){return this._formula}get formulaItemDefinitions(){return this.showFunctions?this._formulaItemDefinitions:this._formulaItemDefinitions.filter(e=>e.type!==a.ExpressionType.Function)}get pinnedFormulaItemDefinitions(){return this._pinnedFormulaItemDefinitions}_initEmptyFormula(){const e=this._createEmptyFormula();return this._validateFormulaItems(e.formulaItems),e}_initFormulaFromExpression(e){return e=this._getSafeExpression(e),this._validateExpression(e),this._createFormulaFromExpression(e)}_getSafeExpression(e){return e instanceof a.Expression?e:this._expressionFactoryMediator.createExpression("expression",e)}_createEmptyFormula(){return new Ue(this._formulaDefinitionsToItemsConverter,[])}_createFormulaFromExpression(e){try{return this._expressionToFormulaConverter.toFormula(e)}catch(t){return this._dialogService.openInfoDialog(t.message),this._initEmptyFormula()}}_onFormulaChanged(e){if(this._formulaCursorPosition=e.cursorPosition,!this._validateFormulaItems(e.formulaItems).success)return;const o=this._formulaConverter.toExpression(e);this._validateExpression(o).success&&this.expressionChanged.emit(o)}_validateFormulaItems(e){const t=this._formulaValidator.validate(e);return this.expressionValidated.emit(t),t}_validateExpression(e){const t=this._expressionValidator.validate(e);return this.expressionValidated.emit(t),t}onFormulaChanged(e){this._onFormulaChanged(e)}onFormulaItemSelected(e){this.formula.addItem(e),this._onFormulaChanged(this.formula)}static{this.\u0275fac=function(t){return new(t||se)(n.\u0275\u0275directiveInject(M),n.\u0275\u0275directiveInject(Bt),n.\u0275\u0275directiveInject(Qt),n.\u0275\u0275directiveInject(a.AbstractExpressionFactoryMediator),n.\u0275\u0275directiveInject(x),n.\u0275\u0275directiveInject(Ge),n.\u0275\u0275directiveInject(ze),n.\u0275\u0275directiveInject(ln.DialogService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:se,selectors:[["ts-formula-designer"]],inputs:{advancedFormulaToolbarVisible:"advancedFormulaToolbarVisible",showFunctions:"showFunctions",expression:"expression"},outputs:{expressionChanged:"expressionChanged",expressionValidated:"expressionValidated"},decls:3,vars:2,consts:[["elseBlock",""],["drawer",""],[4,"ngIf","ngIfElse"],[3,"mode"],[3,"formulaItemSelected","formulaItems"],[1,"drawer-content"],[1,"drawer-toggle-btn",3,"click"],[3,"formulaChanged","formula","formulaItems","pinnedFormulaItems"]],template:function(t,i){if(t&1&&n.\u0275\u0275template(0,Pi,9,6,"ng-container",2)(1,ji,1,3,"ng-template",null,0,n.\u0275\u0275templateRefExtractor),t&2){const o=n.\u0275\u0275reference(2);n.\u0275\u0275property("ngIf",i.advancedFormulaToolbarVisible)("ngIfElse",o)}},dependencies:[he,ve,B.MatDrawer,B.MatDrawerContainer,B.MatDrawerContent,f.NgIf],styles:[`:host mat-drawer-container{height:250px}.drawer-content{display:flex}.drawer-content .drawer-toggle-btn{height:100%;padding:0}ts-advanced-formula-editor{display:block}ts-advanced-formula-editor .formula-input{min-height:90px}
`],encapsulation:2})}}var Yn=d(76923);class Fe{static{this.\u0275fac=function(t){return new(t||Fe)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Fe})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[h.FormulaEditorModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(Fe,{declarations:[we],imports:[h.FormulaEditorModule],exports:[we]})})();class G{static{this.\u0275fac=function(t){return new(t||G)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:G})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[C.MatLegacyButtonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(G,{declarations:[oe],imports:[C.MatLegacyButtonModule],exports:[oe]})})();class Se{static{this.\u0275fac=function(t){return new(t||Se)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Se})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[f.CommonModule,C.MatLegacyButtonModule,Q.MatLegacyMenuModule,G,H.TranslateModule.forChild()]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(Se,{declarations:[Ce],imports:[f.CommonModule,C.MatLegacyButtonModule,Q.MatLegacyMenuModule,G,H.TranslateModule],exports:[Ce]})})();class Ee{static{this.\u0275fac=function(t){return new(t||Ee)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Ee})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[f.CommonModule,Se,G,H.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(Ee,{declarations:[xe],imports:[f.CommonModule,Se,G,H.TranslateModule],exports:[xe]})})();class W{static{this.\u0275fac=function(t){return new(t||W)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:W})}static{this.\u0275inj=n.\u0275\u0275defineInjector({imports:[Ee,Fe]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(W,{declarations:[ve],imports:[Ee,Fe],exports:[ve]})})();class Y{constructor(e,t){this._formulaItemDefinitionProvider=e,this._formulaDefinitionToItemConverter=t}get _formulaItemDefinitions(){return this._formulaItemDefinitionProvider.getDefinitions()}_getFormulaItemDefinition(e){return this._formulaItemDefinitions.find(t=>t.id===e)}_createFormulaOperandItems(e){return[this._createFormulaItemFromDefinition(e.definitionId)]}_createPointOperator(){const e=this._formulaItemDefinitions.find(t=>t instanceof Re);if(e)return e.accept(this._formulaDefinitionToItemConverter);throw new Error("Point definition not found. Need provide it.")}_createCommaOperator(){const e=this._formulaItemDefinitions.find(t=>t instanceof Le);if(e)return e.accept(this._formulaDefinitionToItemConverter);throw new Error("Comma definition not found. Need provide it.")}_createParenthesesOperator(e){const t=this._formulaItemDefinitions.filter(i=>i instanceof fe).find(i=>i.parenthesesType===e);return this._createFormulaItemFromDefinition(t.id)}_createFormulaItemFromDefinition(e){const t=this._getFormulaItemDefinition(e);if(!t)throw new Error(`Definition with id '${e}' not found.`);return t.accept(this._formulaDefinitionToItemConverter)}visitFunctionExpression(e){const t=this._createCommaOperator(),i=this._createParenthesesOperator(p.Opening),o=this._createParenthesesOperator(p.Closing),{fnArgs:s,fnDefinitionId:l}=Ve(e),I=this._createFormulaItemFromDefinition(l),k=s.map(Ne=>Ne.accept(this)),$t=k.length-1,Xt=k.map((Ne,qt)=>qt===$t?Ne:Ne.concat(t)).reduce((Ne,qt)=>Ne.concat(qt),[]);return[I,i,...Xt,o]}visitAggregationSubQueryOperandExpression(e){return this._createFormulaOperandItems(e)}visitColumnOperandExpression(e){return this._createFormulaOperandItems(e)}visitConstOperandExpression(e){return e.definitionId?this._createFormulaOperandItems(e):String(e.value).split("").map(o=>o==="."?this._createPointOperator():new z(Number(o)))}visitSubQueryOperandExpression(e){return this._createFormulaOperandItems(e)}visitSysSettingOperandExpression(e){return this._createFormulaOperandItems(e)}visitSysVariableOperandExpression(e){return this._createFormulaOperandItems(e)}visitArithmeticOperatorExpression(e){const t=e.leftExpression.accept(this),i=e.rightExpression.accept(this),o=this._createFormulaItemFromDefinition(e.definitionId);return[...t,o,...i]}visitParenthesesOperatorExpression(e){const t=this._createParenthesesOperator(p.Opening),i=this._createParenthesesOperator(p.Closing),o=e.expression.accept(this);return[t,...o,i]}visitRelationOperatorExpression(e){const t=e.leftExpression.accept(this),i=e.rightExpression.accept(this),o=this._createFormulaItemFromDefinition(e.definitionId);return[...t,o,...i]}visitTernaryOperatorExpression(e){throw new Error("Method not implemented.")}static{this.\u0275fac=function(t){return new(t||Y)(n.\u0275\u0275inject(M),n.\u0275\u0275inject(L))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac})}}class ce{static{this.\u0275fac=function(t){return new(t||ce)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:ce})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[ln.DialogService,w,re,x,{provide:a.ExpressionVisitor,useClass:Y},{provide:L,useClass:v},{provide:a.ERROR_TRANSLATION_KEY_PATTERN,useValue:"localizableStrings.Formula{0}"},{provide:Qe,useClass:Te,multi:!0},{provide:Qe,useClass:ye,multi:!0},{provide:Qe,useClass:Me,multi:!0},{provide:Jt,useValue:[bn,An,Pn,jn,Ln,Vn,Rn,kn,zn,Un,Wn,Gn(14,8)]},{provide:Qt,useFactory:(e,t)=>new a.ValidatorTranslateDecorator(e,t),deps:[Qe,a.ValidationErrorTranslateService]},{provide:Bt,useFactory:(e,t)=>new a.ValidatorTranslateDecorator(e,t),deps:[Jt,a.ValidationErrorTranslateService]},{provide:Ge,useClass:Oe},{provide:ze,useClass:q},{provide:lt,useFactory:()=>new yi(new S,new V)}],imports:[a.ExpressionFactoryModule,R,W,Yn.MatLegacyDialogModule,B.MatSidenavModule,f.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(ce,{declarations:[se],imports:[a.ExpressionFactoryModule,R,W,Yn.MatLegacyDialogModule,B.MatSidenavModule,f.CommonModule],exports:[se]})})();class Be{static{this.\u0275fac=function(t){return new(t||Be)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Be})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[{provide:L,useClass:v},{provide:Y,useClass:Y}],imports:[f.CommonModule,R,Q.MatLegacyMenuModule,C.MatLegacyButtonModule,B.MatSidenavModule,W,ce]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(Be,{imports:[f.CommonModule,R,Q.MatLegacyMenuModule,C.MatLegacyButtonModule,B.MatSidenavModule,W,ce],exports:[se]})})();class Li extends x{constructor(e=new a.ExpressionVisitorMock,t=new un){super(e,t)}}const Ri=[new O(a.ArithmeticOperatorType.Addition,"+"),new O(a.ArithmeticOperatorType.Subtraction,"-"),new O(a.ArithmeticOperatorType.Multiplication,"*"),new O(a.ArithmeticOperatorType.Division,"/")],Vi=[new pe(c.DataValueType.Integer,"COLUMN_1"),new pe(c.DataValueType.Integer,"COLUMN_2"),new pe(c.DataValueType.Integer,"AGE"),new At("SYS SYS_SETTING",c.DataValueType.Integer),new Pt("SYS SYS_VARIABLE",c.DataValueType.Integer)],ki=[new m("SUM","SUM",u.Math,[{name:"ARG_1",dataTypes:[c.DataValueType.Float],description:"SUM FUNCTION ARGUMENT 1 DESCRIPTION"},{name:"ARG_2",dataTypes:[c.DataValueType.Float],description:"SUM FUNCTION ARGUMENT 2 DESCRIPTION"}],{dataType:c.DataValueType.Float,description:"SUM FUNCTION RETURN DESCRIPTION"}),new m("DATEDIFF","DATEDIFF",u.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:"DATEDIFF FUNCTION ARGUMENT 1 DESCRIPTION"},{name:"ARG_2",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:"DATEDIFF FUNCTION ARGUMENT 1 DESCRIPTION"}],{dataType:c.DataValueType.DateTime,description:"DATEDIFF FUNCTION RETURN DESCRIPTION"}),new m("DATEDIFFYEARS","DATEDIFFYEARS",u.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""},{name:"ARG_2",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""}],{dataType:c.DataValueType.Integer,description:""}),new m("DATEADDMONTHS","DATEADDMONTHS",u.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""},{name:"ARG_2",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""}],{dataType:c.DataValueType.DateTime,description:""}),new m("DATEPARTDAYS","DATEPARTDAYS",u.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""}],{dataType:c.DataValueType.Integer,description:""})],pt=new m("SUM","SUM",u.Math,[{name:"PARAM 1",dataTypes:[c.DataValueType.Integer],description:""},{name:"PARAM 2",dataTypes:[c.DataValueType.Integer],description:""}],null),Qn=[pt],dt=new pe(c.DataValueType.Float,"COLUMN PATH","COLUMN"),ft=new bt(c.DataValueType.Integer,"SUBQUERY COLUMN PATH",null,"SUBQUERY COLUMN"),ht=new nn(c.DataValueType.Integer,"AGGREGATION COLUMN PATH",c.AggregationType.Avg,null,"AGGREGATION COLUMN"),It=new At("SYS SETTING CODE",c.DataValueType.Integer,"SYS SETTING"),gt=new Pt("SYS VARIABLE NAME",c.DataValueType.Integer,"SYS VARIABLE"),Bn=[dt,ft,ht,It,gt],Je=new O(a.ArithmeticOperatorType.Addition,"+"),He=new O(a.ArithmeticOperatorType.Subtraction,"-"),Ze=new O(a.ArithmeticOperatorType.Multiplication,"*"),Ke=new O(a.ArithmeticOperatorType.Division,"/"),$e=new fe(p.Opening,"("),Xe=new fe(p.Closing,")"),Dt=new Re("."),Ot=new Le(","),yt=new rn(a.RelationOperatorType.Equal,"="),Jn=[Je,He,Ze,Ke,$e,Xe,Dt,Ot],Hn=new xt(pt.id,pt.caption),Zn=new Pe(dt.id,dt.caption),zi=new Pe(ft.id,ft.caption),Ui=new Pe(ht.id,ht.caption),Gi=new wt(It.id,It.caption),Wi=new vt(gt.id,gt.caption),qe=(r=c.DataValueType.Integer)=>{const e=Math.round((Math.random()+.1)*10);return new z(e,r)},Ht=new me(Je.id,Je.arithmeticOperatorType,Je.caption),Yi=new me(He.id,He.arithmeticOperatorType,He.caption),Qi=new me(Ze.id,Ze.arithmeticOperatorType,Ze.caption),Kn=new me(Ke.id,Ke.arithmeticOperatorType,Ke.caption),Zt=new it($e.id,$e.parenthesesType,$e.caption),Kt=new it(Xe.id,Xe.parenthesesType,Xe.caption),Bi=new St(Dt.id,Dt.caption),$n=new Ft(Ot.id,Ot.caption),Ji=new Et(yt.id,yt.relationOperationType,yt.caption),Xn=new cn([...Qn,...Bn,...Jn]);class Mt extends Ue{static{this._defaultFormulaItems=[Zn,Ht,Zt,qe(),Ht,qe(),Kt,Kn,Hn,Zt,qe(),$n,qe(),Kt]}static{this._defaultCursorPosition=-1}constructor(e,t){super(new q(new v,Xn),e||Mt._defaultFormulaItems,t||Mt._defaultCursorPosition)}}}}]);
