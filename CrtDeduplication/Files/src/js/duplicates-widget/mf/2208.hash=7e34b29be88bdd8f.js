(self.webpackChunkapp_studio_enterprise_duplicates_widget=self.webpackChunkapp_studio_enterprise_duplicates_widget||[]).push([[2208],{52208:(Le,_e,S)=>{S.r(_e),S.d(_e,{AppendSchemaStateFromUrlService:()=>Y,BaseNavigationOptions:()=>Q,CHILD_HISTORY_STATE_BUILDERS:()=>ee,CHILD_NAVIGATION_TARGETS:()=>ne,CanOpenPageHandler:()=>je,ChildHistoryStateBuilder:()=>le,Crt7XRequestHandler:()=>ge,CrtNavigationGuardsService:()=>U,CrtNavigationModule:()=>ae,CrtNavigationService:()=>j,CrtRouter:()=>O,CrtRouterMock:()=>Ue,CrtUrlSerializer:()=>T,ENTITY_CHILD_HISTORY_STATE_BUILDERS:()=>te,EXECUTION_ZONES_CONTAINER_NAME_FOR_7X:()=>Ne,EntityNavigationOptions:()=>Ee,EntityNavigationTransitionConfigBuilder:()=>b,EntityNavigationTransitionConfigBuilderModule:()=>$,HashLocationStrategy:()=>k,HistoryService:()=>R,HistoryWrapper:()=>W,LocationStrategy:()=>N,ModelInitConfigsGeneratorService:()=>V,ModuleNameReplacer:()=>E,ModuleNavigationOptions:()=>Te,ModuleNavigationTransitionConfigBuilder:()=>P,ModuleNavigationTransitionConfigBuilderModule:()=>G,NAVIGATION_GUARD_TOKEN:()=>de,NAVIGATION_ZONE_NAME:()=>Se,NavigationMode:()=>f,NavigationOptionsTypeEnum:()=>_,NavigationTransitionLocationUtils:()=>ce,NavigationUtils:()=>d.NavigationUtils,RecordUrlCreatorService:()=>L,SCHEMA_CHILD_HISTORY_STATE_BUILDERS:()=>ie,SHELL_MODULE_ALIASES_FACTORY:()=>ue,SchemaAccessGuard:()=>z,SchemaNavigationOptions:()=>Ce,SchemaNavigationTransitionConfigBuilder:()=>M,SchemaNavigationTransitionConfigBuilderModule:()=>F,UITypePriority:()=>d.UITypePriority,crtChildSegmentsEqual:()=>oe,crtStatesEqual:()=>ve,crtUrlSegmentsEqual:()=>se,findChildSegmentsInContextByTarget:()=>re,getLastNestedChildState:()=>K});var l=S(73308),g=S(28399),u=S(62278),I=S(36486),m=S(38495);const ye="ChainModuleStub",Se="navigation",Ne="ExecutionZones",ne={Modal:"modal"},w={ClassicUI:"7x",FreedomUI:"8x"};var C=S(96590),h=S(21018),s=S(59131);class E{static{this._moduleAliases={CardSchemaViewModule:"Card",PageSchemaViewModule:"Page",SectionSchemaViewModule:"Section"}}static getModuleNameByAlias(e){const t=this._moduleAliases;return Object.keys(t).find(i=>t[i]===e)}static replaceModuleNameByAlias(e){const t=e.split("/");return t[0]=this._moduleAliases[t[0]]||t[0],t.join("/")}static{this.\u0275fac=function(t){return new(t||E)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}const Ie="\\[(.+)\\]";class T{static _parseChildRoutes(e,t){const i=[],a=e.match(Ie);if(a?.length>0){const n=a[1],[o,c]=this._getChildRoutesIndexes(n),p=o>=0&&c>0;let y=n,A;p&&(A=n.substring(o,c+1),y=n.replace(A,"")),y.split(",").forEach((me,Oe)=>{const X=this._getChildSegmentByPath(me);if(X.contextName=`${t}_${X.target}${Oe}`,p){const xe=n.indexOf(me);n.at(xe+me.length)==="["&&(X.children=this._parseChildRoutes(A,X.contextName))}i.push(X)})}return i}static _getChildRoutesIndexes(e){const t=[],i=[],a=[];for(let n=0;n<e.length;n++){const o=e.charAt(n);if(o==="[")t.push(n);else if(o==="]"){const c=t.pop();i.push(c),a.push(n)}}return[i.at(-1),a.at(-1)]}static _getRootSegmentByPath(e){if(!e)return{recordId:void 0,contextName:"root",action:void 0,schemaName:void 0,moduleName:void 0};const t=e.split("/");let i,a,n,o;return t.length===5&&t[0]==="SectionModuleV2"?[i,,a,n,o]=t:[i,a,n,o]=t,{moduleName:E.getModuleNameByAlias(i)||i,schemaName:a,action:n,recordId:o,contextName:"root"}}static _getChildSegmentByPath(e){const t=e.split("=");let i,a;t[1]?(a=t[0],i=t[1]):i=t[0];const[n,o,c]=i.split("/");return{schemaName:n,action:o,recordId:c,target:a}}static parse(e){const i=new URL(e).hash.split("#")[1];return T.parseLocation(i)}static parseLocation(e){const t=e?.indexOf("[");let i,a="";t>=0?(i=e.substring(0,t),a=e.substring(t)):i=e;const n=this._getRootSegmentByPath(i);let o=[];return a&&(o=this._parseChildRoutes(a,n.contextName)),{root:n,children:o}}static getQueryParams(e){const t=e.lastIndexOf("?"),i={};return t<0||e.substring(t+1).split("&").forEach(n=>{const o=n.split("=");i[o[0]]=o[1]}),i}}var d=S(1575);function se(r,e){return r?.moduleName===e?.moduleName&&r?.schemaName===e?.schemaName&&r?.action===e?.action&&r?.recordId===e?.recordId&&r?.contextName===e?.contextName}function oe(r,e){if(!(r?.length===e?.length))return!1;for(let i=0;i<r?.length;i++){const a=se(r[i],e[i]),n=oe(r[i].children,e[i].children),o=r[i].target===e[i].target;if(!(a&&n?o:!1))return!1}return!0}function re(r,e,t,i){let a=[];return(0,g.isEmpty)(t)||t.forEach(n=>{const o=i===r,c=n.target===e;if(o&&c)a.push(n);else{const y=re(r,e,n?.children,n.contextName);a=[...a,...y]}}),a}function fe(r){const e=(0,g.omit)(r,"historyIndex","children");return e.modelInitConfigs=e.modelInitConfigs?.map(t=>(0,g.omit)(t,"name")),e}function ve(r,e){return(0,g.isEqual)(fe(r),fe(e))}function K(r){const e=r.children||[];return(0,g.isEmpty)(e)?r:K(e[0])}class ce{static _applyRecordId(e,t,i){return e&&e!==m.ModelInPageAction.Add?t+"/"+i:t}static _getLocationByUrlSegment(e){const t=[e.moduleName,e.schemaName,e.action].filter(i=>i&&i!=="undefined").join("/");return this._applyRecordId(e.action,t,e.recordId)}static _getPrevRootLocation(e){const t=T.parseLocation(e);return this._getLocationByUrlSegment(t.root)}static _getRootLocationSegment(e){return{schemaName:e.schemaName,moduleName:e.moduleName,action:e.modelInitConfigs?.[0]?.action,recordId:e.modelInitConfigs?.[0]?.recordId}}static _getRootLocation(e,t){let i;const a=this._getChildrenState(t),{prevLocation:n,isInChain:o}=e;if(n&&(o||!(0,g.isEmpty)(a)))i=this._getPrevRootLocation(n);else{const c=this._getRootLocationSegment(e);i=this._getLocationByUrlSegment(c)}return i}static _getChildrenState(e){return e.children||[]}static _getChildLocationSegment(e){return{schemaName:e.schemaName,action:e.modelInitConfigs?.[0]?.action,recordId:e.modelInitConfigs?.[0]?.recordId}}static _getChildrenLocation(e){let t="";if((0,g.isEmpty)(e))return t;const i=[...e].sort((n,o)=>n.target.localeCompare(o.target));let a="";return i.forEach(n=>{a===n.target?t+=",":(t+=`${n.target}=`,a=n.target);const o=this._getChildLocationSegment(n);t+=this._getLocationByUrlSegment(o);const c=this._getChildrenLocation(n.children);t=t.concat(`${c}`)}),`[${t}]`}static getLocationByState(e,t){const i=this._getRootLocation(e,t),a=this._getChildrenState(t),n=this._getChildrenLocation(a);return i+n}}class N extends h.RootInjectorGuard{constructor(e){super(),this.window=e,this.state$=new u.Subject,this._indexHistoryStates()}_indexHistoryStates(){const e=()=>{const t=this.getState();if(!t||!("historyIndex"in t)){let i;this.previousState?i=this.previousState?.historyIndex+1:i=this.window.history.length-1;const a={...t,historyIndex:i};this.window.history.replaceState(a,"indexState")}};e(),this.window.addEventListener("popstate",e,!0),this._popstateSubscription=new u.Subscription(()=>this.window.removeEventListener("popstate",e))}replaceAliasWithModuleName(e){const t=e.split("/");return t[0]=E.getModuleNameByAlias(t[0])||t[0],t.join("/")}onPopState(e){}prepareExternalUrl(e){}getBaseHref(){return`${this.window.Terrasoft.workspaceBaseUrl}/Shell`}getRoute(e){const i={...T.parse(this.window.location.href),state:e};return this._applyChildStateToChildSegment(i.children,e.children),i}_applyChildStateToChildSegment(e,t){!e||!t||e.forEach((i,a)=>{const n=t[a];i.parameters=n.parameters,i.defaultValues=n.modelInitConfigs?.[0]?.defaultValues,i.children&&this._applyChildStateToChildSegment(i.children,n.children)})}ngOnDestroy(){this._popstateSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||N)(s.\u0275\u0275inject(C.WINDOW_TOKEN))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac,providedIn:"root"})}}class k extends N{constructor(e,t){super(e),this._ngZone=t}get previousState(){return this._previousState}_splitHistoryState(e){const i=e.split("?")[0].split("/"),a={},o=T.parse(this.window.location.href).root;if(a.moduleName=o.moduleName,a.schemaName=o.schemaName,a.operationType=o.action,i.length<=4&&i[3])return a.recordId=o.recordId,a;let c=3;a.operationType!=="add"&&(c=4,i[3]&&(a.recordId=o.recordId));const p=(i.length-c)/2;a.valuePairs=[];for(let y=0;y<p;y++){const A=c+y*2;a.valuePairs[y]={name:i[A],value:i[A+1]}}return a}_getHash(e=this.window.location.href){const t=e.indexOf("#");return t>=0?e.slice(t):"#"+e}_hasOnlyHistoryState(e){const t=Object.keys(e);return t.length===1&&t.includes("historyIndex")}_toHistoryState(e){const t={recordId:e.recordId,schemaName:e.schemaName,moduleName:e.moduleName,operationType:e.action};return t.modelInitConfigs=[{recordId:e.recordId,action:e.action}],t}_toChildHistoryStates(e){const t=[];return e.forEach(i=>{const a=this._toHistoryState(i);a.target=i.target,a.children=[],(0,g.isEmpty)(i.children)||(a.children=this._toChildHistoryStates(i.children)),t.push(a)}),t}_backToReconstructedState(){const e=T.parse(this.window.location.href),t=this._toChildHistoryStates(e.children);if(t.length>0){t.pop();const i=this._toHistoryState(e.root),a={...this.window.history.state,...i,children:t},n={schemaName:a.schemaName,moduleName:a.moduleName,modelInitConfigs:a.modelInitConfigs},o=ce.getLocationByState(n,a);return this._ngZone.run(()=>{this.replaceState(a,"",o)}),!0}return!1}getActivePathInfo(){let e=this.path();return e.charAt(0)==="/"&&(e=e.slice(1)),e=this.replaceAliasWithModuleName(e),this._splitHistoryState(e)}path(e=!1){const t=this._getHash();return e?t:t.slice(1)}pushState(e,t,i){const a=this.getState()||this._previousState||{historyIndex:0};(e??={}).historyIndex=a.historyIndex+1,this.window.history.pushState(e,t,this._getHash(i)),this._previousState=this.getState(),this.state$.next(e)}replaceState(e,t,i){(e??={}).historyIndex=this.getState().historyIndex,this.window.history.replaceState(e,t,this._getHash(i)),this.state$.next(e)}forward(){this.go(1)}back(){if(this.window.history.length<2){this._backToReconstructedState();return}this._previousState=this.getState(),this.go(-1)}go(e){this.window.history.go(e)}getState(){let e=this.window.history.state;if((0,g.isEmpty)(e))return null;if(this._hasOnlyHistoryState(e)){const t=T.parse(this.window.location.href),i=this._toHistoryState(t.root),a=this._toChildHistoryStates(t.children);e={...e,...i,children:a}}return e}ngOnDestroy(){super.ngOnDestroy()}getRelativePath(e){return e?this._getHash(e):""}static{this.\u0275fac=function(t){return new(t||k)(s.\u0275\u0275inject(C.WINDOW_TOKEN),s.\u0275\u0275inject(s.NgZone))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac,providedIn:"root"})}}class Q{}var _;(function(r){r.Entity="entity",r.Schema="schema",r.Module="module"})(_||(_={}));class Ce extends Q{constructor(e){super(),this.type=_.Schema,this.schemaName=e}}class Ee extends Q{constructor(){super(...arguments),this.type=_.Entity}}class Te extends Q{constructor(){super(...arguments),this.type=_.Module}}var f;(function(r){r.Push="push",r.Replace="replace"})(f||(f={}));class le{getState(e){var t=this;return(0,l.A)(function*(){let i={};yield t.enrichState(i,e);const a=e?.state??{};return i={...i,...a},i})()}}var v;(function(r){r.Back="back",r.Forward="forward",r.ExecuteTransition="executeTransition",r.Go="go"})(v||(v={}));class H{static{this._backEvent={type:v.Back}}_addToBucket(e,t){let i=e[t.type];i||(i=[],e[t.type]=i),i.push(t)}_eventBucketsReducer(e,t){return t.type===v.Go&&t.delta===-1?this._addToBucket(e,H._backEvent):this._addToBucket(e,t),e}_prepareForwardEvents(e,t){let i=[];const a=[];for(const n of e)(n.config.mode===f.Push?a:i).push(n);return i.length===0&&t&&a.length>0&&(a[0].config.mode=f.Replace),i.length>0&&(i=[i[i.length-1]]),[...i,...a]}normalize(e){const t=e.reduce(this._eventBucketsReducer.bind(this),{}),i=t[v.Go],a=t[v.Forward];if(i||a)return[...i||[],...a||[]];const n=t[v.Back],o=t[v.ExecuteTransition];return n&&!o?[n[0]]:this._prepareForwardEvents(o,!!n)}static{this.\u0275fac=function(t){return new(t||H)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac,providedIn:"root"})}}const be="navigation";class J{constructor(e,t,i,a){this._zoneService=e,this._normalizer=t,this._logger=i,this._applicationInfo=a,this._queue=[],this._state=h.CrtZoneState.Idle,this.navigationEventsReady$=new s.EventEmitter(!1);const n=e.register(be,h.CrtZoneType.ExecutionTracking);this._stateChangeSubscription=n.onStateChange$.subscribe(this._onStateChange.bind(this))}_onStateChange(e){this._state!==e&&(this._state=e,e===h.CrtZoneState.Idle&&this._execQueue())}_execQueue(){if(!this._queue.length||this._state===h.CrtZoneState.Busy)return;const e=this._normalizer.normalize(this._queue);this._applicationInfo.isDebugEnabled&&this._logger.log(`Executing ${this._queue.length} events as ${e.length}`,this._queue,{sourceEvents:this._queue,normalizedEvents:e}),this._queue=[],this.navigationEventsReady$.next(e)}_push(e){this._queue.push(e),this._execQueue()}pushTransition(e){this._push({type:v.ExecuteTransition,config:e})}push(e,t){this._push({type:e,delta:t})}ngOnDestroy(){this._stateChangeSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||J)(s.\u0275\u0275inject(h.CrtZoneService),s.\u0275\u0275inject(H),s.\u0275\u0275inject(C.LoggerService),s.\u0275\u0275inject(h.ApplicationInfo))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac,providedIn:"root"})}}const ue=new s.InjectionToken("ShellModuleAliasesFactory"),ee=new s.InjectionToken("CHILD_HISTORY_STATE_BUILDERS"),te=new s.InjectionToken("ENTITY_CHILD_HISTORY_STATE_BUILDERS",{factory:()=>{const r=(0,s.inject)(ee,{optional:!0})||[],e=(0,s.inject)(te)||[];return r.concat(e)}}),ie=new s.InjectionToken("SCHEMA_CHILD_HISTORY_STATE_BUILDERS",{factory:()=>{const r=(0,s.inject)(ee,{optional:!0})||[],e=(0,s.inject)(ie)||[];return r.concat(e)}}),de=new s.InjectionToken("Navigation guard");class R{constructor(e,t,i){this._locationStrategy=e,this._navigationQueue=t,this._moduleAliasesFeatureFactory=i,this._handlerChain=m.HandlerChainService.instance,this._onNavigationEventsReadySubscription=this._navigationQueue.navigationEventsReady$.pipe((0,u.switchMap)(a=>this._handleNavigationEvents(a))).subscribe(),this._moduleAliasesFeatureFactory().then(a=>this._moduleAliasesFeatureEnabled=a)}_handleNavigationEvent(e){switch(e.type){case v.Back:this._locationStrategy.back();break;case v.Forward:this._locationStrategy.forward();break;case v.Go:this._locationStrategy.go(e.delta);break}}_handleNavigationEvents(e){var t=this;return(0,l.A)(function*(){const i=e.length-1;for(let a=0;a<e.length;a++){const n=e[a];if(n.type===v.ExecuteTransition){const o=a<i;yield t._executeTransition(n.config,o)}else t._handleNavigationEvent(n)}})()}_changeHistoryStateUsing8xRouting({mode:e,state:t,pageTitle:i,location:a}){if(i=i??"",e===f.Replace)return this.replaceState(t,i,a);if(e===f.Push)return this.pushState(t,i,a)}_changeHistoryStateUsing7xRouting({mode:e,state:t,location:i},a){var n=this;return(0,l.A)(function*(){const o=e===f.Replace?"ReplaceHistoryState":"PushHistoryState";yield n._handlerChain.process({type:"crt.7XRequest",$context:null,action:o,hash:i,stateObj:t,silent:t?.silent??a})})()}_changeHistoryState(e,t,i){var a=this;return(0,l.A)(function*(){t?a._changeHistoryStateUsing8xRouting(e):yield a._changeHistoryStateUsing7xRouting(e,i)})()}_load7xModule({state:e,moduleConfig:t}){var i=this;return(0,l.A)(function*(){const a=e.initConfig,o=d.NavigationUtils.isAngularRouting(e.moduleName)?ye:e.moduleName,c={renderTo:"centerPanel",id:t?.moduleId??e?.moduleId,keepAlive:t?.keepAlive??!0,instanceConfig:a,replaceLastModuleInChain:e.replaceLastModuleInChain};yield i._handlerChain.process({type:"crt.7XRequest",$context:null,action:"LoadModule",moduleName:o,moduleParams:c})})()}_executeTransition(e,t){var i=this;return(0,l.A)(function*(){const a=e.state,n=a.children?.length>0,o=d.NavigationUtils.isAngularRouting(a.moduleName)||n,c=!!a.isInChain;t&&(a.silent=!0,a.moduleId=e.moduleConfig?.moduleId??a?.moduleId),yield i._changeHistoryState(e,o,c),!t&&c&&!n&&(yield i._load7xModule(e))})()}_getProcessedHash(e){return this._moduleAliasesFeatureEnabled?E.replaceModuleNameByAlias(e):e}executeTransition(e){this._navigationQueue.pushTransition(e)}pushState(e,t,i){const a=this._getProcessedHash(i);this._locationStrategy.pushState(e,t,a)}replaceState(e,t,i){const a=this._getProcessedHash(i);this._locationStrategy.replaceState(e,t,a)}go(e){this._navigationQueue.push(v.Go,e)}back(){this._navigationQueue.push(v.Back)}forward(){this._navigationQueue.push(v.Forward)}ngOnDestroy(){this._onNavigationEventsReadySubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||R)(s.\u0275\u0275inject(N),s.\u0275\u0275inject(J),s.\u0275\u0275inject(ue))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"})}}class U{constructor(e,t,i){this._rightsService=e,this._featureService=t,this._navigationGuards=i}_getNavigationOptionType(e){const t=e.operationType||"",a=new URLSearchParams(t.replace("?","")).get("type");return Object.values(_).find(n=>n.toLowerCase()===a?.toLowerCase())}_getIsNeedRedirectByNavigationModule(e){var t=this;return(0,l.A)(function*(){return!(yield t._featureService.getFeatureState("DisableProcessCrtNavigationModuleLink"))&&e==="CrtNavigation"})()}_redirectByPathInfo(e){var t=this;return(0,l.A)(function*(){const i=e.schemaName;if(!i)return Promise.resolve(!1);const a=t._getNavigationOptionType(e);if(!a||a===_.Entity)return Promise.resolve(!1);const n=yield t._getNewTransitionConfig(a,i);return d.NavigationUtils.isAngularRouting(n.state.moduleName)?Promise.resolve(n):Promise.resolve(!0)})()}_getNewTransitionConfig(e,t){return(0,l.A)(function*(){const i={state:{},path:""};if(e===_.Module)i.state.moduleName=t,i.path=t;else if(e===_.Schema){const a=yield d.NavigationUtils.getModuleName(t);i.state.moduleName=a,i.state.schemaName=t,i.path=`${a}/${t}`}return i})()}canActivate(e){var t=this;return(0,l.A)(function*(){if(yield t._getIsNeedRedirectByNavigationModule(e.moduleName))return t._redirectByPathInfo(e);if(!(yield t._featureService.getFeatureState("EnablePageOpeningRestrictions"))||(yield t._rightsService.getCanExecuteOperation("CanBypassPageOpeningRestrictions")))return Promise.resolve(!0);for(const n of t._navigationGuards){const o=yield n.canActivate(e);if(o!==!0)return Promise.resolve(o)}return Promise.resolve(!0)})()}static{this.\u0275fac=function(t){return new(t||U)(s.\u0275\u0275inject(m.RightsService),s.\u0275\u0275inject(m.FeatureService),s.\u0275\u0275inject(de))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}}class O{constructor(e,t,i,a){var n=this;this._location=e,this._moduleAliasesFeatureFactory=t,this._historyService=i,this._navigationGuardsService=a,this._popState$=(0,u.fromEvent)(window,"popstate"),this._navigateStart$=new u.Subject,this._navigateEnd$=new u.Subject,this._prevRoute={},this._currentRoute={},this.navigateStart$=this._navigateStart$.asObservable(),this.navigateEnd$=this._navigateEnd$.asObservable(),this.historyState$=(0,u.merge)((0,u.of)(this._location.getState()),this._location.state$.pipe((0,I.mergeMap)(()=>(0,u.of)(this._location.getState()))),this._popState$.pipe((0,I.mergeMap)(()=>(0,u.of)(this._location.getState())))).pipe((0,I.switchMap)(function(){var o=(0,l.A)(function*(c){const p=yield n._navigationGuardsService.canActivate(n.getActiveRouteInfo());let y=c;if(p===!1)throw new Error("Navigation prevented.");if(p!==void 0&&typeof p!="boolean"){const A=n._location.path();n._historyService.replaceState(p.state,p.title||"",p.path||A),y=p.state}return y});return function(c){return o.apply(this,arguments)}}()),(0,I.tap)(o=>{if(this._moduleAliasesFeatureEnabled){const c=this._location.path();this._shouldReplaceModuleNameByAlias(c)&&this._historyService.replaceState(o,"",c)}}),(0,I.share)()),this.location$=(0,u.merge)((0,u.of)(new URL(window.location.href)),this._location.state$.pipe((0,I.mergeMap)(()=>(0,u.of)(new URL(window.location.href)))),this._popState$.pipe((0,I.mergeMap)(()=>(0,u.of)(new URL(window.location.href))))),this.crtRoute$=this.historyState$.pipe((0,u.map)(o=>this._location.getRoute(o)),(0,I.tap)(o=>{this._prevRoute=this._currentRoute,this._currentRoute=o}),(0,u.filter)(o=>!(0,g.isEqual)(this._prevRoute,o)),(0,u.shareReplay)({bufferSize:1,refCount:!1})),this._moduleAliasesFeatureFactory().then(o=>this._moduleAliasesFeatureEnabled=o)}_shouldReplaceModuleNameByAlias(e){return E.replaceModuleNameByAlias(e)!==e}_filterChildrenRoute(e,t){const i=!se(e,this._prevRoute.root),a=!ve(t,this._prevRoute.state);return i||a}onNavigateStart(){this._navigateStart$.next()}onNavigateEnd(){this._navigateEnd$.next()}getNavigation$(e){return this.crtRoute$.pipe((0,u.filter)(t=>{if(e)throw new Error("Not implemented yet");return!(0,g.isEmpty)(t.state?.children)||!(0,g.isEmpty)(this._prevRoute.state?.children)?this._filterChildrenRoute(t.root,t.state):!0}))}getChildNavigation$(e,t){return this.crtRoute$.pipe((0,u.filter)(i=>!oe(i.children,this._prevRoute.children)),(0,u.map)(i=>re(e,t,i.children,i.root.contextName)))}getActiveRouteInfo(){const e=this._location.getActivePathInfo(),t=this._location.getState(),i={moduleName:t&&t.moduleName||e.moduleName,schemaName:t&&t.schemaName||e.schemaName,operationType:e.operationType||t.operation,recordId:e.recordId};return t&&t.isInChain&&(i.isInChain=!0),i}static{this.\u0275fac=function(t){return new(t||O)(s.\u0275\u0275inject(N),s.\u0275\u0275inject(ue),s.\u0275\u0275inject(R),s.\u0275\u0275inject(U))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"})}}class W{constructor(e){this._historyService=e}pushState(e,t,i){this._historyService.pushState(e,t,i)}replaceState(e,t,i){this._historyService.replaceState(e,t,i)}go(e){this._historyService.go(e)}back(){this.go(-1)}forward(){this.go(1)}static{this.\u0275fac=function(t){return new(t||W)(s.\u0275\u0275inject(R))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac,providedIn:"root"})}}var Ae=S(79772),Re=S(29957);class q{constructor(e,t,i){this._window=e,this._locationStrategy=t,this._router=i,this._destroyed$=new u.Subject,this._initListenPopStateEvent(),this._initListenNavigationEndEvent()}_initListenNavigationEndEvent(){this.navigateEnd$=this._router.navigateEnd$.pipe((0,u.map)((0,l.A)(function*(){yield m.HandlerChainService.instance.process({type:"crt.7XRequest",action:"RefreshCacheHash",$context:null})})),(0,u.takeUntil)(this._destroyed$))}_initListenPopStateEvent(){var e=this;this.popState$=(0,u.fromEvent)(this._window,"popstate").pipe((0,u.map)(function(){var t=(0,l.A)(function*({state:i}){(yield e._isHistoryStateChanged(i))&&(yield m.HandlerChainService.instance.process({type:"crt.7XRequest",action:"8xHistoryStateChanged",$context:null,back:e._isBack(i)}))});return function(i){return t.apply(this,arguments)}}()),(0,u.takeUntil)(this._destroyed$))}_isHistoryStateChanged(e){var t=this;return(0,l.A)(function*(){const i=t._locationStrategy.getActivePathInfo(),a=e?.schemaName??i.schemaName;if(!(a&&!(yield d.NavigationUtils.isAngularSchema(a)))){const y=e?.moduleName??i.moduleName;if(!(y&&!a&&!d.NavigationUtils.isAngularRouting(y))&&!e?.isInChain)return!1}const c=t._locationStrategy.previousState?.moduleId===e?.moduleId;return!t._wasChildrenRouting()||!c})()}_wasChildrenRouting(){return this._locationStrategy.previousState?.children?.length>0}_isBack(e){return e?.historyIndex<this._locationStrategy.previousState?.historyIndex}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||q)(s.\u0275\u0275inject(C.WINDOW_TOKEN),s.\u0275\u0275inject(N),s.\u0275\u0275inject(O))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac,providedIn:"root"})}}class x{constructor(e){this.injector=e,this.locationStrategy=e.get(N),this._childHistoryStateBuilders=this.getChildHistoryStateBuilders()||[]}_getChildHistoryStates(e){return Promise.all(this._childHistoryStateBuilders.map(t=>t.getState(e)))}_getPrevChildHistoryStates(e){return e}_getState(e,t){var i=this;return(0,l.A)(function*(){let a=yield i._getChildHistoryStates(t);a=a.filter(p=>!(0,g.isEmpty)(p));let n;(0,g.isEmpty)(a)?n=i.getRootState(e,t):n=yield i._applyChildrenHistoryStates(e,a);const o=i._getPrevChildHistoryStates(e.prevState);return!(0,g.isEmpty)(o?.children)&&(0,g.isEmpty)(a)&&(n.keepAlive=!0),n})()}_applyChildrenHistoryStates(e,t){const i=(0,g.cloneDeep)(e.prevState)??{},a=K(i);return this._setChildrenState(a,t),i}_setChildrenState(e,t){e.children=t}_getLocation(e,t){return ce.getLocationByState(e,t)}_getSchemaUIType(e){return(0,l.A)(function*(){if(e.schemaName)return(yield d.NavigationUtils.isAngularSchema(e.schemaName))?w.FreedomUI:w.ClassicUI})()}getChildHistoryStateBuilders(){return(0,s.inject)(ee,{optional:!0})}getModelInitConfigs(e){return[]}getSchemaName(e,t){return Promise.resolve("")}getStateModuleId(e){return""}getModuleName(e,t){const i=e.schemaUIType===w.ClassicUI?t.state?.moduleName:"";return Promise.resolve(i)}getRootState(e,t){const i={...(0,g.cloneDeep)(t?.state??{})};if(i.isInChain=e.isInChain,i.moduleName=e.moduleName,e.isInChain||(i.moduleId=this.getStateModuleId(e)),e.schemaUIType===w.ClassicUI){const a=e.modelInitConfigs?.[0];i.operation=a?.action,i.primaryColumnValue=a?.recordId,i.valuePairs=d.NavigationUtils.getValuePairs(a?.defaultValues),i.isSeparateMode=!0,i.isInChain&&(i.schemaName=e?.schemaName)}else i.schemaName=e.schemaName,i.modelInitConfigs=e.modelInitConfigs;return i}getModuleConfig({isInChain:e,moduleName:t,prevState:i}){return e?{moduleId:(i?.moduleId??"")+d.NavigationUtils.generateChainModuleId(t)}:null}getCommonTransitionInfo(e){var t=this;return(0,l.A)(function*(){const i=t.locationStrategy.getState(),a={};return a.schemaName=yield t.getSchemaName(a,e),a.schemaUIType=yield t._getSchemaUIType(a),a.navigationState=e.state,a.isInChain=a.navigationState?.isInChain??i?.isInChain,a.modelInitConfigs=t.getModelInitConfigs(e),a.prevState=i,a.prevLocation=t.locationStrategy.path(),a.moduleName=yield t.getModuleName(a,e),a})()}getTransitionConfig(e){var t=this;return(0,l.A)(function*(){const i=yield t.getCommonTransitionInfo(e);if(!i)return null;const a=yield t._getState(i,e),n=t._getLocation(i,a),o=t.getModuleConfig(i);return{mode:e.mode,location:n,state:a,pageTitle:"",moduleConfig:o}})()}buildUrlWithoutState(e){var t=this;return(0,l.A)(function*(){const i=yield t.getCommonTransitionInfo(e),a=t._getLocation(i,{});return t.locationStrategy.getRelativePath(a)})()}static{this.\u0275fac=function(t){return new(t||x)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}class b extends x{getChildHistoryStateBuilders(){return(0,s.inject)(te)}getSchemaName(e,t){return(0,l.A)(function*(){const i=yield d.NavigationUtils.getPageForActionAsync(t.options);return e.page=i,d.NavigationUtils.getCardSchemaName(i)||t.options.entityPageName})()}getModuleName(e,t){var i=()=>super.getModuleName,a=this;return(0,l.A)(function*(){const n=yield i().call(a,e,t);if(n)return n;const o=e.page?.cardModuleName;if(o)return o;const{uiTypePriority:c,entityName:p}=t.options;return d.NavigationUtils.getEditPageModuleName(p,c)||e.schemaName&&d.NavigationUtils.getModuleName(e.schemaName)})()}getCommonTransitionInfo(e){var t=()=>super.getCommonTransitionInfo,i=this;return(0,l.A)(function*(){const a=yield t().call(i,e);return a.moduleName?(a?.schemaUIType===w.ClassicUI&&e.options.action!==m.ModelInPageAction.Edit&&(a.isInChain=!0),a):null})()}getModelInitConfigs(e){const{action:t,defaultValues:i,recordId:a}=e.options;if(!t)return null;const n=i?.filter(c=>c.value),o={action:t};return t===m.ModelInPageAction.Add?o.defaultValues=n:o.recordId=d.NavigationUtils.getRecordLookupValue(a),[o]}getStateModuleId(e){const t=e.modelInitConfigs?.[0];return[e.moduleName,t?.recordId,e.schemaName].filter(Boolean).join("_")}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(b)))(i||b)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac})}}class P extends x{getModuleConfig({navigationState:e}){return{keepAlive:e?.keepAlive??!0}}getRootState(e,t){const i=t.options,a={...t?.state??{}};return a.moduleId=i.moduleId,a.moduleName=i.moduleName,a.parameters=i.parameters,a.initConfig=i.initConfig,a.silent??=!1,a}getModuleName(e,t){const i=e.isInChain?e.prevLocation:t.options?.moduleName;return Promise.resolve(i)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(P)))(i||P)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac})}}class D extends le{enrichState(e,t){e.target=ne.Modal,e.schemaName=t?.options?.schemaName;const{modelInitConfigs:i,parameters:a}=t.options;return a&&(e.parameters=a),i&&(e.modelInitConfigs=i),Promise.resolve()}getState(e){var t=()=>super.getState,i=this;return(0,l.A)(function*(){const a=e?.options?.schemaName;return(0,g.isEmpty)(a)||!(yield d.NavigationUtils.isMiniPage(a))?null:t().call(i,e)})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(D)))(i||D)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})}}class M extends x{_getTransitionConfigWithoutSchemaName(e){const t={...(0,g.cloneDeep)(e?.state??{})};return this.locationStrategy.getState()?.isInChain&&(t.isInChain??=!0),t.moduleId=`${t.moduleName}_`,{mode:e.mode,location:t.moduleName,state:t}}getChildHistoryStateBuilders(){return(0,s.inject)(ie)}getSchemaName(e,t){const{schemaName:i}=t.options;return Promise.resolve(i)}getModuleName(e,t){var i=()=>super.getModuleName,a=this;return(0,l.A)(function*(){return(yield i().call(a,e,t))||d.NavigationUtils.getModuleName(e.schemaName)})()}getRootState(e,t){const i=super.getRootState(e,t),{parameters:a}=t.options;return e.schemaUIType===w.FreedomUI&&a&&(i.parameters=a),i}getModelInitConfigs(e){return e.options.modelInitConfigs}getStateModuleId(e){return[e.moduleName,e.schemaName].filter(Boolean).join("_")}getTransitionConfig(e){if(!e.options.schemaName){const t=this._getTransitionConfigWithoutSchemaName(e);return Promise.resolve(t)}return super.getTransitionConfig(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(M)))(i||M)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac})}}class F{static{this.\u0275fac=function(t){return new(t||F)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:F})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[M,{provide:ie,useClass:D,multi:!0}]})}}class j{constructor(){this._entityTransitionConfigBuilder=(0,s.inject)(b),this._schemaTransitionConfigBuilder=(0,s.inject)(M),this._moduleTransitionConfigBuilder=(0,s.inject)(P),this._navigationEventNotifier=(0,s.inject)(q),this._router=(0,s.inject)(O),this._historyService=(0,s.inject)(R),this._translateService=(0,s.inject)(Ae.TranslateService),this._entitySchemaService=(0,s.inject)(h.EntitySchemaService),this.locationStrategy=(0,s.inject)(N),this.window=(0,s.inject)(C.WINDOW_TOKEN),this.handlerChain=m.HandlerChainService.instance,this._navigationEndEventSubscription=this.subscribeForNavigationEndEvent(),this._navigationPopStateEventSubscription=this.subscribeForNavigationPopStateEvent()}_translate(e){return this._translateService.instant(`Navigation.${e}`)}_getEntityNavigationConfig(e){return{mode:e?.mode??f.Push,state:e?.state??{},options:e.options}}_getEntityTransitionConfig(e){const t=this._getEntityNavigationConfig(e);return this._entityTransitionConfigBuilder.getTransitionConfig(t)}_getSchemaNavigationConfig(e){return{mode:e?.mode??f.Push,state:e?.state??{},options:e.options}}_getSchemaTransitionConfig(e){const t=this._getSchemaNavigationConfig(e);return this._schemaTransitionConfigBuilder.getTransitionConfig(t)}_getModuleNavigationConfig(e){return{mode:e?.mode??f.Push,state:e?.state??{},options:e.options}}_getModuleTransitionConfig(e){const t=this._getModuleNavigationConfig(e);return this._moduleTransitionConfigBuilder.getTransitionConfig(t)}_showEntityNavigationError(e){console.error(this._translate("DoesntHaveAddPageMessage"));const t=e.options.entityName;this._entitySchemaService.getEntitySchemaByName(t).pipe((0,I.map)(i=>i.entitySchema?.uId),(0,u.take)(1)).subscribe(i=>{if(i){const a=this._translate("GoToEntityDesignerMessage"),c=`${(0,h.getWorkspaceBaseUrl)()}ClientApp/#/EntitySchemaDesigner/${i}?callbackAction=RelatedPage`,p=Re.String.format(a,c);console.info(p)}})}executeTransition(e){return this._historyService.executeTransition(e),Promise.resolve()}subscribeForNavigationEndEvent(){return this._navigationEventNotifier.navigateEnd$.subscribe()}subscribeForNavigationPopStateEvent(){return this._navigationEventNotifier.popState$.subscribe()}back(){this._historyService.back()}getState(){return this.locationStrategy.getState()}getCurrentState(){const e=this.getState();return K(e)??e}navigate(e){var t=this;return(0,l.A)(function*(){t._router.onNavigateStart();let i;switch(e.options.type){case _.Schema:i=yield t._getSchemaTransitionConfig(e);break;case _.Entity:if(i=yield t._getEntityTransitionConfig(e),!i){t._router.onNavigateEnd(),t._showEntityNavigationError(e);return}break;case _.Module:i=yield t._getModuleTransitionConfig(e);break}yield t.executeTransition(i)})()}navigateToClientApp(e,t=h.TargetMode.Blank){const i=(0,h.getWorkspaceBaseUrl)(),a=(0,h.joinPath)(i,"ClientApp","#",e);this.window.open(a,t)}getActiveRouteInfo(){return this._router.getActiveRouteInfo()}ngOnDestroy(){this._navigationPopStateEventSubscription.unsubscribe(),this._navigationEndEventSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||j)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac,providedIn:"root"})}}class B extends le{_getMiniPageSchemaName(e){return(0,l.A)(function*(){const t=yield d.NavigationUtils.getPageForActionAsync(e.options),i=t?.schemaGroup==="MiniPage"?t:null;return d.NavigationUtils.getCardSchemaName(i)})()}_getRecordId({options:e}){return typeof e.recordId=="string"?e.recordId:e.recordId?.value}enrichState(e,t){var i=this;return(0,l.A)(function*(){e.schemaName=yield i._getMiniPageSchemaName(t);const{action:a,messageTags:n}=t.options,o={action:a};a===m.ModelInPageAction.Add?o.defaultValues=t.options?.defaultValues?.filter(c=>c.value):o.recordId=i._getRecordId(t),e.modelInitConfigs=[o],e.messageTags=n,e.target=ne.Modal})()}getState(e){var t=()=>super.getState,i=this;return(0,l.A)(function*(){return(yield i._getMiniPageSchemaName(e))?t().call(i,e):null})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(B)))(i||B)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac})}}class ${static{this.\u0275fac=function(t){return new(t||$)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:$})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[b,{provide:te,useClass:B,multi:!0}]})}}class G{static{this.\u0275fac=function(t){return new(t||G)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:G})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[P]})}}class V{_getDefaultValues(e){return e&&e.map(t=>{const i=!(0,g.isUndefined)(t.value)&&!(0,g.isUndefined)(t.displayValue)?t:t.value;return{attributeName:t.name,value:i}})}generate(e){let t=e?.modelInitConfigs;if(!t){const i=e?.operation||e?.operationType;if(i){const a=this._getDefaultValues(e.valuePairs);t=[{action:i,recordId:e.primaryColumnValue||e.recordId,defaultValues:a}]}}return t}static{this.\u0275fac=function(t){return new(t||V)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}class Y{constructor(e){this._locationStrategy=e}shouldAppendState(e){return this._locationStrategy.getActivePathInfo().schemaName===e}appendState(e){const t=this._locationStrategy.getActivePathInfo(),i=this._locationStrategy.path().split("/");e.moduleName??=t.moduleName,e.schemaName??=t.schemaName,e.operationType??=t.operationType;let a=3;if(i.length>4&&e?.operationType!=="add"&&(a=4,i[3]&&(e.recordId=t.recordId)),i.length>4){const n=(i.length-a)/2;e.valuePairs=[];for(let o=0;o<n;o++){const c=a+o*2;e.valuePairs[o]={name:i[c],value:i[c+1]}}}else i[3]&&(e.recordId=t.recordId)}static{this.\u0275fac=function(t){return new(t||Y)(s.\u0275\u0275inject(N))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac})}}class L{constructor(e,t,i){this._location=e,this._entityTransitionConfigBuilder=t,this._featureService=i}_getRecordUrl(e){var t=this;return(0,l.A)(function*(){const i={options:{type:_.Entity,action:m.ModelInPageAction.Edit,...e}},a={mode:f.Push,state:{},options:i.options},o=`#${(yield t._entityTransitionConfigBuilder.getTransitionConfig(a)).location}`;return`${t._location.getBaseHref()}/${o}`})()}getUrl(e){var t=this;return(0,l.A)(function*(){return(yield t._featureService.getFeatureState("DisableEntityRecordUrlCreation"))?yield t._getRecordUrl(e):(0,h.getEntityUrl)(e.entityName,e.recordId)})()}static{this.\u0275fac=function(t){return new(t||L)(s.\u0275\u0275inject(N),s.\u0275\u0275inject(b),s.\u0275\u0275inject(m.FeatureService))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac})}}var he=S(5960);class z{get entityStructure(){return Object.values(window.Terrasoft.configuration.EntityStructure)}get moduleStructure(){return Object.values(window.Terrasoft.configuration.ModuleStructure)}get currentUserWorkplaces(){return window.Terrasoft.configuration.WorkplacesStructure?.CurrentUserWorkplaces}_isSectionExistsInWorkplaces(e){return this.currentUserWorkplaces?.length<1?this.moduleStructure.some(t=>t.sectionSchema===e):this.currentUserWorkplaces.some(t=>t.modules.some(i=>i.sectionName===e))}_isPageAccessible(e){return this.entityStructure.some(t=>t.pages.some(i=>i.cardSchema===e&&(i.isDefault===!0||Object.values(i.actions).some(a=>a===!0))&&i.role!==this._getPageExcludedRole()))}_getPageExcludedRole(){return this._userInfo.isSSP?h.ALL_EMPLOYEES_SYSADMINUNIT_ID:h.ALL_PORTAL_USERS_SYSADMINUNIT_ID}_is7xPageAccessible(e){if(!this._pageExistsInModuleStructure(e)&&!this._userInfo.isSSP)return!0;const t=this.moduleStructure.filter(a=>a.cardSchema===e||a.pages?.some(n=>n.cardSchema===e)).map(a=>a.moduleId);return this.currentUserWorkplaces.flatMap(a=>a.modules).some(a=>t.includes(a.moduleId))}_getRedirectState(){return{state:{moduleName:"Desktop"},path:"Desktop"}}_pageExistsInModuleStructure(e){return this.moduleStructure.some(t=>t.cardSchema===e)}_getRouteTargetType(e){if(e.isInChain)return"ModuleInChain";switch(e.moduleName){case"CardSchemaViewModule":return"FreedomPage";case"CardModuleV2":return"7xPage";case"SectionSchemaViewModule":return"FreedomSection";case"SectionModuleV2":return e.operationType?"7xPage":"7xSection";default:return}}constructor(e){this._injector=e,this._userInfo=this._injector.get(h.UserInfo),this._clientLogService=this._injector.get(h.ClientLogService)}canActivate(e){let t,i;if(this._injector.get(h.ACCESS_CONTROL_WHITELIST)?.includes(e.schemaName))return Promise.resolve(!0);switch(this._getRouteTargetType(e)){case"FreedomSection":case"7xSection":i=h.AclRules.SectionAccess,t=e.schemaName?this._isSectionExistsInWorkplaces(e.schemaName):!0;break;case"FreedomPage":i=h.AclRules.PageAccess,t=this._isPageAccessible(e.schemaName);break;case"7xPage":i=h.AclRules.PageAccess,t=this._is7xPageAccessible(e.schemaName);break;case"ModuleInChain":default:t=!0;break}return t?Promise.resolve(!0):(console.error(new h.AclRightsException().message),this._clientLogService.logError(new h.AclRightsException(e.schemaName,this._userInfo.contactName,i)).subscribe(),Promise.resolve(this._getRedirectState()))}static{this.\u0275fac=function(t){return new(t||z)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac})}}class Z extends h.SchemaAccessService{constructor(e){super(e),this.injector=e,this._navigationService=this.injector.get(j)}_bypassPageOpeningRestrictions(){return this._navigationService.getState().bypassPageOpeningRestrictions}checkAccess(e){var t=()=>super.checkAccess,i=this;return(0,l.A)(function*(){e&&!i._bypassPageOpeningRestrictions()&&(yield t().call(i,e))})()}static{this.\u0275fac=function(t){return new(t||Z)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac,providedIn:"root"})}}const Pe={"zh-TW":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u6CA1\u6709\u65B0\u8BB0\u5F55\u6216\u73B0\u6709\u8BB0\u5F55\u7684\u9875\u9762\u3002\u7CFB\u7EDF\u7BA1\u7406\u5458\u5FC5\u987B\u68C0\u67E5\u81EA\u7531\u754C\u9762\u4E2D\u7684\u6309\u94AE\u8BBE\u7F6E","GoToEntityDesignerMessage":"\u8A2D\u5B9A\u9801\u9762\uFF0C\u8ACB\u524D\u5F80URL: {0}"}}'),"hr-HR":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Ne postoji stranica za nove ili postoje\u0107e zapise. Sistem administrator mora provjeriti postavke tipki u Freedom UI","GoToEntityDesignerMessage":"Za postavljanje stranica idite na URL: {0}"}}'),"lv-LV":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nav lapas ne jaunam, ne eso\u0161am ierakstam. Sist\u0113mas administrators j\u0101p\u0101rbauda pogu iestat\u012Bjumus Freedom UI","GoToEntityDesignerMessage":"Lai iestat\u012Btu lapas, dodieties uz URL: {0}"}}'),"hu-HU":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nincs oldal \xFAj vagy megl\xE9v\u0151 rekordhoz. A rendszergazd\xE1nak ellen\u0151riznie kell a gombbe\xE1ll\xEDt\xE1sokat a Freedom UI-ban","GoToEntityDesignerMessage":"Az oldalak be\xE1ll\xEDt\xE1s\xE1hoz l\xE9pjen a k\xF6vetkez\u0151 URL-re: {0}"}}'),"zh-CN":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u6CA1\u6709\u65B0\u8BB0\u5F55\u6216\u73B0\u6709\u8BB0\u5F55\u7684\u9875\u9762\u3002\u7CFB\u7EDF\u7BA1\u7406\u5458\u5FC5\u987B\u68C0\u67E5\u81EA\u7531\u754C\u9762\u4E2D\u7684\u6309\u94AE\u8BBE\u7F6E","GoToEntityDesignerMessage":"\u8981\u8BBE\u7F6E\u9875\u9762, \u8BF7\u8BBF\u95EEURL: {0}"}}'),"vi-VN":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"uk-UA":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u041D\u0435\u043C\u0430\u0454 \u0441\u0442\u043E\u0440\u0456\u043D\u043A\u0438 \u0434\u043B\u044F \u043D\u043E\u0432\u043E\u0433\u043E \u0430\u0431\u043E \u0456\u0441\u043D\u0443\u044E\u0447\u043E\u0433\u043E \u0437\u0430\u043F\u0438\u0441\u0443. \u0421\u0438\u0441\u0442\u0435\u043C\u043D\u0438\u0439 \u0430\u0434\u043C\u0456\u043D\u0456\u0441\u0442\u0440\u0430\u0442\u043E\u0440 \u043C\u0430\u0454 \u043F\u0435\u0440\u0435\u0432\u0456\u0440\u0438\u0442\u0438 \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u043A\u043D\u043E\u043F\u043E\u043A \u0443 Freedom UI","GoToEntityDesignerMessage":"\u0414\u043B\u044F \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u0441\u0442\u043E\u0440\u0456\u043D\u043E\u043A \u043F\u0435\u0440\u0435\u0439\u0434\u0456\u0442\u044C \u0434\u043E URL: {0}"}}'),"tr-TR":JSON.parse(`{"Navigation":{"DoesntHaveAddPageMessage":"Yeni veya mevcut kay\u0131t i\xE7in bir sayfa yok.Sistem Y\xF6neticisi \xD6zg\xFCrl\xFCk UI'deki d\xFC\u011Fme ayarlar\u0131n\u0131 kontrol etmelidir","GoToEntityDesignerMessage":"Sayfalar\u0131 ayarlamak i\xE7in URL'ye gidin: {0}"}}`),"th-TH":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"sv-SE":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"sq-AL":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nuk ka faqe p\xEBr t\xEB dh\xEBna t\xEB reja ose ekzistuese. Administratori i sistemit duhet t\xEB kontrolloj\xEB butonin e konfigurimit n\xEB Freedom Ul","GoToEntityDesignerMessage":"P\xEBr t\xEB konfiguruar faqet shko te URL:{0}"}}'),"ro-RO":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nu exist\u0103 nicio pagin\u0103 pentru \xEEnregistrarea nou\u0103 sau existent\u0103. Administratorul de sistem trebuie s\u0103 verifice set\u0103rile butonului din Freedom UI","GoToEntityDesignerMessage":"Pentru configurarea paginilor merge\u021Bi la URL: {0}"}}'),"pt-PT":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"pt-BR":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"N\xE3o h\xE1 nenhuma p\xE1gina para os registros novos ou existentes. O administrador do sistema dever\xE1 verificar as configura\xE7\xF5es do bot\xE3o na UI Freedom","GoToEntityDesignerMessage":"Para configurar as p\xE1ginas ir para a URL: {0}"}}'),"pl-PL":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nie ma strony dla nowego lub istniej\u0105cego wpisu. Administrator systemu musi sprawdzi\u0107 ustawienia przycisk\xF3w w interfejsie Freedom UI","GoToEntityDesignerMessage":"Aby skonfigurowa\u0107 strony, przejd\u017A do adresu URL: {0}"}}'),"nl-NL":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"ko-KR":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\uC0C8 \uB808\uCF54\uB4DC \uB610\uB294 \uAE30\uC874 \uB808\uCF54\uB4DC\uC5D0 \uB300\uD55C \uD398\uC774\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. \uC2DC\uC2A4\uD15C \uAD00\uB9AC\uC790\uB294 Freedom UI\uC5D0\uC11C \uBC84\uD2BC \uC124\uC815\uC744 \uD655\uC778\uD574\uC57C \uD569\uB2C8\uB2E4","GoToEntityDesignerMessage":"\uD398\uC774\uC9C0\uB97C \uC124\uC815\uD558\uB824\uBA74 URL\uB85C \uC774\uB3D9\uD569\uB2C8\uB2E4. {0}"}}'),"ja-JP":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u65B0\u898F\u307E\u305F\u306F\u65E2\u5B58\u306E\u30EC\u30B3\u30FC\u30C9\u306E\u30DA\u30FC\u30B8\u306F\u3042\u308A\u307E\u305B\u3093\u3002\u30B7\u30B9\u30C6\u30E0\u7BA1\u7406\u8005\u306FFreedom UI\u306E\u30DC\u30BF\u30F3\u8A2D\u5B9A\u3092\u78BA\u8A8D\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002","GoToEntityDesignerMessage":"\u30DA\u30FC\u30B8\u3092\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3059\u308B\u306B\u306FURL\uFF1A {0} \u306B\u9077\u79FB\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}}'),"it-IT":JSON.parse(`{"Navigation":{"DoesntHaveAddPageMessage":"Non c'\xE8 nessuna pagina per il record nuovo o esistente. L'amministratore di sistema deve controllare le impostazioni del pulsante nella Freedom UI","GoToEntityDesignerMessage":"Per impostare le pagine vai all'URL: {0}"}}`),"id-ID":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Tidak ada halaman untuk catatan baru atau yang sudah ada. Administrator sistem harus memeriksa pengaturan tombol di Freedom UI","GoToEntityDesignerMessage":"Untuk mengatur halaman, buka URL: {0}"}}'),"he-IL":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"fr-FR":JSON.parse(`{"Navigation":{"DoesntHaveAddPageMessage":"Il n'y a pas de page pour les enregistrements nouveaux ou existants. L'administrateur du syst\xE8me doit v\xE9rifier les param\xE8tres du bouton dans l'interface Freedom UI","GoToEntityDesignerMessage":"Pour configurer les pages, allez \xE0 l'URL : {0}"}}`),"es-ES":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"No hay ninguna p\xE1gina para el registro nuevo o existente. El administrador del sistema debe comprobar la configuraci\xF3n del bot\xF3n en la interfaz de usuario de la Freedom","GoToEntityDesignerMessage":"Para configurar p\xE1ginas vaya a la URL: {0}"}}'),"de-DE":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Es gibt keine Seite f\xFCr neue oder bestehende Aufzeichnungen. Systemadministrator muss die Einstellungen der Freiheits-Oberfl\xE4che \xFCberpr\xFCfen","GoToEntityDesignerMessage":"Um Seiten einzurichten, gehen Sie zu URL: {0}"}}'),"cs-CZ":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"bg-BG":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u041D\u044F\u043C\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0430 \u0437\u0430 \u043D\u043E\u0432 \u0438\u043B\u0438 \u0441\u044A\u0449\u0435\u0441\u0442\u0432\u0443\u0432\u0430\u0449 \u0437\u0430\u043F\u0438\u0441. \u0421\u0438\u0441\u0442\u0435\u043C\u043D\u0438\u044F\u0442 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440 \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438\u0442\u0435 \u043D\u0430 \u0431\u0443\u0442\u043E\u043D\u0438\u0442\u0435 \u0432 \u043F\u043E\u0442\u0440\u0435\u0431\u0438\u0442\u0435\u043B\u0441\u043A\u0438\u044F \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441 \u043D\u0430 Freedom","GoToEntityDesignerMessage":"\u0417\u0430 \u0434\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0438\u0448 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0438, \u043E\u0442\u0438\u0434\u0438 \u043D\u0430 URL: {0}"}}'),"ar-SA":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u0644\u0627 \u062A\u0648\u062C\u062F \u0635\u0641\u062D\u0629 \u0644\u0633\u062C\u0644\u0627\u062A \u062C\u062F\u064A\u062F\u0629 \u0623\u0648 \u0645\u0648\u062C\u0648\u062F\u0629. \u064A\u062C\u0628 \u0639\u0644\u0649 \u0645\u0633\u0624\u0648\u0644 \u0627\u0644\u0646\u0638\u0627\u0645 \u0627\u0644\u062A\u062D\u0642\u0642 \u0645\u0646 \u0632\u0631 \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0641\u064A \u0648\u0627\u062C\u0647\u0629 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u0627\u0644\u062D\u0631","GoToEntityDesignerMessage":"\u0644\u0625\u0639\u062F\u0627\u062F \u0627\u0644\u0635\u0641\u062D\u0627\u062A\u060C \u0627\u0630\u0647\u0628 \u0625\u0644\u0649 \u0627\u0644\u0631\u0627\u0628\u0637: {0}"}}'),"en-US":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),"ru-RU":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u0414\u043B\u044F \u0437\u0430\u043F\u0438\u0441\u0438 \u043D\u0435\u0442 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F. \u0421\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u043E\u0432 \u043A\u043D\u043E\u043F\u043A\u0438 \u0432 \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI","GoToEntityDesignerMessage":"\u0414\u043B\u044F \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u0442\u0440\u0430\u043D\u0438\u0446 \u043F\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043F\u043E \u0441\u0441\u044B\u043B\u043A\u0435: {0}"}}')};let ae=class pe{static{this.\u0275fac=function(t){return new(t||pe)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:pe})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[V,L,{provide:N,useClass:k},U,{provide:de,useClass:z,multi:!0},{provide:h.SchemaAccessService,useClass:Z},C.LoggerService,m.RightsService],imports:[C.CrtLibTranslateModule.forRoot({i18n:Pe}),$,F,G]})}};ae=(0,he.__decorate)([(0,m.CrtModule)({requestHandlers:[]})],ae),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(ae,{imports:[C.CrtLibTranslateModule,$,F,G]})}();let ge=class extends m.BaseRequestHandler{constructor(e,t){super(),this._navigationService=e,this._recordUrlCreator=t}_getEntityPageUITypePriority(e){var t=this;return(0,l.A)(function*(){const i=t._navigationService.getActiveRouteInfo().schemaName;return i&&(yield d.NavigationUtils.isAngularListPage(i))&&d.NavigationUtils.getSectionEntityName(i)===e?d.UITypePriority.PreferFreedomUI:d.UITypePriority.Auto})()}_openEntityPage(e,t){var i=this;return(0,l.A)(function*(){const a=t,n=yield i._getEntityPageUITypePriority(a?.entityName);yield i._navigationService.navigate({mode:a.replaceHistoryState?f.Replace:f.Push,options:{type:_.Entity,action:e,uiTypePriority:n,...a}})})()}_openDuplicatesPage(e){var t=this;return(0,l.A)(function*(){yield t._navigationService.navigate({mode:f.Push,state:{duplicatesSchemaName:e.entityName},options:{type:_.Schema,schemaName:e.schemaName}})})()}_getEntityPageUrl(e){var t=this;return(0,l.A)(function*(){const i=e,a=yield t._getEntityPageUITypePriority(i?.entityName);return t._recordUrlCreator.getUrl({uiTypePriority:a,...i})})()}handle(e){var t=this;return(0,l.A)(function*(){const i=e?.payload;switch(e.action){case"BackHistoryState":t._navigationService.back();break;case"AddRecord":yield t._openEntityPage(m.ModelInPageAction.Add,i);break;case"EditRecord":yield t._openEntityPage(m.ModelInPageAction.Edit,i);break;case"CopyRecord":yield t._openEntityPage(m.ModelInPageAction.Copy,i);break;case"OpenDuplicatesPage":yield t._openDuplicatesPage(i);break;case"OpenPage":yield t._navigationService.navigate({mode:f.Push,options:{type:_.Schema,...i}});break;case"HasEntityEditPage":return d.NavigationUtils.hasEntityEditPage(i);case"LoadRightsModule":yield t._navigationService.navigate({mode:f.Push,options:{type:_.Module,initConfig:{moduleConfig:i},moduleId:C.NameGenerator.generateUnique("Rights_module"),moduleName:"Rights"},state:{isInChain:!0,silent:!0,_internalNotSilentIn8x:!0}});break;case"GetRecordUrl":return t._getEntityPageUrl(i);case"IsTelephonyEnabled":case"InitDataViews":break}return t.next?.handle(e)})()}};ge=(0,he.__decorate)([(0,m.CrtRequestHandler)({requestType:"crt.7XRequest",type:"crt.Crt7XRequestHandler"}),(0,he.__metadata)("design:paramtypes",[j,L])],ge);var Me=S(85638);class je extends m.BaseRequestHandler{constructor(e){super(),this._rightsService=e.get(Me.RightsService),this._navigationService=e.get(j)}_redirectToMainApplication(){var e=this;return(0,l.A)(function*(){yield e._navigationService.navigate({mode:f.Push,options:{type:_.Schema},state:{moduleName:"Desktop"}})})()}getOperation(){return""}handle(e){var t=this;return(0,l.A)(function*(){return(yield(0,u.firstValueFrom)(t._rightsService.getCanExecuteOperation(t.getOperation())))?t.next?.handle(e):t._redirectToMainApplication()})()}}class Ue{constructor(){this.navigateStart$=new u.Subject,this.navigateEnd$=new u.Subject,this.historyState$=new u.Subject,this._history=[]}push(e){const t=this._history.length+1;e={...e,historyIndex:t},this._history.push(e),this.historyState$.next(e)}replace(e){const t=this._history.length;e={...e,historyIndex:t},this._history[this._history.length-1]=e,this.historyState$.next(e)}back(){this._history.pop();const e=this._history[this._history.length-1];this.historyState$.next(e)}getNavigation$(e){return this.historyState$.pipe((0,u.map)(t=>({state:t,...T.parse(window.location.href)})))}getChildNavigation$(e,t){return(0,u.of)()}onNavigateEnd(){}getActiveRouteInfo(){const e=this._history.at(-1);return{moduleName:e.moduleName,schemaName:e.schemaName,operationType:e.operation,recordId:e.recordId}}}}}]);
