(self.webpackChunkapp_studio_enterprise_duplicates_widget=self.webpackChunkapp_studio_enterprise_duplicates_widget||[]).push([[6815,3308,927,8546,6165,2832,451,8070,5689,4260,1879,1421,9196],{49196:(A,p,g)=>{g.r(p),g.d(p,{NavigationUtils:()=>u,SchemaStructureUtils:()=>c,UITypePriority:()=>o});var d=g(73308),i=g(38495),f=g(28399),o;(function(s){s.Auto="auto",s.PreferFreedomUI="freedom-ui"})(o||(o={}));var y=g(23710);class m{static initialize(){y.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),y.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(e,t="",r="_"){const n=new RegExp(`^${t}`);return t+e.replace(n,"")+r+y.generate()}}m.initialize();class c{static getSchemaRequire(e){return new Promise(t=>{Terrasoft.require([e],r=>t(r))})}static isSchemaInheritedFrom(e,t){var r=this;return(0,d.A)(function*(){let n=Terrasoft.configuration.Structures[t];n||(yield r.getSchemaRequire(t),n=Terrasoft.configuration.Structures[t]);const a=n?.structureParent;return a?a===e||r.isSchemaInheritedFrom(e,a):!1})()}}class u{static{this._angularSchemaType=9}static get angularSchemaType(){return u._angularSchemaType}static{this._angularModules=["PageSchemaViewModule","CardSchemaViewModule","HomePage","Desktop","SectionSchemaViewModule"]}static _getTypeColumnName(e,t){return u.getEntityStructure(e,t??o.Auto)?.pages.find(a=>a.typeColumnName)?.typeColumnName}static _getTypeColumnValue(e){return(0,d.A)(function*(){const{entityName:t,typeColumnValue:r}=e;if(r)return r;const n=u._getTypeColumnName(t,e.uiTypePriority),a=u.getRecordLookupValue(e.recordId);return!n||!a?null:(yield(yield i.Model.create(t)).load({attributes:[n],parameters:[{type:i.ModelParameterType.Filter,value:new i.CompareFilter(i.ComparisonType.Equal,new i.ColumnExpression({columnPath:"Id"}),new i.ParameterExpression({value:a}))}]}))?.[0]?.[n]?.value})()}static _getModuleStructureBySectionSchema(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(t=>t.sectionSchema===e)}static _getSectionModuleName(e){return u._getModuleStructureBySectionSchema(e)?.sectionModule}static _getSectionEditPageModuleName(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(r=>r.cardSchema===e||r.pages?.some(n=>n.cardSchema===e))?.cardModule}static _getModuleName(e){return(0,d.A)(function*(){const t=u._getSectionModuleName(e)??u._getSectionEditPageModuleName(e);if(t)return t;if(yield c.isSchemaInheritedFrom("BasePageV2",e))return"CardModuleV2";switch(!0){case(yield c.isSchemaInheritedFrom("BaseHomePage",e)):return"HomePage";case(yield c.isSchemaInheritedFrom("BaseIntroPageSchema",e)):return"IntroPage";case(yield c.isSchemaInheritedFrom("BaseSectionV2",e)):return"SectionModuleV2";default:return"PageSchemaViewModule"}})()}static _getTypedPage(e,t){if(!t||t.length<=1)return;if(e.entityPageName){const n=t.find(a=>a.cardSchema===e.entityPageName);if(n)return n}let r=e.typeColumnValue;if(!r&&e.entityName){const a=u.getEntityStructure(e.entityName,e.uiTypePriority)?.attribute;if(a){const l=e.defaultValues?.find(P=>P.attributeName===a);r=l?.value?.value||l?.value}}if(r)return t.find(n=>n.UId===r)}static _getDefaultPages(e){return e?.filter(t=>u._isDefaultPage(t))}static _getNotTypedAddPage(e){return e?.find(t=>u._isAddPage(t)&&!t.UId)}static _getTypedAddPage(e){return e?.find(t=>u._isAddPage(t)&&t.UId)}static _getTypedDefaultPage(e){return e?.find(t=>u._isDefaultPage(t)&&t.UId)}static _getNotTypedDefaultPage(e){return e?.find(t=>u._isDefaultPage(t)&&!t.UId)}static _isDefaultPage(e){return e.isDefault||!e.actions}static _isAddPage(e){return e.actions?.add}static _getDefaultPage(e){const t=u.getEntityStructure(e.entityName,e.uiTypePriority);if(!t)return;const r=u._getDefaultPages(t.pages),a=u._getTypedPage(e,r)||u._getNotTypedDefaultPage(r);return!a&&t.pages?.length?(console.warn("Default page not found and random page is given instead. Please, check passed options."),t.pages[0]):a}static _getAddPage(e){const r=u.getEntityStructure(e.entityName,e.uiTypePriority)?.pages,n=u.getPagesForAddAction(r);if(n?.length<=1)return n?.[0];const a=u._getTypedPage(e,n);if(a)return a;const l=u._getNotTypedAddPage(r),P=u._getNotTypedDefaultPage(r);let S=l||P;return S||(console.warn("Add or default page not found and random page is given instead. Please, check options."),console.warn(e),S=r?.[0]),S}static _getEditPage(e){return u._getDefaultPage(e)}static _getGroupedTypedPages(e){const t={};for(const r of e){const{UId:n}=r;n&&(t[n]=t[n]??[],t[n].push(r))}return t}static _getModuleConfig(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(t=>t.cardSchema===e||t.sectionSchema===e||t.pages?.some(r=>r.cardSchema===e))}static getPagesForAddAction(e){if((0,f.isEmpty)(e))return[];const t=u._getGroupedTypedPages(e),r=u._getNotTypedAddPage(e),n=u._getNotTypedDefaultPage(e),a=Object.values(t).map(P=>{const S=u._getTypedAddPage(P);if(S)return S;const h=u._getTypedDefaultPage(P);return h&&r?{...r,...(0,f.pick)(h,["caption","captionLcz","UId"])}:r||h||n});if(!(0,f.isEmpty)(a))return a;const l=r||n;return l?[l]:[]}static getCardSchemaName(e){return e?.cardSchema??e?.cardSchemaName}static getEntityStructure(e,t=o.Auto){if(!e)return;let r;return t===o.PreferFreedomUI&&(r=Object.values(Terrasoft.configuration.EntityStructure).find(n=>n.page8X&&n.entitySchemaName===e)),r??Terrasoft.ModuleUtils.getEntityStructureByName(e)}static getRecordLookupValue(e){return typeof e=="string"?e:e?.value}static getPageForActionAsync(e){return(0,d.A)(function*(){const r={typeColumnValue:yield u._getTypeColumnValue(e),...e};return u.getPageForAction(r)})()}static getPageForAction(e){let t;return e.action===i.ModelInPageAction.Add?t=u._getAddPage(e):t=u._getEditPage(e),t||(t=u._getDefaultPage(e)),t}static getPageSchemaNameForAction(e){return(0,d.A)(function*(){if(e.entityPageName)return e.entityPageName;const t=yield u.getPageForActionAsync(e);return u.getCardSchemaName(t)})()}static isAngularSchema(e){return(0,d.A)(function*(){return yield c.getSchemaRequire(e),(yield c.getSchemaRequire(e+"Structure")).type===u._angularSchemaType})()}static generateChainModuleId(e){return m.generateUnique(e+"_chain")}static getValuePairs(e){return e&&e.map(t=>{let r,n;const a=t.value;return a?.value?(n=a.value,r=a.displayValue):n=a,{name:t.attributeName,value:n,displayValue:r}})}static getModuleName(e,t){return(0,d.A)(function*(){if(!e&&!t)throw new i.ArgumentEmptyException("schemaName");return e&&!t&&(t=yield u._getModuleName(e)),t})()}static getEditPageModuleName(e,t=o.Auto){return u.getEntityStructure(e,t)?.cardModuleName}static hasEntityEditPage(e){return(0,d.A)(function*(){return!!(yield u.getPageForActionAsync(e))})()}static isSectionEditPage(e){return!!u._getSectionEditPageModuleName(e)}static isAngularListPage(e){return(0,d.A)(function*(){return(yield u.isAngularSchema(e))?c.isSchemaInheritedFrom("BaseGridSectionTemplate",e):!1})()}static isAngularRouting(e){return u._angularModules.includes(e)}static getSectionEntityName(e){return u._getModuleStructureBySectionSchema(e)?.entitySchemaName}static getPageEntitySchemaName(e){const t=this._getModuleConfig(e);return t?.entitySchemaName?t.entitySchemaName:Object.values(Terrasoft.configuration.EntityStructure).find(n=>n.pages?.some(a=>a.cardSchema===e))?.entitySchemaName}static getEntityPageStructure(e){return Object.values(Terrasoft.configuration.EntityStructure).find(r=>r.pages.find(n=>n.cardSchema===e))?.pages?.find(r=>r.cardSchema===e)}static isMiniPage(e){const t=u.getEntityPageStructure(e);if(t){const r=t.schemaGroup==="MiniPage";return Promise.resolve(r)}return c.isSchemaInheritedFrom("BaseMiniPageTemplate",e)}static getSysModuleId(e){return(u._getModuleConfig(e)||Object.values(Terrasoft.configuration.ModuleStructure).find(r=>r.sectionModule===e))?.moduleId}}},73308:(A,p,g)=>{g.d(p,{A:()=>i});function d(f,o,y,m,c,u,s){try{var e=f[u](s),t=e.value}catch(r){y(r);return}e.done?o(t):Promise.resolve(t).then(m,c)}function i(f){return function(){var o=this,y=arguments;return new Promise(function(m,c){var u=f.apply(o,y);function s(t){d(u,m,c,s,e,"next",t)}function e(t){d(u,m,c,s,e,"throw",t)}s(void 0)})}}}}]);
