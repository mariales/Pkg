(self.webpackChunkapp_studio_enterprise_duplicates_widget=self.webpackChunkapp_studio_enterprise_duplicates_widget||[]).push([[8025],{78025:(Be,le,u)=>{u.r(le),u.d(le,{ABSTRACT_DIALOG_PROVIDER_ACTIONS:()=>P,Attachment:()=>Ie,Channel:()=>me,ChannelEntityConverter:()=>w,ChannelService:()=>A,ChannelType:()=>S,ChatEntityConverter:()=>N,ChatMessage:()=>_e,ChatOperator:()=>ge,ChatOperatorStatus:()=>te,ChatQueueOperator:()=>ve,ChatQueueOperatorEntityConverter:()=>O,ChatQueueOperatorService:()=>U,ChatSettingsPageInitHandler:()=>X,ChatStatus:()=>B,CreateQueueAgentHandler:()=>q,CreateQueueAgentRequest:()=>Ve,CrtChatHistoryComponent:()=>x,CrtChatMessagesComponent:()=>M,CrtOmnichatModule:()=>$,FacebookApiProvider:()=>j,FacebookChannelCreateRecordHandler:()=>Q,FacebookChannelErrorDialogComponent:()=>R,FacebookProvider:()=>F,FacebookRegistrationService:()=>L,FacebookSettingsService:()=>f,MessageDirection:()=>W,MessageType:()=>D,OmnichannelChat:()=>ue,OmnichannelChatService:()=>y,OpenFacebookIntegrationPageRequestHandler:()=>ne,RegisterTelegramResponse:()=>ye,RegisterWhatsAppResponse:()=>Me,TelegramChannelAttributeChangedHandler:()=>J,TelegramChannelSaveHandler:()=>G,TelegramRegistrationService:()=>E,WhatsAppChannelSaveHandler:()=>Y,WhatsAppRegistrationService:()=>z});var g=u(5960),v=u(40297),I=u(63721),de=u(56711),K=u(23023),V=u(76923),i=u(38495),C=u(79772),_=u(50456),l=u(21018),a=u(59131),c=u(62278),ee=u(29957),B;(function(r){r.Completed="a1b0184b-0a54-4a47-ba08-a5772105d3b2"})(B||(B={}));var te;(function(r){r[r.Inactive=0]="Inactive",r[r.Active=1]="Active",r[r.ChatsExceeded=2]="ChatsExceeded"})(te||(te={}));class ge{}class ue{get chatQueueId(){return this._chatQueueId}set chatQueueId(e){this._chatQueueId=e}}var W;(function(r){r[r.Incoming=1]="Incoming",r[r.Outcoming=2]="Outcoming"})(W||(W={}));var D;(function(r){r[r.Text=0]="Text",r[r.File=1]="File",r[r.Image=2]="Image",r[r.System=5]="System"})(D||(D={}));class Ie{}class _e{}class ye{}class Me{}class ve{}var S;(function(r){r.FacebookMessenger="50491c6c-d82b-4b86-b38c-99262d11a5ac",r.Telegram="645170ab-c67a-4dcc-9def-c0e5236bdfe0",r.WhatsApp="1398dc73-b428-4e21-b97a-c1bb6b4bc621",r.AdaConnector="fd6491c5-0ebe-408a-a4c3-057a1ac79dd4"})(S||(S={}));class me{get type(){switch(this.typeId){case S.FacebookMessenger:return S.FacebookMessenger;case S.Telegram:return S.Telegram;default:throw new Error(`Type with id ${this.typeId} not found`)}}}var Z=u(85638),T=u(35266),p=u(36486);class N{_getChatOperator(e){const t=new ge;return e.Operator&&(t.contact=this._getContact(e["Operator.Contact"]),t.displayValue=e.Operator.displayValue,t.value=e.Operator.value),t}_getContact(e){if(e)return new _.Contact(e.value,e.displayValue,e.primaryImageValue)}_getChannel(e){const t=e.Channel,n=e["Channel.Provider"],s={};return t&&(s.id=t.value,s.name=t.displayValue),n&&(s.provider={id:n.value,name:n.displayValue,icon:(0,l.getImageUrlById)(n.primaryImageValue)}),s.source=e["Channel.Source"],s.msgSettingsId=e["Channel.MsgSettingsId"],s}_getQueue(e){const t=e.Queue,n={};return t&&(n.id=t.value),n}_createChat(e){const t=this._getContact(e.Contact);t.account=e["Contact.Account"];const n=this._getChannel(e),s=this._getQueue(e),o=this._getChatOperator(e);return{id:e.Id,contact:t,lastMessageTime:e.ModifiedOn,status:e.Status,channel:n,chatPreview:e.ChatPreview,operator:o,unprocessedMsgCount:e.UnprocessedMsgCount,chatStartDate:e.ChatStartDate,closeDate:e.CloseDate,completionDate:e.CompletionDate,lastMessageDirection:e.LastMessageDirection,channelId:e.ChannelId,chatQueueId:e.ChatQueueId||s.id}}_getLookupValue(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]?e[t].value:void 0}getEntity(e){return this._createChat(e)}getEntityColumns(e){return[new l.EntityColumn("Id",e.id,i.DataValueType.Guid),new l.EntityColumn("Contact",this._getLookupValue(e,"contact"),i.DataValueType.Lookup),new l.EntityColumn("Contact.Account",this._getLookupValue(e,"account"),i.DataValueType.Lookup),new l.EntityColumn("ModifiedOn",e.lastMessageTime,i.DataValueType.DateTime),new l.EntityColumn("Status",this._getLookupValue(e,"status"),i.DataValueType.Lookup),new l.EntityColumn("Channel",this._getLookupValue(e,"channel"),i.DataValueType.Lookup),new l.EntityColumn("Channel.Provider",this._getLookupValue(e,"channel"),i.DataValueType.Lookup),new l.EntityColumn("Channel.Source",e.channel?.source,i.DataValueType.Text),new l.EntityColumn("Channel.MsgSettingsId",e.channel?.msgSettingsId,i.DataValueType.Text),new l.EntityColumn("ChatPreview",e.chatPreview,i.DataValueType.Text),new l.EntityColumn("Operator",this._getLookupValue(e,"operator"),i.DataValueType.Lookup),new l.EntityColumn("UnprocessedMsgCount",e.unprocessedMsgCount,i.DataValueType.Integer),new l.EntityColumn("ChatStartDate",e.chatStartDate,i.DataValueType.DateTime),new l.EntityColumn("CloseDate",e.closeDate,i.DataValueType.DateTime),new l.EntityColumn("CompletionDate",e.completionDate,i.DataValueType.DateTime),new l.EntityColumn("Operator.Contact",this._getLookupValue(e,"operatorContact"),i.DataValueType.Lookup),new l.EntityColumn("Queue",this._getLookupValue(e,"queue"),i.DataValueType.Lookup)]}static{this.\u0275fac=function(t){return new(t||N)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac})}}var b=u(28399),Se=u.n(b);class O{_createChatQueueOperator(e){return{id:e.Id,operator:e.Operator,chatQueue:e.ChatQueue}}getValueFromLookup(e,t){return e.hasOwnProperty(t)&&!(0,b.isEmpty)(e[t])?e[t].value:void 0}getEntity(e){return this._createChatQueueOperator(e)}getEntityColumns(e){return[new l.EntityColumn("Id",e.id,i.DataValueType.Guid),new l.EntityColumn("Operator",this.getValueFromLookup(e,"operator"),i.DataValueType.Lookup),new l.EntityColumn("ChatQueue",this.getValueFromLookup(e,"chatQueue"),i.DataValueType.Lookup)]}static{this.\u0275fac=function(t){return new(t||O)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}}class w{_createChannel(e){const t=e.Provider,n=e.ChatQueue,s=e.Language;return{id:e.Id,name:e.Name,typeId:t.value,typeName:t.displayValue,msgSettingsId:e.MsgSettingsId,queueId:n.value,queueName:n.displayValue,source:e.Source,isActive:e.IsActive,languageId:s.value,languageName:s.displayValue}}getEntity(e){return this._createChannel(e)}getEntityColumns(e){return[new l.EntityColumn("Id",e.id,i.DataValueType.Guid),new l.EntityColumn("Name",e.name,i.DataValueType.Text),new l.EntityColumn("Provider",e.typeId,i.DataValueType.Lookup),new l.EntityColumn("MsgSettingsId",e.msgSettingsId,i.DataValueType.Guid),new l.EntityColumn("ChatQueue",e.queueId,i.DataValueType.Lookup),new l.EntityColumn("Source",e.source,i.DataValueType.Text),new l.EntityColumn("IsActive",e.isActive,i.DataValueType.Boolean),new l.EntityColumn("Language",e.languageId,i.DataValueType.Lookup)]}static{this.\u0275fac=function(t){return new(t||w)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac})}}class y extends T.BaseEntityService{static get rowsCount(){return 30}constructor(e,t,n,s,o,d){super(t,n,s),this.rightsService=e,this.httpClient=o,this.userInfo=d,this._serviceUrl="/rest/OmnichannelChatService/",this._canManageChatsOperationCode="CanManageChats",this._cacheChatActions={},this.entitySchemaName="OmniChat"}_postWithChatId(e,t){const n=this._serviceUrl+t;return this.httpClient.post(n,{chatId:e})}_getMessages(e,t){const n=this._serviceUrl+t;return this.httpClient.post(n,{chatId:e}).pipe((0,p.map)(this._mapChatMessage()))}_getAllConversationMessages(e,t,n){const s=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),o=this._serviceUrl+"GetAllConversation";return this.httpClient.post(o,{contactId:e,channelId:t,rowCount:y.rowsCount,rowOffset:n},{headers:s}).pipe((0,p.map)(this._mapChatMessage()))}_mapChatMessage(){return e=>(e.forEach(t=>{t.time=new Date(t.time),t.author=new _.Contact(t.author.id,t.author.name,t.author.photoId)}),e)}acceptChat(e){return this._postWithChatId(e,"AcceptChat")}getAllConversationByChat(e,t=0){const n=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"GetAllConversationByChat";return this.httpClient.post(s,{chatId:e,rowCount:y.rowsCount,rowOffset:t},{headers:n}).pipe((0,p.map)(this._mapChatMessage()))}getAllConversation(e,t,n=0){return this._getAllConversationMessages(e,t,n)}markAsRead(e){const t=this._serviceUrl+"MarkChatAsRead";this.httpClient.post(t,{chatId:e}).subscribe()}getMessageTemplate(e){const t=this._serviceUrl+"GetUnifiedMessageTemplate";return this.httpClient.post(t,{chatId:e})}sendMessage(e){const t="/rest/OmnichannelOutcomeMessagingService/SendMessage",n={message:e};return this.httpClient.post(t,n)}sendMessageWithAttachments(e,t){const n="/rest/OmnichannelOutcomeMessagingService/SendMessageWithAttachments",s=new FormData;return s.append("message",JSON.stringify(e)),Array.from(t).forEach((o,d)=>{s.append("file"+d,o,o.name)}),this.httpClient.post(n,s)}completeChat(e){return this._postWithChatId(e,"CloseActiveChat")}getOperatorChats(){const e=this._serviceUrl+"GetChats";return this.httpClient.post(e,{operatorId:this.userInfo.id}).pipe((0,p.map)(t=>({success:!0,errorInfo:null,result:t.Chats.map(n=>this.entityConverter.getEntity(n))})),(0,p.catchError)(t=>this.getBaseErrorResponse(t)))}getChatHistory(e){return this._getMessages(e,"GetHistory")}getChatActions(e){if(this._cacheChatActions[e])return(0,c.of)(this._cacheChatActions[e]);const t=this._serviceUrl+"GetChatActions";return this.httpClient.post(t,{chatId:e}).pipe((0,p.tap)(n=>this._cacheChatActions[e]=n))}isOperatorCanManageChats(){return this.rightsService.getCanExecuteOperation(this._canManageChatsOperationCode).pipe((0,p.map)(e=>e))}isOperatorActive(){const e=new i.EntitySchemaQuery("OperatorSession");return e.rowCount=1,e.addSchemaColumn("OperatorState.OperatorAvailable","IsActive"),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Is_null,"SessionEndDate",null),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"SysUser",this.userInfo.id),this.queryExecutor.executeSelectQuery(e).pipe((0,p.map)(t=>t&&t[0].IsActive||!1),(0,p.catchError)(()=>(0,c.of)(!1)))}isOperatorHasActiveChannel(){const e=new i.EntitySchemaQuery("Channel");e.rowCount=1;const t=new i.FilterGroup;return t.logicalOperation=i.LogicalOperatorType.Or,t.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnit:Operator].SysAdminUnit",this.userInfo.id),t.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnitRoleId:Operator].SysAdminUnit",this.userInfo.id),e.filters.add(t),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"IsActive",!0),this.queryExecutor.executeSelectQuery(e).pipe((0,p.map)(n=>n&&n.length>0||!1),(0,p.catchError)(()=>(0,c.of)(!1)))}hasUncompletedChats(e){const t=this._serviceUrl+"GetHasUncompletedChats";return this.httpClient.post(t,{channelId:e})}static{this.\u0275fac=function(t){return new(t||y)(a.\u0275\u0275inject(Z.RightsService),a.\u0275\u0275inject(T.QueryExecutor),a.\u0275\u0275inject(C.TranslateService),a.\u0275\u0275inject(N),a.\u0275\u0275inject(I.HttpClient),a.\u0275\u0275inject(l.UserInfo))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac,providedIn:"root"})}}class f{constructor(e,t){this.httpClient=e,this.sysSettingsService=t,this._serviceUrl="/rest/FacebookOmnichannelMessagingService/",this._settingsCodes=["IdentityServerUrl"],this._sysSettingsValues={},this.sysSettingsService.getByCodes(this._settingsCodes).subscribe(n=>{const s=n&&n.success&&n.values&&(0,b.mapValues)(n.values||{},o=>o.value);s&&(this._sysSettingsValues=s)})}getApplicationId(){return this.httpClient.get(this._serviceUrl+"GetCurrentFacebookAppId")}getApiVersion(){return"v20.0"}getIdentityServerUrl(){return this._sysSettingsValues.IdentityServerUrl}getPageName(e,t){return this.httpClient.get(this._serviceUrl+`GetPageName?pageId=${e}&channelId=${t}`).pipe((0,c.map)(n=>JSON.parse(n).name),(0,c.take)(1))}static{this.\u0275fac=function(t){return new(t||f)(a.\u0275\u0275inject(I.HttpClient),a.\u0275\u0275inject(Z.SysSettingsService))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac})}}class F{constructor(e,t){this._settingsService=e,this._window=t,this._permissions="pages_show_list,pages_messaging,pages_manage_metadata,business_management,pages_read_engagement",this._toSubscribeFields="messages,messaging_postbacks,message_echoes,standby,messaging_handovers",this._sdkUrl="https://connect.facebook.net/en_US/sdk.js"}_loadScript(e,t,n=null){const s=document.createElement("script");s.async=!0,s.src=e,s.onload=t,n||(n=document.head),n.appendChild(s)}_innerLogin(e=!1){const t={scope:this._permissions,return_scopes:!0};return e&&(t.auth_type="rerequest"),new c.Observable(n=>{FB.login(s=>{s.authResponse?n.next(!0):n.next(!1)},t)})}_getSubscribed(e,t){FB.api(`/me/subscribed_apps?access_token=${e}`,"GET",{},n=>{t(n?.data?.[0]?.subscribed_fields||[])})}isLoggedIn(){return new c.Observable(e=>{FB.getLoginStatus(t=>{t.status==="connected"?e.next(!0):e.next(!1)})})}login(){return this._innerLogin()}reLogin(){return this._innerLogin(!0)}getPages(){return new c.Observable(e=>{FB.api("me/accounts",t=>{e.next(t)})})}initialize(){return new c.Observable(e=>{this._loadScript(this._sdkUrl,()=>{this._settingsService.getApplicationId().subscribe(t=>{const n=t.replace(/\D+/g,"").trim();FB.init({appId:n,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:this._settingsService.getApiVersion()}),this.isInitialized=!0,e.next(!0)})})})}attachPage(e){return new c.Observable(t=>{this._getSubscribed(e,n=>{const s=(0,b.union)(n,this._toSubscribeFields.split(",")).join(",");FB.api(`/me/subscribed_apps?subscribed_fields=${s}&access_token=${e}`,"POST",{},o=>{t.next(o)})})})}isFacebookSettingValid(){return this._settingsService.getIdentityServerUrl()&&this._window.location.protocol==="https:"}static{this.\u0275fac=function(t){return new(t||F)(a.\u0275\u0275inject(f),a.\u0275\u0275inject("Window"))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac})}}var m=u(73308);class j{constructor(e,t,n){this._sysSettingsService=e,this._facebookSettingsService=t,this._window=n,this._permissions="pages_show_list,pages_messaging,pages_manage_metadata,business_management,pages_read_engagement",this._fieldsToSubscribe="messages,messaging_postbacks,message_echoes,standby,messaging_handovers",this._sdkUrl="https://connect.facebook.net/en_US/sdk.js"}get fbApiLibrary(){return this._window.FB||null}_initApi(e){console.log(`FB.init call for appId:${e}`),this.fbApiLibrary.init({appId:e,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:this._facebookSettingsService.getApiVersion()})}_getSubscribedApps(e){return new c.Observable(t=>{console.log(`FB.api call for path '/me/subscribed_apps?access_token=${e}'`),this.fbApiLibrary.api(`/me/subscribed_apps?access_token=${e}`,"GET",{},n=>{const s=n?.data?.[0]?.subscribed_fields||[];t.next(s),t.complete()})})}isFacebookSettingValid(){var e=this;return(0,m.A)(function*(){return(yield(0,c.firstValueFrom)(e._sysSettingsService.getValueByCode("IdentityServerUrl")))&&e._window.location.protocol==="https:"})()}initApi(){return this.fbApiLibrary?(0,c.of)(!0):this.loadLibrary().pipe((0,c.concatMap)(()=>this._facebookSettingsService.getApplicationId()),(0,c.concatMap)(e=>{const t=e.replace(/\D+/g,"").trim();return this._initApi(t),(0,c.of)(!0)}))}loadLibrary(){return new c.Observable(e=>{console.log("Loading FB SDK...");const t=document.createElement("script");t.src=this._sdkUrl,t.onload=()=>{console.log("FB SDK loaded"),e.next(),e.complete()},t.onerror=n=>{e.error(n)},document.body.appendChild(t)})}login(){const e={scope:this._permissions,return_scopes:!0,auth_type:"rerequest"};return new c.Observable(t=>{console.log("FB.login call"),this.fbApiLibrary.login(n=>{n.authResponse&&n.status==="connected"&&(t.next(),t.complete())},e)})}getPages(){return new c.Observable(e=>{console.log("FB.api call for path 'me/accounts'"),this.fbApiLibrary.api("me/accounts",t=>{const n=[];t.data.forEach(s=>{n.push({id:s.id,name:s.name,token:s.access_token})}),e.next(n),e.complete()})})}subscribeApps(e,t){return new c.Observable(n=>{console.log(`FB.api call for path '/me/subscribed_apps?subscribed_fields=${t}&access_token=${e}'`),this.fbApiLibrary.api(`/me/subscribed_apps?subscribed_fields=${t}&access_token=${e}`,"POST",{},s=>{n.next(!!s),n.complete()})})}attachPage(e){return this._getSubscribedApps(e).pipe((0,c.concatMap)(t=>{const n=(0,b.union)(t,this._fieldsToSubscribe.split(",")).join(",");return this.subscribeApps(e,n)}))}static{this.\u0275fac=function(t){return new(t||j)(a.\u0275\u0275inject(Z.SysSettingsService),a.\u0275\u0275inject(f),a.\u0275\u0275inject("Window"))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac})}}class E{constructor(e){this.httpClient=e,this._serviceUrl="/rest/TelegramOmnichannelMessagingService/"}registerTelegramChannel(e){const t=this._serviceUrl+"RegisterChannel";return this.httpClient.post(t,{token:e})}validateRegisterChannel(e){return[{condition:!e.IsTokenValid,message:"ChatSettings.ChannelPage.Telegram.InvalidTelegramToken"},{condition:e.IsTokenExist,message:"ChatSettings.ChannelPage.Telegram.TelegramTokenAlreadyExists"},{condition:e.IsActiveWebhook,message:"ChatSettings.ChannelPage.Telegram.ActiveWebhookErrorMessageForCreating"}].find(n=>n.condition)?.message||""}getTelegramUserName(e){const t=this._serviceUrl+"GetUserName";return this.httpClient.post(t,{settingsId:e})}removeTelegramChannel(e){const t=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),n=this._serviceUrl+"RemoveChannel";return this.httpClient.post(n,{telegramId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||E)(a.\u0275\u0275inject(I.HttpClient))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}class L{constructor(e){this.httpClient=e,this._serviceUrl="/rest/FacebookOmnichannelMessagingService/"}registerFacebookChannel(e,t){const n=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"Register";return this.httpClient.post(s,{token:e,source:t},{headers:n})}removeFacebookChannel(e){const t=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),n=this._serviceUrl+"RemoveChannel";return this.httpClient.post(n,{facebookId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||L)(a.\u0275\u0275inject(I.HttpClient))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac,providedIn:"root"})}}class z{wrapPhoneNumber(e){return`+${e}`}getRequestData(e,t,n){return{token:e,appId:t,channelPhoneNumber:this.wrapPhoneNumber(n)}}constructor(e){this.httpClient=e,this._serviceUrl="/rest/WhatsAppOmnichannelMessagingService/"}tryConnect(e,t,n){const s=this._serviceUrl+"Validate";return this.httpClient.post(s,this.getRequestData(e,t,n))}register(e,t,n){const s=this._serviceUrl+"RegisterChannel";return this.httpClient.post(s,this.getRequestData(e,t,n))}validateRegisterChannel(e){let t="";if(!e?.IsConnectionSuccess&&e?.errorInfo?.errorCode){const n=e.errorInfo.errorCode;["InvalidAppSidException","InvalidAccountPhoneNumberException","AuthenticateException"].indexOf(n)>-1?t=`ChatSettings.ChannelPage.WhatsApp.ErrorMessages.${n}`:t=e.errorInfo.message}return t}removeWhatsAppChannel(e){const t=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),n=this._serviceUrl+"RemoveChannel";return this.httpClient.post(n,{whatsAppId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||z)(a.\u0275\u0275inject(I.HttpClient))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac,providedIn:"root"})}}class U extends T.BaseEntityService{constructor(e,t,n){super(e,t,n),this.entitySchemaName="ChatQueueOperator"}mapSysAdminUnit(e){return{id:e.Id,name:e.Name,parentRoleId:e.ParentRole&&e.ParentRole.value,sysAdminUnitTypeValue:e.SysAdminUnitTypeValue}}addSysAdminUnitQueryFilters(e){const t=new i.FilterGroup;t.logicalOperation=i.LogicalOperatorType.Or,t.addSchemaColumnFilterWithParameter(i.ComparisonType.Not_equal,"SysAdminUnitTypeValue",4),t.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"Active",1),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ConnectionType",0),e.filters.add(t)}getSysAdminUnitQuery(){const e=new i.EntitySchemaQuery("SysAdminUnit");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name"),e.addSchemaColumn("ParentRole"),e.addSchemaColumn("SysAdminUnitTypeValue"),e.addSchemaColumn("ConnectionType"),e.addSchemaColumn("Active"),this.addSysAdminUnitQueryFilters(e),e}getItemsByChatQueueId(e){const t=this.createGetAllItemsEsq();return t.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ChatQueue",e),this.queryExecutor.executeSelectQuery(t).pipe((0,p.map)(n=>({success:!0,errorInfo:null,result:n.map(s=>this.entityConverter.getEntity(s))})),(0,p.catchError)(n=>this.getBaseErrorResponse(n)))}getSysAdminUnitList(){const e=this.getSysAdminUnitQuery();return this.queryExecutor.executeSelectQuery(e).pipe((0,p.map)(t=>({success:!0,errorInfo:null,sysAdminUnits:t.map(n=>this.mapSysAdminUnit(n))})))}static{this.\u0275fac=function(t){return new(t||U)(a.\u0275\u0275inject(T.QueryExecutor),a.\u0275\u0275inject(C.TranslateService),a.\u0275\u0275inject(O))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac})}}class A extends T.BaseEntityService{constructor(e,t,n){super(e,t,n),this.entitySchemaName="Channel"}_createNewChannel(e){const t=new me;return t.id=(0,i.generateGuid)(),t.typeId=e,t}getLookupValues(e){const t=new i.EntitySchemaQuery(e);return t.addSchemaColumn("Id"),t.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),this.queryExecutor.executeSelectQuery(t).pipe((0,p.map)(n=>n.map(s=>({value:s.Id,displayValue:s.Name}))))}getChannelTypeItems(){const e=new i.EntitySchemaQuery("ChannelProvider");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),e.addSchemaColumn("PageUrl"),this.queryExecutor.executeSelectQuery(e).pipe((0,p.map)(t=>t.map(n=>({value:n.Id,displayValue:n.Name,pageUrl:n.PageUrl}))))}getChannelQueueItems(){const e=new i.EntitySchemaQuery("ChatQueue");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),e.addSchemaColumn("[ChatQueueOperator:ChatQueue].Id","Operator"),this.queryExecutor.executeSelectQuery(e).pipe((0,p.map)(t=>{const n=t.filter(o=>!!o.Operator);return n.filter((o,d)=>n.findIndex(h=>h.Id===o.Id)===d).map(o=>({value:o.Id,displayValue:o.Name}))}))}getActiveLanguages(){const e=new i.EntitySchemaQuery("SysLanguage");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"IsUsed",1),this.queryExecutor.executeSelectQuery(e).pipe((0,p.map)(t=>t.map(n=>({value:n.Id,displayValue:n.Name}))))}generateNewChannelResponse(e){return{success:!0,result:[this._createNewChannel(e)]}}checkCanSaveChannel(e,t,n){const s=new i.EntitySchemaQuery("Channel");s.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"Source",e),s.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"Provider",t),this.queryExecutor.executeSelectQuery(s).subscribe(o=>{n(!(o&&o[0]))})}static{this.\u0275fac=function(t){return new(t||A)(a.\u0275\u0275inject(T.QueryExecutor),a.\u0275\u0275inject(C.TranslateService),a.\u0275\u0275inject(w))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac})}}const fe=r=>({"bot-message":r}),xe=r=>({display:r}),be=()=>({}),he=(r,e)=>({"first-in-sequence":r,"last-in-sequence":e}),Ae=(r,e)=>({width:r,height:e});function Pe(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",2)(1,"span"),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd()()),r&2){const t=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(t.firstMessageDate)}}function ke(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",10)(1,"span"),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd()()),r&2){const t=a.\u0275\u0275nextContext(2);a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(t.separatorText)}}function De(r,e){if(r&1){const t=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",11)(1,"label",12),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(3,"ts-contact-photo",13),a.\u0275\u0275listener("contactClick",function(){a.\u0275\u0275restoreView(t);const s=a.\u0275\u0275nextContext().$implicit,o=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(o.openContact(s.author.id))}),a.\u0275\u0275elementEnd()()}if(r&2){const t=a.\u0275\u0275nextContext().$implicit,n=a.\u0275\u0275nextContext();a.\u0275\u0275property("hidden",!n.isContactChanged(t)),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",t.isBotMessage?n.bot.name:t.author.name," "),a.\u0275\u0275advance(),a.\u0275\u0275property("contact",t.isBotMessage?a.\u0275\u0275pureFunction0(4,be):t.author)("contactColor",n.getContactBackground(t))}}function Te(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",14)(1,"span"),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd()()),r&2){const t=a.\u0275\u0275nextContext().$implicit,n=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(n.formatSystemMessage(t))}}function Ne(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",15)(1,"span",16),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(3,"span",17),a.\u0275\u0275text(4),a.\u0275\u0275elementEnd()()),r&2){const t=a.\u0275\u0275nextContext().$implicit,n=a.\u0275\u0275nextContext();a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction2(3,he,n.isFirstMessageInSequence(t),n.isLastMessageInSequence(t))),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(t.text),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(n.getLocalTime(t.time))}}function Oe(r,e){if(r&1){const t=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",24)(1,"img",25),a.\u0275\u0275listener("click",function(s){a.\u0275\u0275restoreView(t);const o=a.\u0275\u0275nextContext(4);return a.\u0275\u0275resetView(o.openImage(s))})("load",function(s){a.\u0275\u0275restoreView(t);const o=a.\u0275\u0275nextContext(4);return a.\u0275\u0275resetView(o.onChatImgLoaded(s))}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(2,"span",26),a.\u0275\u0275text(3),a.\u0275\u0275elementEnd()()}if(r&2){const t=a.\u0275\u0275nextContext().$implicit,n=a.\u0275\u0275nextContext(2).$implicit,s=a.\u0275\u0275nextContext();a.\u0275\u0275advance(),a.\u0275\u0275property("ngStyle",a.\u0275\u0275pureFunction2(3,Ae,s.imageContainerSize.width+"px",s.imageContainerSize.height+"px"))("src",s.getImageUrl(t.fileId),a.\u0275\u0275sanitizeUrl),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(s.getLocalTime(n.time))}}function we(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",27)(1,"span",28)(2,"a",29),a.\u0275\u0275text(3),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(4,"span",17),a.\u0275\u0275text(5),a.\u0275\u0275elementEnd()()),r&2){const t=a.\u0275\u0275nextContext().$implicit,n=a.\u0275\u0275nextContext(2).$implicit,s=a.\u0275\u0275nextContext();a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction2(4,he,s.isFirstMessageInSequence(n),s.isLastMessageInSequence(n))),a.\u0275\u0275advance(2),a.\u0275\u0275property("href",s.getFileUrl(t.fileId),a.\u0275\u0275sanitizeUrl),a.\u0275\u0275advance(),a.\u0275\u0275textInterpolate(t.fileName),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(s.getLocalTime(n.time))}}function je(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",21),a.\u0275\u0275template(1,Oe,4,6,"div",22)(2,we,6,7,"div",23),a.\u0275\u0275elementEnd()),r&2){const t=e.$implicit,n=a.\u0275\u0275nextContext(3);a.\u0275\u0275property("ngSwitch",t.fileType),a.\u0275\u0275advance(),a.\u0275\u0275property("ngSwitchCase",n.messageType.Image)}}function Ee(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",30)(1,"span",16),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(3,"span",17),a.\u0275\u0275text(4),a.\u0275\u0275elementEnd()()),r&2){const t=a.\u0275\u0275nextContext(2).$implicit,n=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(t.text),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(n.getLocalTime(t.time))}}function Re(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",18),a.\u0275\u0275template(1,je,3,2,"div",19)(2,Ee,5,2,"div",20),a.\u0275\u0275elementEnd()),r&2){const t=a.\u0275\u0275nextContext().$implicit,n=a.\u0275\u0275nextContext();a.\u0275\u0275advance(),a.\u0275\u0275property("ngForOf",t.attachments),a.\u0275\u0275advance(),a.\u0275\u0275property("ngIf",n.showMessageFromAttachment(t))}}function Fe(r,e){if(r&1&&(a.\u0275\u0275elementStart(0,"div",3),a.\u0275\u0275text(1),a.\u0275\u0275template(2,ke,3,1,"div",4)(3,De,4,5,"div",5),a.\u0275\u0275elementStart(4,"div",6),a.\u0275\u0275template(5,Te,3,1,"div",7)(6,Ne,5,6,"div",8)(7,Re,3,2,"div",9),a.\u0275\u0275elementEnd()()),r&2){const t=e.$implicit,n=e.index,s=a.\u0275\u0275nextContext();a.\u0275\u0275classMap(s.getDirectionName(t.direction)+"-message"),a.\u0275\u0275propertyInterpolate1("id","message_",t.id,""),a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction1(12,fe,t.isBotMessage))("ngStyle",a.\u0275\u0275pureFunction1(14,xe,s.getIsDuplicateMessage(t.id)?"none":"")),a.\u0275\u0275advance(),a.\u0275\u0275textInterpolate1(" ",s.cachePreviousMessage(n)," "),a.\u0275\u0275advance(),a.\u0275\u0275property("ngIf",s.isShowSeparator(t,n)),a.\u0275\u0275advance(),a.\u0275\u0275property("ngIf",!s.isSystemMessage(t)),a.\u0275\u0275advance(),a.\u0275\u0275property("ngSwitch",t.type),a.\u0275\u0275advance(),a.\u0275\u0275property("ngSwitchCase",s.messageType.System),a.\u0275\u0275advance(),a.\u0275\u0275property("ngSwitchCase",s.messageType.Text)}}class M{constructor(e,t,n,s,o){this._userInfo=e,this._translateService=t,this.injector=n,this._contactColorService=s,this.featureService=o,this._omnichannelMessageFileSchema={name:"OmnichannelMessageFile",uid:"E6B4C4D4-0A51-4A6D-A8C5-18B63FADDAD4"},this._isFileApiEnabled=!1,this._fileServiceUrl=`rest/FileService/GetFile/${this._omnichannelMessageFileSchema.uid}/`,this._imageUrl=`img/entity/hash/${this._omnichannelMessageFileSchema.name}/Data/`,this._duplicateIds=[],this.messagesCounter=0,this.contactClick=new a.EventEmitter,this.messageType=D,this.bot={name:this._translateService.instant("ChatSettings.ChatWindow.Bots.Name")||"Creatio.ai"},this.imageContainerSize={width:200,height:120},this.lastSystemMessageIndex=0,this.featureService.getFeatureState("UseFileApiInChats").pipe((0,c.shareReplay)({bufferSize:1,refCount:!1})).subscribe(d=>this._isFileApiEnabled=d)}set messages(e){this._messages=e,e&&this._findDuplicateMessagesWithoutAttachments(),this._setLastSystemMessageIndex()}get messages(){return this._messages}static _trimSlashes(e){return e.replace(/(^([/\\])+)|(([/\\])+$)/,"")}static _isLargeImage(e,t){return e.naturalWidth>=t.offsetWidth||e.naturalHeight>=t.offsetHeight}_isNewDay(e){return this._previousMessage&&this._previousMessage.time&&e.time&&this._previousMessage.time.getDay()!==e.time.getDay()}_isNewMessages(e){const t=this.messages.length-this.messagesCounter;return e===t&&t>0}_formatDate(e){return new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName).format(e)}_joinPath(...e){return e.map(t=>M._trimSlashes(t)).join("/")}_setFirstMessageData(){if(this.messages?.length>0){const e=this.messages.find(t=>t.direction===W.Incoming);if(!e)return;this.firstMessageDate=this._formatDate(e.time),this.contactColor=this._contactColorService.getNextColor(e.author.id)}}_setLastSystemMessageIndex(){this._messages&&(this._messages.length<y.rowsCount?this.lastSystemMessageIndex=0:this._messages.length===y.rowsCount?this.lastSystemMessageIndex=y.rowsCount-1:this.lastSystemMessageIndex=Se().findLastIndex(this._messages,e=>e.type===D.System)+1)}_isAuthorChanged(e,t){return e.author.id!==t.author.id||this.isSystemMessage(t)}_findDuplicateMessagesWithoutAttachments(){const e=this.messages.reduce((s,o)=>{const{text:d,time:h}=o,k=`${d}-${h}`;return s[k]||(s[k]=[]),s[k].push(o),s},{}),n=Object.values(e).flat().filter(s=>{const{text:o,time:d}=s,k=e[`${o}-${d}`].some(H=>!(0,b.isEmpty)(H.attachments));return(0,b.isEmpty)(s.attachments)&&k});this._duplicateIds=n.map(s=>s.id)}getDirectionName(e){return W[e].toLowerCase()}getContactBackground(e){return e.isBotMessage?"none":e.direction===1?this.contactColor:"#40bf62"}isContactChanged(e){return this._previousMessage?this._previousMessage.author.id!==e.author.id||this._previousMessage.isBotMessage!==e.isBotMessage||this._previousMessage.type===D.System:!0}ngOnChanges(){this._setFirstMessageData()}cachePreviousMessage(e){this._previousMessage=e>0?this.messages[e-1]:void 0}openContact(e){return this.contactClick.emit({contactId:e}),!1}trackMessageById(e,t){return t.id}isShowSeparator(e,t){return this._isNewDay(e)?this.separatorText=this._formatDate(e.time):this.separatorText=this._isNewMessages(t)?this._translateService.instant("ChatSettings.ChatWindow.NewMessages"):"",this.separatorText!==""}openImage(e){const t=e.target,n=document.body,s=document.createElement("div");s.classList.add("full-chat-image-container"),s.style.backgroundImage="url('"+t.src+"')",s.style.backgroundSize=M._isLargeImage(t,n)?"contain":"auto",s.addEventListener("click",function(){n.removeChild(s)}),n.appendChild(s)}getFileUrl(e){return this._joinPath((0,l.getWorkspaceBaseUrl)(),this._fileServiceUrl,e)}getImageUrl(e){return this._isFileApiEnabled?this.getFileUrl(e):this._joinPath((0,l.getWorkspaceBaseUrl)(),this._imageUrl,e)}isFirstMessageInSequence(e){const t=this.messages.findIndex(s=>s.id===e.id);if(t===0)return!0;const n=this.messages[t-1];return this._isAuthorChanged(e,n)}isLastMessageInSequence(e){const t=this.messages.findIndex(s=>s.id===e.id);if(t===this.messages.length-1)return!0;const n=this.messages[t+1];return this._isAuthorChanged(e,n)}isSystemMessage(e){return e.type===D.System}onChatImgLoaded(e){const t=e.target;this.isImageOversize(t.width,t.height)&&t.parentElement.classList.add("img-contain")}isImageOversize(e,t){const n=e/t,s=this.imageContainerSize.width/this.imageContainerSize.height;return Math.max(n,s)/Math.min(n,s)<=2&&e>this.imageContainerSize.width&&t>this.imageContainerSize.height}formatSystemMessage(e){const t=new Date(e.time);(0,l.setTimeZoneOffset)(t,this._userInfo.timeZoneOffsetHours);const n=this._formatDate(t),s=(0,l.getUserCultureTimeFormat)(t,this._userInfo.cultureInfo);return e.text.replace("{datePart}",n).replace("{timePart}",s)}getLocalTime(e){const t=new Date(e);return(0,l.setTimeZoneOffset)(t,this._userInfo.timeZoneOffsetHours),(0,l.getUserCultureTimeFormat)(t,this._userInfo.cultureInfo)}showMessageFromAttachment(e){return e.text}getIsDuplicateMessage(e){return this.messages?this._duplicateIds.indexOf(e)!==-1:!1}static{this.\u0275fac=function(t){return new(t||M)(a.\u0275\u0275directiveInject(l.UserInfo),a.\u0275\u0275directiveInject(C.TranslateService),a.\u0275\u0275directiveInject(a.Injector),a.\u0275\u0275directiveInject(l.ContactColorService),a.\u0275\u0275directiveInject(Z.FeatureService))}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:M,selectors:[["crt-chat-messages"]],inputs:{messages:"messages",messagesCounter:"messagesCounter",chat:"chat"},outputs:{contactClick:"contactClick"},features:[a.\u0275\u0275NgOnChangesFeature],decls:2,vars:3,consts:[["class","first-message-date-separator messages-separator",4,"ngIf"],["class","message",3,"class","id","ngClass","ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"first-message-date-separator","messages-separator"],[1,"message",3,"id","ngClass","ngStyle"],["class","messages-separator",4,"ngIf"],["class","message-author",3,"hidden",4,"ngIf"],[1,"text-block",3,"ngSwitch"],["class","system-message-type",4,"ngSwitchCase"],["class","message-type text-message-type",3,"ngClass",4,"ngSwitchCase"],["class","attachment-message-type",4,"ngSwitchDefault"],[1,"messages-separator"],[1,"message-author",3,"hidden"],[1,"author-name"],[1,"author-photo",3,"contactClick","contact","contactColor"],[1,"system-message-type"],[1,"message-type","text-message-type",3,"ngClass"],[1,"message-text"],[1,"message-time"],[1,"attachment-message-type"],[3,"ngSwitch",4,"ngFor","ngForOf"],["class","message-type text-message-type",4,"ngIf"],[3,"ngSwitch"],["class","message-type image-message-type",4,"ngSwitchCase"],["class","message-type file-message-type",3,"ngClass",4,"ngSwitchDefault"],[1,"message-type","image-message-type"],["alt","",1,"image-container",3,"click","load","ngStyle","src"],[1,"image-time"],[1,"message-type","file-message-type",3,"ngClass"],[1,"download-file","message-text"],[1,"file-message-type-link",3,"href"],[1,"message-type","text-message-type"]],template:function(t,n){t&1&&a.\u0275\u0275template(0,Pe,3,1,"div",0)(1,Fe,8,16,"div",1),t&2&&(a.\u0275\u0275property("ngIf",n.firstMessageDate),a.\u0275\u0275advance(),a.\u0275\u0275property("ngForOf",n.messages)("ngForTrackBy",n.trackMessageById))},dependencies:[v.NgClass,v.NgForOf,v.NgIf,v.NgStyle,v.NgSwitch,v.NgSwitchCase,v.NgSwitchDefault,_.ContactPhotoComponent],styles:[".message[_ngcontent-%COMP%]{flex-direction:column;display:flex}.message[_ngcontent-%COMP%]:last-child{animation:_ngcontent-%COMP%_fadein .5s ease 1 alternate}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}.message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{font-family:Open Sans,serif;font-size:11px;text-align:center;letter-spacing:0;color:#999;opacity:1;vertical-align:top}.message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;cursor:pointer}.message[_ngcontent-%COMP%]   .message-author[_ngcontent-%COMP%]{margin-bottom:-13px;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{display:block;position:relative;bottom:-3px;float:right;text-align:center;font-family:Open Sans,serif;letter-spacing:0;color:#999;opacity:1;padding-top:2px;font-size:11px;margin-left:13px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:3px;display:inline-block;padding:8px 10px;margin:1px 0 1px 39px;text-align:left}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{text-align:left;font-family:Open Sans,serif;font-size:15px;letter-spacing:0;color:#444;opacity:1;white-space:pre-wrap;word-break:break-word}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-time[_ngcontent-%COMP%]{position:absolute;right:18px;bottom:18px;color:#fff;background-color:#999;font-size:11px;border-radius:12px;padding-left:5px;padding-right:5px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .message-image-item[_ngcontent-%COMP%]{position:relative}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:auto;background-position:center;object-fit:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .system-message-type[_ngcontent-%COMP%]{font-size:11px;text-align:center;color:#999;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{padding-left:22px;text-decoration:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K);background-repeat:no-repeat;background-position:2px 5px}.message.incoming-message[_ngcontent-%COMP%]{text-align:left}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:0 16px 16px 0;padding-right:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.text-message-type[_ngcontent-%COMP%]{padding-left:14px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 16px 0}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:0 16px 16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#4e7bd8}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K)}.message.incoming-message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{float:left}.message.incoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-left:7px}.message.outcoming-message[_ngcontent-%COMP%]{text-align:right}.message.outcoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-right:7px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:16px 0 0 16px;padding-left:16px;padding-right:14px;margin-right:0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:16px 0 16px 16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#e5e8ee}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGRhdGEtbmFtZT0iQ29tcG9uZW50IDQ2OSDigJMgMSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBzdHlsZT0iIj48cmVjdCBpZD0iYmFja2dyb3VuZHJlY3QiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHg9IjAiIHk9IjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIvPgogIAogIAogIAogIAo8ZyBjbGFzcz0iY3VycmVudExheWVyIiBzdHlsZT0iIj48dGl0bGU+TGF5ZXIgMTwvdGl0bGU+PGcgaWQ9Ikdyb3VwXzc0OTIiIGRhdGEtbmFtZT0iR3JvdXAgNzQ5MiIgY2xhc3M9IiIgc3Ryb2tlPSIjZGFkYWRhIiBzdHJva2Utb3BhY2l0eT0iMSI+CiAgICA8cGF0aCBpZD0iUGF0aF82OTQ0IiBkYXRhLW5hbWU9IlBhdGggNjk0NCIgZD0iTTMuNSw3LjUwMDAwNzgxMjQ5OTk3MyBsNSw0LjUgbDUsLTQuNSAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2RhZGFkYSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjAuOCIgc3Ryb2tlLW9wYWNpdHk9IjEiLz4KICA8L2c+PGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIgeTI9IjAuNSIgeDI9IjguNSIgeDE9IjguNSIgY2xhc3M9IiIvPjxsaW5lIGRhdGEtbmFtZT0iTGluZSA3NzgiIHkxPSIxMS41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMC41IiB4Mj0iOC41IiB4MT0iOC41IiBjbGFzcz0iIiBpZD0ic3ZnXzEiLz48bGluZSBpZD0iTGluZV83NzkiIGRhdGEtbmFtZT0iTGluZSA3NzkiIHgyPSIxNC41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMTQuNDgxNzAxNzM5MTMyNDA0IiB5MT0iMTQuNDgxNzAxNzM5MTMyNDA0IiB4MT0iMi41IiBjbGFzcz0iIi8+PHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIGNsYXNzPSIiIHk9IjIuMTk3ODAyNTQzNjQwMTM2NyIgeD0iNTEuMDk4OTAzNjU2MDA1ODYiIHRyYW5zZm9ybT0icm90YXRlKC0xLjU5MTE0NTE1NzgxNDAyNTkgNTkuMDk4OTAzNjU2MDA2MDE2LDEwLjE5NzgwMjU0MzY0MDAzNCkgIi8+PC9nPjwvc3ZnPg==)}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo[_ngcontent-%COMP%]   .contact-photo.no-photo[_ngcontent-%COMP%]{font-size:12px!important}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]{display:inline-block;width:16px}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{line-height:1.6em;font-size:1em;width:16px;height:16px;min-width:16px;min-height:16px}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]{background:linear-gradient(#fafcfe,#fafcfe) padding-box,linear-gradient(to bottom right,#0077ff40,#8a1fe640,#f1255b40,#ff180040) border-box;border:1px solid transparent}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{color:#444}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#999}.message.bot-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9Ikljb24gfCBBSSBDb3BpbG90IC0gMTZ4MTYgfCBoZWF2eSI+CjxnIGlkPSJTdWJ0cmFjdCI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDBfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjwvZz4KPGcgaWQ9InNoYXBlIj4KPHBhdGggZD0iTTE2IDhMNyAxMS41TDguNSA4TDAgMkwxNiA4WiIgZmlsbD0idXJsKCNwYWludDJfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGQ9Ik0xNiA4TDcgMTEuNUw4LjUgOEwwIDJMMTYgOFoiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyKSIvPgo8L2c+CjwvZz4KPGRlZnM+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQwX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMTg3OTk3IC0wLjgyMjgyOSkgcm90YXRlKDcyLjA0NjgpIHNjYWxlKDM2LjYyNyAxNS43Mzc5KSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQxX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjM1OTE5IC01LjEpIHJvdGF0ZSg1My43Njk0KSBzY2FsZSgzNi45NDMyIDE2LjQ2NSkiPgo8c3RvcCBzdG9wLWNvbG9yPSIjMDgxQTJGIi8+CjxzdG9wIG9mZnNldD0iMC42MSIgc3RvcC1jb2xvcj0iIzhBMUZFNiIvPgo8c3RvcCBvZmZzZXQ9IjAuOTM1IiBzdG9wLWNvbG9yPSIjRjEyNTVCIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGMTgwMCIvPgo8L3JhZGlhbEdyYWRpZW50Pgo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50Ml9yYWRpYWxfNDc0N183ODEwMiIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgwLjIwMTQ3NCAxLjUxMTQ1KSByb3RhdGUoNTkuNjc5NCkgc2NhbGUoMjMuOTY2NiAxNS4zMDQzKSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjYgLTEuMDI4MTMpIHJvdGF0ZSgzNy4wOTQ1KSBzY2FsZSgyOS4zMzY1IDEzLjE5MzQpIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzA4MUEyRiIvPgo8c3RvcCBvZmZzZXQ9IjAuNjEiIHN0b3AtY29sb3I9IiM4QTFGRTYiLz4KPHN0b3Agb2Zmc2V0PSIwLjkzNSIgc3RvcC1jb2xvcj0iI0YxMjU1QiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGRjE4MDAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K)!important;background-size:16px 16px;cursor:default}.messages-separator[_ngcontent-%COMP%]{width:100%;text-align:center;border-bottom:1px solid #e3e6ec;line-height:.1em;margin:17px 0}.messages-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;letter-spacing:0;color:#999;opacity:1;font-family:Open Sans,serif;font-size:11px}.first-message-date-separator[_ngcontent-%COMP%]{border:none;margin-top:8px}.incoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#eaedf3;border:1px solid #e3e6ec;align-self:flex-start}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#006ce0;align-self:flex-end}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%], .outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fff}.text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{position:relative;background-color:#fff;border:none}.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-left:0}.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-right:0}"]})}}(0,g.__decorate)([(0,i.CrtInput)(),(0,g.__metadata)("design:type",Array),(0,g.__metadata)("design:paramtypes",[Array])],M.prototype,"messages",null),(0,g.__decorate)([(0,i.CrtInput)(),(0,g.__metadata)("design:type",Object)],M.prototype,"messagesCounter",void 0),(0,g.__decorate)([(0,i.CrtInput)(),(0,g.__metadata)("design:type",ue)],M.prototype,"chat",void 0),(0,g.__decorate)([(0,i.CrtOutput)(),(0,g.__metadata)("design:type",Object)],M.prototype,"contactClick",void 0);function Le(r,e){if(r&1){const t=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",1)(1,"span",2),a.\u0275\u0275text(2),a.\u0275\u0275elementStart(3,"a",3),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(t);const s=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(s.contactClicked(s.chat.operator.contact==null?null:s.chat.operator.contact.id))}),a.\u0275\u0275text(4),a.\u0275\u0275elementEnd()()()}if(r&2){const t=a.\u0275\u0275nextContext(2);a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",t.getEndDateCaption(t.chat.completionDate)," "),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(t.chat.operator.contact==null?null:t.chat.operator.contact.name)}}function ze(r,e){if(r&1){const t=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div")(1,"div",1)(2,"span",2),a.\u0275\u0275text(3),a.\u0275\u0275elementStart(4,"a",3),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(t);const s=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(s.contactClicked(s.chat.contact.id))}),a.\u0275\u0275text(5),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(6,"div",4)(7,"crt-chat-messages",5),a.\u0275\u0275twoWayListener("chatChange",function(s){a.\u0275\u0275restoreView(t);const o=a.\u0275\u0275nextContext();return a.\u0275\u0275twoWayBindingSet(o.chat,s)||(o.chat=s),a.\u0275\u0275resetView(s)}),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(8,Le,5,2,"div",6),a.\u0275\u0275elementEnd()}if(r&2){const t=a.\u0275\u0275nextContext();a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate1(" ",t.getStartDateCaption(t.chat.chatStartDate)," "),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(t.chat.contact.name),a.\u0275\u0275advance(2),a.\u0275\u0275property("messages",t.messages),a.\u0275\u0275twoWayProperty("chat",t.chat),a.\u0275\u0275advance(),a.\u0275\u0275property("ngIf",t.isChatCompleted())}}class x{constructor(e,t,n){this.chatService=e,this._userInfo=t,this._translateService=n,this.contactClick=new a.EventEmitter,this.messagesLoaded=new a.EventEmitter}_loadHistory(){this.chatService.getChatHistory(this.chatId).pipe((0,c.tap)(e=>{e&&(this.messages=e,this._setChatInfo())})).subscribe()}_setChatInfo(){this.chatService.getItem(this.chatId).subscribe(e=>{e.success&&(this.chat=e.result[0],this.messagesLoaded.emit())})}getStartDateCaption(e){const t=this._translateService.instant("ChatSettings.History.Captions.StartDate");return ee.String.Format(t,this.formatChatDate(e))}getEndDateCaption(e){const t=this._translateService.instant("ChatSettings.History.Captions.EndDate");return ee.String.Format(t,this.formatChatDate(e))}formatChatDate(e){const t={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},n=e?new Date(e):new Date;return new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName,t).format(n)}ngOnInit(){(0,i.isEmptyGuid)(this.chatId)||this._loadHistory()}contactClicked(e){this.contactClick.emit({contactId:e})}isChatCompleted(){return this.chat.status.value===B.Completed}static{this.\u0275fac=function(t){return new(t||x)(a.\u0275\u0275directiveInject(y),a.\u0275\u0275directiveInject(l.UserInfo),a.\u0275\u0275directiveInject(C.TranslateService))}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:x,selectors:[["crt-omnichannel-messaging-chat-history"]],inputs:{chatId:[a.\u0275\u0275InputFlags.None,"chatid","chatId"]},outputs:{contactClick:"contactClick",messagesLoaded:"messagesLoaded"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"chat-status-info-container"],[1,"chat-date"],[1,"contact-name",3,"click"],[1,"chat-history-component-container"],[3,"chatChange","messages","chat"],["class","chat-status-info-container",4,"ngIf"]],template:function(t,n){t&1&&a.\u0275\u0275template(0,ze,9,5,"div",0),t&2&&a.\u0275\u0275property("ngIf",n.chat)},dependencies:[v.NgIf,M],styles:[`.chat-date{color:#999;font-size:13px;font-family:Open Sans,serif}.chat-history-component-container{margin-bottom:19px}.contact-name{font-size:13px;color:#4e7bd8;cursor:pointer}.contact-name:hover{text-decoration:underline}.full-chat-image-container{top:0;width:100%;height:100%;z-index:999999999999;position:fixed;align-items:center;background-position:center;background-repeat:no-repeat;background-color:#000000b3}
`],encapsulation:2})}}(0,g.__decorate)([(0,i.CrtInput)(),(0,g.__metadata)("design:type",ee.String)],x.prototype,"chatId",void 0),(0,g.__decorate)([(0,i.CrtOutput)(),(0,g.__metadata)("design:type",Object)],x.prototype,"contactClick",void 0),(0,g.__decorate)([(0,i.CrtOutput)(),(0,g.__metadata)("design:type",Object)],x.prototype,"messagesLoaded",void 0);var Ue=u(33e3);class R{constructor(e){this._academyService=e,this.academyUrl$=new c.BehaviorSubject("")}ngOnInit(){this._academyService.getAcademyHelpUrl("ChatAccess").pipe((0,c.take)(1)).subscribe(e=>{this.academyUrl$.next(e)})}static{this.\u0275fac=function(t){return new(t||R)(a.\u0275\u0275directiveInject(Ue.AcademyService))}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:R,selectors:[["ts-facebook-channel-error-dialog"]],decls:12,vars:12,consts:[["mat-dialog-content",""],[1,"message"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(a.\u0275\u0275elementStart(0,"div",0)(1,"span",1),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementStart(4,"a",2),a.\u0275\u0275pipe(5,"async"),a.\u0275\u0275text(6),a.\u0275\u0275pipe(7,"translate"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(8,"div",3)(9,"button",4),a.\u0275\u0275text(10),a.\u0275\u0275pipe(11,"translate"),a.\u0275\u0275elementEnd()()),t&2&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,4,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Message")," "),a.\u0275\u0275advance(2),a.\u0275\u0275propertyInterpolate("href",a.\u0275\u0275pipeBind1(5,6,n.academyUrl$),a.\u0275\u0275sanitizeUrl),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(7,8,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Link.Text")," "),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(11,10,"InfoDialog.OK")," "))},dependencies:[K.MatLegacyButton,V.MatLegacyDialogClose,V.MatLegacyDialogContent,V.MatLegacyDialogActions,v.AsyncPipe,C.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{float:right;margin-left:auto;border-radius:4px}"]})}}let ne=class extends i.BaseRequestHandler{constructor(e){super(),this._facebookProvider=e}handle(e){return this._facebookProvider.initialize().pipe((0,c.take)(1)).subscribe(),this.next?.handle(e)}};ne=(0,g.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.OpenFacebookIntegrationPageRequest",type:"crt.OpenFacebookIntegrationPageHandler"}),(0,g.__metadata)("design:paramtypes",[F])],ne);const P={OK:{key:"OK",config:{color:"primary",caption:"Dialog.Ok"}},YES:{key:"YES",config:{color:"primary",caption:"Dialog.Yes"}},NO:{key:"NO",config:{color:"default",caption:"Dialog.No"}}};let G=class extends i.BaseRequestHandler{constructor(e,t,n,s){super(),this._telegramService=e,this._messageDialogProvider=t,this._translateService=n,this._maskService=s}_setModelValue(e,t,n,s){const o=e.getViewModelAttributePaths(t,n)[0];e[o]=s}_setModelValues(e,t){var n=this;return(0,m.A)(function*(){const s=yield e.getPrimaryModelName();n._setModelValue(e,s,"Name",t.ChannelName),n._setModelValue(e,s,"Source",t.TelegramId),n._setModelValue(e,s,"MsgSettingsId",t.SettingsId)})()}handle(e){var t=this;return(0,m.A)(function*(){const n=e.$context,s=yield n.validate();if(Object.keys(s).length>0)return;yield t._maskService.showBodyMask();const o=yield n.TelegramToken,d=yield(0,c.firstValueFrom)(t._telegramService.registerTelegramChannel(o)),h=t._telegramService.validateRegisterChannel(d);if(yield t._maskService.hideBodyMask(),h?.length>0)t._messageDialogProvider.open({data:{message:t._translateService.instant(h),actions:[P.OK]}});else return yield t._setModelValues(n,d),t.next?.handle(e)})()}};G=(0,g.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.TelegramChannelSaveHandler",scopes:["TelegramChannel_AddingPage"]}),(0,g.__metadata)("design:paramtypes",[E,_.MessageDialogProviderAbstract,C.TranslateService,i.MaskService])],G);let Q=class extends i.BaseRequestHandler{constructor(e,t,n,s,o,d){super(),this._facebookApiProvider=e,this._channelService=t,this._facebookRegistrationService=n,this._maskService=s,this._dialogProvider=o,this._messageDialogProvider=d}_isCreateFacebookChannelRequest(e){return e.entityName==="Channel"&&this._getDefaultValue(e,"Provider")===S.FacebookMessenger}_getDefaultValue(e,t){return e.defaultValues.find(n=>n.attributeName===t)?.value}_getChannel(e){return{id:(0,i.generateGuid)(),name:e.name,typeId:S.FacebookMessenger,source:e.id,isActive:!1}}_addFacebookMessengerChannels(e){var t=this;return(0,m.A)(function*(){if(!(yield t._facebookApiProvider.isFacebookSettingValid())){yield(0,c.firstValueFrom)(t._dialogProvider.open(R,{panelClass:["crt-message-dialog"]}));return}t.initFacebookPages().pipe((0,c.concatMap)(n=>(0,c.from)(n)),(0,c.concatMap)(n=>t._facebookApiProvider.attachPage(n.token).pipe((0,c.concatMap)(()=>{const s=t._getChannel(n);return t._maskService.showBodyMask(),t._facebookRegistrationService.registerFacebookChannel(n.token,n.id).pipe((0,c.concatMap)(o=>o?.success?(s.msgSettingsId=o.SettingsId,s.id=(0,i.generateGuid)(),s.isActive=!0,(0,c.from)(t._channelService.insertItem(s)).pipe((0,c.concatMap)(()=>t._openChannelEditingPage(e,n.id,n.name,s.id)))):(t._messageDialogProvider.open({data:{message:o?.errorInfo?.message||"An unknown error occurred during the operation.",actions:[P.OK]}}),c.EMPTY)))})))).subscribe(()=>{console.log("FB channel connected")},null,()=>{(0,c.from)(t._reloadChannelsList(e)),t._maskService.hideBodyMask()})})()}_reloadChannelsList(e){return(0,m.A)(function*(){const{$context:t,scopes:n}=e,s=e.$context.models.find(d=>d.dataSource.initialConfig.entitySchemaName==="Channel"),o={type:"crt.LoadDataRequest",scopes:n,config:{loadType:i.DataSourceLoadType.Reload},$context:t,dataSourceName:s.dataSource.dataSourceName};yield i.HandlerChainService.instance.process(o)})()}_openChannelEditingPage(e,t,n,s){return(0,m.A)(function*(){const o=e.$context;yield o.executeRequest({type:"crt.OpenPageRequest",schemaName:"FBMessengerChannel_EditPage",modelInitConfigs:[{recordId:s,action:i.ModelInPageAction.Edit}],$context:o})})()}initFacebookPages(){return this._facebookApiProvider.initApi().pipe((0,c.concatMap)(()=>this._facebookApiProvider.login()),(0,c.concatMap)(()=>this._facebookApiProvider.getPages()))}handle(e){var t=this;return(0,m.A)(function*(){if(!t._isCreateFacebookChannelRequest(e))return t.next?.handle(e);yield t._addFacebookMessengerChannels(e)})()}};Q=(0,g.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.FacebookChannelCreateRecordHandler",scopes:["ChatSettingsPage"]}),(0,g.__metadata)("design:paramtypes",[j,A,L,i.MaskService,_.DialogProviderAbstract,_.MessageDialogProviderAbstract])],Q);let Y=class extends i.BaseRequestHandler{constructor(e,t,n,s,o){super(),this._whatsAppService=e,this._channelService=t,this._messageDialogProvider=n,this._translateService=s,this._maskService=o}_handleConnectError(e){if(e?.errorInfo?.errorCode){const t=this._whatsAppService.validateRegisterChannel(e);this._messageDialogProvider.open({data:{message:this._translateService.instant(t),actions:[P.OK]}})}}_getDigits(e){return e.replace(/\D+/g,"")}_setModelValue(e,t,n,s){const o=e.getViewModelAttributePaths(t,n)[0];e[o]=s}_setModelValues(e,t,n){var s=this;return(0,m.A)(function*(){const o=yield e.getPrimaryModelName();s._setModelValue(e,o,"MsgSettingsId",t.SettingsId),s._setModelValue(e,o,"Source",n),s._setModelValue(e,o,"Name",n)})()}handle(e){var t=this;return(0,m.A)(function*(){const n=e.$context,s=yield n.validate();if(Object.keys(s).length>0)return;yield t._maskService.showBodyMask();const o=yield n.TwilioToken,d=yield n.ApplicationId,h=t._getDigits(yield n.PhoneNumber);if(yield(0,c.firstValueFrom)(t.validateIntegration(h,o,d))){const H=yield(0,c.firstValueFrom)(t._whatsAppService.register(o,d,h)),Ce=t._whatsAppService.validateRegisterChannel(H);if(yield t._maskService.hideBodyMask(),Ce?.length>0)t._messageDialogProvider.open({data:{message:t._translateService.instant(Ce),actions:[P.OK]}});else return yield t._setModelValues(e.$context,H,h),t.next?.handle(e)}})()}validateIntegration(e,t,n){return new c.Observable(s=>{this._channelService.checkCanSaveChannel(e,S.WhatsApp,o=>{o?this._whatsAppService.tryConnect(t,n,e).subscribe(d=>{d?.IsConnectionSuccess?s.next(!0):(this._maskService.hideBodyMask(),this._handleConnectError(d),s.next(!1)),s.complete()}):(this._maskService.hideBodyMask(),this._messageDialogProvider.open({data:{message:this._translateService.instant("ChatSettings.ChannelPage.WhatsApp.ChannelDuplicatedErrorMessage"),actions:[P.OK]}}),s.next(!1),s.complete())})})}};Y=(0,g.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.WhatsAppSaveChannelHandler",scopes:["WhatsAppChannel_AddingPage"]}),(0,g.__metadata)("design:paramtypes",[z,A,_.MessageDialogProviderAbstract,C.TranslateService,i.MaskService])],Y);var He=u(59564),pe=u(10850);class Ve extends pe.CreateRecordRequest{}let q=class extends i.BaseRequestHandler{constructor(e,t,n){super(),this.dialogService=e,this.queryExecutor=t,this.translateService=n,this._dataSourceName="QueueAgentsListDS"}_getEntityName(e){return e.$context.dataSchemas[this._dataSourceName]?.dataSourceConfig?.config?.entitySchemaName}_getInsertQuery(e,t){var n=this;return(0,m.A)(function*(){const s=n._getEntityName(e),o=new i.InsertQuery(s);return[{path:"Operator",value:t,type:i.DataValueType.Guid},{path:"ChatQueue",value:yield e.$context.Id,type:i.DataValueType.Guid}].forEach(h=>{o.addColumn(h.path,h.value,h.type)}),o})()}_createDuplicationsValidator(e){return t=>{const n=e.find(s=>s.attributes.QueueAgentsListDS_Operator.value===t.id);return{success:(0,b.isEmpty)(n),message:this.translateService.instant("ChatSettings.ChatQueueOperatorDetail.DuplicationMessage")}}}_saveViewModel(e){return(0,m.A)(function*(){const{$context:t,scopes:n}=e,s={type:"crt.SaveRecordRequest",preventCardClose:!0,scopes:n,$context:t};return yield i.HandlerChainService.instance.process(s)})()}_reloadAgentDetail(e){return(0,m.A)(function*(){const t=e.$context,n=yield t.getPrimaryModelName(),s=yield t.getPrimaryDataSchema(),o={type:"crt.LoadDataRequest",config:{loadType:i.DataSourceLoadType.Reload},$context:t,parameters:[{type:"primaryColumnValue",value:s.primaryAttributeName}],dataSourceName:n};yield i.HandlerChainService.instance.process(o)})()}handle(e){var t=this;return(0,m.A)(function*(){if(e.$context.PrimaryModelMode===l.ModelMode.Create&&!(yield t._saveViewModel(e)))return;const s=yield e.$context.QueueAgentsList,o=yield(0,c.lastValueFrom)(t.dialogService.open(_.SelectSysAdminUnitDialogComponent,{data:{validator:t._createDuplicationsValidator(s)}}));if(o?.id){const d=yield t._getInsertQuery(e,o.id),h=t.queryExecutor.executeInsertQuery(d);yield(0,c.lastValueFrom)(h),yield t._reloadAgentDetail(e)}yield t.next?.handle(e)})()}};q=(0,g.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CreateQueueAgentHandler",requestType:"crt.CreateQueueAgentHandlerRequest"}),(0,g.__metadata)("design:paramtypes",[He.DialogService,T.QueryExecutor,C.TranslateService])],q);let J=class extends i.BaseRequestHandler{constructor(e){super(),this.telegramService=e,this._telegramBotAttrName="TelegramBot"}_setTelegramBotLink(e,t){const n=`<a target='_blank' href='https://t.me/${e}'>${e}</a>`;t[this._telegramBotAttrName]=n}handle(e){var t=this;return(0,m.A)(function*(){const n=e.$context,s=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"MsgSettingsId")[0],o=yield n[s],d=yield n[t._telegramBotAttrName];return o&&!d&&!t._getUserName$&&(t._getUserName$=t.telegramService.getTelegramUserName(o).subscribe(h=>{t._setTelegramBotLink(h,n),t._getUserName$.unsubscribe()})),yield t.next?.handle(e)})()}};J=(0,g.__decorate)([(0,i.CrtRequestHandler)({type:"crt.TelegramChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["TelegramChannel_EditPage"]}),(0,g.__metadata)("design:paramtypes",[E])],J);var We=u(23958);let X=class extends We.CanOpenPageHandler{constructor(e){super(e)}getOperation(){return"CanManageChats"}};X=(0,g.__decorate)([(0,i.CrtRequestHandler)({type:"crt.ChatSettingsPageInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["ChatSettingsPage"]}),(0,g.__metadata)("design:paramtypes",[a.Injector])],X);let ae=class extends i.BaseRequestHandler{constructor(e,t,n,s){super(),this._chatService=e,this._maskService=t,this._messageDialogProvider=n,this._translateService=s,this._channelsListName="ChannelsList",this._activeChatsValidationErrorMsgCode="ChatSettings.Channel.ActiveChatsValidationError"}_validateForActiveChats(e){var t=this;return(0,m.A)(function*(){yield t._maskService.showBodyMask();const n=yield(0,c.lastValueFrom)(t._chatService.hasUncompletedChats(e));if(yield t._maskService.hideBodyMask(),n){const s=t._translateService.instant(t._activeChatsValidationErrorMsgCode);return t._messageDialogProvider.open({data:{message:s,actions:[P.OK]}}),!1}return!0})()}_isValid(e){return this._validateForActiveChats(e)}handle(e){var t=this;return(0,m.A)(function*(){if(e.itemsAttributeName===t._channelsListName){const n=e.recordId;if(!(yield t._isValid(n)))return}t.next?.handle(e)})()}};ae=(0,g.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DeleteRecordRequest",type:"crt.ChanelDeleteRecordHandler",scopes:["ChatSettingsPage"]}),(0,g.__metadata)("design:paramtypes",[y,i.MaskService,_.MessageDialogProviderAbstract,C.TranslateService])],ae);let se=class extends i.BaseRequestHandler{constructor(e){super(),this._translateService=e,this._channelsListAttribute="ChannelsList",this._validationImageAttribute="ValidationImage"}_getAttributeValue(e,t,n){const s=e.getViewModelAttributePaths(t,n);return!s||s.length===0?"":e.attributes[s[0]]}_setupValidationError(e,t,n,s){const o=this._getAttributeValue(e,t,"Name"),d=this._translateService.instant(`ChatSettings.ChannelPage.ErrorCodes.${n}`,{channelName:o});s.tooltip=d,e.set(this._validationImageAttribute,s)}_resetValidationError(e){e.set(this._validationImageAttribute,null)}_validateChannelRecord(e){var t=this;return(0,m.A)(function*(){const n=e.attributes[t._validationImageAttribute];if(!n)return;const s=yield e.getPrimaryModelName(),o=t._getAttributeValue(e,s,"ErrorCode");return o?t._setupValidationError(e,s,o,n):t._resetValidationError(e)})()}_subscribeViewModelEvents(e){var t=this;const n=new c.Subscription;n.add(e.events$.pipe((0,c.filter)(({type:s,payload:o})=>s===pe.ViewModelEventType.FinishLoadModelAttributes&&o&&o[this._channelsListAttribute])).subscribe({next:function(){var s=(0,m.A)(function*(){const o=e.attributes[t._channelsListAttribute];for(const d of o)yield t._validateChannelRecord(d)});return function(){return s.apply(this,arguments)}}(),complete:()=>{n.unsubscribe()}}))}handle(e){var t=this;return(0,m.A)(function*(){yield t.next?.handle(e),t._subscribeViewModelEvents(e.$context)})()}};se=(0,g.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelInitRequest",type:"crt.ChannelErrorValidationHandler",scopes:["ChatSettingsPage"]}),(0,g.__metadata)("design:paramtypes",[C.TranslateService])],se);let ie=class extends i.BaseRequestHandler{_setFacebookPageLink(e,t,n){const s=`<a target='_blank' href='https://facebook.com/${t}'>${e}</a>`;n[this._facebookPageLinkAttrName]=s}constructor(e){super(),this._facebookSettingsService=e,this._facebookPageLinkAttrName="FacebookLink"}handle(e){var t=this;return(0,m.A)(function*(){const n=e.$context,s=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"Source")[0],o=yield n[s],d=yield n[t._facebookPageLinkAttrName];if(o&&!d&&!t._pageRequested){t._pageRequested=!0;const h=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"Id")[0],k=yield n[h];t._getPageName$=t._facebookSettingsService.getPageName(o,k).subscribe(H=>{t._setFacebookPageLink(H,o,n),t._getPageName$.unsubscribe()})}return yield t.next?.handle(e)})()}};ie=(0,g.__decorate)([(0,i.CrtRequestHandler)({type:"crt.FacebookChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["FBMessengerChannel_EditPage"]}),(0,g.__metadata)("design:paramtypes",[f])],ie);let oe=class extends i.BaseRequestHandler{constructor(e,t,n){super(),this._messageDialogProvider=e,this._translateService=t,this._maskService=n}_savePrimaryData(e){var t=this;return(0,m.A)(function*(){const n={type:"crt.SavePrimaryDataRequest",$context:e.$context,scopes:e.scopes},s=yield t.handlerChain.process(n);return s.find(d=>d.success===!1)||s[0]})()}handle(e){var t=this;return(0,m.A)(function*(){const s=yield e.$context.validate();if(!(Object.keys(s).length>0)){yield t._maskService.showBodyMask();try{const o=yield t._savePrimaryData(e);if(!o.success)throw new Error(o.errorInfo);yield t.handlerChain.process({$context:e.$context,type:"crt.ClosePageRequest"})}catch(o){t._messageDialogProvider.open({data:{message:t._translateService.instant(o?.message),actions:[P.OK]}})}finally{t._maskService.hideBodyMask()}}})()}};oe=(0,g.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.TelegramUpdateChannelHandler",scopes:["TelegramChannel_EditPage"]}),(0,g.__metadata)("design:paramtypes",[_.MessageDialogProviderAbstract,C.TranslateService,i.MaskService])],oe);let re=class extends i.BaseRequestHandler{constructor(){super(...arguments),this._whatsappAttrName="WhatsAppLink"}_setWhatsAppLink(e,t){const n=`<a target='_blank' href='https://wa.me/${e}'>${e}</a>`;t[this._whatsappAttrName]=n}handle(e){var t=this;return(0,m.A)(function*(){const n=e.$context,s=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"Source")[0],o=yield n[s],d=yield n[t._whatsappAttrName];return o&&!d&&t._setWhatsAppLink(o,n),yield t.next?.handle(e)})()}};re=(0,g.__decorate)([(0,i.CrtRequestHandler)({type:"crt.WhatsAppChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["WhatsAppChannel_EditPage"]})],re);let $=class ce{static{this.\u0275fac=function(t){return new(t||ce)}}static{this.\u0275mod=a.\u0275\u0275defineNgModule({type:ce})}static{this.\u0275inj=a.\u0275\u0275defineInjector({providers:[A,w,y,N,j,f,O,l.USER_INFO_PROVIDER,{provide:_.RightManagementService,useClass:U}],imports:[v.CommonModule,_.ContactPhotoModule,de.FormsModule,I.HttpClientModule,C.TranslateModule,K.MatLegacyButtonModule,V.MatLegacyDialogModule]})}};$=(0,g.__decorate)([(0,i.CrtModule)({requestHandlers:[G,Y,q,J,Q,ae,se,ie,re,X,oe]})],$),function(){(typeof ngJitMode>"u"||ngJitMode)&&a.\u0275\u0275setNgModuleScope($,{declarations:[x,M,R],imports:[v.CommonModule,_.ContactPhotoModule,de.FormsModule,I.HttpClientModule,C.TranslateModule,K.MatLegacyButtonModule,V.MatLegacyDialogModule],exports:[x,M,R]})}()}}]);
