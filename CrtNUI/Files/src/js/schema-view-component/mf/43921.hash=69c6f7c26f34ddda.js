(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[43921],{43921:(ue,H,h)=>{h.r(H),h.d(H,{TechnicalUserModule:()=>P});var c=h(5960),n=h(38495),S=h(96590),T=h(85638),A=h(21018);const X={"en-US":JSON.parse('{"Dialog":{"CanCompleteSession":"User session will be terminated within several minutes. Do you want to proceed?","CanCompleteUserSessions":"All user sessions will be complete. Do you want to proceed?","SelectFunctionalRolesPageCaption":"Select functional roles","SelectOrganizationalRolesPageCaption":"Select organizational roles","DeleteRoleCaption":"Do you want to exclude the user from the role?"},"Messages":{"SessionComplete":"Request to end the session was completed successfully","SessionNotComplete":"Request to end the session was completed with errors","SessionsComplete":"Request to end all sessions was completed successfully","SessionsNotComplete":"Request to end all sessions was completed with errors","UserIsNotSaved":"Save the user record before adding it to the roles","OAuthHealthCheckFailed":"OAuth health check failed","CreateDefaultResourceFailed":"Failed to create default resource","TechnicalUserCreationFailed":"User that has such a name already exist. Choose another name for your integration or use the existing user for this integration.","FetchingClientSecretFailed":"Fetching client secret failed","OAuthIntegrationCreationFailed":"Unable to save OAuth integration","DefaultResourceSuccessMessage":"Default resource was created","TestConnectionSuccess":"Connection established","TestConnectionError":"Connection failed","ErrorSavingSettings":"You lack permissions to change system settings"},"Captions":{"TechnicalUserLimitState":"Active technical users:"}}'),"ru-RU":JSON.parse('{"Dialog":{"CanCompleteSession":"\u0421\u0435\u0441\u0441\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430 \u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u0438\u0445 \u043C\u0438\u043D\u0443\u0442. \u0425\u043E\u0442\u0438\u0442\u0435 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C?","CanCompleteUserSessions":"\u0412\u0441\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0431\u0443\u0434\u0443\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u044B. \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C?","SelectFunctionalRolesPageCaption":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0435 \u0440\u043E\u043B\u0438","SelectOrganizationalRolesPageCaption":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0440\u0433\u0430\u043D\u0438\u0437\u0430\u0446\u0438\u043E\u043D\u043D\u044B\u0435 \u0440\u043E\u043B\u0438","DeleteRoleCaption":"\u0412\u044B \u0445\u043E\u0442\u0438\u0442\u0435 \u0438\u0441\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0438\u0437 \u0440\u043E\u043B\u0438?"},"Messages":{"SessionComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D \u0443\u0441\u043F\u0435\u0448\u043D\u043E","SessionNotComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D c \u043E\u0448\u0438\u0431\u043A\u043E\u0439","SessionsComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0432\u0441\u0435\u0445 \u0441\u0435\u0441\u0441\u0438\u0439 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D \u0443\u0441\u043F\u0435\u0448\u043D\u043E","SessionsNotComplete":"\u0417\u0430\u043F\u0440\u043E\u0441 \u043D\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u0435 \u0432\u0441\u0435\u0445 \u0441\u0435\u0441\u0441\u0438\u0439 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D c \u043E\u0448\u0438\u0431\u043A\u043E\u0439","UserIsNotSaved":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F, \u043F\u0440\u0435\u0436\u0434\u0435 \u0447\u0435\u043C \u043D\u0430\u0437\u043D\u0430\u0447\u0430\u0442\u044C \u0435\u043C\u0443 \u0440\u043E\u043B\u0438","OAuthHealthCheckFailed":"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 OAuth","CreateDefaultResourceFailed":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0440\u0435\u0441\u0443\u0440\u0441\u0430 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E","TechnicalUserCreationFailed":"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u0441 \u0442\u0430\u043A\u0438\u043C \u0438\u043C\u0435\u043D\u0435\u043C \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0440\u0443\u0433\u043E\u0435 \u0438\u043C\u044F \u0434\u043B\u044F \u0432\u0430\u0448\u0435\u0439 \u0438\u043D\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438 \u0438\u043B\u0438 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0434\u043B\u044F \u043D\u0435\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0435\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F","FetchingClientSecretFailed":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u0435\u043A\u0440\u0435\u0442 OAuth \u043A\u043B\u0438\u0435\u043D\u0442\u0430","OAuthIntegrationCreationFailed":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0438\u043D\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044E OAuth","DefaultResourceSuccessMessage":"\u0420\u0435\u0441\u0443\u0440\u0441 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E \u0441\u043E\u0437\u0434\u0430\u043D","TestConnectionSuccess":"\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043E","TestConnectionError":"\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u043D\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043E","ErrorSavingSettings":"\u0423 \u0432\u0430\u0441 \u043D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u043F\u0440\u0430\u0432 \u0434\u043B\u044F \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u044B\u0445 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A"},"Captions":{"TechnicalUserLimitState":"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439:"}}')};var o=h(73308),_=h(79772),y=h(59564),a=h(62278),u=h(63721),f=h(35266),R=h(35293),m=h(59131);class C{constructor(e,t){this._httpClient=e,this._queryExecutor=t,this.serviceEndpoint="rest/AdministrationService/"}_getUserSysAdminUnitType(e){var t=this;return(0,o.A)(function*(){const s=new n.EntitySchemaQuery("SysAdminUnit");s.addSchemaColumn("SysAdminUnitTypeValue","SysAdminUnitTypeValue"),s.filters.addSchemaColumnFilterWithParameter(n.ComparisonType.Equal,"Id",e);const r=t._queryExecutor.executeSelectQuery(s).pipe((0,a.map)(d=>d[0].SysAdminUnitTypeValue)),i=yield(0,a.lastValueFrom)(r);return Promise.resolve(i)})()}getCompleteSessionById(e){const t=this.serviceEndpoint+"TerminateSession";return this._httpClient.post(t,{recordId:e})}getCompleteAllSessionsByUserId(e){const t=this.serviceEndpoint+"TerminateUserSessions";return this._httpClient.post(t,{recordId:e})}getAddUserRoles(e,t){const s=this.serviceEndpoint+"AddUserRoles";return this._httpClient.post(s,{roleIds:JSON.stringify(t),userId:e})}getRemoveUserRole(e){const t=this.serviceEndpoint+"RemoveUsersInRoles";return this._httpClient.post(t,{recordIds:JSON.stringify(e),roleIds:"",userIds:""}).pipe((0,a.map)(r=>{const i=JSON.parse(r.RemoveUsersInRolesResult);return{Success:i.Success,DeletedItems:i.DeletedItems,ExceptionMessage:i.ExceptionMessage}}))}createTechnicalUser(e){const t=this.serviceEndpoint+"UpdateOrCreateTechnicalUser",s=(0,R.A)();return this._httpClient.post(t,{Name:e,Id:s,Active:!0}).pipe((0,a.map)(i=>({TechnicalUserId:s,ExceptionMessage:i})),(0,a.catchError)(i=>(0,a.throwError)(()=>new Error(i))))}deleteUser(e){const t=this.serviceEndpoint+"DeleteUser";return this._httpClient.post(t,{userId:e})}getUserSysAdminUnitType(e){var t=this;return(0,o.A)(function*(){return yield t._getUserSysAdminUnitType(e)})()}getUserLink(e,t){return e===4?window.location.origin+window.location.pathname+`#CardModuleV2/UserPageV2/edit/${t}`:e===7?window.location.origin+window.location.pathname+`#Card/TechnicalUsers_FormPage/edit/${t}`:""}static{this.\u0275fac=function(t){return new(t||C)(m.\u0275\u0275inject(u.HttpClient),m.\u0275\u0275inject(f.QueryExecutor))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac,providedIn:"root"})}}class v{constructor(e){this._httpClient=e,this.serviceEndpoint="rest/OAuthConfigService/"}isOAuthHealthCheckResult(e){return e&&typeof e.HasProblem=="boolean"&&typeof e.IsSystemSettingsFilledIn=="boolean"&&typeof e.IsIdentityServiceAvailable=="boolean"&&typeof e.IsAccessTokenRetrievableForSystemActions=="boolean"&&typeof e.IsDefaultResourceRegistered=="boolean"}getAddDefaultOAuthResource(){const e=this.serviceEndpoint+"AddDefaultResource";return this._httpClient.post(e,{}).pipe((0,a.map)(s=>({success:s.AddDefaultResourceResult.success,errorInfo:s.AddDefaultResourceResult.errorInfo})))}getOAuthHealthCheck(){return this._httpClient.get("api/OAuthHealthCheck").pipe((0,a.catchError)(t=>t.status===500&&t.error&&this.isOAuthHealthCheckResult(t.error)?(0,a.of)(t.error):(0,a.throwError)(()=>new Error(t.message))))}getClientSecret(e){const t=this.serviceEndpoint+"GetClientSecret";return this._httpClient.post(t,{clientAppId:e}).pipe((0,a.map)(r=>r.GetClientSecretResult),(0,a.catchError)(r=>(0,a.throwError)(()=>new Error(r))))}getTestOAuthConnectionCheck(e,t,s){const r="api/TestOAuthConnection/Check",i={serverUrl:e,clientId:t,clientSecret:s};return this._httpClient.post(r,i)}static{this.\u0275fac=function(t){return new(t||v)(m.\u0275\u0275inject(u.HttpClient))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac,providedIn:"root"})}}let Z=class extends n.BaseRequest{};Z=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.AddOAuthIntegrationRequest"})],Z);let w=class extends n.BaseRequestHandler{constructor(e,t,s,r){super(),this._administrationService=e,this._oauthService=t,this._notifyService=s,this._translateService=r}_showErrorMessage(e){var t=this;return(0,o.A)(function*(){e&&(yield t._notifyService.show({message:e}))})()}_saveRecord(e){return(0,o.A)(function*(){const t={type:"crt.SaveRecordRequest",preventCardClose:!0,$context:e};return yield e.executeRequest(t)})()}_refreshGrid(e,t,s){return(0,o.A)(function*(){const r={type:"crt.LoadDataRequest",config:{loadType:n.DataSourceLoadType.Reload},$context:s,parameters:[{type:"primaryColumnValue",value:t.primaryAttributeName}],dataSourceName:e};yield n.HandlerChainService.instance.process(r)})()}_handleError(e,t){var s=this;return(0,o.A)(function*(){try{return yield e()}catch{throw new Error(s._translateService.instant(t))}})()}_createTechnicalUser(e){var t=this;return(0,o.A)(function*(){const s=yield t._handleError(()=>(0,a.lastValueFrom)(t._administrationService.createTechnicalUser(e.integrationName)),"Messages.TechnicalUserCreationFailed");if(s?.ExceptionMessage===""){const r="formApiModel";e.$context[r].controls.OAuthClientAppSystemUser.value=s.TechnicalUserId}else throw new Error(t._translateService.instant("Messages.TechnicalUserCreationFailed"))})()}_deleteTechnicalUser(e){var t=this;return(0,o.A)(function*(){const r=yield e.$context["formApiModel"].controls.OAuthClientAppSystemUser.value;yield t._handleError(()=>(0,a.lastValueFrom)(t._administrationService.deleteUser(r)),"Messages.TechnicalUserCreationFailed")})()}_setClientSecret(e){var t=this;return(0,o.A)(function*(){const s="attributes",r="OAuthClientSecretKey",i=e.$context[s].Id,d=yield t._handleError(()=>(0,a.lastValueFrom)(t._oauthService.getClientSecret(i)),"Messages.FetchingClientSecretFailed");if(d?.success)e.$context[r]=d.clientSecret,e.$context[s].IsChanged=!1;else throw new Error(t._translateService.instant("Messages.FetchingClientSecretFailed"))})()}handle(e){var t=this;return(0,o.A)(function*(){try{e.createTechnicalUser&&(yield t._createTechnicalUser(e));const s=e.$context;if(!(yield t._saveRecord(s)))return e.createTechnicalUser&&(yield t._deleteTechnicalUser(e)),yield t._showErrorMessage(t._translateService.instant("Messages.OAuthIntegrationCreationFailed")),!1;const i=yield s.getPrimaryModelName(),d=yield s.getPrimaryDataSchema();yield t._refreshGrid(i,d,s),yield t._setClientSecret(e);const g="IsAppRegistrationStagePassed";return e.$context[g]=!0,!0}catch(s){const r=s;return yield t._showErrorMessage(r.message),!1}})()}};w=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.AddOAuthIntegrationHandler",requestType:"crt.AddOAuthIntegrationRequest"}),(0,c.__metadata)("design:paramtypes",[C,v,y.NotifyService,_.TranslateService])],w);var I;(function(l){l[l.Organizational=0]="Organizational",l[l.Functional=1]="Functional"})(I||(I={}));let ee=class extends n.BaseRequest{};ee=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.AddRolesToTechnicalUserRequest"})],ee);let b=class extends n.BaseRequestHandler{constructor(e,t,s){super(),this._administrationService=e,this._translateService=t,this._notifyService=s}_showErrorMessage(e){var t=this;return(0,o.A)(function*(){yield t._notifyService.show({message:e})})()}_refreshGrid(e,t){var s=this;return(0,o.A)(function*(){const r=e.$context,d={type:"crt.LoadDataRequest",scopes:e.scopes,config:{loadType:n.DataSourceLoadType.Reload},$context:r,dataSourceName:t};yield s.handlerChain.process(d)})()}_refreshGrids(e){var t=this;return(0,o.A)(function*(){const s=e.dataSourceNames;for(const r of s)yield t._refreshGrid(e,r)})()}_getLookupPageFeatures(){return{create:{enabled:!1},select:{multiple:!0,selectAll:!0}}}_getCaptionKey(e){return e.rolesType===I.Functional?"Dialog.SelectFunctionalRolesPageCaption":"Dialog.SelectOrganizationalRolesPageCaption"}_getOpenLookupPageRequestConfig(e){const t=e.$context,s=e.scopes;return{type:"crt.OpenSelectionWindowRequest",$context:t,scopes:s,entitySchemaName:"SysAdminUnit",schemaName:"AddRolesSelectionPage",caption:this._translateService.instant(this._getCaptionKey(e)),features:this._getLookupPageFeatures(),afterClosed:r=>this._processLookupPageResult(e,r),filtersConfig:this._getLookupPageFiltersConfig(e)}}_getRoleTypedFilter(e){const t=[];e===I.Functional?t.push(6):t.push(0,1,2,3);const s=new n.ColumnExpression({columnPath:"SysAdminUnitTypeValue"}),r=t.map(i=>new n.ParameterExpression({value:i}));return new n.InFilter(n.ComparisonType.Equal,s,r)}_getLookupPageFiltersConfig(e){const t=e.userId,s=e.rolesType,r="lookupObjectFilter",i=new n.FilterGroup(n.LogicalOperatorType.And),d=new n.CompareFilter(n.ComparisonType.Equal,new n.ColumnExpression({columnPath:"SysUser"}),new n.ParameterExpression({value:t}));i.add(d);const g=new n.FilterGroup(n.LogicalOperatorType.And),O=new n.ColumnExpression({columnPath:"[SysUserInRole:SysRole:Id].Id"}),x=new n.ExistsFilter(O,i,n.ComparisonType.Not_exists);g.add(x),g.add(this._getRoleTypedFilter(s));const pe=new n.IsNullFilter(n.ComparisonType.Is_not_null,new n.ColumnExpression({columnPath:"ParentRole"}));g.add(pe);const me=new n.CompareFilter(n.ComparisonType.Equal,new n.ColumnExpression({columnPath:"ConnectionType"}),new n.ParameterExpression({value:0}));return g.add(me),{filterAttributes:[{name:r,loadOnChange:!1}],attributesConfig:{[r]:{value:g}}}}_processLookupPageResult(e,t){var s=this;return(0,o.A)(function*(){if(t.canceled)return;const i=e.userId,d=yield t.getLookupValues();if(d.length===0)return;const g=[];d.forEach(O=>{g.push(O.value)}),s._administrationService.getAddUserRoles(i,g).pipe((0,a.map)(function(){var O=(0,o.A)(function*(x){if(x?.AddUserRolesResult){yield s._showErrorMessage(x.AddUserRolesResult);return}yield s._refreshGrids(e)});return function(x){return O.apply(this,arguments)}}())).subscribe()})()}handle(e){var t=this;return(0,o.A)(function*(){if((yield e.$context.PrimaryModelMode)===A.ModelMode.Create){yield t._showErrorMessage(t._translateService.instant("Messages.UserIsNotSaved"));return}const r=t._getOpenLookupPageRequestConfig(e);yield t.handlerChain.process(r),yield t.next?.handle(e)})()}};b=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.AddRolesToTechnicalUserHandler",requestType:"crt.AddRolesToTechnicalUserRequest"}),(0,c.__metadata)("design:paramtypes",[C,_.TranslateService,y.NotifyService])],b);var E=h(20822);let te=class extends n.BaseRequest{};te=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.CompleteUserSessionRequest"})],te);let F=class extends n.BaseRequestHandler{constructor(e,t,s,r){super(),this._messageDialogProvider=e,this._administrationService=t,this._translateService=s,this._notifyService=r}_canCompleteSession(){return(0,a.lastValueFrom)(this._messageDialogProvider.confirmation("Dialog.CanCompleteSession"))}_refreshGrid(e){var t=this;return(0,o.A)(function*(){const s=e.$context,r=e.scopes,i=e.dataSourceName,d={type:"crt.LoadDataRequest",scopes:r,config:{loadType:n.DataSourceLoadType.Reload},$context:s,dataSourceName:i};yield t.handlerChain.process(d)})()}handle(e){var t=this;return(0,o.A)(function*(){if(!(yield t._canCompleteSession()))return;const s=e.sessionId;t._administrationService.getCompleteSessionById(s).pipe((0,a.map)(function(){var r=(0,o.A)(function*(i){const d=i.TerminateSessionResult===1?"Messages.SessionComplete":"Messages.SessionNotComplete",g=t._translateService.instant(d);yield t._notifyService.show({message:g}),i.TerminateSessionResult===1&&(yield t._refreshGrid(e))});return function(i){return r.apply(this,arguments)}}())).subscribe(),yield t.next?.handle(e)})()}};F=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.CompleteUserSessionHandler",requestType:"crt.CompleteUserSessionRequest"}),(0,c.__metadata)("design:paramtypes",[E.MessageDialogProvider,C,_.TranslateService,y.NotifyService])],F);let se=class extends n.BaseRequest{};se=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.CompleteAllUserSessionsRequest"})],se);let D=class extends n.BaseRequestHandler{constructor(e,t,s,r){super(),this._messageDialogProvider=e,this._administrationService=t,this._translateService=s,this._notifyService=r}_canCompleteSession(){return(0,a.lastValueFrom)(this._messageDialogProvider.confirmation("Dialog.CanCompleteUserSessions"))}_refreshGrid(e){var t=this;return(0,o.A)(function*(){const s=e.$context,r=e.scopes,i=e.dataSourceName,d={type:"crt.LoadDataRequest",scopes:r,config:{loadType:n.DataSourceLoadType.Reload},$context:s,dataSourceName:i};yield t.handlerChain.process(d)})()}handle(e){var t=this;return(0,o.A)(function*(){if(!(yield t._canCompleteSession()))return;const s=e.userId;t._administrationService.getCompleteAllSessionsByUserId(s).pipe((0,a.map)(function(){var r=(0,o.A)(function*(i){const d=i.TerminateUserSessionsResult===1?"Messages.SessionsComplete":"Messages.SessionsNotComplete",g=t._translateService.instant(d);yield t._notifyService.show({message:g}),i.TerminateUserSessionsResult===1&&(yield t._refreshGrid(e))});return function(i){return r.apply(this,arguments)}}())).subscribe(),yield t.next?.handle(e)})()}};D=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.CompleteAllUserSessionsHandler",requestType:"crt.CompleteAllUserSessionsRequest"}),(0,c.__metadata)("design:paramtypes",[E.MessageDialogProvider,C,_.TranslateService,y.NotifyService])],D);let ne=class extends n.BaseRequest{};ne=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.CreateDefaultOAuthResourceRequest"})],ne);let q=class extends n.BaseRequestHandler{constructor(e,t,s,r){super(),this._maskService=e,this._notifyService=t,this._oauthService=s,this._translateService=r}_tryCreateResource(){var e=this;return(0,o.A)(function*(){let t;try{const s=yield(0,a.firstValueFrom)(e._oauthService.getAddDefaultOAuthResource());s.success?t=e._translateService.instant("Messages.DefaultResourceSuccessMessage"):t=s?.errorInfo?.message??e._translateService.instant("Messages.CreateDefaultResourceFailed")}catch{t=e._translateService.instant("Messages.CreateDefaultResourceFailed")}yield e._notifyService.show({message:t})})()}_refreshHealthCheck(e){var t=this;return(0,o.A)(function*(){const s=e.$context,i={type:"crt.OAuthHealthCheckRequest",showBodyMask:!1,scopes:e.scopes,$context:s};yield t.handlerChain.process(i)})()}handle(e){var t=this;return(0,o.A)(function*(){t._maskService.showBodyMask(),yield t._tryCreateResource(),yield t._refreshHealthCheck(e),t._maskService.hideBodyMask()})()}};q=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.CreateDefaultOAuthResourceHandler",requestType:"crt.CreateDefaultOAuthResourceRequest"}),(0,c.__metadata)("design:paramtypes",[y.MaskService,y.NotifyService,v,_.TranslateService])],q);let re=class extends n.BaseRequest{};re=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.OpenUserCardRequest"})],re);let L=class extends n.BaseRequestHandler{constructor(e,t){super(),this._window=e,this._administrationService=t}handle(e){var t=this;return(0,o.A)(function*(){const s=e.systemUserId,r=yield t._administrationService.getUserSysAdminUnitType(s),i=t._administrationService.getUserLink(r,s);if(i){const d=e.openInNewWindow?"_blank":"_self";t._window.open(i,d)}})()}};L=(0,c.__decorate)([(0,n.CrtRequestHandler)({requestType:"crt.OpenUserCardRequest",type:"crt.OpenUserCardHandler"}),(0,c.__param)(0,(0,n.CrtInject)(S.WINDOW_TOKEN)),(0,c.__metadata)("design:paramtypes",[Window,C])],L);let ie=class extends n.BaseRequest{};ie=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.OpenOAuthClientPageRequest"})],ie);let k=class extends n.BaseRequestHandler{constructor(e,t,s){super(),this._window=e,this._featureService=t,this._oauthService=s}_redirectTo7xPage(e,t){const s=this._window.location.origin+this._window.location.pathname+`#CardModuleV2/OAuthClientAppPage/${e}/${t}`;this._window.location.replace(s),this._window.location.reload()}_fillClientSecret(e,t){var s=this;return(0,o.A)(function*(){const r=yield(0,a.lastValueFrom)(s._oauthService.getClientSecret(t));e.OAuthClientAppDS_ClientSecretText_Control=r.clientSecret})()}handle(e){var t=this;return(0,o.A)(function*(){const s=e.$context,r=yield s.attributes.CardState;let i="";if(r==="edit"&&(i=s.attributes.Id),!(yield(0,a.lastValueFrom)(t._featureService.getFeatureState("EnableFreedomUIOAuthSection")))){t._redirectTo7xPage(r,i);return}r==="edit"&&(yield t._fillClientSecret(s,i),s.attributes.IsChanged=!1)})()}};k=(0,c.__decorate)([(0,n.CrtRequestHandler)({requestType:"crt.OpenOAuthClientPageRequest",type:"crt.OpenOAuthClientPageHandler"}),(0,c.__param)(0,(0,n.CrtInject)(S.WINDOW_TOKEN)),(0,c.__metadata)("design:paramtypes",[Window,T.FeatureService,v])],k);let ae=class extends n.BaseRequest{};ae=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.RemoveRoleFromTechnicalUserRequest"})],ae);let N=class extends n.BaseRequestHandler{constructor(e,t,s){super(),this._messageDialogProvider=e,this._administrationService=t,this._notifyService=s}_showErrorMessage(e){var t=this;return(0,o.A)(function*(){e&&(yield t._notifyService.show({message:e}))})()}_refreshGrid(e,t){var s=this;return(0,o.A)(function*(){const r=e.$context,d={type:"crt.LoadDataRequest",scopes:e.scopes,config:{loadType:n.DataSourceLoadType.Reload,useLastLoadParameters:!0},$context:r,dataSourceName:t};yield s.handlerChain.process(d)})()}_refreshGrids(e){var t=this;return(0,o.A)(function*(){const s=e.dataSourceNames;for(const r of s)yield t._refreshGrid(e,r)})()}_canRemoveUserRole(){return(0,a.lastValueFrom)(this._messageDialogProvider.confirmation("Dialog.DeleteRoleCaption"))}handle(e){var t=this;return(0,o.A)(function*(){if(!(yield t._canRemoveUserRole()))return;const s=[e.recordId];t._administrationService.getRemoveUserRole(s).pipe((0,a.map)(function(){var r=(0,o.A)(function*(i){i?.Success?yield t._refreshGrids(e):yield t._showErrorMessage(i?.ExceptionMessage)});return function(i){return r.apply(this,arguments)}}()),(0,a.catchError)(function(){var r=(0,o.A)(function*(i){yield t._showErrorMessage(i.message)});return function(i){return r.apply(this,arguments)}}())).subscribe(),yield t.next?.handle(e)})()}};N=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.RemoveRoleFromTechnicalUserHandler",requestType:"crt.RemoveRoleFromTechnicalUserRequest"}),(0,c.__metadata)("design:paramtypes",[E.MessageDialogProvider,C,y.NotifyService])],N);var he=h(29957);class U{constructor(e){this._httpClient=e,this.serviceEndpoint="rest/TechnicalUserLimitService/"}getLimitState(){const e=this.serviceEndpoint+"GetLimitState";return this._httpClient.get(e)}static{this.\u0275fac=function(t){return new(t||U)(m.\u0275\u0275inject(u.HttpClient))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}}let oe=class extends n.BaseRequest{};oe=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.UpdateTechnicalUserLimitStateRequest"})],oe);let B=class extends n.BaseRequestHandler{constructor(e,t){super(),this._technicalUserLimitService=e,this._translateService=t,this._currentLimitLabelCaption="",this._currentLimitLabelValue=""}_getCurrentLimit(){var e=this;return(0,o.A)(function*(){try{const t=yield(0,a.firstValueFrom)(e._technicalUserLimitService.getLimitState());if(t.limit===0&&t.count===0){e._currentLimitLabelValue="",e._currentLimitLabelCaption="";return}e._currentLimitLabelCaption=yield e._translateService.instant("Captions.TechnicalUserLimitState");const s="{0}/{1}";e._currentLimitLabelValue=he.String.format(s,t.count,t.limit)}catch{e._currentLimitLabelValue=""}})()}handle(e){var t=this;return(0,o.A)(function*(){yield t._getCurrentLimit(),e.$context.CurrentLimitStateLabelCaption=t._currentLimitLabelCaption,e.$context.CurrentLimitStateLabelValue=t._currentLimitLabelValue})()}};B=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.UpdateTechnicalUserLimitStateHandler",requestType:"crt.UpdateTechnicalUserLimitStateRequest"}),(0,c.__metadata)("design:paramtypes",[U,_.TranslateService])],B);let $=class extends n.BaseRequestHandler{handle(e){var t=this;return(0,o.A)(function*(){yield(yield e.$context.OAuthSysSettingsChangedSubscription).unsubscribe(),yield t.next?.handle(e)})()}};$=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.CloseOAuthListPageHandler",requestType:"crt.HandleViewModelPauseRequest ",scopes:["OAuthAuthorization_ListPage"]})],$);let V=class extends n.BaseRequestHandler{_setButtonDisabled(e){return(0,o.A)(function*(){if(e.attributeName==="ServerUrl"||e.attributeName==="ClientId"||e.attributeName==="ClientSecret"){const t=yield e.$context.ServerUrl,s=yield e.$context.ClientId,r=yield e.$context.ClientSecret;e.$context.ButtonTestDisabled=!t||!s||!r}})()}handle(e){var t=this;return(0,o.A)(function*(){yield t._setButtonDisabled(e),yield t.next?.handle(e)})()}};V=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.EnableTestConnectionButtonPageHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["OAuthSettingsMiniPage"]})],V);let ce=class extends n.BaseRequest{};ce=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.OAuthHealthCheckRequest"})],ce);let G=class extends n.BaseRequestHandler{constructor(e,t){super(),this._oauthService=e,this._maskService=t}_getCanCreateResource(e){return e.HasProblem&&e.IsSystemSettingsFilledIn&&e.IsIdentityServiceAvailable&&e.IsAccessTokenRetrievableForSystemActions&&!e.IsDefaultResourceRegistered}_fillContext(e,t){e.$context.HasProblem=t.HasProblem,e.$context.IsSystemSettingsFilledIn=t.IsSystemSettingsFilledIn,e.$context.IsIdentityServiceAvailable=t.IsIdentityServiceAvailable,e.$context.IsAccessTokenRetrievableForSystemActions=t.IsAccessTokenRetrievableForSystemActions,e.$context.IsDefaultResourceRegistered=t.IsDefaultResourceRegistered,e.$context.HealthCheckMessage=t.Message,e.$context.HealthCheckReason=t.Reason,e.$context.DisableCreateDefaultResource=!this._getCanCreateResource(t)}handle(e){var t=this;return(0,o.A)(function*(){e.showBodyMask&&t._maskService.showBodyMask();const s=yield(0,a.firstValueFrom)(t._oauthService.getOAuthHealthCheck());t._fillContext(e,s),e.showBodyMask&&t._maskService.hideBodyMask()})()}};G=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.OAuthHealthCheckHandler",requestType:"crt.OAuthHealthCheckRequest"}),(0,c.__metadata)("design:paramtypes",[v,y.MaskService])],G);let j=class extends n.BaseRequestHandler{constructor(e){super(),this._messageChannelService=e}_refreshHealthCheck(e){var t=this;return(0,o.A)(function*(){const s=e.$context,i={type:"crt.OAuthHealthCheckRequest",showBodyMask:!1,scopes:e.scopes,$context:s};yield t.handlerChain.process(i)})()}_openDiagnosticTab(e){return(0,o.A)(function*(){e.$context.ShowDiagnostic=!0,(yield e.$context.HasProblem)&&(e.$context.CardToggleTabPanel_SelectedItem={displayValue:"Diagnostic",icon:"settings-tab-icon",iconPosition:"left-icon",value:"OpenDiagnosticButton"})})()}_subscribeOnNotificationMessage(e){var t=this;return(0,o.A)(function*(){const s="OAuthSysSettingsChanged",r=()=>{t._refreshHealthCheck(e)};e.$context.OAuthSysSettingsChangedSubscription=yield t._messageChannelService.subscribe(s,r)})()}handle(e){var t=this;return(0,o.A)(function*(){yield t.next?.handle(e),yield t._refreshHealthCheck(e),yield t._subscribeOnNotificationMessage(e),yield t._openDiagnosticTab(e)})()}};j=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.OpenOAuthListPageHandler",requestType:"crt.HandleViewModelResumeRequest",scopes:["OAuthAuthorization_ListPage"]}),(0,c.__metadata)("design:paramtypes",[A.MessageChannelService])],j);var le=h(23958);let z=class extends le.CanOpenPageHandler{constructor(e){super(e)}getOperation(){return"CanManageOAuth"}};z=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.OpenOAuthSettingsPageHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["OAuthAuthorization_ListPage","OAuthSettingsMiniPage","OAuthAuthorizationEditPage","OAuthAuthorization_Detail","OAuthAuthorization_FormPage","OAuthClientAppMiniPage"]}),(0,c.__metadata)("design:paramtypes",[m.Injector])],z);let W=class extends le.CanOpenPageHandler{constructor(e){super(e)}getOperation(){return"CanManageTechnicalUsers"}};W=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.OpenTechnicalUsersPageHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["TechnicalUsers_FormPage","TechnicalUsers_ListPage"]}),(0,c.__metadata)("design:paramtypes",[m.Injector])],W);let K=class extends n.BaseRequestHandler{constructor(e,t){super(),this._systemSettings=e,this._maskService=t}_fillOAuthSettings(e){var t=this;return(0,o.A)(function*(){let s={},r={};yield t._systemSettings.getByCode("OAuth20IdentityServerUrl").then(i=>{s=i}).catch(()=>{s.value=""}),yield t._systemSettings.getByCode("OAuth20IdentityServerClientId").then(i=>{r=i}).catch(()=>{r.value=""}),e.$context.ServerUrl=s.value,e.$context.ClientId=r.value})()}handle(e){var t=this;return(0,o.A)(function*(){yield t.next?.handle(e),t._maskService.showBodyMask(),yield t._fillOAuthSettings(e),t._maskService.hideBodyMask()})()}};K=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.ResumeOAuthSettingsPageHandler",requestType:"crt.HandleViewModelResumeRequest",scopes:["OAuthSettingsMiniPage"]}),(0,c.__metadata)("design:paramtypes",[n.SysSettingsService,y.MaskService])],K);let J=class extends n.BaseRequestHandler{constructor(e,t,s,r,i){super(),this._systemSettings=e,this._maskService=t,this._messageChannelService=s,this._notifyService=r,this._translateService=i,this._oauthSysSettingsChangedMessage="OAuthSysSettingsChanged"}_saveSettingIfTouched(e,t,s){var r=this;return(0,o.A)(function*(){const i=e.$context.formApiModel.controls[t];if(!i?.touched)return!0;const d={value:i.value,code:s};try{const g=yield r._systemSettings.update(d,!1);return Promise.resolve(g.saveResult[s])}catch{return Promise.resolve(!1)}})()}_saveOAuthSettings(e){var t=this;return(0,o.A)(function*(){const s=[{name:"ServerUrl",code:"OAuth20IdentityServerUrl"},{name:"ClientId",code:"OAuth20IdentityServerClientId"},{name:"ClientSecret",code:"OAuth20IdentityServerClientSecret"}];for(const r of s)if(!(yield t._saveSettingIfTouched(e,r.name,r.code)))return Promise.resolve(!1);return Promise.resolve(!0)})()}_sendMessage(){var e=this;return(0,o.A)(function*(){yield e._messageChannelService.sendMessage(e._oauthSysSettingsChangedMessage,"OAuthSysSettingsChanged",n.MessageChannelType.PTP)})()}handle(e){var t=this;return(0,o.A)(function*(){t._maskService.showBodyMask();const s=yield t._saveOAuthSettings(e);if(t._maskService.hideBodyMask(),!s){const i=t._translateService.instant("Messages.ErrorSavingSettings");return yield t._notifyService.show({message:i}),!1}return yield t._sendMessage(),yield t.next?.handle(e)})()}};J=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.SaveOAuthSettingsPageHandler",requestType:"crt.SaveRecordRequest",scopes:["OAuthSettingsMiniPage"]}),(0,c.__metadata)("design:paramtypes",[n.SysSettingsService,y.MaskService,A.MessageChannelService,y.NotifyService,_.TranslateService])],J);let de=class extends n.BaseRequest{};de=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.TestOAuthConnectionResourceRequest"})],de);let Q=class extends n.BaseRequestHandler{constructor(e,t,s,r){super(),this._maskService=e,this._notifyService=t,this._oauthService=s,this._translateService=r}_testConnection(e){var t=this;return(0,o.A)(function*(){let s;try{(yield(0,a.firstValueFrom)(t._oauthService.getTestOAuthConnectionCheck(e.serverUrl,e.clientId,e.clientSecret))).success?s=t._translateService.instant("Messages.TestConnectionSuccess"):s=t._translateService.instant("Messages.TestConnectionError")}catch{s=t._translateService.instant("Messages.TestConnectionError")}yield t._notifyService.show({message:s})})()}handle(e){var t=this;return(0,o.A)(function*(){t._maskService.showBodyMask(),yield t._testConnection(e),t._maskService.hideBodyMask()})()}};Q=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.TestOAuthConnectionResourceHandler",requestType:"crt.TestOAuthConnectionResourceRequest"}),(0,c.__metadata)("design:paramtypes",[y.MaskService,y.NotifyService,v,_.TranslateService])],Q);let P=class Y{static{this.\u0275fac=function(t){return new(t||Y)}}static{this.\u0275mod=m.\u0275\u0275defineNgModule({type:Y})}static{this.\u0275inj=m.\u0275\u0275defineInjector({providers:[S.WINDOW_PROVIDER,{provide:T.UrlService,useClass:T.CommonUrlService}],imports:[A.CommonModule,S.CrtLibTranslateModule.forRoot({i18n:X})]})}};P=(0,c.__decorate)([(0,n.CrtModule)({includes:[],converters:[],requestHandlers:[w,b,$,D,F,q,V,G,k,z,j,W,L,K,N,J,Q,B],handlerChainServices:[]})],P),function(){(typeof ngJitMode>"u"||ngJitMode)&&m.\u0275\u0275setNgModuleScope(P,{imports:[A.CommonModule,S.CrtLibTranslateModule]})}()},35293:(ue,H,h)=>{h.d(H,{A:()=>y});const n={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let S;const T=new Uint8Array(16);function A(){if(!S&&(S=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!S))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return S(T)}const p=[];for(let a=0;a<256;++a)p.push((a+256).toString(16).slice(1));function M(a,u=0){return p[a[u+0]]+p[a[u+1]]+p[a[u+2]]+p[a[u+3]]+"-"+p[a[u+4]]+p[a[u+5]]+"-"+p[a[u+6]]+p[a[u+7]]+"-"+p[a[u+8]]+p[a[u+9]]+"-"+p[a[u+10]]+p[a[u+11]]+p[a[u+12]]+p[a[u+13]]+p[a[u+14]]+p[a[u+15]]}function X(a,u=0){const f=M(a,u);if(!validate(f))throw TypeError("Stringified UUID is invalid");return f}const o=null;function _(a,u,f){if(n.randomUUID&&!u&&!a)return n.randomUUID();a=a||{};const R=a.random||(a.rng||A)();if(R[6]=R[6]&15|64,R[8]=R[8]&63|128,u){f=f||0;for(let m=0;m<16;++m)u[f+m]=R[m];return u}return M(R)}const y=_}}]);
