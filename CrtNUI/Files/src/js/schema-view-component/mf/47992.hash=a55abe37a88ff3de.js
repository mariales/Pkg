(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[47992,73308,50927,28546,6165,62832,40451,18070,95689,94260,71879,41421,63802,86183,8564,30945,53326,75707,98088,20469,42850,70422,48041,15184,92803,80898,58517,25660,3279,91374,68993,83231,5612,38469],{47992:(ze,he,g)=>{g.r(he),g.d(he,{ACCOUNT_ENTITY_SCHEMA_MOCK:()=>pt,ACL_VALUES_APP_INITIALIZER_PROVIDER:()=>Dt,ACL_VALUES_PROVIDER:()=>vt,AUTH_SETTINGS:()=>Re,AUTH_SETTINGS_PROVIDER:()=>at,AclService:()=>w,ApiKeyService:()=>E,AppInfoService:()=>m,AppearanceSettingsApiService:()=>L,AuthFlowEnum:()=>ft,AuthService:()=>G,BaseCachedHttpService:()=>de,BaseCachedService:()=>Ee,BaseProfileData:()=>Tt,BaseSysSettingValuesService:()=>st,CONTACT_ENTITY_SCHEMA_MOCK:()=>ht,CommonApiModule:()=>ye,CommonUrlService:()=>$,CompleteExecutingRequest:()=>gt,ConfigurationDataService:()=>x,CurrencyService:()=>B,CurrencySysSetting:()=>yt,DcmSchemaManagerService:()=>q,DcmSettingsService:()=>K,ExportToExcelService:()=>Q,FEATURE_SERVICE_MOCK_PROVIDER:()=>mt,FEATURE_VALUES_APP_INITIALIZER_PROVIDER:()=>tt,FEATURE_VALUES_PROVIDER:()=>Xe,FOLDER_TREE_RELATED_ELEMENT_CONFIGS_NOTIFIER:()=>Ce,FaviconService:()=>z,FeatureService:()=>A,FeatureServiceMock:()=>Y,FolderTreeRelatedElementConfigsProvider:()=>M,FolderTreeRelatedElementConfigsRepository:()=>V,GetApiKeyRequest:()=>Ie,GetApiKeyRequestHandler:()=>pe,GoogleTagManagerService:()=>Z,HANDLER_CHAIN_ADAPTER_APP_INITIALIZER_PROVIDER:()=>nt,HandlerChainAdapter:()=>O,HttpClientService:()=>De,LICENSE_RESTRICTION_OPERATION_CODES:()=>we,LICENSE_RESTRICTION_OPERATION_VALUES:()=>je,LICENSE_RESTRICTION_OPERATION_VALUES_APP_INITIALIZER_PROVIDER:()=>ct,LICENSE_RESTRICTION_OPERATION_VALUES_PROVIDER:()=>lt,LicenseService:()=>R,LinkGenerator:()=>J,MultiDeleteService:()=>X,PACKAGE_INFO_INITIALIZER_PROVIDER:()=>Ct,PackageInfoService:()=>F,PrintablesService:()=>ee,ProcessEngineService:()=>te,ProcessSchemaManagerService:()=>ae,ProcessStatus:()=>Ae,REMOTE_ENTRY_PROVIDER:()=>It,RecoveryCodeService:()=>H,RemoteEntryFactory:()=>Be,RemoteEntryService:()=>k,RightsService:()=>me,RunProcessForMatchingRecordsRequest:()=>St,RunProcessRequest:()=>He,SYSTEM_SETTINGS_MOCK:()=>dt,SYS_SETTINGS_PRELOAD_APP_INITIALIZER_PROVIDER:()=>Je,SchemaInfoService:()=>se,ServerClientOperationNotificationReceiver:()=>ie,SysSettingsService:()=>T,ThemeProvider:()=>ne,TotpService:()=>W,UNAVAILABLE_LICENSE_INFO:()=>ke,UNAVAILABLE_LICENSE_INFO_APP_INITIALIZER_PROVIDER:()=>ot,UNAVAILABLE_LICENSE_INFO_PROVIDER:()=>rt,UrlService:()=>Se,UserConsentService:()=>ce,UserDesktopNotificationSettingsProviderService:()=>b,UserProfileService:()=>re,UserProfileServiceMock:()=>oe,UserSchemaProfileService:()=>U,appInitializerLicenseInfoFactory:()=>Le,appInitializerSysSettingsPreloadFactory:()=>be,appInitializerWhitelistFactory:()=>Ke,licenseInfoFactory:()=>Me});var _=g(5960),D=g(40297),o=g(38495),C=g(96590),u=g(21018),f=g(73308),N=g(59564),i=g(62278),d=g(63721),n=g(59131);class E{constructor(e){this._httpClient=e,this._serviceEndpoint="rest/ApiKeyProvider/"}getOrCreateApiKey(e,t){const a=this._serviceEndpoint+"GetOrCreateWebhookApiKey";return this._httpClient.post(a,{integrationName:e,webhookSource:t})}static{this.\u0275fac=function(t){return new(t||E)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}var c=g(36486);let T=class ge extends u.RootInjectorGuard{constructor(e,t){super(),this.httpClient=e,this._sysSettingsInfo=new Map,this._sysSettingsValuesCache=new Map,this._sysSettingsChanged$=new i.Subject,this.sysSettingsChanged$=this._sysSettingsChanged$.asObservable(),this._serviceGetSysSettingsEndpoint=`${t}/QuerySysSettings`,this._serviceSaveSysSettingsEndpoint=`${t}/PostSysSettingsValues`,this._servicePreloadSysSettingsEndpoint=`${t}/PreloadSysSettings`}_removeNotActualSettingsValues(e){e.forEach(([t,a])=>{this._getIsSysSettingCached(t)&&this._getCacheableSysSetting(t).dataValueType===o.DataValueType.Lookup&&this._sysSettingsValuesCache.delete(t)})}_getSysSettingsRequestAfterUpdate(e){const t=e.filter(a=>!this._sysSettingsInfo.has(a[0]));return t.length===0?(0,i.of)(null):this.getByCodes(t.map(a=>a[0]))}_updateCache(e,t){const a=Object.entries(e??{}).filter(s=>t.saveResult[s[0]]);return a.filter(([s,r])=>this._sysSettingsInfo.has(s)).filter(([s,r])=>this._getIsSysSettingCacheable(s)).forEach(([s,r])=>{this._sysSettingsValuesCache.set(s,{value:r})}),this._getSysSettingsRequestAfterUpdate(a).pipe((0,c.map)(()=>t),(0,c.tap)(()=>{this._removeNotActualSettingsValues(a)}),(0,c.tap)(()=>{if(a.length>0){const s=a.map(r=>r[0]);this._sysSettingsChanged$.next(s)}}))}_getIsSysSettingCacheable(e){return this._sysSettingsInfo.get(e)?.isCacheable??!1}_getIsSysSettingCached(e){return this._getIsSysSettingCacheable(e)&&this._sysSettingsValuesCache.has(e)}_getCacheableSysSetting(e){const t=this._sysSettingsInfo.get(e);if(t&&t.isCacheable){const a=this._sysSettingsValuesCache.get(e);return{code:t.code,dataValueType:t.dataValueType,id:t.id,isCacheable:t.isCacheable,name:t.name,value:a.value,displayValue:a.displayValue}}return null}_setSysSettingInfo(e){this._sysSettingsInfo.set(e.code,{code:e.code,dataValueType:e.dataValueType,id:e.id,isCacheable:e.isCacheable,name:e.name})}_setSysSettingDetails(e){this._setSysSettingInfo(e),e?.isCacheable&&this._sysSettingsValuesCache.set(e.code,{displayValue:e.displayValue,value:e.value})}_requestSysSettings(e){return this.httpClient.post(this._serviceGetSysSettingsEndpoint,{sysSettingsNameCollection:e}).pipe((0,c.share)(),(0,c.tap)(t=>{e.forEach(a=>{const s=t.values[a];s&&this._setSysSettingDetails(s)})}))}_getResponseWithCachedSysSettings(e,t){return t.filter(s=>this._getIsSysSettingCached(s)).map(s=>this._getCacheableSysSetting(s)).forEach(s=>{e.values[s.code]=s}),e}_createEmptySysSettingDetailByCode(e){return{code:e,value:null,isCacheable:!0}}_updateNotFoundSettingDetails(e){return e.notFoundSettings?.forEach(t=>{const a=this._createEmptySysSettingDetailByCode(t);this._setSysSettingDetails(a),e.values[t]=a}),e}getByCodes(e){if(!e||e.length===0)return(0,i.of)({success:!0,values:{}});const t=e.filter(a=>!this._getIsSysSettingCached(a));return t.length===0?(0,i.of)(this._getResponseWithCachedSysSettings({success:!0,values:{}},e)):this._requestSysSettings(t).pipe((0,c.map)(a=>this._getResponseWithCachedSysSettings(a,e)),(0,c.map)(a=>this._updateNotFoundSettingDetails(a)))}getByCode(e){return this.getByCodes([e]).pipe((0,c.map)(t=>t.values[e]))}getValueByCode(e,t){return this.getByCode(e).pipe((0,c.map)(a=>{const s=a?.value;return!(s==null||s==="")||t===void 0?s:t}),(0,i.catchError)(()=>(0,i.of)(t)))}updateMany(e,t=!1){const a={};return e.forEach(s=>a[s.code]=s.value),this.httpClient.post(this._serviceSaveSysSettingsEndpoint,{sysSettingsValues:a,isPersonal:t}).pipe((0,c.mergeMap)(s=>this._updateCache(a,s)),(0,c.share)())}update(e,t=!1){return this.updateMany([e],t)}preload(){const e=new d.HttpHeaders().set("Content-Type","application/json; charset=utf-8");return this.httpClient.post(this._servicePreloadSysSettingsEndpoint,{},{headers:e}).pipe((0,c.tap)(t=>{Object.values(t.values).forEach(a=>{a.isCacheable=!0,this._setSysSettingDetails(a)})}),(0,c.map)(()=>!0),(0,i.catchError)(t=>(console.error(t),(0,i.of)(!1))))}static{this.\u0275fac=function(t){return new(t||ge)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(u.DATA_SERVICE_URI))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac,providedIn:"root"})}};T=(0,_.__decorate)([(0,C.CrtHandlerChainAdapter)({requestType:"crt.SysSettingsService"}),(0,_.__metadata)("design:paramtypes",[d.HttpClient,String])],T);let pe=class extends o.BaseRequestHandler{constructor(e,t,a,s,r){super(),this._copyClipboardService=e,this._notifyService=t,this._apiKeyService=a,this._maskService=s,this._sysSettingsService=r}_handleError(e){this._notifyService.show({message:e.Message,closeMode:"manual"})}_handleSuccess(e,t){e.isInternalIntegration?this._setResultValue(e,t):this._sysSettingsService.getByCode("WebhookURL").pipe((0,i.take)(1)).subscribe(a=>{const s=a===void 0?t:`${a.value}${t}`;this._setResultValue(e,s)})}_setResultValue(e,t){e.$context[e.resultShowAttributeName]=!0,e.$context[e.resultValueAttributeName]=t,this._copyClipboardService.copyTextToBuffer(t).then()}handle(e){var t=this;return(0,f.A)(function*(){if(t._syncObject===!0){yield t.next?.handle(e);return}t._syncObject=!0;const a="GET_API_KEY";t._maskService.showMask(a,e.$context);const s=yield(0,i.firstValueFrom)(t._apiKeyService.getOrCreateApiKey(e.integrationName,e.webhookSource));t._syncObject=!1,t._maskService.hideMask(a,e.$context),s.success?t._handleSuccess(e,s.apiKey):t._handleError(s.responseStatus),yield t.next?.handle(e)})()}};pe=(0,_.__decorate)([(0,o.CrtRequestHandler)({type:"crt.GetApiKeyRequestHandler",requestType:"crt.GetApiKeyRequest"}),(0,_.__param)(3,(0,o.CrtInject)(u.DEVKIT_MASK_SERVICE)),(0,_.__metadata)("design:paramtypes",[N.CopyClipboard,N.NotifyService,E,o.MaskService,T])],pe);const Ce="FolderTreeRelatedElementConfigsNotifier";var P=g(35266),S=g(28399);class V{constructor(e,t,a,s){this._userInfo=e,this._httpClient=t,this._queryExecutor=a,this._messageChannelService=s,this._cache=[],this._messageChannelService.messageEvent$.pipe((0,c.filter)(r=>r?.header?.sender===Ce&&r?.body?.UserId!==this._userInfo.id),(0,c.tap)(r=>{this._deleteConfigFromCache({folderId:r.body.FolderId})})).subscribe()}_createEntitySchemaQuery(e,t){const a=new o.EntitySchemaQuery("FolderRelatedElConfig");return a.addSchemaColumn("ElementName"),a.addSchemaColumn("ElementConfig"),this._addQueryFilters(a,{folderId:e,schemaName:t}),a}_createInsertQuery(e){const t=new o.InsertQuery("FolderRelatedElConfig");return this._addQueryColumns(t,e),t}_createUpdateQuery(e,t){const a=new o.UpdateQuery("FolderRelatedElConfig");return this._addQueryColumns(a,t),this._addQueryFilters(a,e),a}_createDeleteQuery(e){const t=new o.DeleteQuery("FolderRelatedElConfig");return this._addQueryFilters(t,e),t}_addQueryColumns(e,t){if("folderId"in t&&e.addColumn("FolderId",t.folderId,o.DataValueType.Guid),"schemaName"in t&&e.addColumn("ClientSchemaName",t.schemaName,o.DataValueType.Text),"elementName"in t&&e.addColumn("ElementName",t.elementName,o.DataValueType.Text),"elementConfig"in t){const a=t.elementConfig?JSON.stringify(t.elementConfig):"";e.addColumn("ElementConfig",a,o.DataValueType.Blob)}}_addQueryFilters(e,t){const{folderId:a,schemaName:s,elementName:r}=t;"folderId"in t&&e.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"FolderId",a),"schemaName"in t&&e.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"ClientSchemaName",s),"elementName"in t&&e.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"ElementName",r)}_executeQueryAndSetCache(e,t,a){return this._queryExecutor.execute(e).pipe((0,i.map)(({success:s})=>({success:s})),(0,i.catchError)(()=>(0,i.of)({success:!1})),(0,c.tap)(({success:s})=>{s&&this._setConfigToCache(t,a)}))}_setResponseToCache(e,t){const{folderId:a,schemaName:s,elementName:r}=e;t.length||t.push({ElementName:r,ElementConfig:null}),t.filter(Boolean).forEach(({ElementName:h,ElementConfig:p})=>{this._setConfigToCache({folderId:a,schemaName:s,elementName:h},p?JSON.parse(p):null)})}_isIncludeCacheKey(e,t){const{folderId:a,schemaName:s,elementName:r}=t;return(!a||a===e.folderId)&&(!s||s===e.schemaName)&&(!r||r===e.elementName)}_hasCachedConfig(e){const{folderId:t,schemaName:a}=e;return this._cache.some(({key:s})=>this._isIncludeCacheKey(s,{folderId:t,schemaName:a}))}_getCachedConfig(e){const{folderId:t,schemaName:a,elementName:s}=e,r=this._cache.find(({key:h})=>(0,S.isEqual)(h,{folderId:t,schemaName:a,elementName:s}));return r?.value?(0,S.cloneDeep)(r.value):null}_setConfigToCache(e,t){const{folderId:a,schemaName:s,elementName:r}=e,h=this._cache.filter(({key:p})=>this._isIncludeCacheKey(p,e));if(h.length){h.forEach(p=>p.value=t);return}a&&s&&r&&this._cache.push({key:{folderId:a,schemaName:s,elementName:r},value:t})}_deleteConfigFromCache(e){this._cache=this._cache.filter(({key:t})=>!this._isIncludeCacheKey(t,e))}get(e){const{folderId:t,schemaName:a,elementName:s}=e??{};if(!t||!a||!s)return(0,i.of)(null);if(this._hasCachedConfig(e))return(0,i.of)(this._getCachedConfig(e));const r=this._createEntitySchemaQuery(t,a);return this._queryExecutor.executeSelectQuery(r).pipe((0,c.tap)(h=>this._setResponseToCache(e,h)),(0,i.map)(()=>this._getCachedConfig(e)),(0,i.catchError)(()=>(0,i.of)(null)))}create(e){const{folderId:t,schemaName:a,elementName:s}=e??{};if(!t||!a||!s)return(0,i.of)({success:!1});const r=this._createInsertQuery(e);return this._executeQueryAndSetCache(r,e,e.elementConfig)}update(e,t){const{folderId:a,schemaName:s,elementName:r}=e??{};if(!a&&!s&&!r||!t)return(0,i.of)({success:!1});const h=this._createUpdateQuery(e,t);return this._executeQueryAndSetCache(h,e,t.elementConfig)}delete(e){const{folderId:t,schemaName:a,elementName:s}=e??{};if(!t&&!a&&!s)return(0,i.of)({success:!1});const r=this._createDeleteQuery(e);return this._executeQueryAndSetCache(r,e,null)}copy(e,t){return!e||!t?(0,i.of)({success:!1}):this._httpClient.post("rest/FolderRelatedElConfigService/Copy",{sourceFolderId:e,targetFolderId:t}).pipe((0,c.tap)(()=>this._deleteConfigFromCache({folderId:t})),(0,i.map)(()=>({success:!0})),(0,i.catchError)(()=>(0,i.of)({success:!1})))}static{this.\u0275fac=function(t){return new(t||V)(n.\u0275\u0275inject(u.UserInfo),n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(P.QueryExecutor),n.\u0275\u0275inject(u.MessageChannelService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac,providedIn:"root"})}}class Ee{constructor(){this._cache=new Map}setToCache(e,t){this._cache.set(e,t)}deleteFromCache(e){this._cache.delete(e)}getFromCache(e){return this._cache.get(e)}}class de extends Ee{constructor(){super(...arguments),this.httpClient=(0,n.inject)(d.HttpClient)}_createCacheKey(e,t={}){return`${e}!${JSON.stringify(t)}`}_cacheRequest(e,t){const a=this.getFromCache(t);if((0,S.isUndefined)(a)){const s=e().pipe((0,i.shareReplay)({bufferSize:1,refCount:!1}));return this.setToCache(t,s),s}return a}_getMethodEndpoint(e){return`${this.serviceEndpoint.replace(/\/$/,"")}/${e}`}executePostRequestWithCache(e,t={}){const a=this._getMethodEndpoint(e),s=this._createCacheKey(e,t),r=()=>this.httpClient.post(a,t);return this._cacheRequest(r,s)}executeGetRequestWithCache(e){const t=this._getMethodEndpoint(e),a=this._createCacheKey(e),s=()=>this.httpClient.get(t);return this._cacheRequest(s,a)}resetCache(e,t={}){const a=this._createCacheKey(e,t);this.deleteFromCache(a)}}class M extends Ee{constructor(e){super(),this._folderTreeRelatedElementConfigsRepository=e}_getCachingKey(e){const{folderId:t,schemaName:a,elementName:s}=e;return`${t}_${a}_${s}`}_isValidFolderSettingsConfig(e){const{folderId:t,schemaName:a,elementName:s}=e;return!!t&&!!a&&!!s}get(e){if(!this._isValidFolderSettingsConfig(e))return(0,i.of)(null);const t=this.getUnsaved(e);return t?(0,i.of)(t):this._folderTreeRelatedElementConfigsRepository.get(e)}getUnsaved(e){if(!this._isValidFolderSettingsConfig(e))return null;const t=this._getCachingKey(e),a=this.getFromCache(t);return(0,S.cloneDeep)(a)??null}setUnsaved(e,t){if(!this._isValidFolderSettingsConfig(e))return;const a=this._getCachingKey(e);this.setToCache(a,(0,S.cloneDeep)(t))}clear(e){return this._isValidFolderSettingsConfig(e)?this._folderTreeRelatedElementConfigsRepository.get(e).pipe((0,i.switchMap)(t=>t?this._folderTreeRelatedElementConfigsRepository.delete(e):(0,i.of)({success:!0})),(0,i.tap)(()=>this.clearUnsaved(e))):(0,i.of)({success:!1})}clearUnsaved(e){if(!this._isValidFolderSettingsConfig(e))return;const t=this._getCachingKey(e);this.deleteFromCache(t)}save(e){if(!this._isValidFolderSettingsConfig(e))return(0,i.of)({success:!1});const t=this.getUnsaved(e);return t?this._folderTreeRelatedElementConfigsRepository.get(e).pipe((0,i.switchMap)(a=>a?this._folderTreeRelatedElementConfigsRepository.update(e,{elementConfig:t}):this._folderTreeRelatedElementConfigsRepository.create({...e,elementConfig:t})),(0,i.tap)(()=>this.clearUnsaved(e))):(0,i.of)({success:!1})}static{this.\u0275fac=function(t){return new(t||M)(n.\u0275\u0275inject(V))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"root"})}}let me=class le extends de{constructor(){super(...arguments),this.serviceEndpoint="rest/RightsService"}_getSchemaDeleteRights(e){return this.executePostRequestWithCache("GetSchemaDeleteRights",e).pipe((0,c.map)(t=>({result:t&&t.GetSchemaDeleteRightsResult?.length===0,message:t?.GetSchemaDeleteRightsResult})))}_getCanDeleteByRecord(e){const t=`${this.serviceEndpoint}/GetCanDelete`;return this.httpClient.post(t,e).pipe((0,c.map)(a=>({result:a&&a.GetCanDeleteResult?.length===0,message:a?.GetCanDeleteResult})))}_getCanAddData(e){const t=e.map(s=>this.getFromCache(`GetCanAdd_${s}`)).filter(s=>!!s),a=e.filter(s=>!t.find(r=>r.schemaName===s));return{cachedResult:t,requestSchemaNames:a}}getCanExecuteOperation(e){return this.getCanExecuteOperations([e]).pipe((0,c.mergeMap)(t=>(0,i.of)((t||[])[0])))}getCanExecuteOperations(e){return(0,i.combineLatest)(e.map(t=>this.executePostRequestWithCache("GetCanExecuteOperation",{operation:t}).pipe((0,c.map)(a=>a?.GetCanExecuteOperationResult))))}getIsTechnicalUser(){const e=`${this.serviceEndpoint}/GetIsTechnicalUser`;return this.httpClient.post(e,null).pipe((0,c.map)(t=>t?.GetIsTechnicalUserResult))}getCanAdd(e){const t="GetCanAdd",{cachedResult:a,requestSchemaNames:s}=this._getCanAddData(e);if(!s.length)return(0,i.of)(a);const r=`${this.serviceEndpoint}/${t}`;return this.httpClient.post(r,s).pipe((0,c.map)(h=>h.map(p=>({schemaName:p.Key,result:(0,S.isEmpty)(p.Value),errorMessage:p.Value}))),(0,c.tap)(h=>h.forEach(p=>this.setToCache(`${t}_${p.schemaName}`,p))),(0,c.map)(h=>h.concat(a)))}getCanEdit(e){const t=`${this.serviceEndpoint}/GetCanEdit`;return this.httpClient.post(t,e).pipe((0,c.map)(a=>({result:a&&a.GetCanEditResult?.length===0,message:a?.GetCanEditResult})))}getCanDelete(e){if(e.primaryColumnValue)return this._getCanDeleteByRecord(e);const t={schemaName:e.schemaName};return this._getSchemaDeleteRights(t)}copyRights(e){const t=`${this.serviceEndpoint}/CopyRights`;return this.httpClient.post(t,e)}getCanEditColumns(e){return this.executePostRequestWithCache("GetCanEditColumns",e).pipe((0,c.map)(t=>{const a=t?.GetCanEditColumnsResult??[],s={};return a.forEach(r=>s[r.Key]=r.Value),s}))}getCanReadColumns(e){return this.executePostRequestWithCache("GetCanReadColumns",e).pipe((0,c.map)(t=>{const a=t?.GetCanReadColumnsResult??[],s={};return a.forEach(r=>s[r.Key]=r.Value),s}))}getCanExecuteEntityOperation(e,t){const a=`${this.serviceEndpoint}/GetCanExecuteEntityOperation`,s={entitySchemaName:e,entityOperationCode:t};return this.httpClient.post(a,s).pipe((0,c.mergeMap)(r=>(0,i.of)(r?.GetCanExecuteEntityOperationResult)))}getAclGranted(e){return(0,i.firstValueFrom)(this.executeGetRequestWithCache("GetReadDeniedEntityList")).then(t=>!t.GetReadDeniedEntityListResult.includes(e),t=>(console.error(`Error while making request to ReadDeniedEntityList: ${t}`),!0))}static{this.\u0275fac=(()=>{let e;return function(a){return(e||(e=n.\u0275\u0275getInheritedFactory(le)))(a||le)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac,providedIn:"root"})}};me=(0,_.__decorate)([(0,C.CrtHandlerChainAdapter)({requestType:"crt.RightsService"})],me);function Ze(l){const e=l.get(u.UserInfoService);return(0,i.lastValueFrom)(e.loadCurrentUserInfo().pipe((0,i.switchMap)(()=>l.get(T).preload())),{defaultValue:null})}function be(l){return Ze.bind(this,l)}const Je={provide:n.APP_INITIALIZER,useFactory:be,deps:[n.Injector],multi:!0},xe="QuerySchemaProfile";class U extends de{constructor(e,t){super(),this.httpClient=e,this.serviceEndpoint=t,this._serviceSaveProfileEndpoint=`${t}/UserSchemaProfile`}getProfile(e){return this.executePostRequestWithCache(xe,{key:e})}saveProfile(e,t,a){const{requirejs:s,require:r}=window;r?.defined("profile")&&r("profile").addKey(e),s?.undef("profile!"+e);const h={key:e,data:t===null?"":JSON.stringify(t),sysAdminUnitId:a};return this.httpClient.post(this._serviceSaveProfileEndpoint,h).pipe((0,c.map)(p=>p),(0,c.tap)(()=>this.resetCache(xe,{key:e})))}static{this.\u0275fac=function(t){return new(t||U)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(u.DATA_SERVICE_URI))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}}class b{constructor(e,t){this._userSchemaProfileService=e,this._subscribeOnNotificationsSettingsChanged(t)}_subscribeOnNotificationsSettingsChanged(e){this._changeUserSettingsSubscription=e.subscribe("UserDesktopNotificationSettingsChanged").subscribe(t=>this._updateRestrictions(t))}_updateRestrictions(e=!1){this._userSettings=this._userSettings||{allowNotifications:!1},this._userSettings.allowNotifications=e}_mapToUserSettings(e){const t={};return!e||!Array.isArray(e)||e.length===0?t.allowNotifications=!1:t.allowNotifications=e[0].Enabled,t}_loadSettings(){return(0,i.lastValueFrom)(this._userSchemaProfileService.getProfile("DesktopPopupNotification.profile").pipe((0,i.map)(e=>this._mapToUserSettings(e))))}getSettings(){var e=this;return(0,f.A)(function*(){return e._userSettings||(e._userSettings=yield e._loadSettings()),e._userSettings})()}ngOnDestroy(){this._changeUserSettingsSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||b)(n.\u0275\u0275inject(U),n.\u0275\u0275inject(C.CustomEventService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac,providedIn:"root"})}}let ye=class Ve{static{this.\u0275fac=function(t){return new(t||Ve)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:Ve})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[C.WINDOW_PROVIDER,{provide:u.SCHEMA_CHANGE_LISTENER_MESSAGE_PREDICATE,useFactory:e=>t=>t?.header?.sender===Ce&&t?.body?.UserId!==e?.id,deps:[u.UserInfo],multi:!0},{provide:u.BaseRightsService,useClass:me},{provide:u.BaseSysSettingsService,useExisting:T},{provide:C.USER_DESKTOP_NOTIFICATION_SETTINGS_PROVIDER,useClass:b}],imports:[D.CommonModule]})}};ye=(0,_.__decorate)([(0,o.CrtModule)({requestHandlers:[pe]})],ye),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(ye,{imports:[D.CommonModule]})}();let Ie=class extends o.BaseRequest{};Ie=(0,_.__decorate)([(0,o.CrtRequest)({type:"crt.GetApiKeyRequest"})],Ie);var y=g(19038);const Ye=new Array("constructor","ngOnDestroy");let Te=!1;const ve=new Proxy({},{get(l,e){if(Te||Ye.includes(e))return l[e];throw new Error(`FEATURE_VALUES. "${String(e)}" not loaded`)}}),Xe={provide:u.FEATURE_VALUES,useFactory:()=>ve};let A=class fe{constructor(e){this.httpClient=e,this._getFeatureStatesEndpoint="rest/FeatureService/GetFeatureStates",this._cachedCodes=new Map,this._destroyed$=new i.Subject}_checkFeaturesFromURL(){const e=location.search;new URLSearchParams(e).forEach((a,s)=>{if(s.indexOf("feature:")>=0){const r=s.split(":")[1],h=a==="true";this._cachedCodes.set(r,h)}})}loadFeatureStates(){return this._featureStates$?this._featureStates$:(this._featureStates$=this.httpClient.post(this._getFeatureStatesEndpoint,{}).pipe((0,c.map)(e=>(e.GetFeatureStatesResult.forEach(t=>{this._cachedCodes.set(t.Key,t.Value===1)}),(0,n.isDevMode)()&&this._checkFeaturesFromURL(),Object.fromEntries(this._cachedCodes.entries()))),(0,c.tap)(e=>{Object.assign(ve,e),Object.freeze(ve),Te=!0}),(0,c.catchError)(()=>(Te=!0,(0,i.of)(null))),(0,c.share)(),(0,c.takeUntil)(this._destroyed$)),this._featureStates$)}getFeatureState(e){return e?this._cachedCodes.size>0?(0,i.of)(this._cachedCodes.get(e)||!1):this.loadFeatureStates().pipe((0,c.map)(()=>this._cachedCodes.get(e)||!1)):(0,i.of)(!1)}getFeaturesState(e){return(0,i.from)(this.getFeaturesStateAsync(e))}getFeaturesStateAsync(e){return Promise.all(e.map(t=>{const a=typeof t=="string"?this.getFeatureState(t):t;return new Promise(s=>a.pipe((0,c.first)()).subscribe({next:s}))}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||fe)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac,providedIn:"root"})}};A=(0,_.__decorate)([(0,C.CrtHandlerChainAdapter)({requestType:"crt.FeatureService"}),(0,_.__metadata)("design:paramtypes",[d.HttpClient])],A);function et(l){return()=>(0,i.lastValueFrom)(l.loadFeatureStates(),{defaultValue:null})}const tt={provide:n.APP_INITIALIZER,useFactory:et,deps:[A],multi:!0};class m{static{this._sourceCodeSchemaDesignerCodeUrl="SourceCodeSchemaDesigner"}static{this._clientUnitSchemaDesignerUrl="ClientUnitSchemaDesigner"}constructor(e){this._features=e}static _getClientUnitSchemaInfo(e,t={isInterfaceDesignerFeatureOn:!1}){const a=t.isInterfaceDesignerFeatureOn?this.getInterfaceDesignerOpenTemplate():m._clientUnitSchemaDesignerUrl+"/{0}";return{itemTypes:[y.WorkspaceItemType.ClientUnitSchema],itemType:y.WorkspaceItemType.ClientUnitSchema,createTemplate:t.createTemplate,createDialogComponentName:t.createDialogComponentName,openTemplate:e+a,itemTitle:t.itemTitle,name:t.name}}static _addAngularSchemaInfo(e,t){e.splice(3,0,m._getClientUnitSchemaInfo(t,{createTemplate:t+"InterfaceDesigner?packageUId={0}&useFullHierarchy={1}",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.AngularSchema",createDialogComponentName:"page-template-lookup",isInterfaceDesignerFeatureOn:!0,name:"angular-schema"}))}static _addExtendingAngularSchemaInfo(e,t){const a={createTemplate:t+m._clientUnitSchemaDesignerUrl+"/new?packageId={0}&packageName={1}&schemaType=9&extendParent=true",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.ExtendedAngularSchema",name:"extended-angular-schema"};e.splice(10,0,m._getClientUnitSchemaInfo(t,a))}static _getEntitySchemaInfo(e,t){return{itemTypes:[y.WorkspaceItemType.EntitySchema],itemType:y.WorkspaceItemType.EntitySchema,createTemplate:e+`EntitySchemaDesigner/new?packageId={0}&packageName={1}&useFullHierarchy={2}&extendParent=${t.isExtendParent}`,openTemplate:e+this.getEntitySchemaDesignerOpenTemplate(),itemTitle:t.itemTitle,name:t.name}}static _getEntitySchemaDesignerOpenToExtendTemplate(){return"EntitySchemaDesigner/new?packageId={0}&packageName={1}&useFullHierarchy={2}&extendParent=true&parentSchemaUId={3}"}static getEntitySchemaDesignerOpenTemplate(){return"EntitySchemaDesigner/{0}?packageId={1}&packageName={2}&useFullHierarchy={3}"}static getInterfaceDesignerOpenTemplate(){return"InterfaceDesigner/{0}?packageUId={1}&useFullHierarchy={2}"}static getSourceCodeDesignerOpenTemplate(){return`${this._sourceCodeSchemaDesignerCodeUrl}/{0}`}static getUserCodeDesignerOpenTemplate(){return"UserTaskSchemaDesigner/{0}"}static getCurrentAppUrl(){let e=location.href;return e=e.replace(location.hash,""),D.Location.joinWithSlash(e,"#/")}getSchemaMetaDataUrl(e,t,a){return`${m.getCurrentAppUrl()}SchemaMetaDataDesigner/${e}/${t}/${a}`}getMetaItemsSourceCodeUrl(e){return`${m.getCurrentAppUrl()}${m._sourceCodeSchemaDesignerCodeUrl}/${e}?showMetaItemSourceCode=true`}getClientUnitSchemaDesignerUrl(e){return`${m.getCurrentAppUrl()}${m._clientUnitSchemaDesignerUrl}/${e}`}getAppsInfo(){const e=m.getCurrentAppUrl(),t=(0,u.getAppUrl)(),a=(0,u.getWorkspaceBaseUrl)(),s=["DisableUserTaskSchemaDesignerComponent","AllowCreateAngularSchema"];return this._features.getFeaturesState(s).pipe((0,c.map)(([r,h])=>{const p=[m._getEntitySchemaInfo(e,{name:"entity-schema",isExtendParent:!1,itemTitle:"WorkspaceExplorer.Section.Items.Add.Entity"}),m._getEntitySchemaInfo(e,{name:"replacing-entity-schema",isExtendParent:!0,itemTitle:"WorkspaceExplorer.Section.Items.Add.ReplacingEntity"}),{itemTypes:[y.WorkspaceItemType.EntitySchema],itemType:y.WorkspaceItemType.EntitySchema,name:"extend-entity-schema",openTemplate:e+m._getEntitySchemaDesignerOpenToExtendTemplate(),itemTitle:""},{name:"source-code-schema-designer",itemTypes:[y.WorkspaceItemType.SourceCodeSchema],itemType:y.WorkspaceItemType.SourceCodeSchema,createTemplate:e+`${m._sourceCodeSchemaDesignerCodeUrl}/new?packageId={0}&packageName={1}`,openTemplate:e+m.getSourceCodeDesignerOpenTemplate(),itemTitle:"WorkspaceExplorer.Section.Items.Add.SourceCode"},m._getClientUnitSchemaInfo(e,{createTemplate:e+m._clientUnitSchemaDesignerUrl+"/new?packageId={0}&packageName={1}&schemaType=1",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.Module",name:"client-unit-schema-module"}),m._getClientUnitSchemaInfo(e,{createTemplate:e+"ClientUnitSchemaDesigner/new?packageId={0}&packageName={1}&schemaType=2",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.EditViewModelSchema",name:"client-unit-schema-page-view-model"}),m._getClientUnitSchemaInfo(e,{createTemplate:e+"ClientUnitSchemaDesigner/new?packageId={0}&packageName={1}&schemaType=3",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.ModuleViewModelSchema",name:"client-unit-schema-section-view-model"}),m._getClientUnitSchemaInfo(e,{createTemplate:e+"ClientUnitSchemaDesigner/new?packageId={0}&packageName={1}&schemaType=5",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.GridDetailViewModelSchema",name:"client-unit-schema-detail-list-view-model"}),m._getClientUnitSchemaInfo(e,{createTemplate:e+"ClientUnitSchemaDesigner/new?packageId={0}&packageName={1}&schemaType=6",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.EditControlsDetailViewModelSchema",name:"client-unit-schema-detail-fields-view-model"}),m._getClientUnitSchemaInfo(e,{createTemplate:e+m._clientUnitSchemaDesignerUrl+"/new?packageId={0}&packageName={1}&schemaType=0&extendParent=true",itemTitle:"WorkspaceExplorer.Section.Items.Add.ClientUnit.ExtendedClientUnitSchema",name:"client-unit-schema-replacing-view-model"}),{name:"business-process-schema-designer",itemTypes:[y.WorkspaceItemType.ProcessSchema],itemType:y.WorkspaceItemType.ProcessSchema,createTemplate:a+"Nui/ViewModule.aspx?vm=SchemaDesigner#process/add/{0}",openTemplate:a+"Nui/ViewModule.aspx?vm=SchemaDesigner#process/{0}/{1}",itemTitle:"WorkspaceExplorer.Section.Items.Add.BusinessProcess"},{name:"rest-services",itemTypes:[y.WorkspaceItemType.ServiceSchema],itemType:y.WorkspaceItemType.ServiceSchema,createTemplate:a+"Nui/ViewModule.aspx?vm=WebServicesDesigner#add/Rest/packageUId/{0}",openTemplate:a+"Nui/ViewModule.aspx?vm=WebServicesDesigner#edit/{0}",itemTitle:"WorkspaceExplorer.Section.Items.Add.RestService"},{name:"soap-services",itemTypes:[y.WorkspaceItemType.ServiceSchema],itemType:y.WorkspaceItemType.ServiceSchema,createTemplate:a+"Nui/ViewModule.aspx?vm=WebServicesDesigner#add/Soap/packageUId/{0}",openTemplate:a+"Nui/ViewModule.aspx?vm=WebServicesDesigner#edit/{0}",itemTitle:"WorkspaceExplorer.Section.Items.Add.SoapService"},{name:"dcm-designer",itemTypes:[y.WorkspaceItemType.DcmSchema],itemType:y.WorkspaceItemType.DcmSchema,createTemplate:"",openTemplate:t+"/Nui/ViewModule.aspx?vm=DcmDesigner#case/{0}",itemTitle:"DcmDesigner"},{name:"user-task-schema-designer",itemTypes:[y.WorkspaceItemType.ProcessUserTaskSchema],itemType:y.WorkspaceItemType.ProcessUserTaskSchema,createTemplate:r?t+"/Designers/ProcessUserTaskSchemaDesigner.aspx?packageUId={0}&isExtendParent=false&isNewSchema=1&autoCreateDesignInstance=true":e+"UserTaskSchemaDesigner/new?packageId={0}&packageName={1}",openTemplate:r?t+"/Designers/ProcessUserTaskSchemaDesigner.aspx?id={0}&autoCreateDesignInstance=true":e+m.getUserCodeDesignerOpenTemplate(),itemTitle:"WorkspaceExplorer.Section.Items.Add.UserTask"},{name:"campaign-designer",itemTypes:[y.WorkspaceItemType.CampaignSchema],itemType:y.WorkspaceItemType.CampaignSchema,createTemplate:"",openTemplate:t+"/Nui/ViewModule.aspx?vm=CampaignDesigner#campaign/{0}",itemTitle:"CampaignDesigner"},{name:"sql-script-schema-designer",itemTypes:[y.WorkspaceItemType.SqlScript],itemType:y.WorkspaceItemType.SqlScript,createTemplate:e+"SqlScriptSchemaDesigner/new?packageId={0}&packageName={1}",openTemplate:e+"SqlScriptSchemaDesigner/{0}",itemTitle:"WorkspaceExplorer.Section.Items.Add.Sql"},{name:"data-binding",itemTypes:[y.WorkspaceItemType.SchemaData],itemType:y.WorkspaceItemType.SchemaData,createTemplate:e+"SchemaDataDesigner/new?packageId={0}&packageName={1}",openTemplate:e+"SchemaDataDesigner/{0}",itemTitle:"WorkspaceExplorer.Section.Items.Add.DataBinding"},{name:"addon-schema",itemTypes:[y.WorkspaceItemType.AddonSchema],itemType:y.WorkspaceItemType.AddonSchema,createTemplate:"",openTemplate:this.getSchemaMetaDataUrl("{0}",y.WorkspaceItemType.AddonSchema,"{1}"),itemTitle:""},{name:"copilot-intent-schema",itemTypes:[y.WorkspaceItemType.CopilotIntentSchema],itemType:y.WorkspaceItemType.CopilotIntentSchema,createTemplate:"",openTemplate:this.getSchemaMetaDataUrl("{0}",y.WorkspaceItemType.CopilotIntentSchema,"{1}"),itemTitle:""}];return m._addAngularSchemaInfo(p,e),h&&m._addExtendingAngularSchemaInfo(p,e),{success:!0,appsInfo:p}}))}static{this.\u0275fac=function(t){return new(t||m)(n.\u0275\u0275inject(A))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac,providedIn:"root"})}}class L{constructor(e){this._httpClient=e,this._serviceUrl="/ServiceModel/AppearanceSettingsService.svc/"}getAppearanceSettings(e){return this._httpClient.post(this._serviceUrl+"GetAppearanceSettings",{schemaName:e}).pipe((0,c.map)(t=>t.value))}static{this.\u0275fac=function(t){return new(t||L)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac,providedIn:"root"})}}class Se{}class ${getBaseUrl(){return(0,u.getAppBaseUrl)()}static{this.\u0275fac=function(t){return new(t||$)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"root"})}}let Oe=null;const Re=new n.InjectionToken("Authentication settings"),at={provide:Re,useFactory:()=>Object.freeze(Oe)};class G{constructor(e,t){this.httpClient=e,this.urlService=t;const s=`${t.getBaseUrl()}/ServiceModel/AuthService.svc`;this._serviceChangePasswordServiceEndpoint=`${s}/DoChangePasswordLogin`,this._serviceGetAuthenticationSettingsEndpoint=`${s}/GetAuthenticationSettings`,this._serviceGetAccessibleAuthFlowsEndpoint=`${s}/GetAccessibleAuthFlows`,this._serviceStartTextCodeAuthFlowEndpoint=`${s}/StartTextCodeAuthFlow`,this._getIsAuthenticatedEndpoint=`${s}/GetIsAuthenticated`}getIsAuthenticated(){return this.httpClient.post(this._getIsAuthenticatedEndpoint,"")}getDoPasswordChange(e){return this.httpClient.post(this._serviceChangePasswordServiceEndpoint,e)}getAuthenticationSettings(){return this.httpClient.post(this._serviceGetAuthenticationSettingsEndpoint,"")}getAccessibleAuthFlows(e){return this.httpClient.post(this._serviceGetAccessibleAuthFlowsEndpoint,e)}initializeCachedSettings(){return this.getAuthenticationSettings().pipe((0,i.map)(e=>{Oe=e}))}startTextCodeAuthFlow(e={},t=""){const a={};return t&&(a.headers={"X-Second-Factor-Provider-Name":t}),this.httpClient.post(this._serviceStartTextCodeAuthFlowEndpoint,e,a)}static{this.\u0275fac=function(t){return new(t||G)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(Se))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac,providedIn:"root"})}}class W{constructor(e,t,a){this._httpClient=e,this._authSettings=t,this._urlService=a,this._baseUrl="",this._totpServicePath="/api/Totp",this._baseUrl=this._urlService.getBaseUrl()}_getEndpointUrl(e){return this._baseUrl+e}getIsTotpEnabledForCurrentUser(){const e=this._getEndpointUrl(`${this._totpServicePath}/IsConfiguredForCurrentUser`);return this._httpClient.get(e)}resetTotpForCurrentUser(){const e=this._authSettings.appFramework==="NextGen"?this._getEndpointUrl(`${this._totpServicePath}/Authenticator/DisconnectForCurrentUser`):this._getEndpointUrl(`/0${this._totpServicePath}/Authenticator/DisconnectForCurrentUser`);return this._httpClient.post(e,"").pipe((0,i.map)(t=>{const a=t;return{isSuccess:a.isSuccess,errorCode:a.errorCode,message:a.message}}))}setUpTotp(e){const t=`${this._totpServicePath}/Authenticator/Connect`,a=this._getEndpointUrl(t);return this._httpClient.post(a,{totpCode:e})}getSecret(){const e=`${this._totpServicePath}/GenerateSecret`,t=this._getEndpointUrl(e);return this._httpClient.post(t,{})}static{this.\u0275fac=function(t){return new(t||W)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(Re),n.\u0275\u0275inject(Se))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac,providedIn:"root"})}}class H{constructor(e,t){this._httpClient=e,this._urlService=t,this._baseUrl="",this._recoveryCodeServicePath="/api/RecoveryCode",this._baseUrl=this._urlService.getBaseUrl()}_getEndpointUrl(e){return this._baseUrl+e}getIsGeneratedForCurrentUser(){const e=this._getEndpointUrl(`${this._recoveryCodeServicePath}/IsGenerated`);return this._httpClient.get(e)}generateForCurrentUser(){const e=this._getEndpointUrl(`${this._recoveryCodeServicePath}/Generate`);return this._httpClient.post(e,{})}deleteForCurrentUser(){const e=this._getEndpointUrl(`${this._recoveryCodeServicePath}/Delete`);return this._httpClient.post(e,{})}static{this.\u0275fac=function(t){return new(t||H)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(Se))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac,providedIn:"root"})}}class st{constructor(e){this._sysSettingsService=e}_getSysSettingValues(e){return Object.keys(e).reduce((t,a)=>(t[a]=e[a].value,t),{})}_getResultFromResponse(e){if(!e.success){const r=e.errorInfo?.message??"Unknown";throw new Error("Error while receiving system settings: "+r)}const t={...this._sysSettingsSnapshot,...e.values};this._sysSettingsSnapshot=t;const a=this._getSysSettingValues(t),s=this.mapSysSettingValues(a);return this._cachedResult=s,s}_buildResultObservable(){const e=this.getSysSettingCodes();return(0,i.merge)((0,i.of)(e),this._sysSettingsService.sysSettingsChanged$).pipe((0,i.mergeMap)(t=>{const a=e.filter(r=>t.includes(r));return this._sysSettingsSnapshot===void 0||this._cachedResult===void 0||a.length!==0?this._sysSettingsService.getByCodes(a).pipe((0,i.map)(r=>this._getResultFromResponse(r))):(0,i.of)(this._cachedResult)}),(0,i.shareReplay)({refCount:!1}))}getConfig(){return this._cache$||(this._cache$=this._buildResultObservable()),this._cache$}}class x{constructor(e,t,a){this.httpClient=e,this._userInfo=t,this._entitySchemaRepository=a,this._serviceEndpoint=(this._userInfo.isSSP?"ssp/":"")+"rest/ConfigurationDataService/",this._cachedEntityConfigurationData=new Map,this._cachedEntityUIdsData=new Map}_getUncachedEntities(e){return e.filter(t=>!this._cachedEntityConfigurationData.has(t))}_loadEntitiesData(e){const t=this._serviceEndpoint+"GetEntityData";return this.httpClient.post(t,e)}_getEntitiesData(e,t){return this._loadEntitiesData(e).pipe((0,c.map)(a=>!a.success||!(0,S.isEmpty)(a.errorInfo)?a:(this._setEntitiesDataToCache(a.data),this._getEntitiesDataResponse(t))))}_setEntitiesDataToCache(e){const{entitiesStructure:t,modulesStructure:a}=e;this._setEntityStructureToCache(t),this._setModuleStructureToCache(a)}_setEntityStructureToCache(e){e.forEach(t=>{const a=t.entitySchemaName,s={entityStructure:t,moduleStructure:null};this._cachedEntityConfigurationData.set(a,s)})}_setModuleStructureToCache(e){e.forEach(t=>{const a=t.entitySchemaName,s=this._cachedEntityConfigurationData.get(a);s&&(s.moduleStructure=t,this._cachedEntityConfigurationData.set(a,s))})}_getEntitiesDataFromCache(e){const t={entitiesStructure:[],modulesStructure:[]};return e.forEach(a=>{const s=this._cachedEntityConfigurationData.get(a);s&&(t.entitiesStructure.push(s.entityStructure),t.modulesStructure.push(s.moduleStructure))}),t}_getEntitiesDataResponse(e){return{data:this._getEntitiesDataFromCache(e),success:!0}}getData(e=!1){if(e&&(this._cachedFullConfigurationData$=void 0),this._cachedFullConfigurationData$)return this._cachedFullConfigurationData$;const t=this._serviceEndpoint+"GetData";return this._cachedFullConfigurationData$=this.httpClient.post(t,e).pipe((0,c.shareReplay)({refCount:!0}))}getEntityData(e,t=!1){return this.getEntitiesData([e],t).pipe((0,c.map)(a=>({data:{entityStructure:a?.data?.entitiesStructure[0],moduleStructure:a?.data?.modulesStructure[0]},success:a?.success,errorInfo:a?.errorInfo})))}getEntityUId(e){return this._cachedEntityUIdsData.has(e)?(0,i.of)(this._cachedEntityUIdsData.get(e)):this._entitySchemaRepository.getSchemaByName(e).pipe((0,c.map)(t=>{const a={data:{entityUIds:[{entitySchemaName:e,entitySchemaUId:t.uId}]},success:!0};return this._cachedEntityUIdsData.set(e,a),a}))}getEntitiesData(e,t=!1){const a=(0,S.uniq)(e);if(t)return this._getEntitiesData(a,a);const s=this._getUncachedEntities(a);return(0,S.isEmpty)(s)?(0,i.of)(this._getEntitiesDataResponse(a)):this._getEntitiesData(s,a)}clearCachedData(){this._cachedFullConfigurationData$=void 0}static{this.\u0275fac=function(t){return new(t||x)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(u.UserInfo),n.\u0275\u0275inject(u.EntitySchemaRepository))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}}class B{constructor(e,t){this.sysSettingsService=e,this.queryExecutor=t}_getPrimarySysSettingValue(){return this.sysSettingsService.getByCodes(["PrimaryCurrency"]).pipe((0,c.map)(e=>e.values.PrimaryCurrency))}getCurrencyById(e){const t=new o.EntitySchemaQuery("Currency");return t.addSchemaColumn("Code"),t.addSchemaColumn("Id"),t.addSchemaColumn("Name"),t.addSchemaColumn("ShortName"),t.addSchemaColumn("Symbol"),t.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"Id",e),this.queryExecutor.executeSelectQuery(t).pipe((0,c.map)(a=>a[0]))}getPrimaryCurrencyInfo(){return this._primaryCurrencyCache?(0,i.of)(this._primaryCurrencyCache):this._getPrimarySysSettingValue().pipe((0,c.switchMap)(e=>this.getCurrencyById(e.value).pipe((0,c.map)(t=>(this._primaryCurrencyCache=t,t)))),(0,c.share)())}static{this.\u0275fac=function(t){return new(t||B)(n.\u0275\u0275inject(T),n.\u0275\u0275inject(P.QueryExecutor))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac,providedIn:"root"})}}class q{constructor(e,t){this.httpClient=e,this._userInfo=t,this._dcmSchemasMap=new Map,this._dcmSchemaItemsMap=new Map,this.serviceEndpoint="DataService/"+(this._userInfo.isSSP?"ssp/":"")+"json/SyncReply/"}getDcmSchemaDataCollection(){if(this._dcmSchemaData)return(0,i.of)(this._dcmSchemaData);const e=this.serviceEndpoint+"DcmSchemaManagerRequest";return this.httpClient.post(e,{}).pipe((0,c.tap)(t=>this._dcmSchemaData=t?.collection),(0,c.map)(t=>t?.collection))}getDcmSchemaData(e){const t=this._dcmSchemasMap.get(e);if(t)return(0,i.of)(t);const a=this.serviceEndpoint+"DcmSchemaInfoRequest";return this.httpClient.post(a,{uId:e}).pipe((0,c.tap)(s=>this._dcmSchemasMap.set(e,s)),(0,c.map)(s=>s))}getDcmSchemaDataItems(e){const t=this._dcmSchemaItemsMap.get(e);if(t)return(0,i.of)(t);const a=this.serviceEndpoint+"DcmSchemaInfoItemsRequest";return this.httpClient.post(a,{entitySchemaUId:e}).pipe((0,c.tap)(s=>this._dcmSchemaItemsMap.set(e,s?.collection)),(0,c.map)(s=>s?.collection))}getDcmRunningProcess(e,t){const a=this.serviceEndpoint+"DcmRunningProcessRequest";return this.httpClient.post(a,{contractName:"DcmRunningProcessRequest",entitySchemaUId:e,recordId:t}).pipe((0,c.map)(s=>({name:s?.Name,uId:s?.UId,success:s?.success})))}getDcmRecordInfo(e,t){const a=this.serviceEndpoint+"DcmInfoRequest";return this.httpClient.post(a,{recordId:e,dcmSchemaUId:t}).pipe((0,c.map)(s=>s))}getAllowedStages(e){return this.httpClient.post("rest/DcmService/GetAllowedStagesForCurrentUser",{dcmSchemaUId:e}).pipe((0,c.map)(a=>a.GetAllowedStagesForCurrentUserResult))}getDcmStageColumnName(e){return this.httpClient.post("rest/DcmService/GetDcmStageColumnName",{entitySchemaId:e}).pipe((0,c.map)(a=>a.GetDcmStageColumnNameResult))}static{this.\u0275fac=function(t){return new(t||q)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(u.UserInfo))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac,providedIn:"root"})}}class K{constructor(e){this.httpClient=e,this._getDcmServiceEndpoint="rest/DcmService/GetDcmStageColumnName",this._destroyed$=new i.Subject}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}getStageColumnName(e){return this.httpClient.post(this._getDcmServiceEndpoint,{entitySchemaName:e}).pipe((0,c.map)(t=>t.GetDcmStageColumnNameResult),(0,c.catchError)(()=>(0,i.of)(null)),(0,c.takeUntil)(this._destroyed$))}static{this.\u0275fac=function(t){return new(t||K)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac})}}class Q{constructor(e,t,a){this._httpClient=e,this._fileDownloadService=t,this._systemSettings=a,this._serviceName="ReportService",this._exportToExcelMethodName="GetExportToExcelKey",this._downloadExcelFileMethodName="GetExportToExcelData",this._timeoutSysSettingCode="ExportToExcelTimeout",this._defaultTimeoutValue=10*60*1e3}_getDownloadExcelFileUrl(e,t){return`../rest/${this._serviceName}/${this._downloadExcelFileMethodName}/${e}/${t}`}_getReportServiceUrl(){return`rest/${this._serviceName}/${this._exportToExcelMethodName}`}_downloadExcelFile(e,t){const a=this._getDownloadExcelFileUrl(e,t),s=`${t}.xlsx`;this._fileDownloadService.downloadFromUrl(a,s)}_getTimeout(e){let t=this._defaultTimeoutValue;return e?.dataValueType===o.DataValueType.Integer&&(t=e.value),t}exportRecordsFromEsqToExcel(e,t){const a=this._getReportServiceUrl(),s=JSON.stringify(e);return this._systemSettings.getByCode(this._timeoutSysSettingCode).pipe((0,c.switchMap)(r=>this._httpClient.post(a,{esqSerialized:s}).pipe((0,i.timeout)(this._getTimeout(r)))),(0,c.map)(r=>(r.GetExportToExcelKeyResult.success&&this._downloadExcelFile(r.GetExportToExcelKeyResult.key,t),r)))}static{this.\u0275fac=function(t){return new(t||Q)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(u.FileDownloaderService),n.\u0275\u0275inject(T))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac,providedIn:"root"})}}var it=g(18081);class z{constructor(e,t,a){this._document=e,this._sysSettingsService=t,this._platform=a,this._useFaviconSysSettingsCode="UseFaviconFromSysSettings",this._faviconImageSysSettingsCode="FaviconImage"}_addFaviconElement(e){const t=this._document.createElement("link");t.setAttribute("rel","icon"),t.setAttribute("type","image/x-icon"),t.setAttribute("href",e),this._document.head.appendChild(t)}_getFaviconHref(e,t){const a="favicon.ico";if(e&&e.success){const s=e.values[this._useFaviconSysSettingsCode];if(s&&s.value){const r=Date.now().toString().slice(0,-5),h=`img/terrasoft.axd?s=nui-binary-syssetting&r=${this._faviconImageSysSettingsCode}&source_hash=${r}`;return D.Location.joinWithSlash(t,h)}}return a}_innerInit(e){return this._sysSettingsService.getByCodes([this._useFaviconSysSettingsCode]).pipe((0,c.map)(t=>{const a=this._getFaviconHref(t,e);this._addFaviconElement(a)}))}init(e){return this._platform.SAFARI?(0,i.of)(void 0):this._innerInit(e)}static{this.\u0275fac=function(t){return new(t||z)(n.\u0275\u0275inject(D.DOCUMENT),n.\u0275\u0275inject(T),n.\u0275\u0275inject(it.Platform))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac})}}class Z extends u.RootInjectorGuard{constructor(e,t){super(),this.sysSettingsService=e,this.userInfo=t,this._enabled=!1,this._initialized=!1}_initializeDataLayer(){const e=window;e.dataLayer&&(this._dataLayer=e.dataLayer)}_initializeScripts(e){e&&(e=e.replace(/'/g,'"'),this._appendChildScriptTag(document.head,"script",this._getHtmlTagContent("script",e)),this._appendChildScriptTag(document.body,"noscript",this._getHtmlTagContent("noscript",e)))}_getHtmlTagContent(e,t){if(!t||!e)return"";const a=new RegExp("<"+e+"[\\s\\S]*?>[\\s\\S]*?<\\/"+e+">","gi"),s=t.match(a);if(s&&s.length===1){const r=s[0],h=new RegExp("<(\\/|)"+e+"(.*?|)>","gi");return r.replace(h,"").trim()}else return""}_appendChildScriptTag(e,t,a){if(!e||!t||!a)return;const s=document.createElement(t);s.appendChild(document.createTextNode(a)),e.appendChild(s)}_initializeDefaultVariables(e){const t=this.userInfo,a={productName:e.ProductName,productEdition:e.ProductEdition,primaryCulture:{displayValue:t.cultureInfo.sysCultureName,value:t.cultureInfo.sysCultureId},customerId:e.CustomerId,version:e.ConfigurationVersion,userId:t.id,userType:this._getUserType(),accessType:t.accessType};this._pushVariables(a)}_getUserType(){return this.userInfo.isSSP?"External":"Employee"}_pushVariables(e){try{this._dataLayer.push(e)}catch(t){console.log(t.message)}}_initializeGoogleTagManager(e){e.UseGoogleTagManager&&(this._initializeScripts(e.GoogleTagManagerScript),this._initializeDataLayer(),this._enabled=!!this._dataLayer,this._enabled&&this._initializeDefaultVariables(e))}_executeInitialization(){const e=["UseGoogleTagManager","GoogleTagManagerScript","ProductName","ProductEdition","ConfigurationVersion","CustomerId"],t=this.sysSettingsService.getByCodes(e);return t.pipe((0,c.take)(1)).subscribe(a=>{const s=a&&a.success&&a.values&&(0,S.mapValues)(a.values||{},r=>r.value);s&&this._initializeGoogleTagManager(s),this._initialized=!0}),t.pipe((0,c.map)(()=>{}))}_resetCustomData(e){const t={};for(const a of Object.keys(e))t[a]=void 0;this._pushVariables(t)}initialize(){return this._initialized?(0,i.of)(void 0):(this._initializationObservable$||(this._initializationObservable$=this._executeInitialization()),this._initializationObservable$)}track(e){this._enabled&&(this._pushVariables(Object.assign(e,{description:JSON.stringify(e.description),event:e?.event||"bpmonlineInfo",virtualUrl:location.href})),this._resetCustomData(e))}static{this.\u0275fac=function(t){return new(t||Z)(n.\u0275\u0275inject(T),n.\u0275\u0275inject(u.UserInfo))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac,providedIn:"root"})}}class O{constructor(e){this._injector=e,this._handlerChain=o.HandlerChainService.instance,this._unsubscribesHandlers=[],this._registerHandlerChain()}_registerHandlerChain(){o.HandlerChainServicesRegistry.services.forEach((e,t)=>{(0,o.checkTypeNameFormat)(t,"HandlerChainServiceTypeName"),(0,o.checkCrtTypeNamePascalCase)(t);const a=class extends o.BaseRequestHandler{constructor(r){super(),this._innerInjector=r}handle(r){const p=this._innerInjector.get(e.typeRef)[r.method](...r.args);let I;return p instanceof Promise?I=p:p instanceof i.Observable?I=(0,i.lastValueFrom)(p,{defaultValue:null}):I=Promise.resolve(p),I}},s=()=>new a(this._injector);this._unsubscribesHandlers.push(this._handlerChain.register({requestType:t,createHandler:s,source:{type:o.HandlerSourceType.Host}}))})}ngOnDestroy(){this._unsubscribesHandlers.forEach(e=>e())}static{this.\u0275fac=function(t){return new(t||O)(n.\u0275\u0275inject(n.Injector))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}}const nt={provide:n.APP_INITIALIZER,useFactory:()=>()=>{},deps:[O],multi:!0};let De=class _e{constructor(e){this._http=e}_mapToCrtHttpHeaders(e){return e.keys().reduce((t,a)=>({...t,[a]:e.get(a)}),{})}get(e,t){return this._http.get(e,{...(0,S.pick)(t,"headers","responseType"),observe:"response"}).pipe((0,c.map)(a=>({headers:this._mapToCrtHttpHeaders(a.headers),...(0,S.pick)(a,"body","status","statusText","url","ok")})))}post(e,t,a){return this._http.post(e,t,{...(0,S.pick)(a,"headers","responseType"),observe:"response"}).pipe((0,c.map)(s=>({headers:this._mapToCrtHttpHeaders(s.headers),...(0,S.pick)(s,"body","status","statusText","url","ok")})))}put(e,t,a){return this._http.put(e,t,{...(0,S.pick)(a,"headers","responseType"),observe:"response"}).pipe((0,c.map)(s=>({headers:this._mapToCrtHttpHeaders(s.headers),...(0,S.pick)(s,"body","status","statusText","url","ok")})))}patch(e,t,a){return this._http.patch(e,t,{...(0,S.pick)(a,"headers","responseType"),observe:"response"}).pipe((0,c.map)(s=>({headers:this._mapToCrtHttpHeaders(s.headers),...(0,S.pick)(s,"body","status","statusText","url","ok")})))}delete(e,t){return this._http.delete(e,{...(0,S.pick)(t,"headers","responseType","body"),observe:"response"}).pipe((0,c.map)(a=>({headers:this._mapToCrtHttpHeaders(a.headers),...(0,S.pick)(a,"body","status","statusText","url","ok")})))}static{this.\u0275fac=function(t){return new(t||_e)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac,providedIn:"root"})}};De=(0,_.__decorate)([(0,C.CrtHandlerChainAdapter)({requestType:"crt.HttpClientService"}),(0,_.__metadata)("design:paramtypes",[d.HttpClient])],De);let R=class ue extends de{constructor(){super(...arguments),this._destroyed$=new i.Subject,this._messageChannelService=(0,n.inject)(u.MessageChannelService),this.serviceEndpoint="ServiceModel/LicenseService.svc",this.getLicenseOperationStatuses=e=>this._getLicenseOperationStatuses(e,"GetLicOperationStatuses","GetLicOperationStatusesResult"),this.getExplicitLicenseOperationStatuses=e=>this._getLicenseOperationStatuses(e,"GetExplicitLicOperationStatuses","GetExplicitLicOperationStatusesResult"),this.loadLicenseOperationStatuses=e=>this._getLicenseOperationStatuses(e,"GetExplicitLicOperationStatuses","GetExplicitLicOperationStatusesResult")}_getLicenseOperationStatuses(e,t,a){return e?.length?this.executePostRequestWithCache(t,{licOperationCodes:e}).pipe((0,i.map)(s=>s?.[a]),(0,i.map)(s=>s?.success?s.licOperationStatuses.reduce((r,h)=>(r[h.Key]=h.Value,r),{}):{})):(0,i.of)({})}listenUnavailableLicenseInfo(){return this._messageChannelService.messageEvent$.pipe((0,i.filter)(e=>e.header.sender==="UnavailableLicenseEventNotifier"),(0,i.map)(e=>e.body),(0,i.takeUntil)(this._destroyed$))}getUnavailableLicenseInfo(){const e=this.serviceEndpoint+"/GetUnavailableLicOperations";return this.httpClient.post(e,null).pipe((0,i.map)(t=>t&&t.success?t.unavailableLicOperationsInfo:null),(0,c.catchError)(()=>(0,i.of)(null)))}ngOnDestroy(){this._destroyed$.next()}static{this.\u0275fac=(()=>{let e;return function(a){return(e||(e=n.\u0275\u0275getInheritedFactory(ue)))(a||ue)}})()}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ue,factory:ue.\u0275fac,providedIn:"root"})}};R=(0,_.__decorate)([(0,C.CrtHandlerChainAdapter)({requestType:"crt.LicenseService"})],R);const ke=new n.InjectionToken("CRT_UNAVAILABLE_LICENSE"),we=new n.InjectionToken("Represents a list of license restriction operation codes"),je=new n.InjectionToken("Represents a list of license restriction operation values");function Me(){return R.unavailableLicenseInfo}const rt={provide:ke,useFactory:Me};function Le(l){return(0,f.A)(function*(){return R.unavailableLicenseInfo=(yield(0,i.lastValueFrom)(l.getUnavailableLicenseInfo(),{defaultValue:null}))??R.unavailableLicenseInfo})}const ot={provide:n.APP_INITIALIZER,useFactory:Le,deps:[R],multi:!0},$e={},ct={provide:n.APP_INITIALIZER,useFactory:(l,e)=>(0,f.A)(function*(){return Object.assign($e,yield(0,i.lastValueFrom)(l.getExplicitLicenseOperationStatuses(e),{defaultValue:null}))}),deps:[R,we],multi:!0},lt={provide:je,useFactory:()=>Object.freeze($e)};class J{constructor(e,t){this.queryExecutor=e,this.configurationDataService=t}_buildUrlWithCardModule(e,t,a){return window.location.origin+window.location.pathname+`#${e}/${t}/edit/${a}`}_getPageSchemaNameForRecord(e,t){const a=e?.pages;if(!a)return(0,i.of)(null);if(a.length===1){const s=a[0];return(0,i.of)(s)}return e.typeColumnName?this._getPageSchemaNameForRecordByType(e,t):(0,i.of)(a.find(s=>s.isDefault))}_getPageSchemaNameByType(e,t){const a=e?.pages;return a?a.length===1?a[0]:this._findPageByType(e,t):null}_getPageSchemaNameForRecordByType(e,t){return new i.Observable(a=>{this._getRecordTypeValue(e,t).subscribe(s=>{const r=this._findPageByType(e,s);a.next(r),a.complete()})})}_findPageByType(e,t){const a=e.pages;t=typeof t=="object"?t.value:t;let s=a.find(r=>r.typeId===t);return(!s||!t)&&(s=a[0]),s}_getRecordTypeValue(e,t){return new i.Observable(a=>{const s=e.entitySchemaName,r=e.typeColumnName,h=new o.EntitySchemaQuery(s);h.rowCount=1,h.addSchemaColumn(r),h.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"Id",t),this.queryExecutor.executeSelectQuery(h).subscribe(p=>{p=p||[];const j=(p[0]||{})[r].value;a.next(j),a.complete()})})}buildPageUrlByEntityName(e,t,a){const s=a.moduleStructure?.cardModule,h=this._getPageSchemaNameByType(a.entityStructure,t.typeId)?.cardSchemaName;return this._buildUrlWithCardModule(s,h,t.Id)}buildPageUrl(e,t){return new i.Observable(a=>{this.configurationDataService.getEntityData(e).subscribe(s=>{const r=s.data?.entityStructure;this._getPageSchemaNameForRecord(r,t).subscribe(h=>{const p=s.data?.moduleStructure?.cardModule,I=h?.cardSchemaName,v=this._buildUrlWithCardModule(p,I,t);a.next(v),a.complete()})})})}static{this.\u0275fac=function(t){return new(t||J)(n.\u0275\u0275inject(P.QueryExecutor),n.\u0275\u0275inject(x))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}function ut(l){const e={};return e.uId=l.uId||(0,o.generateGuid)(),e.name=l.name,e.caption={"en-US":l.caption||l.name},e.usageType=l.usageType||u.EntitySchemaColumnUsageType.General,e.dataValueType=l.dataValueType,e.referenceSchemaUId=l.referenceSchemaUId,e.referenceSchemaName=l.referenceSchemaName,e}function Ne(l){const e={};return e.uId=l.uId,e.name=l.name,e.caption={"en-US":l.caption||l.name},e.columns={Items:{}},l.columns.map(a=>{const s=ut(a);return a.isPrimaryColumn&&(e.primaryColumnUId=s.uId),a.isPrimaryDisplayColumn&&(e.primaryDisplayColumnUId=s.uId),s}).forEach(a=>{e.columns.Items[a.uId]=a}),e}const Pe="16be3651-8fe2-4159-8dd0-a803d4683dd3",Ue="Contact",Ge="25d7c1ab-1de0-4501-b402-02e0e5a72d6e",We="Account",ht=Ne({uId:Pe,name:Ue,columns:[{name:"Id",uId:"ae0e45ca-c495-4fe7-a39d-3ab7278e1617",usageType:u.EntitySchemaColumnUsageType.Advanced,dataValueType:o.DataValueType.Guid,isPrimaryColumn:!0},{name:"Name",dataValueType:o.DataValueType.Text,uId:"a5cca792-47dd-428a-83fb-5c92bdd97ff8"},{name:"Caption",dataValueType:o.DataValueType.Text,isPrimaryDisplayColumn:!0,uId:"9e53fd7c-dde4-4502-a64c-b9e34148108c"},{name:"ProcessListeners",usageType:u.EntitySchemaColumnUsageType.None,dataValueType:o.DataValueType.Integer},{name:"HomePhone",dataValueType:o.DataValueType.Text},{name:"Address",dataValueType:o.DataValueType.Text,uId:"0fb61bc8-a195-4d90-aecc-18b411b51814"},{name:"DoNotUseEmail",dataValueType:o.DataValueType.Boolean},{name:"DoNotUseFax",dataValueType:o.DataValueType.Boolean},{name:"DoNotUseMail",dataValueType:o.DataValueType.Boolean},{name:"DoNotUseCall",dataValueType:o.DataValueType.Boolean},{name:"TwitterId",dataValueType:o.DataValueType.Text,usageType:u.EntitySchemaColumnUsageType.Advanced},{name:"GPSN",dataValueType:o.DataValueType.Text,usageType:u.EntitySchemaColumnUsageType.Advanced},{name:"GPSE",dataValueType:o.DataValueType.Text,usageType:u.EntitySchemaColumnUsageType.Advanced},{name:"BirthDate",dataValueType:o.DataValueType.Date,uId:"3f08db69-6d2f-4b1c-87a4-acddc6c3b9d6"},{name:"Account",uId:"5c6ca10e-1180-4c1e-8a50-55a72ff9bdd4",dataValueType:o.DataValueType.Lookup,referenceSchemaUId:Ge,referenceSchemaName:We},{name:"Owner",dataValueType:o.DataValueType.Lookup,referenceSchemaUId:Pe,referenceSchemaName:Ue},{name:"Skype",dataValueType:o.DataValueType.Text},{name:"Email",dataValueType:o.DataValueType.Text},{name:"DoNotUseSms",dataValueType:o.DataValueType.Boolean},{name:"JobTitle",dataValueType:o.DataValueType.Text},{name:"Phone",dataValueType:o.DataValueType.Text},{name:"MobilePhone",dataValueType:o.DataValueType.Text},{name:"Zip",dataValueType:o.DataValueType.Text},{name:"Surname",dataValueType:o.DataValueType.Text},{name:"Dear",dataValueType:o.DataValueType.Text},{name:"CreatedOn",caption:"Created on",dataValueType:o.DataValueType.DateTime,usageType:u.EntitySchemaColumnUsageType.Advanced},{name:"ModifiedOn",caption:"Modified on",dataValueType:o.DataValueType.DateTime,usageType:u.EntitySchemaColumnUsageType.Advanced}]}),pt=Ne({uId:Ge,name:We,columns:[{name:"Id",usageType:u.EntitySchemaColumnUsageType.Advanced,dataValueType:o.DataValueType.Guid,isPrimaryColumn:!0},{name:"Name",dataValueType:o.DataValueType.Text},{name:"Caption",dataValueType:o.DataValueType.Text,isPrimaryDisplayColumn:!0},{name:"ProcessListeners",usageType:u.EntitySchemaColumnUsageType.None,dataValueType:o.DataValueType.Integer},{name:"Phone",dataValueType:o.DataValueType.Text},{name:"Address",dataValueType:o.DataValueType.Text},{name:"Owner",dataValueType:o.DataValueType.Lookup,referenceSchemaUId:Pe,referenceSchemaName:Ue},{name:"Skype",dataValueType:o.DataValueType.Text},{name:"Email",dataValueType:o.DataValueType.Text},{name:"Fax",dataValueType:o.DataValueType.Text},{name:"Zip",dataValueType:o.DataValueType.Text},{name:"CreatedOn",caption:"Created on",dataValueType:o.DataValueType.DateTime,usageType:u.EntitySchemaColumnUsageType.Advanced},{name:"ModifiedOn",caption:"Modified on",dataValueType:o.DataValueType.DateTime,usageType:u.EntitySchemaColumnUsageType.Advanced}]}),dt=Ne({uId:"27AEADD6-D508-4572-8061-5B55B667C902",name:"SysSettings",columns:[{name:"Id",usageType:u.EntitySchemaColumnUsageType.Advanced,dataValueType:o.DataValueType.Guid,isPrimaryColumn:!0},{name:"Name",dataValueType:o.DataValueType.Text,isPrimaryDisplayColumn:!0},{name:"Code",dataValueType:o.DataValueType.Text}]});class Y extends A{constructor(e,t){super(null),this._values=e,this._defaultValue=t}_getFeatureState(e){return this._values?.[e]??this._defaultValue}getFeatureState(e){return(0,i.of)(this._getFeatureState(e))}getFeaturesState(e){return(0,i.of)(e.map(t=>this._getFeatureState(t)))}static{this.\u0275fac=function(t){n.\u0275\u0275invalidFactory()}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac})}}function mt(l={},e=!0){return{provide:A,useFactory:()=>new Y(l,e)}}class yt extends o.SysSetting{}var Ae;(function(l){l[l.Inactive=0]="Inactive",l[l.Running=1]="Running",l[l.Done=2]="Done",l[l.Error=3]="Error",l[l.Cancelled=4]="Cancelled"})(Ae||(Ae={}));class He{}class St extends He{}class gt{}class ft{static{this.textCodeTwoFactorAuthFlow="SMS"}static{this.totpTwoFactorAuthFlow="TOTP"}static{this.recoveryCodeTwoFactorAuthFlow="RecoveryCode"}}class X{constructor(e){this._httpClient=e,this._url="/rest/GridUtilitiesService/DeleteRecordsAsync"}_getCommonPayloadParams(e){return{rootSchema:e.entitySchemaName,parameters:`{'operationKey':'${e.operationKey}'}`}}_deleteRecordsById(e){const t=this._getCommonPayloadParams(e);return t.primaryColumnValues=e.primaryColumnValues,this._httpClient.post(this._url,t)}_deleteRecordsByFilters(e){const t=this._getCommonPayloadParams(e);return t.filtersConfig=JSON.stringify(e.filters),this._httpClient.post(this._url,t)}deleteRecords(e){return(!!e.filters?this._deleteRecordsByFilters(e):this._deleteRecordsById(e)).pipe((0,c.map)(s=>{const r=JSON.parse(s.DeleteRecordsAsyncResult);return{error:r.ExceptionMessage,operationKey:r.OperationKey,success:r.Success}}),(0,c.catchError)(s=>(0,i.of)({error:s?.message,operationKey:e.operationKey,success:!1})))}static{this.\u0275fac=function(t){return new(t||X)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac,providedIn:"root"})}}class F{constructor(e,t){this._http=e,this._queryExecutor=t}_getPackageNames(){return this.getPackagesInfo().pipe((0,i.map)(e=>{const t={};return e.forEach(a=>t[a.UId]=a.Name),t}))}_getPackageTopologicalOrder(){return this._http.post("ServiceModel/ApplicationInfoService.svc/GetPackageHierarchyInfo",null).pipe((0,i.tap)(({success:t})=>{if(!t)throw new Error("GetPackageHierarchyInfo request is failed")}),(0,i.map)(t=>t.packageTopologicalOrder))}loadPackagesTopology(){return(0,i.forkJoin)([this._getPackageNames(),this._getPackageTopologicalOrder()]).pipe((0,i.map)(([e,t])=>{o.PkgTopology.items.clear(),t.reverse(),t.forEach((a,s)=>{const r=e[a];o.PkgTopology.items.set(r,s)})}))}getPackagesInfo(){if(this._packagesInfo$)return this._packagesInfo$;const e=new o.EntitySchemaQuery("SysPackage");return e.addSchemaColumn("Name"),e.addSchemaColumn("UId"),e.addSchemaColumn("Maintainer"),this._packagesInfo$=this._queryExecutor.executeSelectQuery(e).pipe((0,i.shareReplay)(1)),this._packagesInfo$}static{this.\u0275fac=function(t){return new(t||F)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(P.QueryExecutor))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac,providedIn:"root"})}}function _t(l){return()=>l.get(u.UserInfoService).loadCurrentUserInfo().pipe((0,c.map)(()=>l.get(F)),(0,c.switchMap)(t=>t.loadPackagesTopology()))}const Ct={provide:n.APP_INITIALIZER,useFactory:_t,deps:[n.Injector],multi:!0};var Fe;(function(l){l.DevExpress="DevExpress",l.Word="MS Word"})(Fe||(Fe={}));class ee{constructor(e,t,a){this._queryExecutor=e,this._httpClient=t,this._fileDownloaderService=a}_loadPrintables(){const e=new o.EntitySchemaQuery("SysModuleReport");return e.addSchemaColumn("Id"),e.addSchemaColumn("Caption"),e.addSchemaColumn("ConvertInPDF"),e.addSchemaColumn("ShowInCard"),e.addSchemaColumn("ShowInSection"),e.addSchemaColumn("SysEntitySchema.Name","SysEntitySchemaName"),e.addSchemaColumn("SysModule.SysModuleEntity.[SysSchema:UId:SysEntitySchemaUId].Name","SysModuleEntityName"),e.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"Type.Name",Fe.Word),this._queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>t.map(a=>a)))}_getPrintables(){return this._printables$||(this._printables$=this._loadPrintables()),(0,i.firstValueFrom)(this._printables$)}_filterEntityName(e,t){return e.SysEntitySchemaName===t||e.SysModuleEntityName===t}_getPrintablesList(e){var t=this;return(0,f.A)(function*(){const a=t._httpClient.post("rest/ReportService/CreateReportsList",e);return(yield(0,i.firstValueFrom)(a)).CreateReportsListResult})()}_getPrintablesListByFilter(e){var t=this;return(0,f.A)(function*(){const a=t._httpClient.post("rest/ReportService/CreateReportsListByFilter",e);return(yield(0,i.firstValueFrom)(a)).CreateReportsListByFilterResult})()}_downloadPrintables(e,t){e.forEach(a=>{this._fileDownloaderService.downloadFromUrl(`../rest/ReportService/GetReportFile/${a}`,t)})}getPrintablesForEntity(e){var t=this;return(0,f.A)(function*(){return e?(yield t._getPrintables()).filter(s=>t._filterEntityName(s,e)):[]})()}generatePrintables(e,t){var a=this;return(0,f.A)(function*(){const s=yield a._getPrintablesList(e);a._downloadPrintables(s,t)})()}generatePrintablesByFilter(e,t){var a=this;return(0,f.A)(function*(){const s=yield a._getPrintablesListByFilter(e);a._downloadPrintables(s,t)})()}static{this.\u0275fac=function(t){return new(t||ee)(n.\u0275\u0275inject(P.QueryExecutor),n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(u.FileDownloaderService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac})}}class te{constructor(e){this.httpClient=e,this.serviceEndpoint="ServiceModel/ProcessEngineService.svc/"}_executePost(e,t){const a=this.serviceEndpoint+t;return this.httpClient.post(a,e)}_getRequestSortingColumns(e){return e?Object.entries(e).map(([a,s],r)=>({path:a,direction:(0,o.toOrderDirection)(s),position:r})):[]}createProcessParameterValues(e){const t=[];return e&&Object.entries(e).forEach(([a,s])=>{let r=s;(0,S.isDate)(s)&&(r=(0,o.encodeDate)(s)),t.push({name:a,value:r})}),t}executeProcessByName(e,t,a){const s={schemaName:e,parameterValues:this.createProcessParameterValues(t),resultParameterNames:a};return this._executePost(s,"RunProcess")}executeProcessForMatchingRecords(e){const t={schemaName:e.processName,inputParameterName:e.inputParameterName,entitySchemaName:e.entitySchemaName,filterConfig:JSON.stringify(e.filterConfig),isSupportMultiplePageOpening:!1,sortingColumns:this._getRequestSortingColumns(e.sortingColumns)};return this._executePost(t,"RunProcessForMatchingRecords")}completeExecuting(e,t){const a={processElementUId:e,parameterValues:this.createProcessParameterValues(t)};return this._executePost(a,"CompleteExecuting")}changeToAppropriateDcmInstance(e,t,a){const s={currentStageId:e,entitySchemaName:t,recordId:a};return this._executePost(s,"ChangeToAppropriateDcmInstance")}static{this.\u0275fac=function(t){return new(t||te)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac,providedIn:"root"})}}class ae{constructor(e){this.httpClient=e,this.serviceEndpoint="DataService/json/SyncReply/"}_parseProcessSchemaMetadata(e){return JSON.parse(e)}_convertStringSchemaMetadataToObject(e){const t=this._parseProcessSchemaMetadata(e.schema.metaData);return(0,S.set)(e,"schema.metaData",t),e}getProcessSchemaData(e){const t=this.serviceEndpoint+"ProcessSchemaRequest";return this.httpClient.post(t,{uId:e,packageUId:null,convertLocalizableStringToParameter:!0}).pipe((0,c.map)(a=>this._convertStringSchemaMetadataToObject(a)))}static{this.\u0275fac=function(t){return new(t||ae)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac,providedIn:"root"})}}function Be(l,e,t){return()=>(0,i.lastValueFrom)(t.loadCurrentUserInfo().pipe((0,c.switchMap)(()=>l.loadApplicationInfo()),(0,c.map)(a=>a.applicationInfo),(0,c.switchMap)(a=>{const s=a.configurationContentHash;return e.load(s)})),{defaultValue:null})}var Et=g(95894);class k{get _requirejs(){return this._requireJsProvider.get()}constructor(e,t,a,s,r){this._requireJsProvider=e,this._window=t,this._injector=a,this._remoteEntryLoader=s,this._ngZone=r,this._fileContentUrlBuilder=(0,n.inject)(u.FileContentUrlBuilderService),this._descriptorsKey="_FileContentDescriptors",this._requestUrl=`conf/content/${this._descriptorsKey}`,this._remoteEntryTypes=new Map([["remoteEntry.js",o.RemoteEntryType.Script],["remoteModuleEntry.js",o.RemoteEntryType.Module]]),this._bootstrappingWaitTime=1e4,this._loaded$=new i.BehaviorSubject(!1),this.loaded$=this._loaded$.asObservable()}_setupConfig(e){if(this._requirejs.specified(this._descriptorsKey))return;let t=this._requestUrl;e&&(t+=".js?hash="+e),this._requirejs.config({baseUrl:(0,u.getWorkspaceBaseUrl)(),paths:{[this._descriptorsKey]:t}})}_isRemoteEntry(e){return this._remoteEntryTypes.has(e)}_getRemoteEntryType(e){return this._remoteEntryTypes.get(e)}_getRemoteBuildsInfo(e){const t=[],a=this._injector.get(u.FILE_CONTENT_DESCRIPTOR_TOKEN);return Object.keys(a.descriptors).forEach(s=>{const r=s.split("/"),h=r.at(-1);if(!this._isRemoteEntry(h))return;const p=r.at(0),I=r.at(-2),v=r.slice(1).join("/"),j=this._fileContentUrlBuilder.getUrl(p,v,e),Qe=this._getRemoteEntryType(h),Nt=this._packagesInfo.find(Ut=>Ut.Name===p).Maintainer,Pt=Qe===o.RemoteEntryType.Script?"./RemoteEntry":"./Main";t.push({name:I,entry:j,entryType:Qe,mainModule:Pt,packageName:p,maintainer:Nt})}),t}_loadDescriptors(){return new i.Observable(e=>{this._requirejs([this._descriptorsKey],()=>{e.next(),e.complete()},t=>{console.warn(t),e.next(),e.complete()})})}_loadRemoteBuild(e){return(0,i.defer)(()=>this._ngZone.runOutsideAngular(()=>this._remoteEntryLoader.load({remoteName:e.name,remoteEntry:e.entry,remoteEntryType:e.entryType,shareScope:e.maintainer,exposedModule:e.mainModule})))}_onTimeout(e,t){console.error(`${e} modules did not bootstrap in ${t/1e3} seconds. Please ensure that you called bootstrapCrtModule function inside your project.`)}_onLoadingError(e){console.error(e),console.error("Please ensure the remote module name and file content directory name are the same in the snake_case.")}_listenBootstraps(){return new i.Observable(e=>o.BootstrapNotifier.instance.subscribe(()=>e.next()))}_loadRemoteEntries(e){if(e.length===0)return(0,i.of)(null);let t=e.length;const a=this._listenBootstraps(),s=new i.Subject,r=e.map(v=>this._loadRemoteBuild(v).pipe((0,i.catchError)(j=>(this._onLoadingError(j),s.next(j),(0,i.of)(null))))),h=(0,i.forkJoin)(r).pipe((0,i.tap)(()=>s.complete()),(0,i.map)(()=>{})),p=(0,i.merge)(a,s).pipe((0,i.tap)(()=>t--),(0,i.first)(()=>t===0)),I=h.pipe((0,i.delay)(this._bootstrappingWaitTime),(0,i.tap)(()=>this._onTimeout(t,this._bootstrappingWaitTime)));return(0,i.merge)(p,I).pipe((0,i.first)())}load(e){return this._setupConfig(e),this._loadDescriptors().pipe((0,i.switchMap)(()=>this._injector.get(F).getPackagesInfo()),(0,i.tap)(t=>this._packagesInfo=t),(0,i.map)(()=>this._getRemoteBuildsInfo(e)),(0,i.tap)(t=>t.forEach(a=>o.RemoteEntriesRegistry.items.set(a.name,a))),(0,i.switchMap)(t=>this._loadRemoteEntries(t)),(0,i.tap)(()=>this._loaded$.next(!0)),(0,i.catchError)(t=>(console.log(t),(0,i.of)(null))))}ngOnDestroy(){this._loaded$.complete()}static{this.\u0275fac=function(t){return new(t||k)(n.\u0275\u0275inject(u.RequireJsProvider),n.\u0275\u0275inject(C.WINDOW_TOKEN),n.\u0275\u0275inject(n.Injector),n.\u0275\u0275inject(Et.RemoteEntryLoader),n.\u0275\u0275inject(n.NgZone))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac,providedIn:"root"})}}const It={provide:n.APP_INITIALIZER,useFactory:Be,deps:[u.ApplicationInfoService,k,u.UserInfoService],multi:!0};class se{constructor(e,t){this._httpClient=e,this._queryExecutor=t,this._serviceEndpoint="ServiceModel/SchemaInfoService.svc",this._featureValues=(0,n.inject)(u.FEATURE_VALUES,{optional:!0})}_getExtendParentResponse(e){const t=new o.EntitySchemaQuery("SysSchema");return t.addSchemaColumn("[SysSchema:Id:Parent].UId","UId"),t.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"UId",e),t.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"ExtendParent",!0),(0,i.lastValueFrom)(this._queryExecutor.executeSelectQuery(t))}_getCaptionResponse(e){if(this._featureValues?.DisableUseSchemaInfoService){const a=new o.EntitySchemaQuery("SysSchema");return a.addSchemaColumn("=[VwSysSchemaExtending:BaseSchemaId:Id].[SysSchema:Id:TopExtendingSchemaId].Caption","Caption"),a.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"Name",e),(0,i.lastValueFrom)(this._queryExecutor.executeSelectQuery(a))}const t=`${this._serviceEndpoint}/GetSchemaCaption`;return(0,i.lastValueFrom)(this._httpClient.post(t,{schemaName:e}))}getSchemaUIdByName(e){var t=this;return(0,f.A)(function*(){if(!e)return"";const a=new o.EntitySchemaQuery("SysSchema");a.addSchemaColumn("UId"),a.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"Name",e),a.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"ExtendParent",!1);const s=yield(0,i.lastValueFrom)(t._queryExecutor.executeSelectQuery(a));return s.errorInfo?(console.error(s.errorInfo.message),""):s[0]?.UId})()}getSchemaCaptionByName(e){var t=this;return(0,f.A)(function*(){if(!e)return"";const a=yield t._getCaptionResponse(e);return a.errorInfo?(console.error(a.errorInfo.message),""):a?.caption||a[0]?.Caption})()}getExtendSchemaParentUIdByUId(e){var t=this;return(0,f.A)(function*(){if(!e)return"";const a=yield t._getExtendParentResponse(e);return a.errorInfo?(console.error(a.errorInfo.message),""):a[0]?.UId})()}static{this.\u0275fac=function(t){return new(t||se)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(P.QueryExecutor))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac,providedIn:"root"})}}class ie{constructor(e){this._messageChannelService=e}getNotifications(e,t){return this._messageChannelService.messageEvent$.pipe((0,i.filter)(a=>a.header.sender===e&&(t===void 0||a.body?.operationId===t)),(0,i.map)(a=>a.body.body))}static{this.\u0275fac=function(t){return new(t||ie)(n.\u0275\u0275inject(u.MessageChannelService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac,providedIn:"root"})}}class ne extends u.AbstractThemeProvider{constructor(e){super(),this._injector=e,this._currentThemeProfileKey="CurrentTheme",this._userSchemaProfileService=this._injector.get(U),this._featureService=this._injector.get(o.FeatureService),this._defaultTheme=this._injector.get(u.DEFAULT_THEME)}getCurrentTheme(){return(0,i.from)(this._featureService.getFeatureState("ChangeTheme")).pipe((0,c.switchMap)(e=>e?this._userSchemaProfileService.getProfile(this._currentThemeProfileKey):(0,i.of)([])),(0,c.map)(e=>Array.isArray(e)?e?.pop():void 0),(0,c.map)(e=>e??this._defaultTheme))}static{this.\u0275fac=function(t){return new(t||ne)(n.\u0275\u0275inject(n.Injector))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}}class Tt{}class re{constructor(e,t){this.httpClient=e,this._serviceGetProfileEndpoint=`${t}/QueryProfile`,this._serviceSaveProfileEndpoint=`${t}/UserProfile`}_innerSaveProfile(e,t,a){const{requirejs:s,require:r}=window;r?.defined("profile")&&r("profile").addKey(e);const h={key:e,data:JSON.stringify(t)};return a&&(h.isDef=!0),s?.undef("profile!"+e),this.httpClient.post(this._serviceSaveProfileEndpoint,h).pipe((0,c.map)(p=>p))}getProfile(e){return this.httpClient.post(this._serviceGetProfileEndpoint,{key:e})}saveProfile(e,t){return this._innerSaveProfile(e,t,!1)}saveDefaultProfile(e,t){return this._innerSaveProfile(e,t,!0)}static{this.\u0275fac=function(t){return new(t||re)(n.\u0275\u0275inject(d.HttpClient),n.\u0275\u0275inject(u.DATA_SERVICE_URI))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac,providedIn:"root"})}}class oe{getProfile(e){const t=localStorage.getItem(e);return(0,i.of)(JSON.parse(t))}saveProfile(e,t){return localStorage.setItem(e,JSON.stringify(t)),(0,i.of)(t)}saveDefaultProfile(e,t){return localStorage.setItem(e,JSON.stringify(t)),(0,i.of)(t)}static{this.\u0275fac=function(t){return new(t||oe)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac})}}let qe=[];const vt={provide:u.ACCESS_CONTROL_WHITELIST,useFactory:()=>Object.freeze(qe)};class w{constructor(e){this.httpClient=e,this._destroyed$=new i.Subject,this._whiteListUrl="/rest/ACLService/GetWhitelist"}loadWhitelist(){return this.httpClient.get(this._whiteListUrl).pipe((0,c.map)(e=>(qe=[...e],e)),(0,c.catchError)(()=>(0,i.of)(null)),(0,c.takeUntil)(this._destroyed$))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||w)(n.\u0275\u0275inject(d.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac,providedIn:"root"})}}function Rt(l){const e=l.get(u.UserInfoService);return(0,i.lastValueFrom)(e.loadCurrentUserInfo().pipe((0,i.switchMap)(()=>l.get(w).loadWhitelist())),{defaultValue:null})}function Ke(l){return Rt.bind(this,l)}const Dt={provide:n.APP_INITIALIZER,useFactory:Ke,deps:[n.Injector],multi:!0};class ce{constructor(e){this._userInfo=e.get(u.UserInfo),this._queryExecutor=e.get(P.QueryExecutor)}_mapToUserConsent(e,t){return{id:e.Id,dateOfConsent:e.CreatedOn,expirationDate:e.ExpirationDate,consentId:t}}getConsent(e){const t=new o.EntitySchemaQuery("Consent");return t.addSchemaColumn("Id"),t.addSchemaColumn("Name"),t.addSchemaColumn("ConsentText"),t.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"Code",e),this._queryExecutor.executeSelectQuery(t).pipe((0,c.map)(a=>{if(a&&a.length>0){const s=a[0];return{id:s.Id,consentText:s.ConsentText,name:s.Name,code:e}}return null}),(0,c.catchError)(()=>{throw new Error("Error while getting user consent status")}))}getUserConsent(e,t){const a=new o.EntitySchemaQuery("UserConsentHistory");return a.addSchemaColumn("Id"),a.addSchemaColumn("CreatedOn"),a.addSchemaColumn("ExpirationDate"),a.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"ConsentCode",e),a.filters.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"CreatedBy",t??this._userInfo.contactId),this._queryExecutor.executeSelectQuery(a).pipe((0,c.map)(s=>{if(!s.length)return null;if(s.some(h=>!!h.ExpirationDate)){const h=new Date,p=s.find(I=>{const v=I.ExpirationDate;return v&&new Date(v)>h});return p?this._mapToUserConsent(p,e):null}else{const h=s[0];return this._mapToUserConsent(h,e)}}),(0,c.catchError)(()=>{throw new Error("Error while getting user consent status")}))}giveUserConsent(e,t){return this.getConsent(e).pipe((0,c.mergeMap)(a=>a?this.getUserConsent(a.id).pipe((0,c.mergeMap)(s=>{if(!s){const r=new o.InsertQuery("UserConsentHistory");return r.addColumn("ConsentCode",a.id,o.DataValueType.Lookup),t&&r.addColumn("ExpirationDate",t,o.DataValueType.DateTime),(0,i.from)(this._queryExecutor.executeInsertQuery(r)).pipe((0,c.map)(()=>{}))}return(0,i.of)(void 0)})):(0,i.of)(void 0)))}static{this.\u0275fac=function(t){return new(t||ce)(n.\u0275\u0275inject(n.Injector))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac})}}},73308:(ze,he,g)=>{g.d(he,{A:()=>D});function _(o,C,u,f,N,i,d){try{var n=o[i](d),E=n.value}catch(c){u(c);return}n.done?C(E):Promise.resolve(E).then(f,N)}function D(o){return function(){var C=this,u=arguments;return new Promise(function(f,N){var i=o.apply(C,u);function d(E){_(i,f,N,d,n,"next",E)}function n(E){_(i,f,N,d,n,"throw",E)}d(void 0)})}}}}]);
