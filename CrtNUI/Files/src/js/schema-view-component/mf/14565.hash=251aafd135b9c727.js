(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[14565],{14565:(Te,b,d)=>{d.r(b),d.d(b,{ACTIVE_COMMUNICATIONS_ATTRIBUTE_NAME:()=>w,CALL_INDICATOR_IMAGE:()=>z,CHATS_TAB_NAME:()=>Q,COMMUNICATIONS_PANEL_HAS_NEW_MESSAGES_ATTRIBUTE_NAME:()=>F,COMMUNICATIONS_PANEL_ITEMS_ATTRIBUTE_NAME:()=>y,COMMUNICATIONS_PANEL_MODEL_ATTRIBUTE_NAME:()=>$,COMMUNICATION_PANEL_NAME:()=>C,COMMUNICATION_PANEL_SELECTED_ITEM_ATTRIBUTE_NAME:()=>H,CONSULTATION_INDICATOR_IMAGE:()=>K,CONSULTATION_TAB_NAME:()=>Y,CTI_TAB_NAME:()=>V,CURRENT_CALL_CHANGED_ATTRIBUTE_NAME:()=>W,CURRENT_CALL_CHANGED_LISTENER_ATTRIBUTE_NAME:()=>x,CURRENT_COMMUNICATIONS_INFO_ATTRIBUTE_NAME:()=>j,CURRENT_CONSULTATION_CHANGED_ATTRIBUTE_NAME:()=>X,CURRENT_CONSULTATION_CHANGED_LISTENER_ATTRIBUTE_NAME:()=>J,DISABLE_RIGHT_PANEL_PREPROCESSING_FEATURE_NAME:()=>Z,LEGACY_SIDE_PANEL_ITEMS:()=>ie,LEGACY_SIDE_PANEL_NAME:()=>te,LEGACY_SIDE_PANEL_SELECTED_ITEM:()=>ne,NOTIFICATIONS_PANEL_HAS_NEW_NOTIFICATIONS_ATTRIBUTE_NAME:()=>k,NOTIFICATIONS_PANEL_ITEMS_ATTRIBUTE_NAME:()=>v,NOTIFICATIONS_PANEL_MODEL_ATTRIBUTE_NAME:()=>G,NOTIFICATIONS_PANEL_NAME:()=>f,NOTIFICATIONS_PANEL_SELECTED_ITEM_ATTRIBUTE_NAME:()=>D,PREDEFINED_SIDEBARS:()=>se,RIGHT_PANEL_CONTACT_CHAT_ATTRIBUTE_NAME:()=>B,RIGHT_PANEL_CONTACT_CHAT_SUBSCRIPTION_ATTRIBUTE_NAME:()=>U,RIGHT_PANEL_LISTENER_SUBSCRIPTION_ATTRIBUTE_NAME:()=>m,RIGHT_PANEL_RESET_COUNTER_EVENT_NAME:()=>g,RIGHT_PANEL_RESET_COUNTER_LISTENER_ATTRIBUTE_NAME:()=>P,RIGHT_PANEL_SELECTED_TAB_ATTRIBUTE_NAME:()=>R,RIGHT_PANEL_SELECTED_TAB_SUBSCRIPTION_ATTRIBUTE_NAME:()=>L,RIGHT_PANEL_SET_SELECTED_TAB_EVENT_NAME:()=>O,SIDEBAR_EXTENSIONS_FEATURE_NAME:()=>q,SIDEBAR_OPENED_STATE_ATTRIBUTE_NAME:()=>ae,SIDEBAR_OPENED_STATE_SUBSCRIPTION_ATTRIBUTE_NAME:()=>oe,SIDE_PANEL_CONTAINER_NAME:()=>ee,SidebarApiModule:()=>N,SidebarService:()=>T,SidebarStateService:()=>A,SidebarsConfigProvider:()=>E,findLeafSidebarInfo:()=>I,findNestedSidebarInGroup:()=>p,findRootSidebar:()=>h});const R="RightPanelSelectedTab",O="RightPanelSetSelectedTabEvent",L="RightPanelSelectedTabSubscription",m="RightPanelListenerSubscription",P="RightPanelResetCounterListener",g="RightPanelResetCounter",U="RightPanelContactChatSubscription",B="RightPanelContactChat",f="NotificationsPanel",D="NotificationsPanelItemsTabPanel_SelectedItem",v="NotificationsPanelItemsTabPanel_Items",G="NotificationsPanelModel",k="NotificationsPanelHasNewNotifications",C="CommunicationPanel",H="CommunicationsPanelItemsTabPanel_SelectedItem",$="CommunicationsPanelModel",y="CommunicationsPanelItemsTabPanel_Items",F="CommunicationsPanelHasNewMessages",j="CurrentCommunicationsInfo",w="ActiveCommunicationsInfo",V="CtiTab",x="CurrentCallChangedListener",W="CurrentCallChanged",Y="OBSWTab",J="CurrentConsultationChangedListener",X="CurrentConsultationChanged",z="right-panel-call-timer",K="right-panel-consultation-timer",Q="ChatsTab",Z="DisableRightPanelsPreprocessing",q="SidebarExtensions",ee="SidebarContainerWrapper",te="LegacySidePanel",ie="LegacySidePanelItemsTabPanel_Items",ne="LegacySidePanelItemsTabPanel_SelectedItem",ae="SidebarOpenedState",oe="SidebarOpenedState_Subscription",se=["FeedsTab","CtiTab","EmailsTab","ChatsTab","OBSWTab","ReminderTab","EsnNotificationsTab","VisaNotificationsTab","AnniversaryNotificationsTab","SystemNotificationsTab","BusinessProcessTab"];var u=d(40297),M=d(96590);const re={"en-US":JSON.parse('{"Sidebar":{"PredefinedSidebarGroups":{"CommunicationPanel":"Communication panel","NotificationsPanel":"Notifications panel"}}}'),"ru-RU":JSON.parse('{"Sidebar":{"PredefinedSidebarGroups":{"CommunicationPanel":"\u041A\u043E\u043C\u043C\u0443\u043D\u0438\u043A\u0430\u0446\u0438\u043E\u043D\u043D\u0430\u044F \u043F\u0430\u043D\u0435\u043B\u044C","NotificationsPanel":"\u041F\u0430\u043D\u0435\u043B\u044C \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439"}}}')};var r=d(59131);class N{static{this.\u0275fac=function(t){return new(t||N)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:N})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[u.CommonModule,M.CrtLibTranslateModule.forRoot({i18n:re})]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(N,{imports:[u.CommonModule,M.CrtLibTranslateModule]})})();var de=d(79772),o=d(62278),_e=d(63721);class T{constructor(e){this._httpClient=e,this.serviceEndpoint="/ServiceModel/SidebarService.svc/",this.getItemsMethodName="GetItems"}getItems(){const e=`${this.serviceEndpoint}${this.getItemsMethodName}`;return this._httpClient.post(e,null)}static{this.\u0275fac=function(t){return new(t||T)(r.\u0275\u0275inject(_e.HttpClient))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"})}}class E{constructor(e,t){this._sidebarService=e,this._translateService=t,this._additionalProperties={CtiTab:{containerClasses:["ts-cti-container"]},ChatsTab:{containerId:"OmniChatModule_WrapContainer"},FeedsTab:{containerClasses:["ts-feed-container"]}}}_translateInstant(e){return this._translateService.instant(`Sidebar.${e}`)}_createLeafSidebarDefinitionBase(e){return{code:e.code,title:e.title,icon:e.icon,schemaName:e.schemaName,index:e.index,autoHideNotificationMark:e.autoHideNotificationMark}}_createNestedSidebarDefinition(e){return{...this._createLeafSidebarDefinitionBase(e),...this._additionalProperties[e.code]}}_createStandaloneSidebarDefinition(e){return{...this._createLeafSidebarDefinitionBase(e),type:"standalone"}}_sortSidebarsByIndexAndCode(e,t){return e.index-t.index||e.code.localeCompare(t.code)}_fillCustomSidebarToSidebarGroupDefinition(e,t){const n=e.filter(i=>i.groupCode===t.code).map(i=>this._createNestedSidebarDefinition(i));return t.nestedSidebars=[...t.nestedSidebars,...n].sort((i,a)=>this._sortSidebarsByIndexAndCode(i,a)),t}_mapResponseItemsToDefinitions(e){const t=e.filter(n=>n.groupCode===null).map(n=>this._createStandaloneSidebarDefinition(n));return[this._fillCustomSidebarToSidebarGroupDefinition(e,{type:"group",code:C,outerContainerClasses:["communication-panel-item-container"],nestedSidebarsContainerClasses:["communications-panel-items-tab-panel"],nestedSidebars:[],title:this._translateInstant("PredefinedSidebarGroups.CommunicationPanel"),icon:"tools-icon",index:9e3}),this._fillCustomSidebarToSidebarGroupDefinition(e,{type:"group",code:f,outerContainerClasses:["ts-notifications-container","communication-panel-item-container"],nestedSidebarsContainerClasses:["notifications-panel-items-tab-panel"],nestedSidebars:[],title:this._translateInstant("PredefinedSidebarGroups.NotificationsPanel"),icon:"notifications-icon",index:1e4}),...t]}getSidebarsConfig(){return this._cachedSidebarsConfig$=this._cachedSidebarsConfig$??this._sidebarService.getItems().pipe((0,o.catchError)(()=>(0,o.of)({success:!1,items:[]})),(0,o.map)(e=>({rootSidebars:this._mapResponseItemsToDefinitions(e.items).filter(a=>a.type==="standalone"||a.type==="group"&&a.nestedSidebars.length).sort((a,s)=>this._sortSidebarsByIndexAndCode(a,s))})),(0,o.shareReplay)({bufferSize:1,refCount:!1})),this._cachedSidebarsConfig$}static{this.\u0275fac=function(t){return new(t||E)(r.\u0275\u0275inject(T),r.\u0275\u0275inject(de.TranslateService))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"root"})}}var _=d(73308);function h(c,e){return e.rootSidebars.find(t=>t.code===c)}function p(c,e){return e.nestedSidebars.find(t=>t.code===c)}function I(c,e){const t=e.rootSidebars.find(i=>i.code?.toLowerCase()===c.toLowerCase()&&i.type!=="group");if(t)return{leafSidebar:t,group:null};const n=e.rootSidebars.filter(i=>i.type==="group").flatMap(i=>i.nestedSidebars.map(a=>({group:i,nestedSidebar:a}))).find(i=>i.nestedSidebar.code?.toLowerCase()===c.toLowerCase());return n?{leafSidebar:n.nestedSidebar,group:n.group}:void 0}class A{constructor(e){this._sidebarsConfigProvider=e,this._notificationMarks={rootSidebars$:new o.BehaviorSubject({}),nestedSidebars$:new o.BehaviorSubject({}),nestedSidebarsSnapshot:{}},this._opened={rootSidebar$:new o.BehaviorSubject(null),nestedSidebars$:new o.BehaviorSubject({}),leafSidebar$:new o.BehaviorSubject(null),snapshot$:new o.BehaviorSubject({leafSidebar:null,nestedSidebars:{}})},this.notificationMarks={rootSidebars$:this._notificationMarks.rootSidebars$.asObservable(),nestedSidebars$:this._notificationMarks.nestedSidebars$.asObservable()},this.opened={rootSidebar$:this._opened.rootSidebar$.asObservable(),nestedSidebars$:this._opened.nestedSidebars$.asObservable(),leafSidebar$:this._opened.leafSidebar$.asObservable(),snapshot$:this._opened.snapshot$.asObservable()}}_getSidebarsConfig(){return(0,o.firstValueFrom)(this._sidebarsConfigProvider.getSidebarsConfig())}_updateNestedNotificationMarksSnapshot(e,t,n){const i=e.code,a=t.code;let s=this._notificationMarks.nestedSidebarsSnapshot[a];s||(s={},this._notificationMarks.nestedSidebarsSnapshot[a]=s),s[i]=n}_shouldSkipNotificationMark(e,t){const{markState:n,leafSidebarInfo:i}=e;return i.leafSidebar.code===t&&i.leafSidebar.autoHideNotificationMark&&n.visible}_autoHideNotificationMark(e){var t=this;return(0,_.A)(function*(){e.autoHideNotificationMark&&(yield t.setLeafNotificationMarks({[e.code]:{visible:!1}}))})()}_isNotificationMarkStateChanged(e,t){return(e?.visible??!1)!==t.visible}_emitNestedSidebarsNotificationMarks(e){const t=this._notificationMarks.nestedSidebars$.getValue();let n=!1;for(const i of e){const a=i.leafSidebarInfo.leafSidebar;this._updateNestedNotificationMarksSnapshot(a,i.leafSidebarInfo.group,i.markState),n||=this._isNotificationMarkStateChanged(t[a.code],i.markState),t[a.code]=i.markState}n&&this._notificationMarks.nestedSidebars$.next(t)}_setSidebarGroupsNotificationMarks(e){let t=!1;for(const[n,i]of Object.entries(this._notificationMarks.nestedSidebarsSnapshot)){const s={visible:Object.values(i).some(l=>l.visible)};t||=this._isNotificationMarkStateChanged(e[n],s),e[n]=s}return t}_setStandaloneSidebarsNotificationMarks(e,t){let n=!1;for(const i of e){const a=i.leafSidebarInfo.leafSidebar;n||=this._isNotificationMarkStateChanged(t[a.code],i.markState),t[a.code]=i.markState}return n}_emitRootSidebarsNotificationMarks(e){const t=this._notificationMarks.rootSidebars$.getValue(),n=this._setSidebarGroupsNotificationMarks(t),i=this._setStandaloneSidebarsNotificationMarks(e,t);(n||i)&&this._notificationMarks.rootSidebars$.next(t)}_emitIfChanged(e,t){return e.getValue()===t?!1:(e.next(t),!0)}_getLeafSidebarOpenedState(e){return e.nestedSidebar??e.rootSidebar}_emitOpenedSidebar(e){this._emitIfChanged(this._opened.rootSidebar$,e.rootSidebar);const t=this._getLeafSidebarOpenedState(e);if(this._opened.leafSidebar$.next(t),e.nestedSidebar){const n=this._opened.nestedSidebars$.getValue(),i=e.rootSidebar;n[i]!==e.nestedSidebar&&this._opened.nestedSidebars$.next({...n,[i]:e.nestedSidebar})}this._opened.snapshot$.next({leafSidebar:t,nestedSidebars:this._opened.nestedSidebars$.getValue()})}_openSidebarInGroup(e,t){var n=this;return(0,_.A)(function*(){n._emitOpenedSidebar({rootSidebar:e.code,nestedSidebar:t.code}),yield n._autoHideNotificationMark(t)})()}_openSidebarGroup(e){var t=this;return(0,_.A)(function*(){const n=e.code,i=t._opened.nestedSidebars$.getValue()[n];let a;if(i&&(a=p(i,e),a||console.warn(`It is not possible to open nested sidebar with code "${i}" because it does not belong to the specified group with code "${n}"`)),a||(a=e.nestedSidebars[0]),!a){console.warn(`It is not possible to open sidebar group with code "${n}" because it does not contain any nested sidebars`);return}yield t._openSidebarInGroup(e,a)})()}_openStandaloneSidebar(e){var t=this;return(0,_.A)(function*(){t._emitOpenedSidebar({rootSidebar:e.code,nestedSidebar:null}),yield t._autoHideNotificationMark(e)})()}_openLeafSidebarInternal(e){var t=this;return(0,_.A)(function*(){if(t._opened.leafSidebar$.getValue()===e)return!1;const n=yield t._getSidebarsConfig(),i=I(e,n);return i?(i.group?yield t._openSidebarInGroup(i.group,i.leafSidebar):yield t._openStandaloneSidebar(i.leafSidebar),!0):(console.warn(`Leaf sidebar with code "${e}" does not exist and can not be opened`),!1)})()}setLeafNotificationMarks(e){var t=this;return(0,_.A)(function*(){const n=yield t._getSidebarsConfig(),i=t._opened.leafSidebar$.getValue(),a=Object.entries(e).map(([S,Se])=>({markState:Se,leafSidebarInfo:I(S,n)})).filter(S=>S.leafSidebarInfo&&!t._shouldSkipNotificationMark(S,i)),s=a.filter(S=>S.leafSidebarInfo.group!==null),l=a.filter(S=>S.leafSidebarInfo.group===null);t._emitNestedSidebarsNotificationMarks(s),t._emitRootSidebarsNotificationMarks(l)})()}openLeafSidebar(e){var t=this;return(0,_.A)(function*(){yield t._openLeafSidebarInternal(e)})()}openRootSidebar(e){var t=this;return(0,_.A)(function*(){if(t._opened.rootSidebar$.getValue()===e)return;const n=yield t._getSidebarsConfig(),i=h(e,n);if(!i){console.warn(`Root sidebar with code "${e}" does not exist and can not be opened`);return}i.type==="group"?yield t._openSidebarGroup(i):yield t._openStandaloneSidebar(i)})()}loadOpenedSidebarSnapshot(e){var t=this;return(0,_.A)(function*(){t._opened.nestedSidebars$.next(e.nestedSidebars);const n=e.leafSidebar;n&&(yield t._openLeafSidebarInternal(n))||t._opened.snapshot$.next(e)})()}closeSidebar(){this._emitOpenedSidebar({rootSidebar:null,nestedSidebar:null})}static{this.\u0275fac=function(t){return new(t||A)(r.\u0275\u0275inject(E))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac,providedIn:"root"})}}}}]);
