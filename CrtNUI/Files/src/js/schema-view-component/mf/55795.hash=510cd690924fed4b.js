(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[55795],{50347:(S,E,t)=>{t.d(E,{T:()=>o});var d=t(59131),m=t.n(d);const o=new d.InjectionToken("ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN")},47530:(S,E,t)=>{t.d(E,{X:()=>r});var d=t(96590),m=t.n(d),o=t(21018),p=t.n(o),c=t(23958),v=t.n(c),i=t(28399),g=t.n(i),_=t(50347),f=t(77989),s=t(59131),h=t.n(s);class r{get lastTransition(){return this._lastTransition}get length(){return this._items.length}constructor(e,a,n){this._window=e,this._featureValues=n,this._historyLimit=20,this._items=[],this._previous=-1,this._current=-1,a!==null&&(this._historyLimit=a),(this._window.__crtHistory??=[]).push(this)}_assertIndexedState(e){if(!("historyIndex"in e)||isNaN(e.historyIndex))throw new Error("History state should have historyIndex.")}_enforceHistoryLimit(){for(let e=this._current+1;e<this._items.length;e++)this.destroy(e);for(let e=0;e<this._current-this._historyLimit;e++)this.destroy(e)}destroy(e){const a=this._items[e];a?.view&&(a.view.destroy(),a.view=null)}_hasChildrenState(e){const a=e.state;return!(0,i.isEmpty)(a.children)}_getRootViewForChildrenRouting(){let e=!0;const a=this._items[this._current].state;for(let n=this._current-1;n>=0;n--){const u=this._items[n];if((0,i.isEmpty)(u)||!e)return null;if((0,c.crtStatesEqual)(a,u.state)&&e&&!(0,i.isEmpty)(u?.view?.pageRef))return u.view;e=this._hasChildrenState(u)}return null}goTo(e){this._assertIndexedState(e),this._previous=this._current,this._current=e.historyIndex;const a=this._current<this._previous,n=a&&!this._items[this._current],u=this._current===this._previous,y=this._current>this._previous;this._lastTransition={isBack:a,isReplace:u,isPush:y},!(e.silent&&!e._internalNotSilentIn8x&&!a)&&(u&&this.destroy(this._previous),(n||u||y)&&(this._items[this._current]={state:e}),y&&this._items.splice(this._current+1),this._enforceHistoryLimit())}canRestoreView(){const a=this._getCurrentView()?.pageRef;return this._current<this._previous&&!!a}_getCurrentView(){const e=this._items[this._current],a=this._hasChildrenState(e);let n;return a&&(0,i.isEmpty)(e?.view?.pageRef)&&(n=this._getRootViewForChildrenRouting()),n?new f.Pf(n.pageRef,e?.view?.modalRefs,n.schemaState,n.pageRefReusable,n.scrollPositions,this._featureValues):e?.view}getView(){if(!this.canRestoreView())throw new Error("Cannot restore view");return this._getCurrentView()}getViewByOffset(e){return this._items[this._current+e]?.view}validateBeforeStore(e){const a=this._items[this._current].view;if(a?.pageRef&&a?.pageRef!==e.pageRef)throw new Error("This history item already contain another view. If you want to change view, do replace history state first.")}storeView(e){this.validateBeforeStore(e),this._items[this._current].view=e}actualHistoryLength(){return this._items.filter(e=>e?.state?.moduleName)?.length}static{this.\u0275fac=function(a){return new(a||r)(s.\u0275\u0275inject(d.WINDOW_TOKEN),s.\u0275\u0275inject(_.T,8),s.\u0275\u0275inject(o.FEATURE_VALUES))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac})}}},37019:(S,E,t)=>{t.d(E,{p:()=>s});var d=t(73308),m=t(59131),o=t(20822),p=t(52552),c=t(21018),v=t(22438),i=t(10850),g=t(28399),_=t(62278),f=t(36486);class s extends p.BaseDataGridStateHandlerService{constructor(r,l,e,a,n,u,y,M){super(r),this._schemaPartsService=l,this._metadataModifierService=e,this._featureValues=a,this._dataGridDesignSettingsProvider=n,this._dataGridDesignSettingsUpdater=u,this._dataGridActiveFolderDesignSettingsProvider=y,this._dataGridMetadataTransferService=M}_getActiveFolderDataGridDesignSettings(r){return this.viewModel$.pipe((0,f.switchMap)(l=>this._dataGridActiveFolderDesignSettingsProvider.get({viewConfig:r,viewModel:l,metadata:this.schemaService.schema})))}_saveSettingsForFolder(r,l){const{columns:e,viewElementConfig:a}=l,n=(0,g.cloneDeep)(e),u=r.columns?.map(M=>M?.viewMetadata);this._metadataModifierService.revert(n),this._setColumnsCaptionResourceMacros(n,u);const y=this._dataGridDesignSettingsUpdater.updateColumns(r,n,a);return this.viewModel$.pipe((0,f.switchMap)(M=>this._dataGridActiveFolderDesignSettingsProvider.set({viewConfig:a,viewModel:M,metadata:this.schemaService.schema},y)),(0,f.switchMap)(()=>this._schemaPartsService.commit({silent:!1})),(0,f.map)(()=>{}))}_setColumnsCaptionResourceMacros(r,l){(r??[]).filter(e=>e&&!(0,c.isResourceMacros)(e.caption)).forEach(e=>{const a=this._getColumnCaptionResourceKey(e,l);e.caption=(0,c.toResourceMacros)(a)})}_getColumnCaptionResourceKey(r,l){const e=l?.find(u=>u?.id&&u.id===r.id),a=(0,c.extractResourcesKey)(e?.caption),n=(0,o.createDataGridColumnCaptionResourceKey)(r);return a||n}_saveSettingsToProfile(r){var l=this;const{columns:e,viewElementConfig:a}=r,n=(0,g.cloneDeep)(e);let u=n?.some(y=>y.changed);return(0,_.from)(this._schemaPartsService.apply(function(){var y=(0,d.A)(function*([M,R]){const D=M.getViewConfigInfoByName(a?.name)?.viewConfig;if(!D)return;const O=yield l._dataGridDesignSettingsProvider.get(D,M,R),w=O.columns?.map(C=>C?.viewMetadata).filter(Boolean);l._metadataModifierService.revert(n),l._setColumnsCaptionResourceMacros(n,w),u=u||n?.length!==w?.length;const P=l._dataGridDesignSettingsUpdater.updateColumns(O,n,D);D._designOptions?.designSettings||(yield l._revertDeprecatedMetadata(D.name,P,M,R)),(0,g.set)(D,"_designOptions.designSettings",P)});return function(M){return y.apply(this,arguments)}}())).pipe((0,f.switchMap)(()=>this._schemaPartsService.commit({silent:u===!1})),(0,f.map)(()=>{}))}_revertDeprecatedMetadata(r,l,e,a){var n=this;return(0,d.A)(function*(){const[u]=yield n._schemaPartsService.use("ALL_EMPLOYERS");yield n._dataGridMetadataTransferService.transfer(u,e,r);const y={localizableStrings:{}};Object.keys(l.resources?.localizableStrings).forEach(M=>y.localizableStrings[M]=void 0),yield a.upsertResources(y)})()}innerHandle(r){return this._featureValues.DisableDataGridSettingsByFolders?this._saveSettingsToProfile(r):this._getActiveFolderDataGridDesignSettings(r.viewElementConfig).pipe((0,f.switchMap)(l=>l?this._saveSettingsForFolder(l,r):this._saveSettingsToProfile(r)))}handle(r,l){return super.handle({...r},l)}static{this.\u0275fac=function(l){return new(l||s)(m.\u0275\u0275inject(v.SchemaService),m.\u0275\u0275inject(v.SchemaPartsService),m.\u0275\u0275inject(i.MetadataModifierService),m.\u0275\u0275inject(c.FEATURE_VALUES),m.\u0275\u0275inject(o.DataGridDesignSettingsProvider),m.\u0275\u0275inject(o.DataGridDesignSettingsUpdater),m.\u0275\u0275inject(o.DataGridActiveFolderDesignSettingsProvider),m.\u0275\u0275inject(o.DataGridMetadataTransferService))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac})}}},77989:(S,E,t)=>{t.d(E,{OG:()=>m,X8:()=>d,pU:()=>c,Pf:()=>p});class d{constructor(i){i&&(this.title=i.title,this.schemaName=i.schemaName)}}class m{}var o=t(62278);class p{constructor(i=null,g=new Map,_=i?.instance?.schemaState,f=!1,s=i?.instance?.scrollPositions,h={}){this.pageRef=i,this.modalRefs=g,this.schemaState=_,this.pageRefReusable=f,this.scrollPositions=s,this._featureValues=h,this.isDestroyed=!1}_destroyModalViews(){const i=this?.modalRefs;i?.size&&(Array.from(i.values()).forEach(g=>g.close()),this.modalRefs.clear())}_destroyViewModelAsync(i){return this._featureValues.DisableHandleFixedViewModelResumePauseRequest?i?.destroy().pipe((0,o.take)(1)):(0,o.concat)(i?.pause()??(0,o.of)(),i?.destroy()??(0,o.of)()).pipe((0,o.take)(2))}destroy(){if(this._destroyModalViews(),this.pageRefReusable){const i=this.pageRef?.instance?.schemaComponent;this.schemaState.viewModel&&(i?.clearResources(this.schemaState.viewModel),this._destroyViewModelAsync(this.schemaState.viewModel).subscribe()),this.schemaState.viewModel=null,this.schemaState.models=null,this.schemaState=null}else{const i=this.pageRef?.instance?.schemaComponent?.schemaState;this._destroyViewModelAsync(i?.viewModel).subscribe(),this.pageRef?.destroy(),this.pageRef?.hostView?.destroy(),this.pageRef=null}this.isDestroyed=!0}get viewModel(){return this._featureValues?.UseSchemaOutletReuseViewStrategy?this?.schemaState?.viewModel:this?.pageRef?.instance?.schemaState?.viewModel}}class c extends Error{constructor(i){super(i),Object.setPrototypeOf(this,c.prototype)}}},31418:(S,E,t)=>{t.d(E,{P:()=>o});var d=t(59131),m=t.n(d);class o{constructor(){this._repository=new Map}set(c,v){this._repository.set(c,v)}get(c){return this._repository.get(c)}getAll(){return Array.from(this._repository.values())}static{this.\u0275fac=function(v){return new(v||o)}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}}},26958:(S,E,t)=>{t.d(E,{j:()=>g});var d=t(59131),m=t.n(d),o=t(10850),p=t.n(o),c=t(36486),v=t.n(c),i=t(31418);class g extends o.DataSourceFactoryService{constructor(f,s,h){super(s,h),this._dataSourceRepository=f}create(f,s,h){return super.create(f,s,h).pipe((0,c.tap)(r=>{this._dataSourceRepository.set(f,r)}))}static{this.\u0275fac=function(s){return new(s||g)(d.\u0275\u0275inject(i.P),d.\u0275\u0275inject(d.Injector),d.\u0275\u0275inject(o.DataSourceTypeResolver))}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac})}}},25343:(S,E,t)=>{t.d(E,{$:()=>i});var d=t(50456),m=t(21018),o=t(10850),p=t(62278),c=t(31418),v=t(59131);class i extends d.DataSourceStructureExplorerService{constructor(_,f,s,h){super(),this._dataSourceRepository=_,this._dataSchemaRepository=f,this._entityBackwardReferenceService=s,this._featureValues=h}getDataSchemaAttributeByPath(_){return(0,p.throwError)(new Error("Method not implemented"))}getDataSchemaByName(_){return this._dataSchemaRepository.get(_)}getDataSourceByName(_){return(0,p.of)(this._dataSourceRepository.get(_))}getDataSources(){return(0,p.of)(this._dataSourceRepository.getAll())}getDataSchemaBackReference(_){return this._featureValues.UseBackwardReferencesInStructureExplorer?this._entityBackwardReferenceService.getBackwardReferences(_):(0,p.of)([])}static{this.\u0275fac=function(f){return new(f||i)(v.\u0275\u0275inject(c.P),v.\u0275\u0275inject(o.DataSchemaRepositoryService),v.\u0275\u0275inject(d.EntityBackwardReferenceService),v.\u0275\u0275inject(m.FEATURE_VALUES))}}static{this.\u0275prov=v.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac})}}},70765:(S,E,t)=>{t.d(E,{U:()=>_});var d=t(96590),m=t(21018),o=t(10850),p=t(23958),c=t(28399),v=t(62278),i=t(47530),g=t(59131);class _ extends o.ViewModelDataDelayer{constructor(s,h,r,l){super(),this._crtRouter=s,this._routerOutletHistory=h,this._featureValues=r,this._window=l,this._disableDelayingModelEventsFeatureName="DisableDelayingModelEvents",this._disableDelayingModelsEventFeatureState=!1,this._disableOffsetForDelayingModelEventsFeatureName="DisableOffsetForDelayingModelEvents",this._disableOffsetForDelayingModelEventsFeatureState=!1,this._defaultViewLoadingOffset=-1,this._subscriptions=new v.Subscription,this._loadTriggerSubject=new v.Subject,this.loadTrigger$=this._loadTriggerSubject.asObservable(),this._isAngularHost=(0,c.get)(this._window,"Terrasoft")?.isAngularHost,this._isAngularHost&&(this._initFeatureStates(),this._disableDelayingModelsEventFeatureState||this._subscribeOnNavigation())}setViewModel(s){this._viewModel||(this._viewModel=s)}_initFeatureStates(){this._disableDelayingModelsEventFeatureState=this._featureValues[this._disableDelayingModelEventsFeatureName]??!1,this._disableDelayingModelsEventFeatureState||(this._disableOffsetForDelayingModelEventsFeatureState=this._featureValues[this._disableOffsetForDelayingModelEventsFeatureName]??!1),this._viewLoadingOffset=this._disableOffsetForDelayingModelEventsFeatureState?0:this._defaultViewLoadingOffset}_shouldLoadForModals(s,h){return s&&s.modalRefs?Array.from(s.modalRefs.values()).some(r=>r?.componentInstance?.page?.schemaState?.viewModel===h):!1}_shouldLoadForPage(s,h){return s?.viewModel===h}_getViews(){const s=[];for(let h=this._viewLoadingOffset;h<=0;h++)s.push(this._routerOutletHistory.getViewByOffset(h));return s}_shouldLoadForViews(){const s=(0,o.getRootViewModel)(this._viewModel);return this._getViews().some(r=>{const l=this._shouldLoadForPage(r,s),e=this._shouldLoadForModals(r,s);return l||e})}_shouldLoad(){return this?._routerOutletHistory?this._shouldLoadForViews():!1}_subscribeOnNavigation(){this._subscriptions.add(this._crtRouter?.navigateEnd$.subscribe(()=>{this._shouldLoad()&&this._loadTriggerSubject.next()}))}shouldBeDelayed(){return!this._isAngularHost||this._disableDelayingModelsEventFeatureState?!1:this._viewModel.State===o.ViewModelStates.Paused&&!this._shouldLoad()}setState(s,h){this._disableDelayingModelsEventFeatureState||s._setStateAttribute(h)}destroy(){this._subscriptions.unsubscribe(),this._loadTriggerSubject.complete(),this._viewModel=null}ngOnDestroy(){this.destroy()}static{this.\u0275fac=function(h){return new(h||_)(g.\u0275\u0275inject(p.CrtRouter,8),g.\u0275\u0275inject(i.X,8),g.\u0275\u0275inject(m.FEATURE_VALUES),g.\u0275\u0275inject(d.WINDOW_TOKEN))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}}}}]);
