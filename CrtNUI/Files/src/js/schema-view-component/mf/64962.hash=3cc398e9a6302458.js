(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[64962],{64962:(E,fe,u)=>{u.r(fe),u.d(fe,{CrtEntityHierarchyFilterComponent:()=>g,CrtEntityHierarchyFilterModule:()=>U,CrtHierarchyTreeNodePaddingDirectiveModule:()=>B,CrtSpecificationFilterModule:()=>O,HierarchyTreeNodePaddingDirective:()=>R,createHierarchyFilters:()=>M});var d=u(5960),S=u(40297),te=u(52989),o=u(38495),z=u(59564),K=u(96590),m=u(20822),G=u(87368),ie=u(47742),ge=u(10850);const he={"hr-HR":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Sve","NotFilledNode":"Nije ispunjeno","SpecificationFilterCaption":"Otvori dodatno filtriranje","BackButtonCaption":"Natrag","ClearAllFiltersButtonCaption":"O\u010Disti sve"}}'),"hu-HU":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\xD6sszes","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Vissza","ClearAllFiltersButtonCaption":"\xD6sszes t\xF6rl\xE9se"}}'),"zh-CN":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u5168\u90E8","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"sq-AL":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"T\xEB gjitha","NotFilledNode":"Nuk \xEBsht\xEB plot\xEBsuar","SpecificationFilterCaption":"Shto filt\xEBr shtes\xEB","BackButtonCaption":"Pas","ClearAllFiltersButtonCaption":"Fshiji t\xEB gjitha"}}'),"en-GB":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"bg-BG":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u0412\u0441\u0438\u0447\u043A\u043E","NotFilledNode":"\u041D\u0435 \u0435 \u043F\u043E\u043F\u044A\u043B\u043D\u0435\u043D\u043E","SpecificationFilterCaption":"\u041E\u0442\u0432\u043E\u0440\u0438 \u0434\u043E\u043F\u044A\u043B\u043D\u0438\u0442\u0435\u043B\u043D\u043E \u0444\u0438\u043B\u0442\u0440\u0438\u0440\u0430\u043D\u0435","BackButtonCaption":"\u041D\u0430\u0437\u0430\u0434","ClearAllFiltersButtonCaption":"\u0418\u0437\u0447\u0438\u0441\u0442\u0438 \u0432\u0441\u0438\u0447\u043A\u043E"}}'),"zh-TW":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u5168\u90E8","NotFilledNode":"\u672A\u586B\u5BEB","SpecificationFilterCaption":"\u958B\u555F\u984D\u5916\u7BE9\u9078\u5668","BackButtonCaption":"\u8FD4\u56DE","ClearAllFiltersButtonCaption":"\u5168\u90E8\u6E05\u9664"}}'),"no-NO":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"ko-KR":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\uBAA8\uB4E0","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"\uB4A4\uB85C","ClearAllFiltersButtonCaption":"Clear all"}}'),"ja-JP":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u3059\u3079\u3066","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"\u623B\u308B","ClearAllFiltersButtonCaption":"\u3059\u3079\u3066\u30AF\u30EA\u30A2\u3059\u308B"}}'),"fr-CA":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),zh:JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"vi-VN":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"T\u1EA5t c\u1EA3","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Tr\u1EDD l\u1EA1i","ClearAllFiltersButtonCaption":"Clear all"}}'),"tr-TR":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"T\xFCm","NotFilledNode":"Dolu de\u011Fil","SpecificationFilterCaption":"Ek Filtreleme A\xE7","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"th-TH":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u0E17\u0E31\u0E49\u0E07\u0E2B\u0E21\u0E14","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"\u0E01\u0E25\u0E31\u0E1A\u0E44\u0E1B","ClearAllFiltersButtonCaption":"Clear all"}}'),"sv-SE":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Alla","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Tillbaka","ClearAllFiltersButtonCaption":"Rensa alla"}}'),"ro-RO":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Toate","NotFilledNode":"Nu a fost completat","SpecificationFilterCaption":"Deschide filtrare suplimentar\u0103","BackButtonCaption":"\xCEnapoi","ClearAllFiltersButtonCaption":"\u0218terge tot"}}'),"pt-PT":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Tudo","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Voltar","ClearAllFiltersButtonCaption":"Limpar tudo"}}'),"pt-BR":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Todos","NotFilledNode":"N\xE3o preenchido","SpecificationFilterCaption":"Abrir as filtragens adicionais","BackButtonCaption":"Voltar","ClearAllFiltersButtonCaption":"Esvaziar tudo"}}'),"pl-PL":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Wszystkie","NotFilledNode":"Niewype\u0142nione","SpecificationFilterCaption":"Otw\xF3rz dodatkowe filtry","BackButtonCaption":"Powr\xF3t","ClearAllFiltersButtonCaption":"Wyczy\u015B\u0107 warto\u015B\u0107"}}'),no:JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"nl-NL":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Alle","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Terug","ClearAllFiltersButtonCaption":"Wis alles"}}'),"lv-LV":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Visi","NotFilledNode":"Nav aizpild\u012Bts","SpecificationFilterCaption":"Atv\u0113rt papildu filtr\u0113\u0161anu","BackButtonCaption":"Atpaka\u013C","ClearAllFiltersButtonCaption":"Not\u012Br\u012Bt visu"}}'),"kk-KZ":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"it-IT":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Tutto","NotFilledNode":"Non compilato","SpecificationFilterCaption":"Apri filtro aggiuntivo","BackButtonCaption":"Indietro","ClearAllFiltersButtonCaption":"Cancella tutto"}}'),"id-ID":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Semua","NotFilledNode":"Tidak terisi","SpecificationFilterCaption":"Buka penyaringan tambahan","BackButtonCaption":"Kembali","ClearAllFiltersButtonCaption":"Hapus semua"}}'),"he-IL":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u05D4\u05DB\u05DC","NotFilledNode":"\u05DC\u05D0 \u05DE\u05DC\u05D0","SpecificationFilterCaption":"\u05E4\u05EA\u05D7 \u05E1\u05D9\u05E0\u05D5\u05DF \u05E0\u05D5\u05E1\u05E3","BackButtonCaption":"\u05D7\u05D6\u05D5\u05E8","ClearAllFiltersButtonCaption":"\u05E0\u05E7\u05D4 \u05D4\u05DB\u05DC"}}'),"fr-FR":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Tous","NotFilledNode":"Vide","SpecificationFilterCaption":"Ouvrir le filtrage suppl\xE9mentaire","BackButtonCaption":"Retour","ClearAllFiltersButtonCaption":"Tout effacer"}}'),"fa-IR":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"es-ES":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Todos","NotFilledNode":"No completado","SpecificationFilterCaption":"Abrir filtrado adicional","BackButtonCaption":"Atr\xE1s","ClearAllFiltersButtonCaption":"Limpiar todo"}}'),"de-DE":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"Alle","NotFilledNode":"Nicht ausgef\xFCllt","SpecificationFilterCaption":"Zus\xE4tzliche Filter \xF6ffnen","BackButtonCaption":"Zur\xFCck","ClearAllFiltersButtonCaption":"Alles l\xF6schen"}}'),"cs-CZ":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"V\u0161e","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Zp\u011Bt","ClearAllFiltersButtonCaption":"Zru\u0161it v\u0161e"}}'),"ar-SA":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u0627\u0644\u0643\u0644","NotFilledNode":"\u063A\u064A\u0631 \u0645\u0639\u0628\u0623\u0629","SpecificationFilterCaption":"\u0641\u062A\u062D \u0641\u0644\u062A\u0631\u0629 \u0625\u0636\u0627\u0641\u064A","BackButtonCaption":"\u0639\u0648\u062F\u0629","ClearAllFiltersButtonCaption":"\u0645\u0633\u062D \u0627\u0644\u0643\u0644"}}'),"en-US":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"All","NotFilledNode":"Not filled","SpecificationFilterCaption":"Open additional filtering","BackButtonCaption":"Back","ClearAllFiltersButtonCaption":"Clear all"}}'),"ru-RU":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u0412\u0441\u0435","NotFilledNode":"\u041D\u0435 \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u043E","SpecificationFilterCaption":"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0434\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u0443\u044E \u0444\u0438\u043B\u044C\u0442\u0440\u0430\u0446\u0438\u044E","BackButtonCaption":"\u041D\u0430\u0437\u0430\u0434","ClearAllFiltersButtonCaption":"\u0421\u043A\u0438\u043D\u0443\u0442\u044C \u0432\u0441\u0451"}}'),"uk-UA":JSON.parse('{"EntityHierarchyFilter":{"AllFilterCaption":"\u0423\u0441\u0456","NotFilledNode":"\u041D\u0435 \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043E","SpecificationFilterCaption":"\u0412\u0456\u0434\u043A\u0440\u0438\u0442\u0438 \u0434\u043E\u0434\u0430\u0442\u043A\u043E\u0432\u0443 \u0444\u0456\u043B\u044C\u0442\u0440\u0430\u0446\u0456\u044E","BackButtonCaption":"\u041D\u0430\u0437\u0430\u0434","ClearAllFiltersButtonCaption":"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u0438 \u0432\u0441\u0435"}}')};var e=u(59131),f=u(88886),H=u(56711),b=u(79772);class N{constructor(t){this._cdk=t,this.valueChange=new e.EventEmitter}ngOnDestroy(){this._valueChangeSubscription?.unsubscribe(),this._valueChangeSubscription=null}static{this.\u0275fac=function(i){return new(i||N)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:N,selectors:[["crt-base-specification-filter"]],inputs:{specificationId:"specificationId"},outputs:{valueChange:"valueChange"},decls:0,vars:0,template:function(i,n){},encapsulation:2})}}const Fe=["*"];class I{constructor(){this.customToggleStyles={toggle:{height:"20px",width:"20px"}}}static{this.\u0275fac=function(i){return new(i||I)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:I,selectors:[["crt-specification-filter-panel"]],inputs:{caption:"caption"},ngContentSelectors:Fe,decls:3,vars:6,consts:[["togglePosition","after","toggleType","material",3,"expanded","fullWidthHeader","title","extraStyles"]],template:function(i,n){i&1&&(e.\u0275\u0275projectionDef(),e.\u0275\u0275elementStart(0,"crt-expansion-panel",0),e.\u0275\u0275pipe(1,"uppercase"),e.\u0275\u0275projection(2),e.\u0275\u0275elementEnd()),i&2&&e.\u0275\u0275property("expanded",!0)("fullWidthHeader",!1)("title",e.\u0275\u0275pipeBind1(1,4,n.caption))("extraStyles",n.customToggleStyles)},dependencies:[m.CrtExpansionPanelComponent,S.UpperCasePipe],styles:[`crt-specification-filter-panel crt-expansion-panel-header{padding:4px 0}
`],encapsulation:2,changeDetection:0})}}class V extends N{set caption(t){this._caption=t,this.radioGroupAriaLabel=`Choose the state for ${this.caption} filter`}get caption(){return this._caption}constructor(t,i){super(t),this._cdk=t,this._translateService=i,this._booleanSpecFilterTranslateKey="SpecificationFilter.Boolean",this.radioButtonOptions=[{value:!0,caption:this._translateService.instant(`${this._booleanSpecFilterTranslateKey}.Yes`)},{value:!1,caption:this._translateService.instant(`${this._booleanSpecFilterTranslateKey}.No`)}]}ngOnInit(){this.reset()}reset(){this._valueChangeSubscription?.unsubscribe(),this.control=new H.FormControl(void 0),this._valueChangeSubscription=this.control.valueChanges.subscribe(t=>this.valueChange.emit({specificationId:this.specificationId,value:t})),this._cdk.detectChanges()}static{this.\u0275fac=function(i){return new(i||V)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(b.TranslateService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:V,selectors:[["crt-boolean-specification-filter"]],inputs:{caption:"caption"},features:[e.\u0275\u0275ProvidersFeature([{provide:N,useExisting:(0,e.forwardRef)(()=>V)}]),e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:5,consts:[[3,"caption"],[3,"radioGroupAriaLabel","items","control"]],template:function(i,n){i&1&&(e.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0),e.\u0275\u0275element(1,"crt-icon-radio-button",1),e.\u0275\u0275elementEnd()),i&2&&(e.\u0275\u0275property("caption",n.caption),e.\u0275\u0275advance(),e.\u0275\u0275property("radioGroupAriaLabel",n.radioGroupAriaLabel)("items",n.radioButtonOptions)("control",n.control),e.\u0275\u0275attribute("data-qa",n.caption))},dependencies:[m.CrtIconRadioButtonComponent,I],styles:[`crt-boolean-specification-filter .crt-icon-radio-button{padding-top:2px}crt-boolean-specification-filter .crt-icon-radio-group{gap:1rem}crt-boolean-specification-filter .crt-icon-radio-group .mat-ripple-element{height:8px!important;width:8px!important;left:calc(50% - 4px)!important;top:calc(50% - 4px)!important;border-radius:50%}
`],encapsulation:2,changeDetection:0})}}var F=u(62278);class j extends N{set caption(t){this._caption=t,this.ariaLabel=`Fill in the ${this.caption} filter`}get caption(){return this._caption}constructor(t){super(t),this._cdk=t}ngOnInit(){this.reset()}reset(){this._valueChangeSubscription?.unsubscribe(),this.control=new H.FormControl(void 0),this._valueChangeSubscription=this.control.valueChanges.pipe((0,F.debounceTime)(500)).subscribe(t=>this.valueChange.emit({specificationId:this.specificationId,value:t?.length?t:void 0})),this._cdk.detectChanges()}static{this.\u0275fac=function(i){return new(i||j)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:j,selectors:[["crt-string-specification-filter"]],inputs:{caption:"caption"},features:[e.\u0275\u0275ProvidersFeature([{provide:N,useExisting:(0,e.forwardRef)(()=>j)}]),e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:6,consts:[[3,"caption"],[3,"placeholder","ariaLabel","control"]],template:function(i,n){i&1&&(e.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0),e.\u0275\u0275element(1,"crt-input",1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),i&2&&(e.\u0275\u0275property("caption",n.caption),e.\u0275\u0275advance(),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(2,4,"SpecificationFilter.String.Placeholder"))("ariaLabel",n.ariaLabel)("control",n.control))},dependencies:[m.CrtInputComponent,I,b.TranslatePipe],styles:[`crt-string-specification-filter .crt-input{min-height:unset!important;padding-top:4px!important;padding-bottom:4px!important}crt-string-specification-filter .crt-input .crt-input-label-container{display:none!important}
`],encapsulation:2,changeDetection:0})}}var Ne=u(13053),W=u(47726),Se=u(36486);function ne(l,t){return i=>{const r=H.Validators.max(l)(i);return r?{max:{...r.max,message:t}}:null}}function re(l,t){return i=>{const r=H.Validators.min(l)(i);return r?{min:{...r.min,message:t}}:null}}class k extends N{set caption(t){this._caption=t,this.fromAriaLabel=`Fill in the ${this.caption} filter starting value`,this.toAriaLabel=`Fill in the ${this.caption} filter ending value`}get caption(){return this._caption}constructor(t,i,n){super(t),this._cdk=t,this.directionality=i,this._translateService=n,this.format={decimalPrecision:0}}ngOnInit(){this.reset()}reset(){this._valueChangeSubscription?.unsubscribe(),this.fromControl=new H.FormControl(void 0),this.toControl=new H.FormControl(void 0),this._valueChangeSubscription=this.fromControl.valueChanges.pipe((0,Se.mergeWith)(this.toControl.valueChanges),(0,F.debounceTime)(500)).subscribe(t=>this._emitValue()),this._cdk.detectChanges()}_getMaxValue(){return this.format.decimalPrecision>0?W.dataValueTypeNumberSize.Float.max:W.dataValueTypeNumberSize.Integer.max}_getMinValue(){return this.format.decimalPrecision>0?W.dataValueTypeNumberSize.Float.min:W.dataValueTypeNumberSize.Integer.min}_emitValue(){this.fromControl.value!==null||this.toControl.value!==null?this._handleNonNullValues():this._handleNullValues()}_handleNonNullValues(){(this.fromControl.value!==this._prevFrom||this.toControl.value!==this._prevTo)&&(this.fromControl.valid&&this.toControl.valid&&(this._emitValueChange(),this._updatePreviousValues()),this._updateValidators())}_handleNullValues(){this._prevFrom===void 0&&this._prevTo===void 0||(this.valueChange.emit({specificationId:this.specificationId,value:void 0}),this._prevFrom=null,this._prevTo=null)}_emitValueChange(){this.valueChange.emit({specificationId:this.specificationId,value:{from:this.fromControl.value,to:this.toControl.value}})}_updatePreviousValues(){this._prevFrom=this.fromControl.value,this._prevTo=this.toControl.value}_updateValidators(){this._updateToControlValidators(),this._updateFromControlValidators()}_updateToControlValidators(){this.toControl.clearValidators(),this.toControl.addValidators(re(this.fromControl.value,this._translateService.instant("SpecificationFilter.Numeric.MinValueError"))),this.toControl.addValidators(re(this._getMinValue(),this._translateService.instant("SpecificationFilter.Numeric.MinValueError"))),this.toControl.addValidators(ne(this._getMaxValue(),this._translateService.instant("SpecificationFilter.Numeric.MaxValueError"))),this.toControl.invalid&&this.toControl.updateValueAndValidity()}_updateFromControlValidators(){this.fromControl.clearValidators(),this.fromControl.addValidators(ne(this.toControl.value,this._translateService.instant("SpecificationFilter.Numeric.MaxValueError"))),this.fromControl.addValidators(re(this._getMinValue(),this._translateService.instant("SpecificationFilter.Numeric.MinValueError"))),this.fromControl.addValidators(ne(this._getMaxValue(),this._translateService.instant("SpecificationFilter.Numeric.MaxValueError"))),this.fromControl.invalid&&this.fromControl.updateValueAndValidity()}static{this.\u0275fac=function(i){return new(i||k)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Ne.Directionality),e.\u0275\u0275directiveInject(b.TranslateService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:k,selectors:[["crt-numeric-specification-filter"]],inputs:{caption:"caption",format:"format"},features:[e.\u0275\u0275ProvidersFeature([{provide:N,useExisting:(0,e.forwardRef)(()=>k)}]),e.\u0275\u0275InheritDefinitionFeature],decls:9,vars:18,consts:[[3,"caption"],[1,"numerics-container"],[3,"ariaLabel","placeholder","control","format"],[1,"to","specification-caption"]],template:function(i,n){i&1&&(e.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0)(1,"div",1),e.\u0275\u0275element(2,"crt-number-input",2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"div",3),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"crt-number-input",2),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd()()),i&2&&(e.\u0275\u0275property("caption",n.caption),e.\u0275\u0275advance(),e.\u0275\u0275classProp("rtl",(n.directionality==null?null:n.directionality.value)==="rtl"),e.\u0275\u0275advance(),e.\u0275\u0275property("ariaLabel",n.fromAriaLabel)("placeholder",e.\u0275\u0275pipeBind1(3,12,"SpecificationFilter.Numeric.Placeholder"))("control",n.fromControl)("format",n.format),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,14,"SpecificationFilter.Numeric.To")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ariaLabel",n.toAriaLabel)("placeholder",e.\u0275\u0275pipeBind1(8,16,"SpecificationFilter.Numeric.Placeholder"))("control",n.toControl)("format",n.format))},dependencies:[m.CrtNumberInputComponent,I,b.TranslatePipe],styles:[`crt-numeric-specification-filter .numerics-container{display:flex;padding-top:3.5px;padding-bottom:3.5px}crt-numeric-specification-filter .numerics-container .to{padding-right:12px;margin-top:auto;margin-bottom:auto;min-width:50px}crt-numeric-specification-filter .numerics-container crt-number-input{min-width:0}crt-numeric-specification-filter .numerics-container crt-number-input .crt-input{min-height:unset!important}crt-numeric-specification-filter .numerics-container crt-number-input .crt-input .crt-input-label-container{max-height:0px}crt-numeric-specification-filter .numerics-container.rtl .to{padding-right:0;padding-left:12px}
`],encapsulation:2,changeDetection:0})}}function ve(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"crt-checkbox",2),e.\u0275\u0275listener("valueChange",function(r){const a=e.\u0275\u0275restoreView(i).$implicit,c=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(c.onValueChange(a.id,r))}),e.\u0275\u0275elementEnd()()}if(l&2){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ariaLabel",n.getCheckboxAriaLabel(i))("label",i.name)("title",i.name)}}class w extends N{constructor(){super(...arguments),this._selectedIds=[],this.options=[]}getCheckboxAriaLabel(t){const i=this._selectedIds.includes(t.id);let n=`${t.name}`;return i&&(n=`${n} Selected`),n}onValueChange(t,i){i?this._selectedIds.push(t):this._selectedIds=this._selectedIds.filter(n=>n!==t),this.valueChange.emit({specificationId:this.specificationId,value:this._selectedIds?.length?this._selectedIds:void 0})}reset(){this._selectedIds=[],this.checkboxes?.forEach(t=>t.value=!1)}static{this.\u0275fac=(()=>{let t;return function(n){return(t||(t=e.\u0275\u0275getInheritedFactory(w)))(n||w)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:w,selectors:[["crt-list-specification-filter"]],viewQuery:function(i,n){if(i&1&&e.\u0275\u0275viewQuery(m.CrtCheckboxComponent,5),i&2){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.checkboxes=r)}},inputs:{caption:"caption",options:"options"},features:[e.\u0275\u0275ProvidersFeature([{provide:N,useExisting:(0,e.forwardRef)(()=>w)}]),e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:2,consts:[[3,"caption"],[4,"ngFor","ngForOf"],["labelPosition","right",3,"valueChange","ariaLabel","label","title"]],template:function(i,n){i&1&&(e.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0),e.\u0275\u0275template(1,ve,2,3,"div",1),e.\u0275\u0275elementEnd()),i&2&&(e.\u0275\u0275property("caption",n.caption),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.options))},dependencies:[S.NgForOf,m.CrtCheckboxComponent,I],styles:[`crt-list-specification-filter crt-specification-filter-panel crt-expansion-panel .crt-expansion-panel.mat-expansion-panel .mat-expansion-panel-content .mat-expansion-panel-body{padding-top:4px}crt-list-specification-filter .crt-checkbox-container{padding-top:0;padding-bottom:8px}
`],encapsulation:2,changeDetection:0})}}function xe(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-boolean-specification-filter",7),e.\u0275\u0275listener("valueChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onFilterValueChange(r))}),e.\u0275\u0275elementEnd()}if(l&2){const i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("specificationId",i.specificationId)("caption",i.caption)}}function Ee(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-string-specification-filter",7),e.\u0275\u0275listener("valueChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onFilterValueChange(r))}),e.\u0275\u0275elementEnd()}if(l&2){const i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("specificationId",i.specificationId)("caption",i.caption)}}function be(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-numeric-specification-filter",7),e.\u0275\u0275listener("valueChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onFilterValueChange(r))}),e.\u0275\u0275elementEnd()}if(l&2){const i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("specificationId",i.specificationId)("caption",i.caption)}}function Ie(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-numeric-specification-filter",8),e.\u0275\u0275listener("valueChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onFilterValueChange(r))}),e.\u0275\u0275elementEnd()}if(l&2){const i=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("specificationId",i.specificationId)("caption",i.caption)("format",n.decimalFormat)}}function we(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-list-specification-filter",9),e.\u0275\u0275listener("valueChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onFilterValueChange(r))}),e.\u0275\u0275elementEnd()}if(l&2){const i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("specificationId",i.specificationId)("options",i.listItems)("caption",i.caption)}}function Ae(l,t){if(l&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",3),e.\u0275\u0275template(2,xe,1,2,"crt-boolean-specification-filter",4)(3,Ee,1,2,"crt-string-specification-filter",4)(4,be,1,2,"crt-numeric-specification-filter",4)(5,Ie,1,3,"crt-numeric-specification-filter",5)(6,we,1,3,"crt-list-specification-filter",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),l&2){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitch",i.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.specificationTypes.Boolean),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.specificationTypes.String),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.specificationTypes.Integer),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.specificationTypes.Decimal),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.specificationTypes.List)}}function Te(l,t){l&1&&(e.\u0275\u0275elementStart(0,"div",10),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),l&2&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"SpecificationFilter.NoData")," "))}class A{constructor(){this._specificationValues=new Map,this.filterChange=new e.EventEmitter,this.specificationTypes={Boolean:f.SpecificationType.Boolean,String:f.SpecificationType.String,Integer:f.SpecificationType.Integer,Decimal:f.SpecificationType.Decimal,List:f.SpecificationType.List},this.decimalFormat={decimalPrecision:2}}onFilterValueChange(t){t.value!==void 0?this._specificationValues.set(t.specificationId,t.value):this._specificationValues.delete(t.specificationId),this.filterChange.emit({specificationFiltersConfiguration:this.specificationFilters,specificationFiltersValues:this._specificationValues,specificationEntityName:this.specificationEntityName,specificationReferenceColumnName:this.specificationReferenceColumnName})}reset(){this._specificationValues=new Map,this.specificationFilterInputs.forEach(t=>{t.reset()})}static{this.\u0275fac=function(i){return new(i||A)}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:A,selectors:[["crt-specification-filter"]],viewQuery:function(i,n){if(i&1&&e.\u0275\u0275viewQuery(N,5),i&2){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.specificationFilterInputs=r)}},inputs:{specificationEntityName:"specificationEntityName",specificationReferenceColumnName:"specificationReferenceColumnName",specificationFilters:"specificationFilters"},outputs:{filterChange:"filterChange"},decls:3,vars:2,consts:[[1,"container"],[4,"ngFor","ngForOf"],["class","no-data specification-text",4,"ngIf"],[3,"ngSwitch"],[3,"specificationId","caption","valueChange",4,"ngSwitchCase"],[3,"specificationId","caption","format","valueChange",4,"ngSwitchCase"],[3,"specificationId","options","caption","valueChange",4,"ngSwitchCase"],[3,"valueChange","specificationId","caption"],[3,"valueChange","specificationId","caption","format"],[3,"valueChange","specificationId","options","caption"],[1,"no-data","specification-text"]],template:function(i,n){i&1&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Ae,7,6,"ng-container",1)(2,Te,3,3,"div",2),e.\u0275\u0275elementEnd()),i&2&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.specificationFilters),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(n.specificationFilters!=null&&n.specificationFilters.length)))},dependencies:[S.NgForOf,S.NgIf,S.NgSwitch,S.NgSwitchCase,V,j,k,w,b.TranslatePipe],styles:["[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{padding:0 4px}[_nghost-%COMP%]   .no-data[_ngcontent-%COMP%]{text-align:center}"],changeDetection:0})}}var C=u(73308),P=u(35266),D=u(21018);const v="9d8c9238-7a6b-9cc0-be1f-45b130cd4918";class L{constructor(t,i,n){this._entitySchemaRepository=t,this._queryExecutor=i,this._translateService=n,this._allFiltersNodeCaptionPath="EntityHierarchyFilter.AllFilterCaption"}_getLookupDataEsq(t){var i=this;return(0,C.A)(function*(){const r=(yield(0,F.firstValueFrom)(i._entitySchemaRepository.getSchemaByName(t))).getPrimaryDisplayColumn(),a=new o.EntitySchemaQuery(t);return a.addSchemaColumn(r.name).withOrdering(o.OrderDirection.Asc,0),a})()}_getLookupData(t){var i=this;return(0,C.A)(function*(){const n=yield i._getLookupDataEsq(t);return yield(0,F.firstValueFrom)(i._queryExecutor.executeSelectQuery(n))})()}_getNodeFilter(t,i,n){let r=null;return t?(r=t.clone(),r.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,i,n)):r=this._getLookupFilter(i,n),r}_getLookupFilter(t,i){const n=new o.FilterGroup;return n.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,t,i),n}_formSubNodes(t,i,n,r){var a=this;return(0,C.A)(function*(){const c=[],s=i.columns.find(_=>_.name===t.columnName);let p=r.get(s.referenceSchemaName);p||(p=yield a._getLookupData(s.referenceSchemaName),r.set(s.referenceSchemaName,p));for(const _ of p){const h=a._getNodeFilter(n,s.name,_.Id),y={id:_.Id,caption:_.Name,filter:h,children:[]},x=t.children??[];for(const q of x){const ue=yield a._formSubNodes(q,i,h,r);y.children=y.children.concat(ue.map(Z=>({...Z,id:`${y.id}_${Z.id}`})))}c.push(y)}return c})()}convert(t,i){var n=this;return(0,C.A)(function*(){const r=yield(0,F.firstValueFrom)(n._entitySchemaRepository.getSchemaByName(i)),a=n.createRootNode(),c=new Map;for(const s of t){const p=yield n._formSubNodes(s,r,null,c);a.children=a.children.concat(p)}return[a]})()}createRootNode(){return{id:v,caption:this._translateService.instant(this._allFiltersNodeCaptionPath),filter:null,columnName:"All",children:[]}}static{this.\u0275fac=function(i){return new(i||L)(e.\u0275\u0275inject(D.EntitySchemaRepository),e.\u0275\u0275inject(P.QueryExecutor),e.\u0275\u0275inject(b.TranslateService))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac,providedIn:"root"})}}function Be(l,t){l&1&&e.\u0275\u0275element(0,"mat-icon",5)}function Oe(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-button",13),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext().node,a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.onShowSpecificationFilters(r))})("keydown",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext().node,c=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(c.onKeyShowSpecificationFilters(a,r))}),e.\u0275\u0275elementEnd()}if(l&2){const i=e.\u0275\u0275nextContext().node,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("iconPosition","left-icon")("icon","filter"),e.\u0275\u0275attribute("aria-label",n.getNodeFilterAriaLabel(i))}}function He(l,t){if(l&1&&(e.\u0275\u0275elementStart(0,"div",9)(1,"div",10)(2,"div",11),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,Oe,1,3,"crt-button",12),e.\u0275\u0275elementEnd()),l&2){const i=t.node,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275attribute("aria-label",n.getNodeAriaLabel(i)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",i.Caption," "),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.specificationEntityName)}}function Ve(l,t){l&1&&e.\u0275\u0275element(0,"div",14)}function je(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-virtual-scroll-tree-view",6),e.\u0275\u0275listener("nodeExpanded",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onNodeExpanded(r))})("expandedItemsChanged",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onExpandedItemsChanged(r))})("selectedItemKeyChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onSelectedItemKeyChange(r))})("paginationChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.onPaginationChange(r))}),e.\u0275\u0275template(1,He,5,3,"ng-template",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,Ve,1,0,"div",8)}if(l&2){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("items",i.flatItems)("selectedItemKey",i.selectedNodeId)("expandedItems",i.expandedItems),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.loaderVisible)}}function ke(l,t){if(l&1&&(e.\u0275\u0275elementStart(0,"crt-toggle-container-item",3)(1,"div",0),e.\u0275\u0275template(2,Be,1,0,"mat-icon",4)(3,je,3,4,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()),l&2){const i=e.\u0275\u0275reference(4),n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.initializing)("ngIfElse",i)}}function Le(l,t){if(l&1){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"crt-toggle-container-item",15)(1,"div",0)(2,"div",16)(3,"div",17)(4,"crt-button",18),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onHideSpecificationFilters())})("keydown",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onKeyBackButton(r))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"crt-button",19),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275listener("clicked",function(){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onClearSpecificationFilter())})("keydown",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onKeyClearSpecificationFilter(r))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(8,"hr",20),e.\u0275\u0275elementStart(9,"div",21),e.\u0275\u0275element(10,"crt-label",22),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"crt-specification-filter",23),e.\u0275\u0275listener("filterChange",function(r){e.\u0275\u0275restoreView(i);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.onSpecificationFilterChange(r))}),e.\u0275\u0275elementEnd()()()}if(l&2){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("iconPosition","left-icon")("icon","back-button-icon")("caption",e.\u0275\u0275pipeBind1(5,10,"EntityHierarchyFilter.BackButtonCaption")),e.\u0275\u0275advance(2),e.\u0275\u0275property("iconPosition","left-icon")("icon","eraser-icon")("caption",e.\u0275\u0275pipeBind1(7,12,"EntityHierarchyFilter.ClearAllFiltersButtonCaption")),e.\u0275\u0275advance(4),e.\u0275\u0275property("caption",i.selectedNodeFullPathCaption),e.\u0275\u0275advance(),e.\u0275\u0275property("specificationFilters",i.specificationFiltersConfiguration)("specificationReferenceColumnName",i.specificationReferenceColumnName)("specificationEntityName",i.specificationEntityName)}}let g=class Y extends ie.CrtBaseComponent{constructor(){super(...arguments),this._selectedTabIndex=0,this.initializing=!0,this.skeletonStyles={height:"18px","margin-top":"8px","margin-left":"4px"},this.flatItems=[],this.items=[],this.loadSpecificationFilters=new e.EventEmitter,this.specificationFilterChange=new e.EventEmitter,this.expandedItemsChange=new e.EventEmitter,this.loadNext=new e.EventEmitter,this.nodeClick=new e.EventEmitter,this.tabIndexChange=new e.EventEmitter}set nodes(t){const i=this._convertNodesToFlatStructure(t);JSON.stringify(this.flatItems)!==JSON.stringify(i)&&(this.flatItems=i,this.items=t,t?.length&&this._initTreeExpandedNodes(),this.loading=!1,this.initializing=!1)}get nodes(){return this.items}set selectedNodeId(t){this._selectNodeById(t)}get selectedNodeId(){return this._selectedNodeId}set expandedItems(t){this._expandedItems=t||[]}get expandedItems(){return this._expandedItems}set selectedTabIndex(t){t!=null&&(this._selectedTabIndex=t,this.tabIndexChange.emit(t))}get selectedTabIndex(){return this._selectedTabIndex}_selectNodeById(t){this._selectedNodeId=t,!(!t||this._lastSelectedNodeId===t)&&(this._lastSelectedNodeId=t,this.nodeClick.emit(this.selectedNodeId),this.specificationFilter?.reset())}_initTreeExpandedNodes(){const t=this.items?.[0];this.expandedItems?.length===0&&(this._expandedItems=[t.id],this.selectedNodeId=t.id,this.onExpandedItemsChanged(this.expandedItems))}_convertNodesToFlatStructure(t,i=[],n=0,r=""){return t?.forEach(a=>{i.push({Id:a.id,Caption:a.caption,Level:n,ParentId:r,Expandable:!a.isLastLevel,IsLastItem:a.isLastItem}),this._convertNodesToFlatStructure(a.children,i,n+1,a.id)}),i}_refocusActiveNode(){setTimeout(()=>{const t=document.querySelector(".crt-virtual-scroll-view-item-selected");t&&t.focus()},50)}ngAfterViewInit(){this.toggleContainer.showItem()}onSelectedItemKeyChange(t){this.selectedNodeId=t}getNodeAriaLabel(t){let i=t.Caption;if(t.Expandable){const r=this.expandedItems&&this.expandedItems.includes(t.Id)?"Expanded":"Collapsed";i=`${i} ${r}`}return this.selectedNodeId===t.Id&&(i=`${i} Selected`),i}getNodeFilterAriaLabel(t){return`${t.Caption} Open additional filtering`}onSpecificationFilterChange(t){this.specificationFilterChange.emit(t)}onShowSpecificationFilters(t){const i=(0,f.findHierarchyNode)(this.items,t.Id,"id");if(!i)return;t.id!==this._lastSelectedNodeId&&this._selectNodeById(t.Id);const n=(0,f.getNodeParents)(t.Id,this.items);if(t.id!==v){const r=(0,f.findHierarchyNode)(this.items,v,"id");r&&n.unshift(r)}n.push(i),this.selectedNodeFullPathCaption=n.map(r=>r.caption).join(" / "),this.selectedTabIndex=1,this.loadSpecificationFilters.emit(this.specificationEntityName)}onKeyShowSpecificationFilters(t,i){i.key==="Enter"&&this.onShowSpecificationFilters(t)}onKeyBackButton(t){t.key==="Enter"&&(this.onHideSpecificationFilters(),this._refocusActiveNode())}onHideSpecificationFilters(){this.selectedTabIndex=0}onKeyClearSpecificationFilter(t){t.key==="Enter"&&this.onClearSpecificationFilter()}onClearSpecificationFilter(){this.specificationFilter?.reset(),this.specificationFilterChange.emit({specificationEntityName:this.specificationEntityName,specificationReferenceColumnName:this.specificationReferenceColumnName,specificationFiltersConfiguration:this.specificationFiltersConfiguration,specificationFiltersValues:new Map})}onNodeExpanded(t){const i=(0,f.findHierarchyNode)(this.items,t.Id,"id");i.id!==v&&(this.loading=!0),this.loadNext.emit([i])}onExpandedItemsChanged(t){this.expandedItemsChange.emit(t)}onPaginationChange(t){const i=t?.parentKeys.map(n=>(0,f.findHierarchyNode)(this.nodes,n,"id")).filter(n=>n!==void 0);i?.length&&(this.loading=!0,this.loadNext.emit(i))}static{this.\u0275fac=(()=>{let t;return function(n){return(t||(t=e.\u0275\u0275getInheritedFactory(Y)))(n||Y)}})()}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Y,selectors:[["crt-entity-hierarchy-filter"]],viewQuery:function(i,n){if(i&1&&(e.\u0275\u0275viewQuery(A,5),e.\u0275\u0275viewQuery(m.CrtToggleContainerComponent,5)),i&2){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.specificationFilter=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.toggleContainer=r.first)}},inputs:{nodes:"nodes",specificationReferenceColumnName:"specificationReferenceColumnName",specificationEntityName:"specificationEntityName",specificationFiltersConfiguration:"specificationFiltersConfiguration",selectedNodeId:"selectedNodeId",expandedItems:"expandedItems",selectedTabIndex:"selectedTabIndex"},outputs:{loadSpecificationFilters:"loadSpecificationFilters",specificationFilterChange:"specificationFilterChange",expandedItemsChange:"expandedItemsChange",loadNext:"loadNext",nodeClick:"nodeClick",tabIndexChange:"tabIndexChange"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:5,vars:2,consts:[["items",""],["treeViewContainer",""],[3,"selectedTabIndex","slidingAnimation"],[1,"hierarchy-container"],["class","tree-skeleton-icon","svgIcon","tree-skeleton",4,"ngIf","ngIfElse"],["svgIcon","tree-skeleton",1,"tree-skeleton-icon"],[3,"nodeExpanded","expandedItemsChanged","selectedItemKeyChange","paginationChange","items","selectedItemKey","expandedItems"],["crtVirtualScrollTreeViewItemOutlet",""],["class","crt-hierarchy-progress-bar",4,"ngIf"],["data-item-hierarchy-tree-node","","role","status",1,"tree-node"],["node-caption-container","",1,"tree-node-caption-container"],[1,"tree-node-caption","pointer"],["node-filter-container","","class","tree-node-filters","size","small","color","transparent","role","button",3,"iconPosition","icon","clicked","keydown",4,"ngIf"],["node-filter-container","","size","small","color","transparent","role","button",1,"tree-node-filters",3,"clicked","keydown","iconPosition","icon"],[1,"crt-hierarchy-progress-bar"],[1,"specification-container"],[1,"navigation-body-wrapper"],[1,"navigation-header"],["size","large","displayType","text","color","primary","role","button",1,"navigate-back-button",3,"clicked","keydown","iconPosition","icon","caption"],["size","medium","size","large","displayType","text","color","default","role","button",3,"clicked","keydown","iconPosition","icon","caption"],[1,"navigation-divider"],[1,"navigation-path-caption"],["labelType","caption","labelColor","var(--crt-palette-label-400)",3,"caption"],[3,"filterChange","specificationFilters","specificationReferenceColumnName","specificationEntityName"]],template:function(i,n){i&1&&(e.\u0275\u0275elementStart(0,"crt-toggle-container",2),e.\u0275\u0275template(1,ke,5,2,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(3,Le,12,14,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),i&2&&e.\u0275\u0275property("selectedTabIndex",n.selectedTabIndex)("slidingAnimation",!0)},dependencies:[S.NgIf,te.MatIcon,A,m.CrtToggleContainerItemComponent,m.CrtToggleContainerComponent,m.CrtButtonComponent,m.CrtLabelComponent,G.CrtVirtualScrollTreeViewComponent,G.CrtVirtualScrollTreeViewItemOutletDirective,b.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}crt-entity-hierarchy-filter{overflow:auto;min-width:12rem}crt-entity-hierarchy-filter .tree-skeleton-icon{min-height:12rem;width:100%;opacity:.6;min-width:12rem}crt-entity-hierarchy-filter .tree-skeleton-icon:before{animation:tree-skeleton-icon-progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;top:0;left:0;width:200px;height:100%;content:"";background-image:linear-gradient(90deg,#fff0,#fff9,#fff0)}@keyframes tree-skeleton-icon-progress{0%{transform:translate(-200px)}to{transform:translate(calc(200px + 100vw))}}crt-entity-hierarchy-filter crt-toggle-container,crt-entity-hierarchy-filter .crt-toggle-container{border-radius:0!important}crt-entity-hierarchy-filter crt-toggle-container crt-toggle-container-item div[items],crt-entity-hierarchy-filter .crt-toggle-container crt-toggle-container-item div[items]{height:100%}crt-entity-hierarchy-filter .hierarchy-container .tab-body,crt-entity-hierarchy-filter .specification-container .tab-body{padding:0}crt-entity-hierarchy-filter .pointer{cursor:pointer}crt-entity-hierarchy-filter crt-tree-view{height:100%}crt-entity-hierarchy-filter .tree-node{height:2.5rem;display:flex;align-items:center;padding-left:.5rem;padding-right:.5rem}crt-entity-hierarchy-filter .tree-node:not(.nested-node){width:100%}crt-entity-hierarchy-filter .tree-node .tree-node-caption-container{display:flex}crt-entity-hierarchy-filter .tree-node .tree-node-filters{padding:5px 5px 0;margin-left:auto}crt-entity-hierarchy-filter .tree-node:hover .tree-node-filters{opacity:1}crt-entity-hierarchy-filter .tree-node-hidden{display:none}crt-entity-hierarchy-filter .nested-node{display:flex}crt-entity-hierarchy-filter .nested-node .nested-node-filters{padding:5px 5px 0;margin-left:auto}crt-entity-hierarchy-filter .nested-node .nested-node-filters:hover,crt-entity-hierarchy-filter .nested-node .nested-node-filters:focus{opacity:1}crt-entity-hierarchy-filter .nested-node:hover .nested-node-filters{opacity:1}crt-entity-hierarchy-filter .nested-node.focused .nested-node-filters{opacity:1}crt-entity-hierarchy-filter .nested-node .mat-icon.chevron-icon{height:16px}crt-entity-hierarchy-filter .nested-node .nested-node-icon{align-items:center;display:flex}crt-entity-hierarchy-filter .nested-node .nested-node-icon .chevron-icon.icon-collapsed{transform:rotate(-90deg)}crt-entity-hierarchy-filter .nested-node .nested-node-icon :hover{cursor:pointer}crt-entity-hierarchy-filter .nested-node .nested-node-caption-container{display:flex}crt-entity-hierarchy-filter .nested-node .nested-node-caption-container .nested-node-caption{align-items:center;display:flex;margin-left:.5rem}crt-entity-hierarchy-filter .navigation-body-wrapper{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1;padding:0 4px}crt-entity-hierarchy-filter .navigation-body-wrapper .navigation-header{display:flex;flex-direction:row;justify-content:space-between;align-items:center;height:2.5rem}crt-entity-hierarchy-filter .navigation-body-wrapper .navigation-divider{margin:0;border-style:none;height:1px}crt-entity-hierarchy-filter .navigation-body-wrapper .navigation-path-caption{height:2.5rem;display:flex;flex-wrap:wrap;align-items:center}crt-entity-hierarchy-filter .crt-hierarchy-progress-bar{position:absolute;bottom:0;width:100%;z-index:10;height:2px;background-repeat:no-repeat;background-image:linear-gradient(90deg,var(--crt-palette-label-50) 0%,var(--crt-palette-navigation-secondary-500) 100%);background-color:var(--crt-palette-label-50);background-size:40% 100%;animation:loader-animation 1.4s infinite}@keyframes loader-animation{0%{background-position-x:-67%}to{background-position-x:167%}}crt-entity-hierarchy-filter[dir=rtl] .tree-node .tree-node-caption{margin-right:1rem;margin-left:0rem}crt-entity-hierarchy-filter[dir=rtl] .tree-node .tree-node-filters{margin-right:auto;margin-left:0}crt-entity-hierarchy-filter[dir=rtl] .crt-hierarchy-progress-bar{background-image:linear-gradient(270deg,var(--crt-palette-label-50) 0%,var(--crt-palette-navigation-secondary-500) 100%);animation-direction:reverse}
`],encapsulation:2,changeDetection:0})}};(0,d.__decorate)([(0,o.CrtInput)({reuseStrategy:{resetValue:!0}}),(0,d.__metadata)("design:type",Array),(0,d.__metadata)("design:paramtypes",[Array])],g.prototype,"nodes",null),(0,d.__decorate)([(0,o.CrtInput)(),(0,d.__metadata)("design:type",String)],g.prototype,"specificationReferenceColumnName",void 0),(0,d.__decorate)([(0,o.CrtInput)(),(0,d.__metadata)("design:type",String)],g.prototype,"specificationEntityName",void 0),(0,d.__decorate)([(0,o.CrtInput)(),(0,d.__metadata)("design:type",Array)],g.prototype,"specificationFiltersConfiguration",void 0),(0,d.__decorate)([(0,o.CrtOutput)(),(0,d.__metadata)("design:type",Object)],g.prototype,"loadSpecificationFilters",void 0),(0,d.__decorate)([(0,o.CrtOutput)(),(0,d.__metadata)("design:type",Object)],g.prototype,"specificationFilterChange",void 0),(0,d.__decorate)([(0,o.CrtInput)(),(0,d.__metadata)("design:type",String),(0,d.__metadata)("design:paramtypes",[String])],g.prototype,"selectedNodeId",null),(0,d.__decorate)([(0,o.CrtInput)(),(0,d.__metadata)("design:type",Array),(0,d.__metadata)("design:paramtypes",[Array])],g.prototype,"expandedItems",null),(0,d.__decorate)([(0,o.CrtOutput)(),(0,d.__metadata)("design:type",Object)],g.prototype,"expandedItemsChange",void 0),(0,d.__decorate)([(0,o.CrtOutput)(),(0,d.__metadata)("design:type",Object)],g.prototype,"loadNext",void 0),(0,d.__decorate)([(0,o.CrtOutput)(),(0,d.__metadata)("design:type",Object)],g.prototype,"nodeClick",void 0),(0,d.__decorate)([(0,o.CrtOutput)(),(0,d.__metadata)("design:type",Object)],g.prototype,"tabIndexChange",void 0),(0,d.__decorate)([(0,o.CrtInput)(),(0,d.__metadata)("design:type",Number),(0,d.__metadata)("design:paramtypes",[Number])],g.prototype,"selectedTabIndex",null),g=(0,d.__decorate)([(0,o.CrtViewElement)({type:"crt.EntityHierarchyFilter",reuseStrategy:o.ViewElementReuseStrategy.Reuse}),(0,o.CrtInterfaceDesignerItem)({toolbarConfig:{position:290,icon:u(27778),hint:"Components.EntityHierarchyFilter.Hint"},typeCaption:"Components.EntityHierarchyFilter.Caption",viewElementGroupType:o.ViewElementGroupType.Components,propertiesPanelComponentTypeName:"crt.EntityHierarchyFilterPropertiesPanel",designViewItemCommands:{create:"crt.CreateEntityHierarchyFilterComponentCommand",update:"crt.ChangeFilterViewItemCommand",delete:"crt.RemoveFilterViewItemCommand"}})],g);var ye=u(28399);function M(l,t){const i=new o.FilterGroup(o.LogicalOperatorType.And,l);return t?.forEach(n=>{n.id&&n.id!=="empty"?i.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,n.columnName,n.id):i.addSchemaColumnIsNullFilter(n.columnName)}),i}class ${constructor(t){this._injector=t,this._notFilledCaptionKey="EntityHierarchyFilter.NotFilledNode",this._entitySchemaRepository=this._injector.get(D.EntitySchemaRepository),this._queryExecutor=this._injector.get(P.QueryExecutor),this._translateService=this._injector.get(b.TranslateService)}_getLookupDataEsq(t,i){var n=this;return(0,C.A)(function*(){const r=yield(0,F.firstValueFrom)(n._entitySchemaRepository.getSchemaByName(t));n._referencedColumn=r.columns.find(s=>s.name===i);const a=yield(0,F.firstValueFrom)(n._entitySchemaRepository.getSchemaByName(n._referencedColumn.referenceSchemaName)),c=new o.EntitySchemaQuery(a.name);return c.addSchemaColumn(`${a.getPrimaryDisplayColumn().name}`,"Name").withOrdering(o.OrderDirection.Asc,0),c.addSchemaColumn(`${a.getPrimaryColumn().name}`,"Id"),c})()}_getLookupData(t){var i=this;return(0,C.A)(function*(){const n=t.schemaName,r=t.columnName,a=t.nextLevelColumnName,c=t.count,s=yield i._getLookupDataEsq(n,r);c&&(s.rowCount=c,s.rowsOffset=t.offset);const p=new o.FilterGroup(o.LogicalOperatorType.And,n);if(p.add(M(n,t.parentNodes)),t.predefinedFilters&&p.add(o.FilterGroup.fromJson(t.predefinedFilters,o.FilterParser)),s.filters.addExistsFilter(`[${n}:${r}:Id].Id`,p),a){const _=new o.FilterGroup(o.LogicalOperatorType.And,i._referencedColumn.referenceSchemaName);t.parentNodes?.forEach(y=>{_.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,`[${n}:${a}:Id].${y.columnName}`,y.id)});const h={filter:_};s.addAggregationSubQueryColumn(`[${n}:${t.columnName}:Id].${a}.Id`,o.AggregationType.Count,h,"NextLevelCount")}return(0,F.firstValueFrom)(i._queryExecutor.executeSelectQuery(s))})()}loadData(t){var i=this;return(0,C.A)(function*(){const n=yield i._getLookupData(t),r="empty",a=t.parentNodes?.map(s=>s.id||r).join("_"),c=n.map(s=>{const p=s.Id||r;return{id:a?`${a}_${p}`:p,caption:s.Name||`${i._referencedColumn.caption}: ${i._translateService.instant(i._notFilledCaptionKey)}`,columnName:t.columnName,filters:null,children:[],isLastLevel:!t.nextLevelColumnName||+s.NextLevelCount==0}}).sort((s,p)=>{const _=s.id.split("_").filter(y=>y===r).length,h=p.id.split("_").filter(y=>y===r).length;return _-h});return c.length===t.count&&(c[c.length-1].isLastItem=!0),c})()}static{this.\u0275fac=function(i){return new(i||$)(e.\u0275\u0275inject(e.Injector))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"root"})}}let ae=class{constructor(t,i,n){this.injector=t,this._entityHierarchyFiltersService=i,this._loadDataService=n,this._rowCount=30}_getParentNodes(t,i){const n=[],r=t.id.split("_");return r.map((c,s)=>r[s-1]?r.slice(0,s+1).join("_"):c).forEach(c=>{if(c===v)return;const s=(0,f.getHierarchyIdLastPart)(c);n.push({id:s,columnName:(0,f.findHierarchyNode)(i,c,"id").columnName})}),n}convert([t,i,n],r,a,c){var s=this;return(0,C.A)(function*(){if(!a)return[];if(!i?.length){const _=s._entityHierarchyFiltersService.createRootNode();return _.children=yield s._loadDataService.loadData({schemaName:a,columnName:t?.[0].columnName,nextLevelColumnName:t?.[0].children?.[0]?.columnName,predefinedFilters:n,parentNodes:[],count:s._rowCount,offset:0}),[_]}const p=(0,ye.cloneDeep)(yield r[c]);for(const _ of i){const h=(0,f.findHierarchyNode)(p,_.id,"id"),y=h.id===v?t?.[0]:(0,f.findHierarchyNode)(t,h.columnName,"columnName")?.children?.[0];if(!y?.columnName)continue;const q=y?.children?.[0]?.columnName,ue=s._getParentNodes(h,p);h.children=h.children||[],h.children?.forEach(Pe=>{Pe.isLastItem=!1});const Z=yield s._loadDataService.loadData({schemaName:a,columnName:y?.columnName,nextLevelColumnName:q,predefinedFilters:n,parentNodes:ue,count:s._rowCount,offset:h.children.length});h.children.push(...Z)}return p})()}};ae=(0,d.__decorate)([(0,o.CrtConverter)({type:"crt.ToHierarchyNodesConverter"}),(0,d.__metadata)("design:paramtypes",[e.Injector,L,$])],ae);let oe=class{convert([t,i],n,r,a){return(0,C.A)(function*(){const c=new o.FilterGroup(o.LogicalOperatorType.And,r);if(t){if(t.id!==v){const s=(0,ye.cloneDeep)(t),p=yield n[a];s.id=(0,f.getHierarchyIdLastPart)(s.id),c.add(M(r,[s]));const _=(0,f.getNodeParentsIds)(t.id);let h=[],y=p[0];for(const x of _)h.push({id:(0,f.getHierarchyIdLastPart)(x),columnName:y?.columnName}),y=y.children?.[0];h=h?.filter(x=>x.id!==v),h?.length&&c.add(M(r,h))}return i&&c.add(i),c}})()}};oe=(0,d.__decorate)([(0,o.CrtConverter)({type:"crt.ToHierarchyFiltersConverter"})],oe);let ce=class{constructor(t){this._queryExecutor=t}_formEsq(t,i,n){var r=this;return(0,C.A)(function*(){const a=M(t,i),c=new o.EntitySchemaQuery(t);return c.addSchemaColumn(i[i.length-1].columnName,"Caption"),c.filters.add(a),n&&c.filters.add(n),yield(0,F.firstValueFrom)(r._queryExecutor.executeSelectQuery(c))})()}_getNodes(t,i,n){return(0,C.A)(function*(){const r=yield t[i],a=n.split("_");let c=r[0];const s=[];return a.forEach(p=>{s.push({id:p,columnName:c?.columnName}),c=c?.children?.[0]}),s})()}convert([t,i],n,r,a,c){var s=this;return(0,C.A)(function*(){const p=yield n[c];let _=(0,f.findHierarchyNode)(p,t,"id");const h=(0,f.findHierarchyNode)(p,v,"id");if(!t)return h;if(!_&&t!==v){const y=yield s._getNodes(n,a,t);if(y.find(q=>!q.columnName))return h;const x=yield s._formEsq(r,y,i);if(!x?.length)return h;_={id:t,columnName:y[y.length-1].columnName,caption:x[0].Caption.displayValue}}return _})()}};ce=(0,d.__decorate)([(0,o.CrtConverter)({type:"crt.HierarchyCheckSelectedNodeExistsConverter"}),(0,d.__metadata)("design:paramtypes",[P.QueryExecutor])],ce);let _e=class extends o.BaseRequest{};_e=(0,d.__decorate)([(0,o.CrtRequest)({type:"crt.EntityHierarchyFilterNodeChangeRequest"})],_e);let le=class extends o.BaseRequestHandler{handle(t){return(0,C.A)(function*(){const i=t.$context;yield i.set(t.selectedNodeIdProfileAttributeName,t.nodeId),yield i.set(t.specificationFilterAttributeName,null)})()}};le=(0,d.__decorate)([(0,o.CrtRequestHandler)({type:"crt.EntityHierarchyFilterNodeChangeHandler",requestType:"crt.EntityHierarchyFilterNodeChangeRequest"})],le);let Ce=class extends o.BaseRequest{};Ce=(0,d.__decorate)([(0,o.CrtRequest)({type:"crt.EntityHierarchyFilterLoadNodeDataRequest"})],Ce);let se=class Q extends o.BaseRequestHandler{handle(t){return(0,C.A)(function*(){yield t.$context.set(t.expandedNodesAttributeName,t.nodes)})()}static{this.\u0275fac=(()=>{let t;return function(n){return(t||(t=e.\u0275\u0275getInheritedFactory(Q)))(n||Q)}})()}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac,providedIn:"root"})}};se=(0,d.__decorate)([(0,o.CrtRequestHandler)({type:"crt.EntityHierarchyFilterLoadNodeDataHandler",requestType:"crt.EntityHierarchyFilterLoadNodeDataRequest"})],se);class T{constructor(t){this._queryExecutor=t}_loadSpecificationListItems(t){const i=t.filter(r=>r.type===f.SpecificationType.List);if(!i?.length)return(0,F.of)(t);const n=new o.EntitySchemaQuery("SpecificationListItem");return n.isDistinct=!0,n.addSchemaColumn("Specification"),n.addSchemaColumn("Name"),n.addSchemaColumn("Id"),n.filters.addSchemaColumnInFilterWithParameters(o.ComparisonType.Equal,"Specification",i.map(r=>r.specificationId)),this._queryExecutor.executeSelectQuery(n).pipe((0,F.map)(r=>this._mapListItems(r)),(0,F.map)(r=>(t.forEach(a=>{a.type===f.SpecificationType.List&&(a.listItems=r.filter(c=>c.specificationId===a.specificationId))}),t)))}_mapListItems(t){return t.map(i=>({id:i.Id,name:i.Name,specificationId:i.Specification.value})).sort((i,n)=>i.name.localeCompare(n.name))}_loadSpecifications(t,i,n){const r=new o.EntitySchemaQuery(t);if(r.isDistinct=!0,r.addSchemaColumn("Specification"),r.addSchemaColumn("Specification.Type"),r.addSchemaColumn("Specification.Name"),r.filters.addSchemaColumnIsNotNullFilter("Specification"),n){const a=o.FilterGroup.fromJson(n,o.FilterParser);r.filters.addExistsFilter(`${i}.Id`,a)}return this._queryExecutor.executeSelectQuery(r).pipe((0,F.map)(a=>this._mapSpecifications(a)))}_mapSpecifications(t){return t.map(i=>({specificationId:i.Specification.value,type:i["Specification.Type"].value,caption:i["Specification.Name"]})).sort((i,n)=>i.caption.localeCompare(n.caption))}formSpecificationModels(t,i,n){return this._loadSpecifications(t,i,n).pipe((0,F.switchMap)(r=>this._loadSpecificationListItems(r)))}formFilters(t,i,n,r){const a=new o.FilterGroup;for(const c of i.keys()){const s=t.find(_=>_.specificationId===c),p=new o.FilterGroup;p.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,`[${n}:${r}].Specification`,c),s.type===f.SpecificationType.Boolean&&this._addBooleanValueFilter(p,i.get(c),n,r),s.type===f.SpecificationType.String&&this._addStringValueFilter(p,i.get(c),n,r),(s.type===f.SpecificationType.Decimal||s.type===f.SpecificationType.Integer)&&this._addNumericValueFilter(p,i.get(c),n,r,s.type),s.type===f.SpecificationType.List&&this._addListValueFilter(p,i.get(c),n,r),a.add(p)}return a}_addListValueFilter(t,i,n,r){i?.length&&t.addSchemaColumnInFilterWithParameters(o.ComparisonType.Equal,`[${n}:${r}].ListItemValue`,i)}_addNumericValueFilter(t,i,n,r,a){const c=a===f.SpecificationType.Decimal?"FloatValue":"IntValue";i?.from!==null&&i?.from!==void 0&&t.addSchemaColumnFilterWithParameter(o.ComparisonType.Greater_or_equal,`[${n}:${r}].${c}`,i.from),i?.to!==null&&i?.to!==void 0&&t.addSchemaColumnFilterWithParameter(o.ComparisonType.Less_or_equal,`[${n}:${r}].${c}`,i.to)}_addStringValueFilter(t,i,n,r){t.addSchemaColumnFilterWithParameter(o.ComparisonType.Contain,`[${n}:${r}].StringValue`,i)}_addBooleanValueFilter(t,i,n,r){t.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,`[${n}:${r}].BooleanValue`,i)}static{this.\u0275fac=function(i){return new(i||T)(e.\u0275\u0275inject(P.QueryExecutor))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac})}}let de=class X extends o.BaseRequestHandler{constructor(t){super(),this._injector=t,this._specificationService=this._injector.get(T)}handle(t){var i=this;return(0,C.A)(function*(){const n=yield t.$context[t.predefinedFilterAttributeName],r=yield(0,F.lastValueFrom)(i._specificationService.formSpecificationModels(t.specificationEntityName,t.specificationReferenceColumnName,n));yield t.$context.set(t.specificationFiltersConfigurationAttributeName,r)})()}static{this.\u0275fac=function(i){return new(i||X)(e.\u0275\u0275inject(e.Injector))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac,providedIn:"root"})}};de=(0,d.__decorate)([(0,o.CrtRequestHandler)({type:"crt.EntityHierarchyLoadSpecificationFiltersHandler",requestType:"crt.EntityHierarchyLoadSpecificationFiltersRequest"}),(0,d.__metadata)("design:paramtypes",[e.Injector])],de);let pe=class ee extends o.BaseRequestHandler{constructor(t){super(),this._injector=t,this._specificationService=this._injector.get(T)}handle(t){var i=this;return(0,C.A)(function*(){const n=t.data,r=i._specificationService.formFilters(n.specificationFiltersConfiguration,n.specificationFiltersValues,n.specificationEntityName,n.specificationReferenceColumnName);yield t.$context.set(t.specificationFilterAttributeName,r)})()}static{this.\u0275fac=function(i){return new(i||ee)(e.\u0275\u0275inject(e.Injector))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac,providedIn:"root"})}};pe=(0,d.__decorate)([(0,o.CrtRequestHandler)({type:"crt.EntityHierarchyFormSpecificationFiltersHandler",requestType:"crt.EntityHierarchyFormSpecificationFiltersRequest"}),(0,d.__metadata)("design:paramtypes",[e.Injector])],pe);var Re=u(85638);class J{constructor(t){this.injector=t,this._componentName="crt.EntityHierarchyFilter",this._expandedItemsAttributeNameSuffix="_ExpandedItems",this._selectedNodeIdAttributeNameSuffix="_SelectedNodeId",this._specificationSettings=[],this._queryExecutor=t.get(P.QueryExecutor),this._profileAttributeService=t.get(m.ProfileAttributeService),this._entitySchemaRepository=t.get(D.EntitySchemaRepository),this._packageInfoService=t.get(Re.PackageInfoService)}_getComponents(t){return D.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,t.viewConfig).map(i=>i.viewConfig)}_getComponentName(t){return t.name.replace(/\./g,"_")}_setExpandedItemsAttrValue(t,i){if(i.expandedItems)return;const n=`${i.name}${this._expandedItemsAttributeNameSuffix}`;this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(t,i,"expandedItems",n)}_setAttributeWithChangeRequestForSelectedNodeId(t,i){this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(t,i,"selectedNodeId")}_getSpecificationSettingsEntity(){const t=new o.EntitySchemaQuery("SpecificationSettings");return t.addSchemaColumn("SpecificationEntityName"),t.addSchemaColumn("EntityName"),(0,F.lastValueFrom)(this._queryExecutor.executeSelectQuery(t))}_setSpecificationEntityName(t){const i=this._specificationSettings.find(n=>n.EntityName===t.schemaName);t.specificationEntityName=i?i.SpecificationEntityName:""}_setSpecificationEntityColumnReferenceName(t){var i=this;return(0,C.A)(function*(){if(!t.specificationEntityName)return;const r=(yield(0,F.lastValueFrom)(i._entitySchemaRepository.getSchemaByName(t.specificationEntityName))).columns.filter(a=>!["ModifiedBy","CreatedBy"].includes(a.name)).find(a=>a.referenceSchemaName===t.schemaName);t.specificationReferenceColumnName=r?.name})()}_setComponentConfigValues(t,i){t.nodeClick={request:"crt.EntityHierarchyFilterNodeChangeRequest",params:{selectedNodeIdProfileAttributeName:i.selectedNodeIdProfileAttributeName,specificationFilterAttributeName:i.specificationFilterAttributeName,nodeId:"@event"}},t.specificationFilterChange={request:"crt.EntityHierarchyFormSpecificationFiltersRequest",params:{selectedNodeAttributeName:i.selectedNodeAttributeName,nodesAttributeName:i.nodesAttributeName,specificationReferenceColumnName:t.specificationReferenceColumnName,specificationFilterAttributeName:i.specificationFilterAttributeName,data:"@event"}},t.loadNext={request:"crt.EntityHierarchyFilterLoadNodeDataRequest",params:{expandedNodesAttributeName:i.expandedNodesAttributeName,nodes:"@event"}},t.nodes||(t.nodes=`$${i.nodesAttributeName}`),t.loadSpecificationFilters={request:"crt.EntityHierarchyLoadSpecificationFiltersRequest",params:{specificationEntityName:"@event",selectedNodeAttributeName:i.selectedNodeAttributeName,nodesAttributeName:i.nodesAttributeName,specificationFiltersConfigurationAttributeName:i.specificationFiltersConfigurationAttributeName,specificationReferenceColumnName:t.specificationReferenceColumnName,predefinedFilterAttributeName:i.predefinedFilterAttributeName}},t.tabIndexChange={request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:i.selectedTabIndexAttributeName,attributeValue:"@event"}}}_setComponentAttributes(t,i,n){const r=i.viewModelConfig.attributes;r[n.nodesConfigAttributeName]={value:t.nodesConfig},r[n.expandedNodesAttributeName]={value:null},r[n.specificationFilterAttributeName]={value:null},r[n.specificationFiltersConfigurationAttributeName]={value:[]},t.specificationFiltersConfiguration=`$${n.specificationFiltersConfigurationAttributeName}`,r[n.selectedTabIndexAttributeName]={value:0},t.selectedTabIndex=`$${n.selectedTabIndexAttributeName}`,r[n.filterAttributeName]={from:[n.selectedNodeAttributeName,n.specificationFilterAttributeName],converter:`${n.filterConverter} : '${t.schemaName}' : '${n.nodesConfigAttributeName}'`,filter:`crt.ToBoolean : $${n.selectedNodeAttributeName}`},r[n.nodesAttributeName]={from:[n.nodesConfigAttributeName,n.expandedNodesAttributeName,n.predefinedFilterAttributeName],converter:`crt.ToHierarchyNodesConverter : '${t.schemaName}' : '${n.nodesAttributeName}' : '${n.predefinedFilterAttributeName}'`},r[n.selectedNodeAttributeName]={from:[n.selectedNodeIdProfileAttributeName,n.predefinedFilterAttributeName],converter:`crt.HierarchyCheckSelectedNodeExistsConverter : '${t.schemaName}' : '${n.nodesConfigAttributeName}' : '${n.nodesAttributeName}'`}}_getComponentAttributeNames(t){const i=this._getComponentName(t);return(0,D.buildHierarchyAttributeNames)(i)}_isSpecificationPackageInstalled(){var t=this;return(0,C.A)(function*(){return!!(yield(0,F.lastValueFrom)(t._packageInfoService.getPackagesInfo())).find(n=>n.Name==="CrtSpecification")})()}_loadSpecificationSettings(){var t=this;return(0,C.A)(function*(){if(t._specificationSettings.length||!(yield t._isSpecificationPackageInstalled()))return;const i=yield t._getSpecificationSettingsEntity();t._specificationSettings=i})()}crtOnMetaDataInit(t){var i=this;return(0,C.A)(function*(){const n=t,r=i._getComponents(n);for(const a of r){yield i._loadSpecificationSettings();const c=i._getComponentAttributeNames(a);i._setComponentAttributes(a,n,c),i._setSpecificationEntityName(a),yield i._setSpecificationEntityColumnReferenceName(a),i._setComponentConfigValues(a,c),i._setExpandedItemsAttrValue(n,a),i._setAttributeWithChangeRequestForSelectedNodeId(n,a)}return t})()}static{this.\u0275fac=function(i){return new(i||J)(e.\u0275\u0275inject(e.Injector))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}class R{constructor(t,i){this.el=t,this.renderer=i,this.isRtl=!1,this.paddingPerLevel=2,this.treeNodeSelector="[data-item-hierarchy-tree-node]"}ngOnInit(){if(!this.el?.nativeElement?.ariaLevel)return;const t=+this.el.nativeElement.ariaLevel;let i=.5;t!==1&&(i=(t-1)*this.paddingPerLevel);const n=`${i}rem`;let r="padding-left";this.isRtl&&(r="padding-right");const a=this.el.nativeElement.querySelector(this.treeNodeSelector);this.renderer.setStyle(a,r,n)}static{this.\u0275fac=function(i){return new(i||R)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(e.Renderer2))}}static{this.\u0275dir=e.\u0275\u0275defineDirective({type:R,selectors:[["","crtHierarchyTreeNodePadding",""]],inputs:{isRtl:"isRtl"}})}}class B{static{this.\u0275fac=function(i){return new(i||B)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:B})}static{this.\u0275inj=e.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(B,{declarations:[R],exports:[R]})})();class O{static{this.\u0275fac=function(i){return new(i||O)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:O})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[T],imports:[S.CommonModule,K.CrtLibTranslateModule.forRoot({i18n:he}),m.CrtExpansionPanelModule,m.CrtRadioButtonModule,m.CrtInputModule,m.CrtNumberInputModule,m.CrtCheckboxModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(O,{declarations:[A,V,I,j,k,w],imports:[S.CommonModule,K.CrtLibTranslateModule,m.CrtExpansionPanelModule,m.CrtRadioButtonModule,m.CrtInputModule,m.CrtNumberInputModule,m.CrtCheckboxModule],exports:[A]})})();let U=class me{constructor(t){this._materialIconsRegistrar=t,this._materialIconsRegistrar.addIcons([{name:"hierarchy-chevron-down",icon:u(70674)},{name:"tree-skeleton",icon:u(49430)},{name:"filter",icon:u(7716)}])}static{this.\u0275fac=function(i){return new(i||me)(e.\u0275\u0275inject(z.MaterialIconsRegistrator))}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:me})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[L,{provide:ge.CRT_METADATA_PREPROCESSOR,useClass:J,multi:!0}],imports:[S.CommonModule,ie.ViewModule,te.MatIconModule,z.CrtSkeletonLoaderModule,B,O,m.CrtTabPanelModule,m.CrtButtonModule,m.CrtLabelModule,K.CrtLibTranslateModule.forRoot({i18n:he}),G.CrtVirtualScrollTreeViewModule]})}};U=(0,d.__decorate)([(0,o.CrtModule)({viewElements:[g],converters:[ae,oe,ce],requestHandlers:[le,se,de,pe]}),(0,d.__metadata)("design:paramtypes",[z.MaterialIconsRegistrator])],U),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(U,{declarations:[g],imports:[S.CommonModule,ie.ViewModule,te.MatIconModule,z.CrtSkeletonLoaderModule,B,O,m.CrtTabPanelModule,m.CrtButtonModule,m.CrtLabelModule,K.CrtLibTranslateModule,G.CrtVirtualScrollTreeViewModule],exports:[g]})}()},70674:E=>{E.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M3.27572 5.27844C3.64335 4.90719 4.2394 4.90719 4.60703 5.27844L8 8.70489L11.393 5.27844C11.7606 4.90719 12.3566 4.90719 12.7243 5.27844C13.0919 5.6497 13.0919 6.25163 12.7243 6.62289L8.66565 10.7216C8.29802 11.0928 7.70198 11.0928 7.33435 10.7216L3.27572 6.62289C2.90809 6.25163 2.90809 5.6497 3.27572 5.27844Z" fill="currentColor"/>
</svg>
`},27778:E=>{E.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="16" y="17" width="2" height="39" rx="1" fill="#D1D1D1"/>
<rect x="34.752" y="31" width="2" height="25" rx="1" fill="#D1D1D1"/>
<rect x="17" y="24" width="2" height="9" rx="1" transform="rotate(-90 17 24)" fill="#D1D1D1"/>
<rect x="35.752" y="41" width="2" height="9" rx="1" transform="rotate(-90 35.752 41)" fill="#D1D1D1"/>
<rect x="34.752" y="56" width="2" height="10" rx="1" transform="rotate(-90 34.752 56)" fill="#D1D1D1"/>
<rect x="9" y="3" width="16" height="12" rx="3" fill="#40ACF0"/>
<rect x="28" y="17" width="16" height="12" rx="3" fill="#004FD6"/>
<rect x="46.752" y="33" width="16" height="12" rx="3" fill="#004FD6"/>
<rect x="46.752" y="49" width="16" height="12" rx="3" fill="#004FD6"/>
</svg>
`},7716:E=>{E.exports=`<svg width="12" height="10" viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4.66667 9C4.66667 9.55229 5.11438 10 5.66667 10H6.33333C6.88562 10 7.33333 9.55229 7.33333 9C7.33333 8.44771 6.88562 8 6.33333 8H5.66667C5.11438 8 4.66667 8.44771 4.66667 9ZM1 0C0.447715 0 0 0.447715 0 1C0 1.55228 0.447715 2 1 2L11 2C11.5523 2 12 1.55228 12 1C12 0.447715 11.5523 0 11 0L1 0ZM2 5C2 5.55228 2.44772 6 3 6L9 6C9.55229 6 10 5.55228 10 5C10 4.44772 9.55229 4 9 4L3 4C2.44772 4 2 4.44772 2 5Z" fill="currentColor"/>
</svg>
`},49430:E=>{E.exports=`<svg
	xmlns="http://www.w3.org/2000/svg" fill="none">
	<rect x="12" y="12" width="16" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="36" y="12" width="45%" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="12" y="52" width="16" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="36" y="52" width="20%" height="16" rx="8" fill="#E7E7E7"/>
	<rect width="100%" height="40" transform="translate(0 80)" fill="#E7ECFA"/>
	<rect x="12" y="92" width="16" height="16" rx="8" fill="white"/>
	<rect x="36" y="92" width="75%" height="16" rx="8" fill="white"/>
	<rect x="16" y="132" width="16" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="40" y="132" width="70%" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="36" y="172" width="16" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="60" y="172" width="45%" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="12" y="212" width="16" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="36" y="212" width="70%" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="12" y="252" width="16" height="16" rx="8" fill="#E7E7E7"/>
	<rect x="36" y="252" width="15%" height="16" rx="8" fill="#E7E7E7"/>
</svg>`}}]);
