(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[16835],{16835:(A,P,l)=>{l.r(P),l.d(P,{AnnotationBracketOffset:()=>d.rY,AnnotationOutlineMargin:()=>d.q8,BaseAccountProfileService:()=>m.hN,BaseDiagramEventHandlerController:()=>m.LV,BaseDiagramEventService:()=>m.K$,BaseDiagramRules:()=>d.iW,BaseDiagramSnapping:()=>d.Ng,BaseDrawConnection:()=>d.EI,BaseElementTools:()=>d.Hq,BaseFeatureService:()=>d.xi,CommandType:()=>y.g4,CommonDiagramDeleteShapeHandler:()=>d.LZ,CommonDiagramEventHandlerController:()=>d.F2,ConnectionClasses:()=>y.Fx,ConnectionProperties:()=>d.Qj,DefaultOutlineOffset:()=>d.xt,DiagramBaseOutline:()=>d.rk,DiagramBendpoints:()=>d.ij,DiagramCanvas:()=>d.gK,DiagramCircleOutline:()=>d.E7,DiagramCommandStack:()=>d.X3,DiagramComponent:()=>C.R,DiagramConnectionHighlight:()=>d.EY,DiagramConnectionOutline:()=>d.k3,DiagramConnectionPreview:()=>d.OZ,DiagramConnectionSegmentMove:()=>d.GT,DiagramContextPad:()=>d.QS,DiagramCopyPaste:()=>d.wA,DiagramCreateElementsHandler:()=>d.lY,DiagramCreateLabelHandler:()=>d.WQ,DiagramCreatePopupMenu:()=>d.RX,DiagramCreateShapeHandler:()=>d.jt,DiagramDataService:()=>m.B6,DiagramEditorActions:()=>d.WD,DiagramElementFactory:()=>d.cf,DiagramElementOutline:()=>d.cD,DiagramElementRegistry:()=>d.XP,DiagramElementToolsConfig:()=>d.rm,DiagramFeatures:()=>d.jF,DiagramFeaturesToken:()=>d.oE,DiagramKeyboardBindings:()=>d.cl,DiagramLabelEdit:()=>d.Yj,DiagramLabelOutline:()=>d.QM,DiagramLabelSupport:()=>d.F3,DiagramLassoTool:()=>d.IO,DiagramLoader:()=>d.xk,DiagramLocalStorage:()=>d.S1,DiagramModeling:()=>d.vh,DiagramModule:()=>S.O,DiagramMoveElementsHandler:()=>d.Kp,DiagramMoveHelper:()=>d.h1,DiagramOutline:()=>d.mQ,DiagramPalette:()=>d.vf,DiagramPaletteProvider:()=>d.Cc,DiagramPaletteTools:()=>d.kH,DiagramPopupMenu:()=>d.HE,DiagramPreviewSupport:()=>d.bF,DiagramReconnectHandler:()=>d.jB,DiagramRenderer:()=>d.br,DiagramRhombOutline:()=>d.q6,DiagramShapeOutline:()=>d.vy,DiagramSpaceTool:()=>d.YY,DiagramSpaceToolHandler:()=>d.Ov,DiagramSpaceToolPreview:()=>d.Q8,DiagramSplitConnectionHelper:()=>d.s0,DiagramTextUtils:()=>d.KP,DiagramValidationOutline:()=>d.TN,DiagramZoomScroll:()=>d.Ce,DirectEditing:()=>d.Wq,DrawConnection:()=>d.JP,ElementTools:()=>d.Ae,ElementToolsFactory:()=>d.MZ,EventPriority:()=>y.nS,FeatureExecutionOrder:()=>D.TG,FeatureProvider:()=>d.Ci,KeysEnum:()=>y.GS,LabelTools:()=>d.o9,Layouter:()=>d.Y3,Minimap:()=>d.Uf,OutlineFactory:()=>d.ZY,ProcessConvertUtils:()=>m.Gz,RenderingBaseShape:()=>d.tn,RenderingLabel:()=>d.JL,RenderingShape:()=>d.kh,RenderingShapeFactory:()=>d.cI,ReplaceMenuProvider:()=>d.TH,ShapeResizerMarginBottom:()=>d.Ve,Size:()=>d.or,Styles:()=>d.P_,SvgUtils:()=>R.Y,TextAreaBorder:()=>d.X5,TextAreaOffset:()=>d.aK,TextBox:()=>d.fI,UniqueNameService:()=>m.G6,UpdateLabelHandler:()=>d.sc,featureImplementation:()=>D.$8,featureImplementationExtension:()=>D._E,getKeyCode:()=>d.ZP,handleEnterKey:()=>d.Ot,ifNotReadonly:()=>D.P7,isEnterKey:()=>d.jX,isKey:()=>d.m0,isPrintableKey:()=>d.TW});var s=l(15534),o=l.n(s),_={};for(const O in s)O!=="default"&&(_[O]=()=>s[O]);l.d(P,_);var D=l(66262),C=l(46203),S=l(29766),y=l(87828),d=l(45971),m=l(5440),R=l(27449)},11177:(A,P,l)=>{l.d(P,{P:()=>s});function s(){return function(o,_,D){const C=D.value;D.value=function(){return this.isReadOnly?!1:C.apply(this,arguments)}}}},66262:(A,P,l)=>{l.d(P,{TG:()=>s,$8:()=>_,_E:()=>o,P7:()=>D.P});var s;(function(C){C[C.before=0]="before",C[C.after=1]="after",C[C.instead=2]="instead"})(s||(s={}));function o(C,S,y=s.instead){return(d,m,R)=>{R===void 0&&(R=Object.getOwnPropertyDescriptor(d,m));const O=R.value;return S.__instance__ instanceof S||(S.__instance__=new S),R.value=function(){const M=[].slice.call(arguments),L=[...M];let k;if(this.createFeatureContext instanceof Function&&L.unshift(this.createFeatureContext.call(this)),C(...M)){const f=S.__instance__;switch(y){case s.before:return k=f[m].apply(f,[...L]),O.apply(this,[...M,k]);case s.after:return k=O.apply(this,M),f[m].apply(f,[...L,k]);default:return f[m].apply(f,[...L])}}return O.apply(this,[...M,k])},R}}function _(C,S=s.before){return o(()=>!0,C,S)}var D=l(11177)},7319:(A,P,l)=>{l.d(P,{R:()=>N});var s=l(73308),o=l(59131),_=l.n(o),D=l(79772),C=l.n(D),S=l(59564),y=l.n(S),d=l(15534),m=l.n(d),R=l(96590),O=l.n(R),M=l(28399),L=l.n(M),k=l(15192),f=l(62278),F=l.n(f),B=l(36486),ae=l.n(B),V=l(7371),oe=l(44777),j=l(5440);const Q=["diagramContainer"],Ne=["resetZoomButton"];class N{set _isReadOnly(u){this.isReadOnly=u==="true"}set _isStraightConnection(u){this.isStraightConnection=u==="true"}set _isRtl(u){this.isRtl=u==="rtl"}get diagramEventHandlerController(){return this.get("diagramEventHandlerController")}get _diagramLoader(){return this.get("diagramLoader")}get modeling(){return this.get("modeling")}constructor(u){this.injector=u,this._initScale=1,this._unloaded$=new f.Subject,this._defaultTool="arrow",this.isRtl=!1,this.destroyed$=new f.Subject,this.initScroll={x:0,y:0},this.loaded=new f.Subject,this.loading=!0,this.elementDblClick=new o.EventEmitter,this.elementSelected=new o.EventEmitter,this.diagramInitialized=new o.EventEmitter,this.afterViewInit=new o.EventEmitter,this.loadProgress$=new f.Subject,this.isReadOnly=!1,this.isStraightConnection=!1,this.injectDependencies()}_initDiagram(u){this.diagramContainer=new o.ElementRef(document.querySelector(".diagram-container")),this.diagram=new k.A({canvas:{container:this.diagramContainer.nativeElement},keyboard:{bindTo:window},modules:[this.features,{loggerService:["value",this.loggerService]}],isReadOnly:this.isReadOnly,isStraightConnection:this.isStraightConnection,isRtl:this.isRtl,popupMenu:{scale:{min:1,max:1}},contextPad:{scale:{min:1,max:1}},initScroll:this.initScroll,initScale:this._initScale,...u}),this.diagramDataService.diagram=this.diagram,this.diagramEventHandlerController.service=this.service;const v=this.get("canvas"),w=this.get("editorActions"),b=this.get("elementFactory"),g=this.get("eventBus");g.fire("attach",{}),g.fire("editorActions.init",{editorActions:w});const J=b.createRoot({id:d.Roots.root.id});v.setRootElement(J),this.tool=this._defaultTool,this._serviceSubscriptions=this._subscribeService(),this.get("featureProvider").featureService=this.featureService}_setSelectedElement(u){if(u){const v=this.get("eventBus"),b=this.get("elementRegistry").get(u);b&&v.fire("element.click",{element:b})}}_subscribeLoadingData(){var u=this;const v=this.service.startLoading$.subscribe(b=>{this.dataId!==b&&(this.loading=!0)}),w=this.service.endLoading$.pipe((0,B.filter)(b=>b&&this.dataId!==b.id)).subscribe(function(){var b=(0,s.A)(function*(g){u._unloaded$.next(),yield u.loadDiagramData(g)});return function(g){return b.apply(this,arguments)}}());this._serviceSubscriptions.push(v,w),this.diagramInitialized.emit(),this.get("eventBus").fire(d.Handlers.diagram.initialized)}_getCancellationToken(){const u=new f.Subject;return(0,f.merge)(this.destroyed$,this._unloaded$).subscribe(()=>{u.next(),u.complete()}),u}_subscribeService(){var u=this;const v=this.diagramEventHandlerController.subscribeServerChanges();return v.push(this.service.error$.pipe((0,B.takeUntil)(this.destroyed$),(0,B.debounceTime)(1e3)).subscribe(function(){var w=(0,s.A)(function*(b){yield u.notifyService.error({message:b});const g=u.diagramDataService.getDiagramDataId();u.loggerService.exception(b,{loggerName:"DiagramService"},{diagramDataId:g})});return function(b){return w.apply(this,arguments)}}()),this.service.updateCaption$.subscribe(w=>this._changeCaption(w))),v}_unsubscribeService(){this._serviceSubscriptions&&this._serviceSubscriptions.forEach(u=>u.unsubscribe())}unloadDiagramData(){this.diagram&&(this.get("directEditing").complete(),this._clearDiagram())}initDiagramData(u){var v=this;return(0,s.A)(function*(){v._initLocalStorage(),v._initZoomScroll(),v.diagramEventHandlerController.stopSync(),v.unloadDiagramData();const w=yield v._diagramLoader.load(v.diagramDataService.data,u,v.loadProgress$);if(u.isStopped)return;const b=w&&w[0];b&&(yield v.notifyService.show({message:b})),v.diagramEventHandlerController.startSync()})()}_changeCaption(u){this.caption=u.value}_initLocalStorage(){const u=this.get("localStorage");u.diagramId=this.diagramDataService.getDiagramDataId()}_initZoomScroll(){this.get("zoomScroll").initZoomScroll()}_subscribeDiagramChanges(){const u=this.get("eventBus");u.on(["create.end","connect.end","element.click","shape.move.end"],v=>{this._onSelectedElementChanged(v.element||v.context.shape||v.context.connection)}),u.on(["shape.replaced"],v=>M.defer(()=>this._onSelectedElementChanged(v))),u.on(["selection.changed"],v=>{const w=v.newSelection,b=w.length===1&&w[0];b&&!this.loading&&this._onSelectedElementChanged(b)}),u.on(["tool-manager.update"],v=>this._onToolChanged(v.tool)),u.on(["element.dblclick"],()=>this._elementDblClick())}_elementDblClick(){this.elementDblClick.emit()}_onSelectedElementChanged(u){let v=null;const w={source:this,id:v};u&&u.type!==d.Roots.root.type&&(v=(u.labelTarget||u).id,w.id=v),this.elementSelected.emit(w),this.get("eventBus").fire("diagram.item.selected",{id:v})}_onToolChanged(u){this.tool=u||this._defaultTool}_getLocalizationObject(u){return{get:v=>{const w=v.split(".");let b=u;for(const g of w){if(!b||!b.hasOwnProperty(g))return v;b=b[g]}return b??v}}}_getDiagramLocalizableStrings(u){var v=this;return(0,s.A)(function*(){const w=v.translateService,b=w.getDefaultLang(),g=w.currentLang;let J,z;b===g?z=w.translations[g]?(0,f.of)({...w.translations[g],...w.translations[g]?.diagram}):w.getTranslation(g).pipe((0,B.map)(({diagram:re})=>re)):(J=w.translations?(0,f.zip)((0,f.of)(w.translations[b]),(0,f.of)(w.translations[g])):(0,f.zip)(w.getTranslation(b),w.getTranslation(g)),z=J.pipe((0,B.map)(([re,ce])=>M.merge(re?.diagram,ce?.diagram))));const q=yield(0,f.lastValueFrom)(z.pipe((0,B.first)()),{defaultValue:null});return v._getLocalizationObject({...q,...u})})()}_reloadDiagram(){var u=this;return(0,s.A)(function*(){const v=yield u._getDiagramConfig();u.diagramDataService.hasDiagramData()&&u._clearDiagram(),u._destroyDiagram(),u._unsubscribeService(),u._initDiagram(v),u._subscribeLoadingData(),u._subscribeDiagramChanges(),u.diagramDataService.hasDiagramData()&&(yield u.initDiagramData(u._getCancellationToken()))})()}_clearDiagram(){this.diagramEventHandlerController.stopSync(),this.diagram.clear()}_destroyDiagram(){this.diagram&&(this.get("eventBus").fire("detach",{}),this.diagram.destroy())}_getDiagramConfig(){var u=this;return(0,s.A)(function*(){const v=yield u.service.getDiagramConfig();return{localizableStrings:yield u._getDiagramLocalizableStrings(v&&v.customLocalizableStrings),...v}})()}injectDependencies(){this.diagramDataService=this.injector.get(j.B6),this.service=this.injector.get(j.K$),this.translateService=this.injector.get(D.TranslateService),this.notifyService=this.injector.get(S.NotifyService),this.featureService=this.injector.get(V.x),this.loggerService=this.injector.get(R.LoggerService),this.features=this.injector.get(oe.o)}loadDiagramData(u){var v=this;return(0,s.A)(function*(){const w=v._getCancellationToken();if(!(v.destroyed$.isStopped||v._unloaded$.isStopped))if(v.diagramDataService.data=u,v.diagramDataService.hasDiagramData()){if(yield v.initDiagramData(w),w.isStopped)return;v.caption=v.diagramDataService.getDiagramDataCaption(),v.loading=!1,v.loaded.next(u.id),v._setSelectedElement(v.elementSelect)}else{v.loading=!1;const b=`Error. Diagram with id = "${u.id}" does not exists`;v.loaded.error(b)}})()}ngOnInit(){this.translateService.onLangChange.pipe((0,B.takeUntil)(this.destroyed$)).subscribe(()=>{this.loading?this.service.endLoading$.pipe((0,B.first)()).subscribe(()=>this._reloadDiagram()):this._reloadDiagram()})}ngAfterViewInit(){var u=this;return(0,s.A)(function*(){const v=yield u._getDiagramConfig();u._initDiagram(v),u._subscribeLoadingData(),u._subscribeDiagramChanges(),u._initZoomScroll(),u.afterViewInit.emit()})()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this._unsubscribeService(),this.diagramDataService.hasDiagramData()&&this.unloadDiagramData(),this._destroyDiagram()}get(u){return this.diagram.get(u)}onHandClick(){this.get("toolManager").setActive(null),this.get("dragging").cancel()}onLassoClick(){this.get("lassoTool").toggle()}onSpaceClick(){this.get("spaceTool").toggle()}onUndoClick(){this.service.undo()}onRedoClick(){this.service.redo()}update(u){this.modeling.updateLabel(u.id,u.value)}static{this.\u0275fac=function(v){return new(v||N)(o.\u0275\u0275directiveInject(o.Injector))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:N,selectors:[["ts-app-diagram"]],viewQuery:function(v,w){if(v&1&&(o.\u0275\u0275viewQuery(Q,7,o.ElementRef),o.\u0275\u0275viewQuery(Ne,7,o.ElementRef)),v&2){let b;o.\u0275\u0275queryRefresh(b=o.\u0275\u0275loadQuery())&&(w.diagramContainer=b.first),o.\u0275\u0275queryRefresh(b=o.\u0275\u0275loadQuery())&&(w.resetZoomButton=b.first)}},hostVars:1,hostBindings:function(v,w){v&2&&o.\u0275\u0275attribute("data-qa",w.caption)},inputs:{_isReadOnly:[o.\u0275\u0275InputFlags.None,"readonly","_isReadOnly"],_isStraightConnection:[o.\u0275\u0275InputFlags.None,"straightconnection","_isStraightConnection"],_isRtl:[o.\u0275\u0275InputFlags.None,"dir","_isRtl"],elementSelect:"elementSelect"},outputs:{elementDblClick:"elementDblClick",elementSelected:"elementSelected",diagramInitialized:"diagramInitialized",afterViewInit:"afterViewInit"},decls:2,vars:0,consts:[["diagramContainer",""],[1,"diagram-container"]],template:function(v,w){v&1&&o.\u0275\u0275element(0,"div",1,0)},styles:[`.diagram-container{position:relative;height:100%;width:100%;margin:0}.diagram-container svg{display:block}.djs-container{direction:ltr}.djs-tooltip{border-radius:4px;padding:8px;width:150px;opacity:.9;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:1010}.djs-palette{left:10px;top:10px;border-radius:4px;overflow:hidden;padding-top:6px;padding-bottom:6px}.djs-palette.open,.djs-palette.two-column.open{width:46px}.djs-palette .group{padding:0!important;width:100%}.djs-palette .entry{width:32px;height:32px;line-height:32px;margin-left:6px;cursor:pointer}.djs-palette .entry.active{border-radius:7px}.djs-palette .entry.create-menu:after{content:"";position:absolute;width:0;height:0;border-top:3px solid transparent;border-bottom:3px solid transparent;border-left:3px solid #006ce0;margin-top:13px;margin-left:-4px}.djs-context-pad.open{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;border-radius:4px;pointer-events:auto}.djs-context-pad.open .group{display:grid;grid-template-columns:auto auto;padding:3px}.djs-context-pad.open .group:not(:first-child){padding-left:0}.djs-context-pad.open.one-column-grid .group{grid-template-columns:auto}.djs-context-pad.open .entry{height:32px;width:32px;background:transparent;margin:0;box-shadow:none;border-radius:3px}.djs-context-pad.open .entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}.djs-context-pad.open .entry.noop-entry:hover{background:inherit!important}.djs-context-pad.open .entry img{padding:4px}.entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}@supports ((-webkit-backdrop-filter: none) or (backdrop-filter: none)){.djs-context-pad.open{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:#ffffffc7}.djs-context-pad.open .entry{background:transparent}}.djs-context-pad{max-width:72px}.djs-element.djs-connection.djs-updating path,.djs-element.djs-connection.selected path,.djs-element.djs-connection.animated path{stroke:#1186d8!important}.djs-element.djs-connection.djs-updating path.connection-end-marker,.djs-element.djs-connection.selected path.connection-end-marker,.djs-element.djs-connection.animated path.connection-end-marker{fill:#1186d8!important}.djs-element.djs-connection.animated path.connection{stroke-width:3!important;stroke-dasharray:20,3;animation:dash 5s linear infinite}@keyframes dash{0%{stroke-dashoffset:115}}.djs-bendpoint .djs-visual{fill:#fff;stroke-width:1px;stroke:#1186d8}.djs-bendpoint.floating .djs-visual{display:none}.djs-bendpoints.hover .djs-visual{stroke:#8095b3}.djs-element.hover .djs-outline{stroke:#a7c6ff}.laneSet.hover .djs-visual,.lane.hover .djs-visual{opacity:initial}.djs-element.selected .djs-outline{stroke:#3168cc}.djs-segment-dragger .djs-visual{fill:transparent;stroke:transparent}.djs-snap-line{stroke-width:1px}.djs-popup{overflow-y:auto;overflow-x:hidden;max-height:calc(100% - 20px);opacity:0;transition:opacity .2s ease-out}.djs-popup .entry{display:flex;flex-direction:row-reverse;justify-content:flex-end;align-items:stretch;padding:5px 7px}.djs-popup .entry img{height:24px;width:24px}.djs-popup .djs-popup-header{display:flex;margin:0 9px}.djs-popup .djs-popup-header .entry.active{border:none}.djs-popup .djs-popup-header .entry:first-child{margin-left:0}.djs-popup .djs-popup-header .entry{height:34px;width:34px;padding:4px;margin:2px 1px 2px 4px}.djs-dragger .djs-visual rect{fill:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border){display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;pointer-events:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border) .djs-direct-editing-content{margin:0 auto;pointer-events:auto;text-align:center}.djs-direct-editing-content{-webkit-user-select:text!important;user-select:text!important;overflow:hidden;outline:none;resize:none}.djs-direct-editing-parent-no-border .djs-direct-editing-content{border:0}.djs-direct-editing-rotate-90{transform:rotate(-90deg);transition:transform .1s ease}.djs-direct-editing-rotate-90 .djs-direct-editing-content{border:none;transition:border .1s ease}.djs-direct-editing-rotate-0{transform:rotate(0)}.djs-text-hidden text{display:none}.djs-text-hidden foreignObject{display:none}.djs-direct-editing-resize-handle{display:none}.djs-shape.connect-ok.textAnnotation .djs-visual>:nth-child(1):not(path),.djs-shape.connect-not-ok.textAnnotation .djs-visual>:nth-child(1):not(path){fill:inherit!important}.djs-element.lane.hover:not(.selected) .djs-outline{stroke:none}.djs-element.laneSet.hover:not(.selected) .djs-outline{stroke:none}foreignObject.djs-label{overflow:visible}.foreign-text-container{display:flex;justify-content:center;height:100%}.laneSet .foreign-text-container,.lane .foreign-text-container{align-items:center}.eventSubProcessExpanded .foreign-text-container{height:initial;padding:5px}.foreign-text{text-align:center;box-sizing:border-box;outline:none;font-family:Open Sans,sans-serif;font-size:12px;font-weight:400;line-height:1.2;overflow-wrap:break-word;white-space:pre-line}.label .foreign-text{max-width:130px;-webkit-user-select:text;user-select:text}.textAnnotation .foreign-text{padding:12px;max-width:none;text-align:left;line-height:1.41667;word-wrap:break-word}.textAnnotation foreignObject{height:100%}.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}@supports (-webkit-line-clamp: 2){.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{vertical-align:center;overflow:hidden;text-overflow:ellipsis;white-space:initial;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}.foreign-text-helper{max-width:128px;min-height:14.39px;width:-moz-fit-content;width:fit-content;margin:0 auto;overflow-wrap:break-word}.diagram-create-popup-menu{border-top:none!important}.diagram-create-popup-menu .entry{cursor:move}.djs-minimap{position:absolute;right:8px;bottom:11px;width:248px;height:33px;border-radius:4px;opacity:1;overflow:hidden;box-sizing:border-box;-webkit-user-select:none;user-select:none;transition:height .2s cubic-bezier(0,0,.2,1)}.djs-minimap .map-buttons{position:absolute;bottom:0;left:0;right:0;height:32px;display:flex;padding:0 5px;z-index:1}.djs-minimap .map-buttons .map-button{min-width:32px;height:32px;cursor:pointer;line-height:32px;font-size:16px;padding:0 8px;background-position:center;transition:background .8s}.djs-minimap .map-buttons .map-button:active{background-size:100%;transition:background 0s}.djs-minimap .map-buttons .map-button.preview-button{padding:0 12px 0 10px;margin:0 4px 0 0;min-width:40px}.djs-minimap .map-buttons .map-button.zoom-button{width:100%;height:100%;padding:0 16px 0 0;text-align:right}.djs-minimap .map-buttons .map-button.zoom-button:after{content:"";position:absolute;width:0;height:0;right:9px;top:16px}.djs-minimap .map{width:248px;height:148px;margin-bottom:32px;cursor:crosshair}.djs-minimap.open{transition:height .2s cubic-bezier(.18,.89,.32,1.28);height:180px}.djs-minimap.open .overlay{position:absolute;inset:0;pointer-events:none}.djs-minimap .viewport{fill:none;stroke:none}.djs-minimap .viewport-dom{position:absolute;border-radius:2px;box-sizing:border-box;cursor:move}.djs-minimap .cursor-crosshair{cursor:crosshair}.djs-minimap .cursor-move{cursor:move}.djs-popup.zoom{right:8px;bottom:47px;top:inherit!important;left:inherit!important}.djs-popup.zoom .entry{display:flex;flex-direction:row;justify-content:space-between;align-items:stretch}.djs-popup.zoom .entry.entry-separator{padding:0!important;margin:4px 10px!important}#canvas_svg_export{position:absolute;left:50px;top:50px;box-shadow:0 0 9px 2px #0000007a}#canvas_svg_export .close-button{position:absolute;right:8px;width:16px;height:16px;cursor:pointer}
`,`.djs-outline{fill:none;visibility:hidden}.djs-element.hover .djs-outline,.djs-element.selected .djs-outline{visibility:visible;shape-rendering:crispEdges;stroke-dasharray:3,3}.djs-element.selected .djs-outline{stroke:#88f;stroke-width:1px}.djs-element.hover .djs-outline{stroke:#f88;stroke-width:1px}svg.drop-not-ok{background:#f9dee5!important}.djs-connection.connect-ok .djs-visual>:nth-child(1),.djs-connection.drop-ok .djs-visual>:nth-child(1){stroke:#90dd5f!important}.djs-connection.connect-not-ok .djs-visual>:nth-child(1),.djs-connection.drop-not-ok .djs-visual>:nth-child(1){stroke:#e56283!important}.drop-not-ok,.connect-not-ok{cursor:not-allowed}.djs-element.attach-ok .djs-visual>:nth-child(1){stroke-width:5px!important;stroke:#ff7400b3!important}.djs-frame.connect-not-ok .djs-visual>:nth-child(1),.djs-frame.drop-not-ok .djs-visual>:nth-child(1){stroke-width:3px!important;stroke:#e56283!important;fill:none!important}.djs-lasso-overlay{fill:#ff7400;fill-opacity:.1;stroke-dasharray:5 1 3 1;stroke:#ff7400;shape-rendering:crispEdges;pointer-events:none}.djs-resize-overlay{fill:none;stroke-dasharray:5 1 3 1;stroke:#ff7400;pointer-events:none}.djs-resizer-hit{fill:none;pointer-events:all}.djs-resizer-visual{fill:#fff;stroke-width:1px;stroke:#000;shape-rendering:crispEdges;stroke-opacity:.2}.djs-cursor-resize-ns,.djs-resizer-n,.djs-resizer-s{cursor:ns-resize}.djs-cursor-resize-ew,.djs-resizer-e,.djs-resizer-w{cursor:ew-resize}.djs-cursor-resize-nwse,.djs-resizer-nw,.djs-resizer-se{cursor:nwse-resize}.djs-cursor-resize-nesw,.djs-resizer-ne,.djs-resizer-sw{cursor:nesw-resize}.djs-shape.djs-resizing>.djs-outline{visibility:hidden!important}.djs-shape.djs-resizing>.djs-resizer{visibility:hidden}.djs-dragger>.djs-resizer{visibility:hidden}marker.djs-dragger circle,marker.djs-dragger path,marker.djs-dragger polygon,marker.djs-dragger polyline,marker.djs-dragger rect{fill:#ff7400!important;stroke:none!important}marker.djs-dragger text,marker.djs-dragger tspan{fill:none!important;stroke:#ff7400!important}.djs-dragging{opacity:.3}.djs-dragging,.djs-dragging>*{pointer-events:none!important}.djs-dragging .djs-context-pad,.djs-dragging .djs-outline{display:none!important}.djs-visual,.djs-outline{pointer-events:none}.djs-element.attach-ok .djs-hit{stroke-width:60px!important}.djs-element>.djs-hit-all{pointer-events:all}.djs-element>.djs-hit-stroke,.djs-element>.djs-hit-click-stroke{pointer-events:stroke}.djs-drag-active .djs-element>.djs-hit-click-stroke{pointer-events:all}.djs-connection .djs-visual{stroke-width:2px;fill:none}.djs-cursor-grab{cursor:grab}.djs-cursor-grabbing{cursor:grabbing}.djs-cursor-crosshair{cursor:crosshair}.djs-cursor-move{cursor:move}.djs-cursor-resize-ns{cursor:ns-resize}.djs-cursor-resize-ew{cursor:ew-resize}.djs-snap-line{stroke:#ffc342;stroke:#ffc34280;stroke-linecap:round;stroke-width:2px;pointer-events:none}.djs-crosshair{stroke:#555;stroke-linecap:round;stroke-width:1px;pointer-events:none;shape-rendering:crispEdges;stroke-dasharray:5,5}.djs-palette{position:absolute;left:20px;top:20px;box-sizing:border-box;width:48px}.djs-palette .separator{margin:0 5px;padding-top:5px;border:none;border-bottom:solid 1px #DDD;clear:both}.djs-palette .entry:before{vertical-align:text-bottom}.djs-palette .djs-palette-toggle{cursor:pointer}.djs-palette .entry,.djs-palette .djs-palette-toggle{color:#333;font-size:30px;text-align:center}.djs-palette .entry{float:left}.djs-palette .entry img{max-width:100%}.djs-palette .djs-palette-entries:after{content:"";display:table;clear:both}.djs-palette .djs-palette-toggle:hover{background:#666}.djs-palette .entry:hover{color:#ff7400}.djs-palette .highlighted-entry{color:#ff7400!important}.djs-palette .entry,.djs-palette .djs-palette-toggle{width:46px;height:46px;line-height:46px;cursor:default}.djs-palette.two-column.open{width:94px}.djs-palette:not(.open) .djs-palette-entries{display:none}.djs-palette:not(.open){overflow:hidden}.djs-palette.open .djs-palette-toggle{display:none}.djs-overlay-context-pad{width:72px}.djs-context-pad{position:absolute;display:none;pointer-events:none}.djs-context-pad .entry{width:22px;height:22px;text-align:center;display:inline-block;font-size:22px;margin:0 2px 2px 0;border-radius:3px;cursor:default;background-color:#fefefe;box-shadow:0 0 2px 1px #fefefe;pointer-events:all}.djs-context-pad .entry:before{vertical-align:top}.djs-context-pad .entry:hover{background:#fffcb0}.djs-context-pad.open{display:block}.djs-popup .entry{line-height:20px;white-space:nowrap;cursor:default}.djs-popup .entry:before{vertical-align:middle;font-size:20px}.djs-popup .entry>span{vertical-align:middle;font-size:14px}.djs-popup .entry:hover,.djs-popup .entry.active:hover{background:#fffcb0}.djs-popup .entry.disabled{background:inherit}.djs-popup .djs-popup-header .entry{display:inline-block;padding:2px 3px;border:solid 1px transparent;border-radius:3px}.djs-popup .djs-popup-header .entry.active{color:#ff7400;border:solid 1px rgb(255,116,0);background-color:#f6f6f6}.djs-popup-body .entry{padding:4px 10px 4px 5px}.djs-popup-body .entry>span{margin-left:5px}.djs-popup-body{background-color:#fefefe}.djs-popup-header{border-bottom:1px solid #DDD}.djs-popup-header .entry{margin:1px 1px 1px 3px}.djs-popup-header .entry:last-child{margin-right:3px}.djs-popup,.djs-palette{background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-shape,.djs-connection{touch-action:none}.djs-segment-dragger,.djs-bendpoint{display:none}.djs-segment-dragger .djs-visual{fill:#ffff7933;stroke-width:1px;stroke-opacity:1;stroke:#ffff794d}.djs-bendpoint .djs-visual{fill:#ffff79cc;stroke-width:1px;stroke-opacity:.5;stroke:#000}.djs-segment-dragger:hover,.djs-bendpoints.hover .djs-segment-dragger,.djs-bendpoints.selected .djs-segment-dragger,.djs-bendpoint:hover,.djs-bendpoints.hover .djs-bendpoint,.djs-bendpoints.selected .djs-bendpoint{display:block}.djs-drag-active .djs-bendpoints *{display:none}.djs-bendpoints:not(.hover) .floating{display:none}.djs-segment-dragger:hover .djs-visual,.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint:hover .djs-visual,.djs-bendpoint.floating .djs-visual{fill:#ff0;stroke-opacity:.5;stroke:#000}.djs-bendpoint.floating .djs-hit{pointer-events:none}.djs-segment-dragger .djs-hit,.djs-bendpoint .djs-hit{pointer-events:all;fill:none}.djs-segment-dragger.horizontal .djs-hit{cursor:ns-resize}.djs-segment-dragger.vertical .djs-hit{cursor:ew-resize}.djs-segment-dragger.djs-dragging .djs-hit{pointer-events:none}.djs-updating,.djs-updating>*{pointer-events:none!important}.djs-updating .djs-context-pad,.djs-updating .djs-outline,.djs-updating .djs-bendpoint,.connect-ok .djs-bendpoint,.connect-not-ok .djs-bendpoint,.drop-ok .djs-bendpoint,.drop-not-ok .djs-bendpoint{display:none!important}.djs-segment-dragger.djs-dragging,.djs-bendpoint.djs-dragging{display:block;opacity:1}.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint.djs-dragging .djs-visual{fill:#ff0;stroke-opacity:.5}.djs-tooltip-error{font-size:11px;line-height:18px;text-align:left;padding:5px;opacity:.7}.djs-tooltip-error>*{width:160px;background:#fcecf0;color:#9e4c4c;padding:3px 7px;border-radius:5px;border-left:solid 5px rgb(174,73,73)}.djs-tooltip-error:hover{opacity:1}.djs-search-container{position:absolute;top:20px;left:0;right:0;margin-left:auto;margin-right:auto;width:25%;min-width:300px;max-width:400px;z-index:10;font-size:1.05em;opacity:.9;background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-search-container:not(.open){display:none}.djs-search-input input{font-size:1.05em;width:100%;padding:6px 10px;border:1px solid #ccc}.djs-search-input input:focus{outline:none;border-color:#52b415}.djs-search-results{position:relative;overflow-y:auto;max-height:200px}.djs-search-results:hover{cursor:pointer}.djs-search-result{width:100%;padding:6px 10px;background:#fff;border-bottom:solid 1px #AAA;border-radius:1px}.djs-search-highlight{color:#000}.djs-search-result-primary{margin:0 0 10px}.djs-search-result-secondary{font-family:monospace;margin:0}.djs-search-result:hover{background:#fdffd6}.djs-search-result-selected{background:#fffcb0}.djs-search-result-selected:hover{background:#f7f388}.djs-search-overlay{background:#ff0;opacity:.3}.djs-element-hidden,.djs-element-hidden .djs-hit,.djs-element-hidden .djs-outline,.djs-label-hidden .djs-label{display:none!important}
`],encapsulation:2})}}},46203:(A,P,l)=>{l.d(P,{R:()=>s.R});var s=l(7319)},29766:(A,P,l)=>{l.d(P,{O:()=>F});var s=l(40297),o=l.n(s),_=l(79772),D=l.n(_),C=l(59564),S=l.n(C),y=l(96590),d=l.n(y),m=l(7319),R=l(45971),O=l(7371),M=l(44777),L=l(5440),k=l(59131),f=l.n(k);class F{static{this.\u0275fac=function(V){return new(V||F)}}static{this.\u0275mod=k.\u0275\u0275defineNgModule({type:F})}static{this.\u0275inj=k.\u0275\u0275defineInjector({providers:[L.K$,O.x,{provide:M.o,useValue:R.jF},y.LoggerService],imports:[s.CommonModule,_.TranslateModule.forChild(),C.NotifyModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&k.\u0275\u0275setNgModuleScope(F,{declarations:[m.R],imports:[s.CommonModule,_.TranslateModule,C.NotifyModule],exports:[m.R]})})()},87828:(A,P,l)=>{l.d(P,{g4:()=>s,Fx:()=>D,nS:()=>o,GS:()=>_.G});const s={Add:"add",Remove:"remove",Update:"update"},o={MIN:100,LOW:500,MEDIUM:1e3,HIGH:1500,MAX:5e3};var _=l(4217),D;(function(C){C.Connection="connection",C.ConnectionEndMarker="connection-end-marker"})(D||(D={}))},4217:(A,P,l)=>{l.d(P,{G:()=>s});const s={Backspace:{code:"Backspace",keyCode:8},Tab:{code:"Tab",keyCode:9},Enter:{code:"Enter",keyCode:13},NumpadEnter:{code:"NumpadEnter",keyCode:13},Escape:{code:"Escape",keyCode:27},Space:{code:"Space",keyCode:32},PageUp:{code:"PageUp",keyCode:33},PageDown:{code:"PageDown",keyCode:34},End:{code:"End",keyCode:35},Home:{code:"Home",keyCode:36},ArrowLeft:{code:"ArrowLeft",keyCode:37},ArrowUp:{code:"ArrowUp",keyCode:38},ArrowRight:{code:"ArrowRight",keyCode:39},ArrowDown:{code:"ArrowDown",keyCode:40},Insert:{code:"Insert",keyCode:45},Delete:{code:"Delete",keyCode:46},ShiftLeft:{code:"ShiftLeft",keyCode:16},ShiftRight:{code:"ShiftRight",keyCode:16},ControlLeft:{code:"ControlLeft",keyCode:17},ControlRight:{code:"ControlRight",keyCode:17},AltLeft:{code:"AltLeft",keyCode:18},AltRight:{code:"AltRight",keyCode:18},CapsLock:{code:"CapsLock",keyCode:20},OSLeft:{code:"OSLeft",keyCode:91},OSRight:{code:"OSRight",keyCode:92},Digit0:{code:"Digit0",keyCode:48},Digit1:{code:"Digit1",keyCode:49},Digit2:{code:"Digit2",keyCode:50},Digit3:{code:"Digit3",keyCode:51},Digit4:{code:"Digit4",keyCode:52},Digit5:{code:"Digit5",keyCode:53},Digit6:{code:"Digit6",keyCode:54},Digit7:{code:"Digit7",keyCode:55},Digit8:{code:"Digit8",keyCode:56},Digit9:{code:"Digit9",keyCode:57},KeyA:{code:"KeyA",keyCode:65},KeyB:{code:"KeyB",keyCode:66},KeyC:{code:"KeyC",keyCode:67},KeyD:{code:"KeyD",keyCode:68},KeyE:{code:"KeyE",keyCode:69},KeyF:{code:"KeyF",keyCode:70},KeyG:{code:"KeyG",keyCode:71},KeyH:{code:"KeyH",keyCode:72},KeyI:{code:"KeyI",keyCode:73},KeyJ:{code:"KeyJ",keyCode:74},KeyK:{code:"KeyK",keyCode:75},KeyL:{code:"KeyL",keyCode:76},KeyM:{code:"KeyM",keyCode:77},KeyN:{code:"KeyN",keyCode:78},KeyO:{code:"KeyO",keyCode:79},KeyP:{code:"KeyP",keyCode:80},KeyQ:{code:"KeyQ",keyCode:81},KeyR:{code:"KeyR",keyCode:82},KeyS:{code:"KeyS",keyCode:83},KeyT:{code:"KeyT",keyCode:84},KeyU:{code:"KeyU",keyCode:85},KeyV:{code:"KeyV",keyCode:86},KeyW:{code:"KeyW",keyCode:87},KeyX:{code:"KeyX",keyCode:88},KeyY:{code:"KeyY",keyCode:89},KeyZ:{code:"KeyZ",keyCode:90},NumpadMultiply:{code:"NumpadMultiply",keyCode:106},NumpadAdd:{code:"NumpadAdd",keyCode:107},NumpadDecimal:{code:"NumpadDecimal",keyCode:108},NumpadSubtract:{code:"NumpadSubtract",keyCode:109},NumpadDivide:{code:"NumpadDivide",keyCode:111},F1:{code:"F1",keyCode:112},F2:{code:"F2",keyCode:113},F3:{code:"F3",keyCode:114},F4:{code:"F4",keyCode:115},F5:{code:"F5",keyCode:116},F6:{code:"F6",keyCode:117},F7:{code:"F7",keyCode:118},F8:{code:"F8",keyCode:119},F9:{code:"F9",keyCode:120},F10:{code:"F10",keyCode:121},F11:{code:"F11",keyCode:122},F12:{code:"F12",keyCode:123},F13:{code:"F13",keyCode:124},F14:{code:"F14",keyCode:125},F15:{code:"F15",keyCode:126},F16:{code:"F16",keyCode:127},F17:{code:"F17",keyCode:128},F18:{code:"F18",keyCode:129},F19:{code:"F19",keyCode:130},F20:{code:"F20",keyCode:131},F21:{code:"F21",keyCode:132},F22:{code:"F22",keyCode:133},F23:{code:"F23",keyCode:134},F24:{code:"F24",keyCode:135},NumLock:{code:"NumLock",keyCode:144},Semicolon:{code:"Semicolon",keyCode:186},Equal:{code:"Equal",keyCode:187},Comma:{code:"Comma",keyCode:188},Minus:{code:"Minus",keyCode:189},Period:{code:"Period",keyCode:190},Slash:{code:"Slash",keyCode:191},Backquote:{code:"Backquote",keyCode:192},IntlRo:{code:"IntlRo",keyCode:193},BracketLeft:{code:"BracketLeft",keyCode:219},Backslash:{code:"Backslash",keyCode:220},BracketRight:{code:"BracketRight",keyCode:221},Quote:{code:"Quote",keyCode:222},IntlYen:{code:"IntlYen",keyCode:255}}},7371:(A,P,l)=>{l.d(P,{x:()=>C});var s=l(62278),o=l.n(s),_=l(59131),D=l.n(_);class C{getFeatureValues(y){return(0,s.of)([]).subscribe(()=>y({}))}static{this.\u0275fac=function(d){return new(d||C)}}static{this.\u0275prov=_.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac})}}},44777:(A,P,l)=>{l.d(P,{o:()=>_});var s=l(59131),o=l.n(s);const _=new s.InjectionToken("DiagramFeaturesToken")},45971:(A,P,l)=>{l.d(P,{rY:()=>yn,q8:()=>fn,iW:()=>S,Ng:()=>R,EI:()=>Xe,Hq:()=>tt,xi:()=>O.x,LZ:()=>L,F2:()=>B,Qj:()=>Y,xt:()=>Qe,rk:()=>it,ij:()=>V,gK:()=>Q,E7:()=>Pn,X3:()=>N,EY:()=>Ue,k3:()=>Mt,OZ:()=>u,GT:()=>de,QS:()=>be,wA:()=>_e,lY:()=>ye,WQ:()=>ue,RX:()=>ee,jt:()=>me,WD:()=>xe,cf:()=>ct,cD:()=>Tt,XP:()=>Ce,rm:()=>je,jF:()=>ni,oE:()=>wn.o,cl:()=>pt,Yj:()=>Le,QM:()=>Rt,F3:()=>Be,IO:()=>Ee,xk:()=>De,S1:()=>X,vh:()=>H,Kp:()=>ve,h1:()=>Ye,mQ:()=>We,vf:()=>Oe,Cc:()=>Pe,kH:()=>Ie,HE:()=>Me,bF:()=>mt,jB:()=>le,br:()=>ge,q6:()=>In,vy:()=>ie,YY:()=>Fe,Ov:()=>fe,Q8:()=>Ct,s0:()=>It,KP:()=>z,TN:()=>st,Ce:()=>ze,Wq:()=>Ae,JP:()=>ft,Ae:()=>He,MZ:()=>Ot,Ci:()=>Pt,o9:()=>wt,Y3:()=>Ke,Uf:()=>we,ZY:()=>se,tn:()=>ne,JL:()=>Je,kh:()=>kt,cI:()=>he,TH:()=>Ve,Ve:()=>mn,or:()=>Mn,P_:()=>ke,X5:()=>vn,aK:()=>bn,fI:()=>yt,sc:()=>q,ZP:()=>te,Ot:()=>gt,jX:()=>ht,m0:()=>W,TW:()=>dt});var s=l(5960),o=l(15534),_=l(96590),D=l(43537),C=l(11177);let S=class extends D.A{constructor(e,t){super(e),this.isReadOnly=!1,this.isReadOnly=t.isReadOnly}canConnect(e,t){return e.type!==o.DiagramElementType.root&&e.type!==o.DiagramElementType.connection&&t.type!==o.DiagramElementType.root&&t.type!==o.DiagramElementType.connection}addRule(e,t){super.addRule(e,t)}init(){super.addRule("connection.create",this.canConnectionCreate.bind(this)),super.addRule("connection.reconnect",this.canReconnect.bind(this)),super.addRule("elements.move",this.canElementMove.bind(this)),super.addRule("shape.create",this.canElementMove.bind(this)),super.addRule("elements.create",this.canElementMove.bind(this)),super.addRule("shape.resize",this.canElementResize.bind(this)),super.addRule("element.copy",this.canElementCopy.bind(this)),super.addRule("element.paste",this.canElementPaste.bind(this)),super.addRule("elements.delete",this.canElementsDelete.bind(this)),super.addRule("canOpenContextPad",this.canOpenContextPad.bind(this)),super.addRule("canShowConnectionOutline",this.canShowConnectionOutline.bind(this)),super.addRule("canConnectionSegmentMove",this.canConnectionSegmentMove.bind(this)),super.addRule("canLabelEdit",this.canLabelEdit.bind(this)),super.addRule("canShowPalette",this.canShowPalette.bind(this)),super.addRule("canShowLabelOutline",this.canShowLabelOutline.bind(this)),super.addRule("canElementMarkerUpdate",this.canElementMarkerUpdate.bind(this)),super.addRule("element.canUpdateType",this.canElementUpdateType.bind(this)),super.addRule("connection.updateWaypoints",this.canConnectionUpdateWaypoints.bind(this))}canElementMarkerUpdate(){return!0}canShowLabelOutline(){return!0}canConnectionSegmentMove(){return!0}canShowPalette(){return!0}canLabelEdit(){return!0}canShowConnectionOutline(){return!0}canOpenContextPad(){return!0}canConnectionCreate(e){return this.canConnect(e.target,e.source)}canReconnect(e){if(o.DiagramUtils.isRoot(e.target)||o.DiagramUtils.isRoot(e.source))return!1;switch(e.type){case"reconnectEnd":return this.canReconnectEnd(e);case"reconnectStart":return this.canReconnectStart(e);default:return this.canReconnectEnd(e)||this.canReconnectStart(e)}}canReconnectStart(e){return this.canConnect(e.target,e.source)}canReconnectEnd(e){return this.canConnect(e.target,e.source)}canElementMove(e){return!0}canElementResize(e){return!1}canElementCopy(e){return!0}canElementPaste(e){return!0}canElementsDelete(e){return!0}canElementUpdateType(e){return!0}canConnectionUpdateWaypoints(){return!1}};(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementMarkerUpdate",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canConnectionSegmentMove",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canShowPalette",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canLabelEdit",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canShowConnectionOutline",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canOpenContextPad",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canConnectionCreate",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",Boolean)],S.prototype,"canReconnect",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementMove",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementResize",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementCopy",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementPaste",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementsDelete",null),(0,s.__decorate)([(0,C.P)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementUpdateType",null),S=(0,s.__decorate)([(0,s.__param)(0,(0,_.Inject)("eventBus")),(0,s.__param)(1,(0,_.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object])],S);var y=l(17521),d=l(97317),m=l(87828);let R=class extends d.A{constructor(e,t,n){super(t),this.eventBus=e,this.canvas=t,this.diagramUtils=n,this._subscribeEvents()}_subscribeEvents(){this.eventBus.on([o.Handlers.connect.move,o.Handlers.connect.hover,o.Handlers.connect.end],m.nS.HIGH,e=>{this.onSnapping(e)})}canSetSnapping(e){const{source:t,target:n}=e;return n&&t&&!o.DiagramUtils.isRoot(n)&&!o.DiagramUtils.isRoot(t)&&!this.diagramUtils.isConnection(t)&&!this.diagramUtils.isConnection(n)&&!o.DiagramUtils.isLabel(t)&&!o.DiagramUtils.isLabel(n)}onSnapping(e){const t=e.context;this.canSetSnapping(t)&&this.setSnapping(e)}snapEvent(e,t){(0,y.CU)(e,"x",t.x),(0,y.CU)(e,"y",t.y)}};R=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,o.DiagramUtils])],R);var O=l(7371),M=l(81493);let L=class extends M.A{constructor(e,t,n){super(e,t),this.canvas=e,this.modeling=t,this.diagramUtils=n}createSingleCrossConnection(e,t){const n=e.source,i=t.target;if(n.outgoing.some(c=>c.target.id===i.id)||n.incoming.some(c=>c.source.id===i.id)||i.incoming.some(c=>c.source.id===n.id)||i.outgoing.some(c=>c.target.id===n.id)||i.outgoing.some(c=>c.source.id===n.id))return;const r=(0,y.jz)(i);this.modeling.reconnectEnd(e,i,r,{isUpdateConnectionType:!1})}createMultipleCrossConnections(e){const t=e.shape,n=[...t.incoming],i=[...t.outgoing];if(n.length<1||i.length<1)return;const a=i.filter(h=>this.isDiagramFlow(h)).sort((h,x)=>h.id>x.id?1:-1);if(a.length<1)return;const r=a[0];n.filter(h=>this.isDiagramFlow(h)).forEach(h=>this.createSingleCrossConnection(h,r))}isDiagramFlow(e){return this.diagramUtils.isFlow(e)}preExecute(e){const t=e.hints;t&&t.force||this.createMultipleCrossConnections(e),super.preExecute(e)}};L=(0,s.__decorate)([(0,s.__param)(0,(0,_.Inject)("canvas")),(0,s.__param)(1,(0,_.Inject)("modeling")),(0,s.__param)(2,(0,_.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object])],L);var k=l(52874),f=l(28399),F=l(9224);let B=class extends F.L{constructor(e,t){super(),this.eventBus=e,this.diagramUtils=t,this._stopSync=0,this.sourceId=k.Guid.create(),this.subscribeDiagramChanges()}getElement(e){const t=e.context.shape||e.context.element||e.context.connection;switch(!0){case o.DiagramUtils.isLabel(t):return this.getLabel(e);case this.diagramUtils.isConnection(t):return this.getConnection(e);default:return this.getShape(e)}}updateProperties(e,t){if(this._stopSync)return;const n=e.context,i=this.getElement(e),a={};if(t.forEach(r=>{const c=i[r],h=this.getOldValue(n,r);f.isEqual(h,c)||(a[r]=f.cloneDeep(c))}),!f.isEmpty(a))switch(!0){case o.DiagramUtils.isLabel(i):this.service.bufferiseOps(m.g4.Update,["labels",i.id],a);break;case this.diagramUtils.isConnection(i):this.service.bufferiseOps(m.g4.Update,["connections",i.id],a);break;default:this.service.bufferiseOps(m.g4.Update,["elements",i.id],a)}}getShape(e){const t=e.context.shape||e.context.element;return{caption:t.caption,height:t.height,id:t.id,parent:t.parent&&t.parent.id,type:t.type,width:t.width,rx:t.rx,ry:t.ry,defaultParamValues:t.defaultParamValues,source:t.source}}getConnection(e){const t=e.context,n=t.connection||t.element,i=n.source||t.source,a=n.target||t.target;return{caption:n.caption,id:n.id,source:i.id,target:a.id,type:n.type,waypoints:n.waypoints}}getLabel(e){const t=e.context,n=t.shape,i=n.labelTarget||t.labelTarget;return{height:n.height,id:n.id,parent:i&&i.id,type:n.type,width:n.width,rx:n.rx,ry:n.ry}}addElement(e){const t=this.getElement(e);this.service.bufferiseOps(m.g4.Add,["elements"],{[t.id]:t})}subscribeDiagramChanges(){const e=this.eventBus;e.on([o.Handlers.diagram.initialized],()=>{this.service.diagramInitialized()}),e.on([o.Handlers.shape.createExecuted],t=>{if(!this._stopSync){const n=this.getElement(t);o.DiagramUtils.isLabel(n)?this.service.bufferiseOps(m.g4.Add,["labels"],{[n.id]:n}):this.addElement(t)}}),e.on([o.Handlers.shape.deleteExecuted],t=>{if(!this._stopSync){const n=this.getElement(t);n.parent||(n.parent=t.context.oldParent.id),o.DiagramUtils.isLabel(n)?this.service.bufferiseOps(m.g4.Remove,["labels"],{[n.id]:n}):this.service.bufferiseOps(m.g4.Remove,["elements"],{[n.id]:n})}}),e.on([o.Handlers.shape.moveExecuted],t=>{this.updateProperties(t,["parent","rx","ry"])}),e.on([o.Handlers.shape.resizeExecuted],t=>{this.updateProperties(t,["rx","ry","width","height"])}),e.on([o.Handlers.element.updateLabelExecuted],t=>{if(this._stopSync)return;const n=this.getElement(t);let i;this.diagramUtils.isConnection(n)?(i=this.getConnection(t),this.service.bufferiseOps(m.g4.Update,["connections",i.id],{caption:i.caption})):(i=this.getShape(t),this.service.bufferiseOps(m.g4.Update,["elements",i.id],{caption:i.caption}))}),e.on([o.Handlers.element.updateExecuted],t=>{this.updateProperties(t,["width","height","type"])}),e.on([o.Handlers.label.createExecuted],t=>{if(!this._stopSync){const n=this.getLabel(t);this.service.bufferiseOps(m.g4.Add,["labels"],{[n.id]:n})}}),e.on([o.Handlers.connection.createExecuted],t=>{if(!this._stopSync){const n=this.getConnection(t);this.service.bufferiseOps(m.g4.Add,["connections"],{[n.id]:n})}}),e.on([o.Handlers.connection.deleteExecuted],t=>{if(!this._stopSync){const n=this.getConnection(t);this.service.bufferiseOps(m.g4.Remove,["connections"],{[n.id]:n})}}),e.on([o.Handlers.connection.reconnectExecuted],t=>{const n=t.context.hints.docking;this.updateProperties(t,[n,"type"])}),e.on([o.Handlers.connection.updateWaypointsExecuted],t=>{this.updateProperties(t,["waypoints"])}),e.on([o.Handlers.connection.layoutExecuted],t=>{this.updateProperties(t,["waypoints"])}),e.on([o.Handlers.connection.moveExecuted],t=>{this.updateProperties(t,["waypoints"])}),e.on([o.Handlers.connection.updateExecuted],t=>{this.updateProperties(t,["type"])}),e.on([o.Handlers.connection.changeDirectionExecuted],t=>{this.updateProperties(t,["source","target","waypoints"])}),e.on([o.Handlers.elements.changed],()=>{this.service.commit(this.sourceId).then()}),e.on(["undo"],()=>this.service.undo()),e.on(["redo"],()=>this.service.redo())}getOldValue(e,t){let n;switch(t){case"rx":case"ry":case"width":case"height":n=e.oldBounds[t];break;case"parent":n=f.get(e,"oldParent.id");break;case"waypoints":n=f.get(e,"oldWaypoints");break;case"source":n=f.get(e,"oldSource.id");break;case"target":n=f.get(e,"oldTarget.id");break;case"type":n=f.get(e,"oldType");break;default:console.warn(`Unknown element property ${t}`)}return n}startSync(){this._stopSync=0}stopSync(){this._stopSync++}};B=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object])],B);var ae=l(6513);let V=class extends ae.A{constructor(e,t,n,i,a,r){super(e,t,n,i,a),this.eventBus=e,this.canvas=t,this.interactionEvents=n,this.bendpointMove=i,this.connectionSegmentMove=a,this.rules=r,e.on("element.marker.update",m.nS.HIGH,this.onElementMarkerUpdate.bind(this))}onElementMarkerUpdate(e){this.rules.allowed("canElementMarkerUpdate")||(e.element={})}getConnectionBendpointsFilter(e,t,n){return t===0||t===n.length-1}};V=(0,s.__decorate)([(0,s.__param)(0,(0,_.Inject)("eventBus")),(0,s.__param)(1,(0,_.Inject)("canvas")),(0,s.__param)(2,(0,_.Inject)("interactionEvents")),(0,s.__param)(3,(0,_.Inject)("bendpointMove")),(0,s.__param)(4,(0,_.Inject)("connectionSegmentMove")),(0,s.__param)(5,(0,_.Inject)("rules")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],V);var oe=l(69034),j=l(87004);let Q=class extends oe.A{constructor(e,t,n,i){super(e,t,n,i),this._canvas=e,this._eventBus=t,this._graphicsFactory=n,this._elementRegistry=i,t.on(["canvas.init"],a=>this.onInit(a))}onInit(e){const t=(0,j.vt)("defs");(0,j.BC)(e.svg,t)}zoom(e,t){const n=super.zoom(e,t);return this._eventBus.fire("zoom.changed",n),n}bringToFrontElement(e){const n=this._elementRegistry.getGraphics(e).parentNode,i=n.parentNode;i.removeChild(n),i.appendChild(n)}};Q=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config.canvas")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("graphicsFactory")),(0,s.__param)(3,(0,o.Inject)("elementRegistry")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object])],Q);var Ne=l(17389);let N=class extends Ne.A{constructor(e,t){super(e,t),this.eventBus=e}undo(){this.eventBus.fire("undo")}redo(){this.eventBus.fire("redo")}};N=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("injector")),(0,s.__metadata)("design:paramtypes",[Object,Object])],N);var At=l(28012);let u=class extends At.A{constructor(e,t,n,i){super(e,t,n,i),this._injector=e,this._canvas=t,this._graphicsFactory=n,this._elementFactory=i}createNoopConnection(e,t){const n=(0,j.vt)("polyline");return(0,j.CF)(n,{stroke:"#8095b3",strokeWidth:2}),(0,j.CF)(n,{points:[e.x,e.y,t.x,t.y]}),n}};u=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("graphicsFactory")),(0,s.__param)(3,(0,o.Inject)("elementFactory")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object])],u);var v=l(45041),w=l(3366),b=l(98218),g=l(52687),J=l(44156);let z=class extends J.A{constructor(e,t,n){super({style:f.cloneDeep(o.Labels.label.editStyle)}),this.config=e,this.elements=t,this.diagramUtils=n,this.style=f.cloneDeep(o.Labels.label.editStyle)}getElementLabelPosition(e,t){return t.delta?{x:Math.round(e.x+t.delta.x+t.width/2),y:Math.round(e.y+t.delta.y+t.height/2)}:{x:Math.round(e.x+e.width/2),y:Math.round(e.y+e.height+o.Labels.label.height/2)}}layoutToFirstLine(e,t){const i=e[0].textContent,a=super.layoutText(i,t);return a.element.children[0].textContent=i.substring(0,i.length-3)+"...",a}layoutRtlText(e,t){const n=e.element.children||[];n.length>1&&(e=this.layoutToFirstLine(n,t)),e.element.style.direction="rtl";const i=e.element.children||[];for(const a of i)a.style.direction="ltr";return e}getLabelPaddingTop(e,t){return 7}isIEOrEdge(){return/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)}applySvgHelperContent(e,t){const n=this.isEmptyText(t)?"dummy":t;e.textContent=n}createForeignText(e,t,n){const i=document.createElement("div"),a=`color: ${f.get(n,"style.fill","initial")}`;return i.setAttribute("class","foreign-text"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),i.setAttribute("style",`width: ${t}px; ${a}`),i.textContent=e,i}createForeignTextContainer(e,t,n){const i=document.createElement("div");i.setAttribute("class","foreign-text-container"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const a=this.createForeignText(e,t,n);return i.append(a),i}createForeignObject(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i=e.height,a=e.width;n.setAttribute("height",i.toString()),n.setAttribute("width",a.toString());const r=this.createForeignTextContainer(e.text,e.width,t);return n.append(r),n}getTextLayout(e,t){const n=(0,b.assign)({},{},t.box);let i={height:n.height,width:n.width,text:e};if(t.needRecalcDimensions){const a=i.height===void 0?i.width:null,r=this.getHelperSvg(a);i={...this.getTextBBox(e,r),text:e},(0,g.remove)(r)}return i}getLabelOptions(e){return{box:{x:Math.round(e.width/2+e.x),y:Math.round(e.height/2+e.y),width:e.width||o.Labels.label.width,height:e.height},style:{direction:"ltr",...this.style}}}getHelperSvg(e){let t=document.getElementById("helper-svg");return t||(t=document.createElement("div"),t.setAttribute("id","helper-svg"),t.setAttribute("class","foreign-text foreign-text-helper"),e&&t.setAttribute("style",`max-width: ${e}px`),document.body.appendChild(t)),t}getTextBBox(e,t){this.applySvgHelperContent(t,e);const n=t.getBoundingClientRect();return{width:this.isEmptyText(e)?0:n.width,height:n.height}}getDimensions(e,t){return t.needRecalcDimensions=!0,this.layoutText(e,t).dimensions}createText(e,t){return super.createText(e,t)}layoutText(e,t){if(this.isIEOrEdge()){const a=super.layoutText(e,t);return this.config.isRtl?this.layoutRtlText(a,t):a}const n=this.getTextLayout(e,t),i=this.createForeignObject(n,t);return{dimensions:{width:n.width,height:n.height},element:i}}getConnectionLabelPosition(e,t){const n=Math.floor(e.length/2-1),i=e[n],a=e[n+1],r={x:Math.round((a.x-i.x)/2),y:Math.round((a.y-i.y)/2)},c=i.x+r.x;let h=i.y+r.y;return i.y===a.y&&(h+=Math.round(t.height/2)+5),{x:c,y:h}}getLabelBounds(e,t){const n=this.getLabelOptions(e),i=this.getDimensions(t,n);return{height:i.height,width:i.width,x:Math.round(e.x+e.width/2-i.width/2),y:Math.round(e.y)}}isEmptyText(e){return!e||!e.trim()}resetLabelPosition(e){const{width:i,height:a}=this.getLabelBounds(e,e.labelTarget.caption);e.width=i,e.height=a;const r=e.parent;e.x=Math.round(r.x+r.width/2-e.width/2),e.y=Math.round(r.y+r.height+o.Labels.label.height/2)-1*2-1}addLabel(e,t,n,i=t.caption){if(!this.isEmptyText(i)){const a=this.getLabelPosition(t,n);a.y+=this.getLabelPaddingTop(t,n.delta);const r={id:k.Guid.create().toString(),getDimensions:!0,...f.pick(n,["type","width","height"])};e.createLabel(t,a,r)}}getLabelPosition(e,t=o.Labels.label){return this.diagramUtils.isConnection(e)?this.getConnectionLabelPosition(e.waypoints,t):this.getElementLabelPosition(e,t)}};z=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config")),(0,s.__param)(1,(0,o.Inject)("elements")),(0,s.__param)(2,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,o.DiagramElements,o.DiagramUtils])],z);let q=class{constructor(e,t){this.modeling=e,this.diagramText=t}setText(e,t){const n=e.label||e,i=e.labelTarget||e;return i.caption=t,[n,i]}preExecute(e){const t=e.element;t&&!t.label&&!o.DiagramUtils.isLabel(t)&&this.diagramText.addLabel(this.modeling,t,o.Labels.label,e.text)}execute(e){e.oldText=e.element.caption||"";const t=(e.text||"").trim();return this.setText(e.element,t)}revert(e){return this.setText(e.element,e.oldText)}resizeShape(e,t){this.modeling.resizeShape(e,t,{height:0,width:0})}postExecute(e){const t=e.element.label;if(!t)return;const n=this.diagramText;if(n.isEmptyText(e.text))this.modeling.removeShape(t,{unsetLabel:!1});else{const i=t.labelTarget.caption;if(i){const a=e.newBounds||n.getLabelBounds(t,i);this.resizeShape(t,a)}}}};q=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__param)(1,(0,o.Inject)("diagramText")),(0,s.__metadata)("design:paramtypes",[Object,z])],q);var re=l(34635),ce=l(66435);let ue=class extends re.A{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new ce.G(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t,e.labelTarget),t}};ue=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("canvas")),(0,s.__param)(1,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object])],ue);var Ut=l(2050);let me=class extends Ut.A{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new ce.G(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t),t}};me=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("canvas")),(0,s.__param)(1,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object])],me);var Ft=l(97970),Z=l(65911);let le=class extends Ft.A{constructor(e){super(e)}execute(e){super.execute(e)}postExecute(e){const{connection:t,hints:n}=e;n&&n.docking&&(e.dockingOrPoints=n.docking==="source"?(0,Z.pp)(t.source):(0,Z.pp)(t.target)),super.postExecute(e)}};le=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__metadata)("design:paramtypes",[Object])],le);var zt=l(57261),Ht=l(45240);let fe=class extends zt.A{constructor(e){super(e),this.modeling=e,this.postExecute=function(t){const n=t.movingShapes,i=t.delta;this.modeling.moveElements(n,i,void 0,{autoResize:!1,attach:!1})},this.preExecute=function(t){const n=t.resizingShapes,i=t.delta,a=t.direction;n.forEach(r=>{const c=(0,Ht.Ih)(r,a,i);this.modeling.resizeShape(r,c)})}}};fe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__metadata)("design:paramtypes",[Object])],fe);var Kt=l(90006);let ye=class extends Kt.A{constructor(e,t){super(e),this.modeling=e,this.canvas=t}getParent(e,t){const n=this.canvas.getRootElement();let i=super.getParent(e,t);return o.DiagramUtils.isLabel(i)&&(i=n),i}preExecute(e){super.preExecute(e)}};ye=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],ye);var Wt=l(12301);let ve=class extends Wt.A{constructor(e,t,n,i){super(e),this.modeling=e,this.elementRegistry=t,this.canvas=n,this.diagramUtils=i}setParent(e){const t=e.newParent;t&&(this.diagramUtils.isFlow(t)&&(e.targetConnection=t,e.newParent=this.getRealParent(e)),o.DiagramUtils.isLabel(t)&&(e.newParent=this.getRealParent(e)))}getRealParent(e){const t=this.diagramUtils.getAllContainers(this.elementRegistry.getAllElements()),n=this.canvas.getRootElement(),i=e.shapes[0];return this.diagramUtils.findRealElementParent({x:i.x,y:i.y},t,n)}postExecute(e){this.setParent(e),super.postExecute(e)}};ve=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__param)(1,(0,o.Inject)("elementRegistry")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,o.DiagramUtils])],ve);const Vt={CENTER:"center",RIGHT:"right",LEFT:"left"},Nt={TOP:"top",CENTER:"center",BOTTOM:"bottom"};let H=class extends w.A{constructor(e,t,n,i,a,r,c,h,x){super(e,t,n,i),this.eventBus=e,this.elementFactory=t,this.commandStack=n,this.canvas=i,this.registry=a,this.diagramText=r,this.elements=c,this.rules=h,this.diagramUtils=x,this.convertUtils=new ce.G(x)}addShapeHandlers(e){e[o.Handlers.shape.shapeCreate]=me}addLabelHandlers(e){e[o.Handlers.label.create]=ue}getLabelPositionByX(e,t){return e.horizontalAlignment===Vt.CENTER?e.x:e.x+t.width/2}getLabelPositionByY(e,t){return e.verticalAlignment===Nt.CENTER?e.y:e.y+t.height/2}getLabelPosition(e,t,n){let i,a;if(this.needResetLabelPosition(e,t)){const r=this.diagramText.getLabelPosition(t,n),c=this.getFixedLabelPosition(r,n,t);i=!f.isUndefined(e.x)&&f.isUndefined(e.y)?this.getLabelPositionByX(e,n):c.x,a=!f.isUndefined(e.y)&&f.isUndefined(e.x)?this.getLabelPositionByY(e,n):c.y}else i=this.getLabelPositionByX(e,n),a=this.getLabelPositionByY(e,n);return{x:Math.round(i),y:Math.round(a)}}getLabelSize(e,t){let n;if(e.width&&e.height)n={width:e.width,height:e.height};else{const i=e.caption||t.caption,a=this.diagramText.getLabelBounds(e,i);n={width:a.width,height:a.height}}return n}addElementHandlers(e){e[o.Handlers.element.updateLabel]=q}addConnectionHandlers(e){e[o.Handlers.connection.update]=le,e[o.Handlers.connection.reconnect]=le}getFixedLabelPosition(e,t,n){const r=e.x,c=this.diagramUtils.isConnection(n)?e.y:e.y+t.height/2-1*2-1;return{x:Math.round(r),y:Math.round(c)}}needResetLabelPosition(e,t){return f.isUndefined(e.x)||f.isUndefined(e.y)}getElement(e){return typeof e=="string"?this.registry.get(e):e}addElementsHandlers(e){e[o.Handlers.elements.create]=ye,e[o.Handlers.elements.move]=ve}getLabelAttributes(e,t,n,i){return{id:t.id,type:e.type,width:n.width,height:n.height,caption:e.caption,backgroundStyle:e.backgroundStyle,style:e.style,hidden:i?.hidden,tooltip:e.tooltip,tooltipConfig:e.tooltipConfig}}getElementAttributes(e,t,n){const{caption:i,type:a}=t,r=t.width||n.width,c=t.height||n.height,h=t.largeImage||n.largeImage,x=t.name;return{id:e,type:a,width:r,height:c,largeImage:h,name:x,caption:i&&i.toString(),tooltip:t.tooltip,tooltipConfig:t.tooltipConfig}}centerViewbox(e){o.DiagramUtils.centerViewboxOnElement(e,this.canvas)}getElementPosition(e,t){const{x:n=0,y:i=0}=e,a=e.width||t.width,r=e.height||t.height;return{x:Math.round(n+a/2),y:Math.round(i+r/2)}}createDiagramLabel(e){const t=f.cloneDeep(e.value),n=this.registry.get(t.parent);if(n){this.convertUtils.setShapeAbsolutePosition(t,n);const i=this.getLabelSize(t,n);t.height=t.height||i.height;const a=this.getLabelPosition(t,n,i),r=this.getLabelAttributes(t,e,i,n);return this.createLabel(n,a,r,n)}}createDiagramElement(e,t){if(this.registry.get(e))return;const n=this.elements.items.root.id,i=f.cloneDeep(t[e]),a=i.parent||n;let r=this.registry.get(a);r||(this.createDiagramElement(a,t),r=this.registry.get(a)),this.convertUtils.setShapeAbsolutePosition(i,r);const c=this.elements.getConfig(i),h=this.getElementAttributes(e,i,c),x=this.getElementPosition(i,c);this.createShape(h,x,r,0,{generateUniqueCaption:!1})}getHandlers(){const e=super.getHandlers(this);return e.spaceTool=fe,this.addLabelHandlers(e),this.addShapeHandlers(e),this.addElementHandlers(e),this.addElementsHandlers(e),this.addConnectionHandlers(e),e}moveConnection(e,t,n,i){super.moveConnection(e,t,e.parent,n,i)}createShape(e,t,n,i,a){return super.createShape(e,t,n,i,a)}pasteElements(e,t,n){super.pasteElements(e,t,n)}moveShape(e,t,n=null,i=null,a=null){super.moveShape(e,t,n,i,a)}updateWaypoints(e,t,n={}){const i=this.getElement(e);i&&(f.defaults(n,{doUpdateLabelPosition:!0}),super.updateWaypoints(i,t,n))}reconnect(e,t,n,i,a){a&&a.docking==="target"&&f.defaults(a,{isUpdateConnectionType:!0});const r=this.getElement(e),c=this.getElement(t),h=this.getElement(n);r&&(c||h)&&super.reconnect(r,c,h,i,a)}reconnectStart(e,t,n,i={}){if(!n){const a=this.getElement(e),r=a.waypoints[0];n=r.original||o.DiagramUtils.getOriginalWaypoint(r,a.source)}super.reconnectStart(e,t,n,i)}reconnectEnd(e,t,n,i={}){if(!n){const a=this.getElement(e),r=a.waypoints,c=r[r.length-1];n=c.original||o.DiagramUtils.getOriginalWaypoint(c,a.target)}super.reconnectEnd(e,t,n,i)}createLabel(e,t,n,i){if(this.registry.get(n.id))return;const a=super.createLabel(e,t,n,i);return a.parent=e,a}removeConnection(e){const t=this.getElement(e);t&&super.removeConnection(t)}connect(e,t,n,i){const a=this.canvas.getRootElement();return n=n||{},this.createConnection(e,t,n,a,i)}createConnection(e,t,n,i,a,r){if(typeof n=="object"&&(r=a,a=i,i=n,n=void 0),!this.registry.get(i.id))return a=a||this.canvas.getRootElement(),super.createConnection(e,t,n,i,a,r)}updateLabel(e,t,n=null){const i=this.getElement(e);i&&this.commandStack.execute(o.Handlers.element.updateLabel,{element:i,text:t,newBounds:n})}moveConnectionLabel(e,t){const n={connection:e,hints:t};this.eventBus.fire(o.Handlers.connection.moveConnectionLabel,{context:n})}removeElementChildren(e){const t=e.children;for(t.length&&this.eventBus.fire(o.Handlers.elements.removing,{elements:t});t.length>0;){const n=t[0];this.removeShape(n,{force:!0})}}resizeShape(e,t,n,i){super.resizeShape(e,t,n,i)}removeShape(e,t){super.removeShape(e,t)}removeElements(e,t=!1){(t||this.rules.allowed(o.Handlers.elements.delete,{elements:e}))&&super.removeElements(e)}clearDiagram(){const e=this.registry.getAllElements();super.removeElements(e)}layoutConnection(e,t){super.layoutConnection(e,t)}};H=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("elementFactory")),(0,s.__param)(2,(0,o.Inject)("commandStack")),(0,s.__param)(3,(0,o.Inject)("canvas")),(0,s.__param)(4,(0,o.Inject)("elementRegistry")),(0,s.__param)(5,(0,o.Inject)("diagramText")),(0,s.__param)(6,(0,o.Inject)("elements")),(0,s.__param)(7,(0,o.Inject)("rules")),(0,s.__param)(8,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,o.DiagramElements,Object,o.DiagramUtils])],H);let de=class extends v.A{constructor(e,t,n,i,a,r,c){super(e,t,n,i,c,r),this.rules=a;const h=this.start;this.start=(x,E,T)=>{this.rules.allowed("canConnectionSegmentMove")&&h.call(this,x,E,T)}}};de=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("dragging")),(0,s.__param)(4,(0,o.Inject)("rules")),(0,s.__param)(5,(0,o.Inject)("modeling")),(0,s.__param)(6,(0,o.Inject)("graphicsFactory")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,H,Object])],de);var $e=l(10018);const rt=".entry";let be=class{constructor(e,t,n,i){this.eventBus=e,this.overlays=t,this.rules=n,this.canvas=i,this._providers=[],this.current=null,this.init()}init(){this.eventBus.on("selection.changed",e=>{const t=e.newSelection;t.length===1?this.open(t[0]):this.close()}),this.eventBus.on("elements.delete",e=>{const t=e.elements;(0,b.forEach)(t,n=>{this.isOpen(n)&&this.close()})}),this.eventBus.on("element.changed",e=>{const t=e.element,n=this.current;n&&n.element===t&&this.open(t,!0)}),this.eventBus.on("canvas.viewbox.changing",()=>{this.isOpen()&&(0,b.assign)(this.current.pad.html.style,{visibility:"hidden"})}),this.eventBus.on("canvas.viewbox.changed",()=>{const e=this.current&&this.current.element;e&&this.open(e,!0)}),this.eventBus.on("diagram.clear",()=>{this.close()})}canOpen(e){return this.rules.allowed("canOpenContextPad",{})}getSeparatorConfig(){return{className:"entry-separator"}}getNoopConfig(){return{noop:{className:"noop-entry"}}}sliceObj(e,t,n){return Object.keys(e).slice(t,n).reduce((i,a)=>(i[a]=e[a],i),{})}addNoopEntry(e){const t=Object.keys(e);return t.length<=2||t[1]==="setup"?e:{...this.sliceObj(e,0,1),...this.getNoopConfig(),...this.sliceObj(e,1,t.length)}}addSeparators(e){const t=Object.keys(e);return t.length<=1?e:t.length===2?t[1]==="setup"?e:(this.oneColumnMode=!0,{...this.sliceObj(e,0,1),separator1:this.getSeparatorConfig(),...this.sliceObj(e,1,t.length)}):{...this.sliceObj(e,0,2),separator1:this.getSeparatorConfig(),separator2:this.getSeparatorConfig(),...this.sliceObj(e,2,t.length)}}fixConnectToolPosition(e){const t=Object.keys(e);if(t.length<=2)return e;const n=t.indexOf("connect");if(n<0||n%2===0)return e;const i=t[n-1];return{...this.sliceObj(e,0,n-1),connect:e.connect,[i]:e[i],...this.sliceObj(e,n+1,t.length)}}fixEntries(e){return this.oneColumnMode=!1,e=this.addNoopEntry(e),e=this.addSeparators(e),e=this.fixConnectToolPosition(e),e}trigger(e,t,n=!1){const{entries:i,element:a}=this.current,r=t.delegateTarget||t.target;if(!r)return t.preventDefault();const c=(0,g.attr)(r,"data-action"),x=i[c].action,E=t.originalEvent||t;if((0,b.isFunction)(x)){if(e==="click")return x(E,a,n)}else if(x[e])return x[e](E,a,n);t.preventDefault()}getConnectionBBox(e){const t=(0,$e.U7)(e);return{x:t.x,y:t.y,width:t.width,height:t.height}}getElementBBox(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}getPadPosition(e){const t={left:9,top:-6},n=this.canvas.viewbox(),i=e.waypoints?this.getConnectionBBox(e):this.getElementBBox(e),a=i.x+i.width+t.left-n.x,r=i.y+t.top-n.y,c=n.scale;return{x:Math.round(a*c),y:Math.round(r*c)}}getEntryControl(e,t){const{className:n,title:i,imageUrl:a}=t,r=(0,g.domify)(`<div class="entry" draggable="true" data-action="${e}"></div>`);if(n){const c=(0,g.classes)(r);((0,b.isArray)(n)?n:n.split(/\s+/g)).forEach(x=>{c.add(x)})}return i&&(0,g.attr)(r,"title",i),a&&r.appendChild((0,g.domify)('<img src="'+a+'">')),r}addEntriesContainer(e){const t=(0,g.domify)('<div class="group"></div>');return(0,b.forEach)(e,(n,i)=>{const a=this.getEntryControl(i,n);t.appendChild(a)}),t}getPad(e){if(this.isOpen())return this.current.pad;const t=(0,g.domify)('<div class="djs-context-pad"></div>');g.delegate.bind(t,rt,"click",a=>{this.trigger("click",a)}),g.delegate.bind(t,rt,"dragstart",a=>{this.trigger("dragstart",a)}),g.event.bind(t,"mousedown",a=>{a.stopPropagation()});const n=this.getPadPosition(e);(0,b.assign)(t.style,{position:"absolute",left:n.x+"px",top:n.y+"px",visibility:"visible"});const i={html:t};return this.eventBus.fire("contextPad.create",{element:e,pad:i}),i}getEntries(e){const t={};return(0,b.forEach)(this._providers,n=>{const i=n.getContextPadEntries(e);(0,b.forEach)(i,(a,r)=>{t[r]=a})}),this.fixEntries(t)}registerProvider(e){this._providers.push(e)}open(e,t=!1){if(!t&&this.isOpen(e)||(this.close(),!this.canOpen(e)))return;const n=this.getEntries(e);if(f.isEmpty(n))return;const i=this.addEntriesContainer(n),a=this.getPad(e),r=a.html;r.appendChild(i),(0,g.classes)(r).add("open"),(0,g.classes)(r).toggle("one-column-grid",this.oneColumnMode),this.canvas.getContainer().appendChild(r),this.current={element:e,pad:a,entries:n},this.eventBus.fire("contextPad.open",{current:this.current})}isOpen(e){return this.current&&(!e||this.current.element===e)}close(){this.isOpen()&&((0,g.remove)(this.current.pad.html),this.eventBus.fire("contextPad.close",{current:this.current}),this.current.pad.html=null,this.current=null)}};be=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("overlays")),(0,s.__param)(2,(0,o.Inject)("rules")),(0,s.__param)(3,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object])],be);var $t=l(7034);let _e=class extends $t.A{constructor(e,t,n,i,a,r,c,h,x,E){super(e,t,n,i,a,r,c,h),this.canvas=e,this.create=t,this.clipboard=n,this.elementFactory=i,this.eventBus=a,this.modeling=r,this.mouse=c,this.rules=h,this.diagramText=x,this.config=E,this.init()}_onPasteElement(e){Object.assign(e.hints,{generateUniqueCaption:!1,isElementCopyPaste:!0})}onCopyElement({element:e,descriptor:t}){this.copyProperties.forEach(n=>t[n]=(0,f.clone)(e[n]))}init(){this.copyProperties=["type","caption"],this.eventBus.on("copyPaste.pasteElements",e=>this._onPasteElement(e)),this.eventBus.on("copyPaste.copyElement",e=>this.onCopyElement(e))}resetLabelsPosition(e){const t=e.filter(n=>o.DiagramUtils.isLabel(n));t.length===1&&e.length===2&&this.diagramText.resetLabelPosition(t[0])}_createElements(e){const t=super._createElements(e);return this.resetLabelsPosition(t),t}createShape(e){const t=e.id,n=super.createShape(e);return n.sourceId=t,n}};_e=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("canvas")),(0,s.__param)(1,(0,o.Inject)("create")),(0,s.__param)(2,(0,o.Inject)("clipboard")),(0,s.__param)(3,(0,o.Inject)("elementFactory")),(0,s.__param)(4,(0,o.Inject)("eventBus")),(0,s.__param)(5,(0,o.Inject)("modeling")),(0,s.__param)(6,(0,o.Inject)("mouse")),(0,s.__param)(7,(0,o.Inject)("rules")),(0,s.__param)(8,(0,o.Inject)("diagramText")),(0,s.__param)(9,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],_e);let ee=class{constructor(e,t){this.eventBus=e,this.canvas=t}getEntry(e,t){const n=(0,b.matchPattern)({id:t}),i=(0,b.find)(e,n);if(!i)throw new Error("entry not found");return i}createContainer(){const t=this.canvas.getContainer().getBoundingClientRect(),i=(0,g.query)(`[data-action="${this.paletteEntryId}"]`).getBoundingClientRect(),a={x:12,y:-5},r={x:i.left+i.width+a.x-t.left,y:i.top+a.y-t.top},c=(0,g.domify)('<div class="djs-popup diagram-create-popup-menu">');return(0,b.assign)(c.style,{position:"absolute",left:r.x+"px",top:r.y+"px",visibility:"hidden"}),c}alignPosition(e){const n=this.canvas.getContainer().getBoundingClientRect(),i=e.getBoundingClientRect(),a=10,r=i.top+i.height-(n.top+n.height)+a;if(r>0){let c=i.top-n.top-r;c=c>a?c:a,(0,b.assign)(e.style,{top:c+"px"})}}entryAction(e,t,n){n.preventDefault();const i=n.delegateTarget||n.target,a=(0,g.attr)(i,"data-id"),r=this.getEntry(e,a),c=r.action[t];c&&c.call(null,n,r)}attachContainer(e,t){const n=this.canvas.getContainer();g.delegate.bind(t,".entry","dragstart",this.entryAction.bind(this,e,"dragstart")),g.delegate.bind(t,".entry","click",this.entryAction.bind(this,e,"click")),n.appendChild(t),this.alignPosition(t),(0,b.assign)(t.style,{visibility:"visible","z-index":1e3,opacity:1}),this.subscribeEvents(),t.onwheel=i=>this.onWheel(i)}createEntriesContainer(e){const t=(0,g.domify)('<div class="djs-popup-body">');return(0,b.forEach)(e,n=>{const i=this.createEntry(n);t.appendChild(i)}),t}createEntry(e){if(!e.id)throw new Error("every entry must have the id property set");const t=(0,g.domify)('<div class="entry" draggable="true"></div>');(0,g.classes)(t).add("entry"),(0,g.attr)(t,"data-id",e.id);const i=(0,g.domify)("<span>");return i.textContent=e.label,t.appendChild(i),t.appendChild((0,g.domify)('<img src="'+e.imageUrl+'" />')),t}subscribeEvents(){const e=this.eventBus;e.once("contextPad.close",this.close.bind(this)),e.once("popupMenu.open",this.close.bind(this)),e.once("canvas.viewbox.changing",this.close.bind(this)),e.once("commandStack.changed",this.close.bind(this)),e.once("element.mousedown",m.nS.HIGH,this.close.bind(this)),e.once("keyboard.keydown",m.nS.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this.eventBus;e.off("contextPad.close",this.close.bind(this)),e.off("popupMenu.open",this.close.bind(this)),e.off("canvas.viewbox.changed",this.close.bind(this)),e.off("commandStack.changed",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}open(e,t,n){if(this.isOpen()&&(this.close(),e.type===this.currentElement.type))return;this.currentElement=e,this.paletteEntryId=t,this.eventBus.fire("createPopupMenu.open",{paletteEntryId:t});const i=this.createContainer(),a=this.createEntriesContainer(n);i.appendChild(a),this.attachContainer(n,i),this.container=i}close(){if(!this.isOpen())return;const e=this.paletteEntryId;this.eventBus.fire("createPopupMenu.close",{paletteEntryId:e}),this.unsubscribeEvents(),(0,g.remove)(this.container),this.container=null}isOpen(){return!!this.container}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};ee=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],ee);var Gt=l(20990);let xe=class extends Gt.A{constructor(e,t){super(t,e),this.injector=e}_registerDefaultActions(){super._registerDefaultActions.call(this,this.injector);const e=this.injector.get("elementRegistry",!1),t=this.injector.get("selection",!1);e&&t&&super._registerAction("selectAll",()=>{const n=e.getAllElements();return t.select(n),n})}};xe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__metadata)("design:paramtypes",[Object,Object])],xe);var Yt=l(15176),Zt=l(23710),Ge=l.n(Zt);class ct extends Yt.A{constructor(){super(),Ge().config({disableDefaultAlphabetLength:!0}),Ge().characters("0123456789abcdefghijklmnopqrstuvwxyz")}generateId(e){return e+"_"+Ge().generate()}create(e,t){return t=Object.assign({},t),t.type||(t.type=e),t.id||(t.id=this.generateId(t.type)),super.create(e,t)}}var Xt=l(54343);let Ce=class extends Xt.A{constructor(e){super(),this.injector=e}getAllElements(){const t=this.injector.get("canvas",!1).getRootElement();return super.filter(n=>n!==t)}getAll(){return this.getAllElements()}getGraphics(e,t){return super.getGraphics(e,t)}get(e){return super.get(e)}};Ce=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__metadata)("design:paramtypes",[Object])],Ce),(0,_.ngxTranslateExtract)("diagram.elementTools.connect.connect"),(0,_.ngxTranslateExtract)("diagram.elementTools.remove"),(0,_.ngxTranslateExtract)("diagram.elementTools.changeType");const Qt="assets/images/icon_tools_del.svg",Jt="assets/images/icon_tools_setup.svg",qt="assets/images/icon_tools_arrow.svg";let je=class{constructor(e,t){this.elements=e,this.config=t,this.addItems=this.getAddItems(),this.tools=this.getTools()}getAddItems(){return[]}getTools(){const e=this.config.localizableStrings;return{connect:{imageUrl:qt,title:e.get("elementTools.connect.connect")},setup:{imageUrl:Jt,title:e.get("elementTools.changeType")},delete:{imageUrl:Qt,title:e.get("elementTools.remove")}}}};je=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("elements")),(0,s.__param)(1,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[o.DiagramElements,Object])],je);var en=l(77117),lt=l(34495),K=l(4217);function te(p){const e=K.G[p.code];return e?e.keyCode:p.keyCode}function dt(p){if(p.ctrlKey||p.metaKey||p.altKey)return!1;const e=p.which||p.keyCode;return e>47&&e<58||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function W(p,e,t={}){return!f.isUndefined(t.ctrl)&&t.ctrl!==(0,lt.nM)(p)||!f.isUndefined(t.shift)&&t.shift!==(0,lt.Tu)(p)?!1:te(p)===e.keyCode}function ht(p){return te(p)===K.G.Enter.keyCode}function gt(p,e){p.shiftKey||(p.stopPropagation(),p.preventDefault(),p.ctrlKey||p.altKey?document.execCommand("insertText",!1,`
`):e())}class pt extends en.A{registerBindings(e,t){const a=(r,c)=>{t.isRegistered(r)&&e.addListener(c)};a("stepZoom",r=>{const c=r.keyEvent;if(W(c,K.G.Equal,{ctrl:!0})||W(c,K.G.NumpadAdd,{ctrl:!0}))return t.trigger("stepZoom",{value:1}),!0}),a("undo",r=>{const c=r.keyEvent;if(W(c,K.G.KeyZ,{ctrl:!0,shift:!1}))return t.trigger("undo"),!0}),a("redo",r=>{const c=r.keyEvent;if(W(c,K.G.KeyY,{ctrl:!0})||W(c,K.G.KeyZ,{ctrl:!0,shift:!0}))return t.trigger("redo"),!0}),a("copy",r=>{const c=r.keyEvent;if(W(c,K.G.KeyC,{ctrl:!0}))return t.trigger("copy"),!0}),a("paste",r=>{const c=r.keyEvent;if(W(c,K.G.KeyV,{ctrl:!0}))return t.trigger("paste"),!0}),a("selectAll",r=>{const c=r.keyEvent;if(W(c,K.G.KeyA,{ctrl:!0}))return t.trigger("selectAll"),!0}),super.registerBindings(e,t)}}var tn=l(40406);let Ee=class extends tn.A{constructor(e,t,n,i,a,r){super(e,t,n,i,a,r),this.eventBus=e,this.canvas=t,this.dragging=n,this.elementRegistry=i,this.selection=a,this.toolManager=r}select(e,t){const n=(0,$e.rx)(e,t),i=(0,b.values)(n),a=i.filter(r=>o.DiagramUtils.isLabel(r)&&i.includes(r.parent)||!o.DiagramUtils.isLabel(r));this.selection.select(a)}};Ee=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("dragging")),(0,s.__param)(3,(0,o.Inject)("elementRegistry")),(0,s.__param)(4,(0,o.Inject)("selection")),(0,s.__param)(5,(0,o.Inject)("toolManager")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],Ee);var $=l(73308);let De=class{constructor(e,t,n,i,a){this.elementRegistry=e,this.diagramModeling=t,this.elements=n,this.eventBus=i,this.logger=a,this.errors=[],this.loadRenderInterval=500}createElement(e,t){this.diagramModeling.createDiagramElement(e,t)}createLabel(e,t){this.diagramModeling.createDiagramLabel({value:e,id:t})}createConnection(e,t){const n=f.cloneDeep(e),{source:i,target:a}=n,r=this.elementRegistry,c=r.get(i),h=r.get(a),x=this.getConnectionAttributes(t,n);this.diagramModeling.connect(c,h,x,e.hints||{})}addOriginalToWaypoint(e,t){if(!e.original){const n=this.elementRegistry.get(t);n&&(e.original=o.DiagramUtils.getOriginalWaypoint(e,n))}}addOriginalToConnection(e){const t=e.waypoints;if(t&&t.length>1){const n=t[0];this.addOriginalToWaypoint(n,e.source);const i=t[t.length-1];this.addOriginalToWaypoint(i,e.target)}}getConnectionAttributes(e,t){const{waypoints:n,name:i,type:a=o.DiagramElementType.connection}=t;this.addOriginalToConnection(t);let{caption:r,documentation:c}=t;return r=r&&r.toString(),c=c&&c.toString(),{id:e,waypoints:n,name:i,caption:r,documentation:c,type:a}}load(e,t,n){var i=this;return(0,$.A)(function*(){i.errors=[];const a=[...f.map(e.elements,(c,h)=>({handler:()=>i.createElement(h,e.elements),id:h})),...f.map(e.connections,(c,h)=>({handler:()=>i.createConnection(c,h),id:h})),...f.map(e.labels,(c,h)=>({handler:()=>i.createLabel(c,h),id:h}))];let r=Number(new Date);try{for(let c=0,h=a.length;c<h&&!t.isStopped;c++){try{a[c].handler()}catch(E){i.errors.push(a[c].id+" "+E.toString()),console.error(E)}if(Number(new Date)-r>i.loadRenderInterval){const E=Math.round(c/h*100);n.next(E),yield new Promise(T=>f.delay(T,0)),r=Number(new Date)}}return i.errors.length&&i.logger.exception(`Error when loading process with ID: ${e.id}`,{loggerName:"DiagramLoader"},i.errors),i.errors}finally{n.next(0),t.isStopped||i.eventBus.fire("diagram.loaded")}})()}};De=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("elementRegistry")),(0,s.__param)(1,(0,o.Inject)("modeling")),(0,s.__param)(2,(0,o.Inject)("elements")),(0,s.__param)(3,(0,o.Inject)("eventBus")),(0,s.__param)(4,(0,o.Inject)("loggerService")),(0,s.__metadata)("design:paramtypes",[Object,H,o.DiagramElements,Object,_.LoggerService])],De);var nn=l(59131);class X extends _.LocalStorageService{constructor(){super({prefix:"bpmonline-designer.diagram",storageType:"localStorage"}),this.diagramId=""}set(e,t,n=!0){return n&&(e+="."+this.diagramId),super.set(e,t)}get(e,t=!0){return t&&(e+="."+this.diagramId),super.get(e)}remove(...e){return e&&(e=e.map(t=>t+"."+this.diagramId)),super.remove(...e)}static{this.\u0275fac=function(t){return new(t||X)}}static{this.\u0275prov=nn.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac})}}var sn=l(25141),ut=l.n(sn),an=l(12266);const Se=50,on={min:.2,max:4},rn=10,cn=.1;let we=class{constructor(e,t,n,i,a,r,c,h){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.zoomScroll=i,this.localStorage=a,this.popupMenu=r,this.config=c,this.diagramUtils=h,this.openStateKey="minimap-state",this.loadMiniMapRenderInterval=50,this._onElementAdded=this.onElementAdded.bind(this),this._onElementRemoved=this.onElementRemoved.bind(this),this._onElementsChanged=this.onElementsChanged.bind(this),this._onElementUpdateId=this.onElementUpdateId.bind(this),this.init()}init(){const e=this.getOpenState();this._state={isOpen:e,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0,data:null},this.createComponent(),this.registerPopupMenu(),this.subscribeEvents()}getOpenState(){return this.localStorage.get(this.openStateKey,!1)}setOpenState(e){(0,b.assign)(this._state,{isOpen:e}),this.localStorage.set(this.openStateKey,e,!1),e?((0,g.classes)(this.parent).add("open"),(0,g.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapClose"))):((0,g.classes)(this.parent).remove("open"),(0,g.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapOpen")))}createComponent(){this.parent=document.createElement("div"),(0,g.classes)(this.parent).add("djs-minimap"),g.event.bind(this.parent,"mousedown",t=>t.stopPropagation());const e=this.canvas.getContainer();this.isOpen()&&(0,g.classes)(this.parent).add("open"),e.appendChild(this.parent),this.initButtons(),this.map=document.createElement("div"),(0,g.classes)(this.map).add("map"),this.parent.appendChild(this.map),this.svg=(0,j.vt)("svg"),(0,j.CF)(this.svg,{width:"100%",height:"100%"}),(0,j.BC)(this.map,this.svg),this.elementsGroup=(0,j.vt)("g"),(0,j.BC)(this.svg,this.elementsGroup),this.viewportGroup=(0,j.vt)("g"),(0,j.BC)(this.svg,this.viewportGroup),this.viewport=(0,j.vt)("rect"),(0,j.Ly)(this.viewport).add("viewport"),(0,j.BC)(this.viewportGroup,this.viewport),this.viewportDom=document.createElement("div"),(0,g.classes)(this.viewportDom).add("viewport-dom"),this.parent.appendChild(this.viewportDom),this.overlay=document.createElement("div"),(0,g.classes)(this.overlay).add("overlay"),this.parent.appendChild(this.overlay)}initButtons(){const e=document.createElement("div");(0,g.classes)(e).add("map-buttons"),this.mapButtons={},this.getMapButtonsConfig().forEach(n=>{const i=document.createElement("div");if(["map-button",...n.classes].forEach(a=>(0,g.classes)(i).add(a)),n.title){let a=this.config.localizableStrings.get(n.title);n.shortcut&&(a+=` (${n.shortcut})`),(0,g.attr)(i,"title",a)}n.caption&&(i.textContent=n.caption),this.subscribeUserEvent(i,"click",n.click),this.mapButtons[n.id]=i,e.appendChild(i)}),this.parent.appendChild(e)}getMapButtonsConfig(){return[{id:"preview",classes:["material-icons","preview-button"],title:this.isOpen()?"miniMapClose":"miniMapOpen",caption:"icon_preview_16",click:()=>this.preview()},{id:"fitToView",classes:["material-icons","fit-to-view-button"],title:"fitToView",shortcut:"Ctrl+0",caption:"icon_fullscreen_16",click:()=>this.fitToView()},{id:"resetView",classes:["reset-view-button"],title:"resetView",caption:"1:1",click:()=>this.resetView()},{id:"zoomOut",classes:["material-icons","zoom-out-button"],title:"zoomOut",shortcut:"Ctrl+-",caption:"icon_zoom_out_16",click:()=>this.zoomScroll.zoomOut()},{id:"zoomIn",classes:["material-icons","zoom-in-button"],title:"zoomIn",shortcut:"Ctrl++",caption:"icon_zoom_in_16",click:()=>this.zoomScroll.zoomIn()},{id:"zoom",classes:["zoom-button"],caption:"100%",click:()=>this.togglePopupMenu()}]}subscribeEvents(){let e=!0;this.eventBus.on("diagram.loaded",()=>{e?(e=!1,this.isOpen()&&this.open().then(()=>{this.onDiagramLoaded().then()})):this.onDiagramLoaded().then()}),this.subscribeUserEvent(this.svg,"click",t=>this.onSvgClick(t)),g.event.bind(this.viewportDom,"mousedown",t=>this.onMousedown(!1,t)),g.event.bind(this.svg,"mousedown",t=>this.onMousedown(!0,t)),this.subscribeUserEvent(this.parent,"wheel",t=>this.onParentWheel(t)),this.eventBus.on("canvas.viewbox.changed",()=>this.onViewBoxChanged()),this.eventBus.on("canvas.resized",()=>this.onCanvasResized()),this.eventBus.on("zoom.changed",(t,n)=>this._onZoomChanged(n)),this.eventBus.on("keyboard.keydown",t=>this.onKeyDown(t)),this.eventBus.on("diagram.clear",()=>this.onClear())}onDiagramLoaded(){var e=this;return(0,$.A)(function*(){e.isOpen()&&(yield e.loadData(),e.subscribeElementEvents())})()}onSvgClick(e){this.setViewboxCenteredAroundClickEvent(e)}onViewBoxChanged(){this._state.isDragging||this.update()}onCanvasResized(){document.body.contains(this.parent)&&(this._state.isDragging||this.update(),this._state._svgClientRect=this.svg.getBoundingClientRect())}onKeyDown({keyEvent:e}){if(e.ctrlKey&&te(e)===m.GS.Digit0.keyCode)return this.fitToView(),!1}onClear(){this.isOpen()&&this.unsubscribeElementEvents(),this.elementRegistry.getAllElements().forEach(e=>this.removeElement(e))}subscribeUserEvent(e,t,n){g.event.bind(e,t,i=>{i.preventDefault(),i.stopPropagation(),n.call(this,i)})}onParentWheel(e){if(!e.ctrlKey||(this.updateSvgClientRect(),!this.isPointInside(e,this._state._svgClientRect)))return;const{deltaMode:t,deltaX:n,deltaY:i}=e,a=t===0?.02:.32,r=Math.sqrt(Math.pow(i,2)+Math.pow(n,2))*Math.sign(i)*-a;if(this._state.zoomDelta+=r,Math.abs(this._state.zoomDelta)>cn){const c=r>0?1:-1,h=Math.log(this.canvas.zoom())/Math.log(10),x=this.getStepSize(on,rn*2),E=Math.round(h/x)*x+x*c,T=Math.pow(10,E);this.zoomScroll.setZoom(T),this._state.zoomDelta=0;const I=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(I),this.update()}}update(){if(!this.isOpen())return;const e=this.canvas.viewbox(),t=e.inner,n=e.outer;if(!this.validViewbox(e))return;let i,a,r,c;const h=n.width-t.width,x=n.height-t.height;t.width<n.width?(i=t.x-h/2,r=n.width,t.x+t.width<n.width&&(i=Math.min(0,t.x))):(i=t.x,r=t.width),t.height<n.height?(a=t.y-x/2,c=n.height,t.y+t.height<n.height&&(a=Math.min(0,t.y))):(a=t.y,c=t.height),i=i-Se,a=a-Se,r=r+Se*2,c=c+Se*2,this.lastViewbox={x:i,y:a,width:r,height:c},(0,j.CF)(this.svg,{viewBox:i+", "+a+", "+r+", "+c}),(0,j.CF)(this.viewport,{x:e.x,y:e.y,width:e.width,height:e.height});const E=this.map.getBoundingClientRect();this._state._parentClientRect=E;const T=this.viewport.getBoundingClientRect(),I={top:T.top-E.top,left:T.left-E.left,width:T.width,height:T.height};(0,b.assign)(this.viewportDom.style,{top:I.top+"px",left:I.left+"px",width:I.width+"px",height:I.height+"px"});const G=this.getOverlayClipPath(E,I);(0,b.assign)(this.overlay.style,{clipPath:G})}setViewboxCenteredAroundClickEvent(e){this.updateSvgClientRect();const t=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(t),this.update()}onMousedown(e,t){if(t.button!==0)return;this.updateSvgClientRect(),e&&this.setViewboxCenteredAroundClickEvent(t);const n=this.mapMousePositionToDiagramPoint(t),i=this.canvas.viewbox(),a=this.getOffsetViewport(n,i),r=this.viewportDom.getBoundingClientRect(),c={x:t.clientX-r.left+1,y:t.clientY-r.top+1};(0,b.assign)(this._state,{cachedViewbox:i,initialDragPosition:{x:t.clientX,y:t.clientY},isDragging:!0,offsetViewport:a,offsetViewportDom:c,viewportClientRect:this.viewport.getBoundingClientRect(),parentClientRect:this.map.getBoundingClientRect()}),g.event.bind(document,"mousemove",this.onMousemove.bind(this)),g.event.bind(document,"mouseup",this.onMouseup.bind(this))}updateSvgClientRect(){(!this._state._svgClientRect||this.isZeroDimensional(this._state._svgClientRect))&&(this._state._svgClientRect=this.svg.getBoundingClientRect())}onMousemove(e){if(this._state.isDragging){this.updateSvgClientRect();const t=this._state.offsetViewportDom,n=this._state.viewportClientRect,i=this._state.parentClientRect;(0,b.assign)(this.viewportDom.style,{top:e.clientY-t.y-i.top+"px",left:e.clientX-t.x-i.left+"px"});const a=this.getOverlayClipPath(i,{top:e.clientY-t.y-i.top,left:e.clientX-t.x-i.left,width:n.width,height:n.height});(0,b.assign)(this.overlay.style,{clipPath:a});const r=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint({x:r.x-this._state.offsetViewport.x,y:r.y-this._state.offsetViewport.y})}}onMouseup(e){if(this._state.isDragging){const t=this._state.initialDragPosition;t.x===e.clientX&&t.y===e.clientY&&this.setViewboxCenteredAroundClickEvent(e),this.update(),(0,b.assign)(this._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),g.event.unbind(document,"mousemove",this.onMousemove.bind(this)),g.event.unbind(document,"mouseup",this.onMouseup.bind(this))}}_onZoomChanged(e){this.mapButtons.zoom.textContent=Math.round(e*100)+"%"}updateElement(e){try{e.parent!==void 0&&e.parent!==null&&(this.removeElement(e),this.addElement(e))}catch(t){console.warn(`Minimap#updateElement error: ${t}`)}}addElement(e){if(this.removeElement(e),e.hidden)return;let t,n,i;const a=this.createElement(e);if(a){const r=(0,g.query)("#"+ut()(e.parent.id),this.elementsGroup),c=this.elementRegistry.getGraphics(e),h=this.elementRegistry.getGraphics(e.parent),x=this.getIndexOfChildInParentChildren(c,h);return x!=="undefined"?r?r.childNodes.length>x?this.insertChildAtIndex(a,r,x):this.insertChildAtIndex(a,r,r.childNodes.length-1):this.elementsGroup.appendChild(a):this.elementsGroup.appendChild(a),this.diagramUtils.isConnection(e)?(t=e.parent,n=0,i=0,typeof t.x<"u"&&typeof t.y<"u"&&(n=-t.x,i=-t.y),(0,j.CF)(a,{transform:"translate("+n+" "+i+")",strokeWidth:"4"})):(n=e.x,i=e.y,r&&(t=e.parent,typeof t.x<"u"&&typeof t.y<"u"&&(n-=t.x,i-=t.y)),(0,j.CF)(a,{transform:"translate("+n+" "+i+")"})),e.children&&e.children.length&&e.children.forEach(E=>{this.addElement(E)}),a}}removeElement(e){const t=this.svg.getElementById(e.id);t&&(0,j.TF)(t)}createElement(e){const t=this.elementRegistry.getGraphics(e);if(t){const n=(0,an.P)(t);if(n){const i=(0,j.o8)(n);return(0,j.CF)(i,{id:e.id}),i}}}getOffsetViewport(e,t){return{x:e.x-(t.x+t.width/2),y:e.y-(t.y+t.height/2)}}mapMousePositionToDiagramPoint({clientX:e,clientY:t}){const n={x:e-this._state._svgClientRect.left,y:t-this._state._svgClientRect.top},i=this.svg.getBoundingClientRect(),a=this.fitAspectRatio(this.lastViewbox,i.width/i.height),r=this.mapPosition(n.x,0,i.width,a.x,a.x+a.width),c=this.mapPosition(n.y,0,i.height,a.y,a.y+a.height);return{x:r,y:c}}setViewboxCenteredAroundPoint(e){const t=this.canvas.viewbox(),n=t.width,i=t.height;this.canvas.viewbox({x:e.x-n/2,y:e.y-i/2,width:n,height:i})}fitAspectRatio(e,t){const n=e.width/e.height,i=(0,b.assign)({},{x:e.x,y:e.y,width:e.width,height:e.height});if(n>t){const a=i.width*(1/t),r=i.y-(a-i.height)/2;(0,b.assign)(i,{y:r,height:a})}else if(n<t){const a=i.height*t,r=i.x-(a-i.width)/2;(0,b.assign)(i,{x:r,width:a})}return i}mapPosition(e,t,n,i,a){const r=n-t,c=a-i;return(e-t)*c/r+i}getIndexOfChildInParentChildren(e,t){const n=(0,g.query)(".djs-children",t.parentNode);if(!n)return;const i=[].slice.call(n.childNodes);let a=-1;return i.forEach(function(r,c){(0,g.query)(".djs-element",r)===e&&(a=c)}),a}insertChildAtIndex(e,t,n){const a=[].slice.call(t.childNodes)[n];t.insertBefore(e,a.nextSibling)}isZeroDimensional(e){return e.width===0&&e.height===0}isPointInside(e,t){return e.x>t.left&&e.x<t.left+t.width&&e.y>t.top&&e.y<t.top+t.height}getStepSize(e,t){const n=Math.log(e.min)/Math.log(10),i=Math.log(e.max)/Math.log(10);return(Math.abs(n)+Math.abs(i))/t}getOverlayClipPath(e,t){return`polygon(${[[t.left,t.top],[t.left+t.width,t.top],[t.left+t.width,t.top+t.height],[t.left,t.top+t.height],[t.left,e.height],[e.width,e.height],[e.width,0],[0,0],[0,e.height],[t.left,e.height]].map(([i,a])=>`${i}px ${a}px`).join(", ")})`}validViewbox(e){return(0,b.every)(e,t=>(0,b.isObject)(t)?this.validViewbox(t):(0,b.isNumber)(t)&&isFinite(t))}subscribeElementEvents(){this.eventBus.on(["shape.added","connection.added"],m.nS.MIN,this._onElementAdded),this.eventBus.on(["shape.removed","connection.removed"],m.nS.MIN,this._onElementRemoved),this.eventBus.on(["elements.changed"],m.nS.MIN,this._onElementsChanged),this.eventBus.on(["element.updateId"],m.nS.MIN,this._onElementUpdateId)}unsubscribeElementEvents(){this.eventBus.off(["shape.added","connection.added"],this._onElementAdded),this.eventBus.off(["shape.removed","connection.removed"],this._onElementRemoved),this.eventBus.off(["elements.changed"],this._onElementsChanged),this.eventBus.off(["element.updateId"],this._onElementUpdateId)}onElementAdded({element:e}){this.addElement(e),this.update()}onElementRemoved({element:e}){this.removeElement(e),this.update()}onElementsChanged({elements:e}){e.forEach(t=>this.updateElement(t)),this.update()}onElementUpdateId({element:e,newId:t}){try{const n=(0,g.query)("#"+ut()(e.id),this.elementsGroup);n&&(n.id=t)}catch(n){console.warn(`Minimap#updateElementId error: ${n}`)}}registerPopupMenu(){this.popupMenu.registerProvider("zoom",this),this.eventBus.on("minimap.open",()=>this.popupMenu.close()),this.eventBus.on("minimap.close",()=>this.popupMenu.close())}delay(e=0){return new Promise(t=>f.delay(t,e))}loadData(){var e=this;return(0,$.A)(function*(){yield e.delay();let t=Number(new Date);const n=e.elementRegistry.getAllElements();for(let i=0,a=n.length;i<a;i++){try{e.addElement(n[i])}catch(c){console.error(c)}Number(new Date)-t>e.loadMiniMapRenderInterval&&(yield e.delay(),t=Number(new Date))}})()}open(){var e=this;return(0,$.A)(function*(){e.setOpenState(!0),yield e.loadData(),e.update(),e.subscribeElementEvents(),e.eventBus.fire("minimap.open")})()}close(){this.isOpen()&&(this.setOpenState(!1),this.unsubscribeElementEvents(),this.eventBus.fire("minimap.close"))}isOpen(){return this._state.isOpen}resetView(){var e=this;return(0,$.A)(function*(){yield e.zoomScroll.animateResetView()})()}fitToView(){this.zoomScroll.fitToView()}preview(){this.isOpen()?this.close():this.open()}togglePopupMenu(){if(this.popupMenu.isOpen()){this.popupMenu.close();return}this.popupMenu.open({},"zoom",{cursor:{}})}getEntries(){var e=this;return[...[25,50,75,100,200,300].map(n=>({id:`zoom-${n}`,label:`${n}%`,action:function(){var i=(0,$.A)(function*(){yield e.zoomScroll.animateZoom(n/100)});return function(){return i.apply(this,arguments)}}()})),{id:"separator-1",className:"entry-separator",disabled:!0},{id:"reset-view",label:this.config.localizableStrings.get("resetView"),action:()=>this.resetView()},{id:"fit-into-view",label:this.config.localizableStrings.get("fitToView"),action:()=>this.fitToView()}]}};we=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__param)(3,(0,o.Inject)("zoomScroll")),(0,s.__param)(4,(0,o.Inject)("localStorage")),(0,s.__param)(5,(0,o.Inject)("popupMenu")),(0,s.__param)(6,(0,o.Inject)("config")),(0,s.__param)(7,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,o.DiagramUtils])],we);var ln=l(35797);let Ye=class extends ln.A{constructor(e){super(e),this.modeling=e}moveShape(e,t){const n=e.allShapes;Object.values(n).forEach(i=>{this.modeling.moveShape(i,t,!1,{recurse:!1,layout:!1},null),this.moveConnectionLabel(i,t)})}moveConnectionLabel(e,t){(e.outgoing||[]).forEach(i=>{this.modeling.moveConnectionLabel(i,{delta:t})})}moveRecursiveShape(e,t){const n=this.getClosure(e.children);this.moveShape(n,t),this.moveConnectionLabel(e,t)}};Ye=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__metadata)("design:paramtypes",[H])],Ye);var dn=l(18587);let Oe=class extends dn.A{constructor(e,t){super(e,t),this.eventBus=e,this.canvas=t,e.on("diagram.init",m.nS.LOW,()=>{this.updateEntries()})}updateEntries(){const e=this.getEntries();(0,b.forEach)(e,function(t,n){const i=(0,g.query)(`[data-action="${n}"]`);t.hasOwnProperty("menu")&&(0,g.classes)(i).add("create-menu")})}getEntries(){return super.getEntries()}};Oe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],Oe);let Pe=class{constructor(e,t,n,i,a,r,c,h,x,E,T){this.create=e,this.elementFactory=t,this.palette=n,this.featureProvider=i,this.canvas=a,this.elements=r,this.paletteElements=c,this.rules=h,this.eventBus=x,this.createPopupMenu=E,this.config=T,this.dataActionPrefix="create-",this.init()}init(){this.rules.allowed("canShowPalette")&&(this.palette.registerProvider(this),this.subscribeEvents())}subscribeEvents(){this.eventBus.on("createPopupMenu.open",e=>this.activateEntry(e)),this.eventBus.on("createPopupMenu.close",e=>this.deactivateEntry(e))}getCreateShapeConfig(e){const t=this.elements.getConfig(e),{type:n,width:i,height:a}=t;return{type:n,width:i,height:a}}createActionClick(e,t){const n=this.getCreateShapeConfig(e),i=this.elementFactory.createShape(n);this.create.start(t,i),this.createPopupMenu.close()}openCreateMenu(e,t,n){this.createPopupMenu.open(e,t,n)}getCreateMenuEntries(e){return e.menu.map(t=>this.elements.items[t]).filter(t=>t).map(t=>({action:{dragstart:this.createActionClick.bind(this,t)},id:t.userTaskType||t.type,imageUrl:t.smallImage,label:this.config.localizableStrings.get(t.caption)}))}activateEntry({paletteEntryId:e}){const t=(0,g.query)(`[data-action="${e}"]`);(0,g.classes)(t).add("active")}deactivateEntry({paletteEntryId:e}){const t=(0,g.query)(`[data-action="${e}"]`);(0,g.classes)(t).remove("active")}getPaletteEntries(){const e={};return Object.values(this.paletteElements.getElements()).forEach(t=>{const n=this.dataActionPrefix+t.type,i={group:"elements",action:{dragstart:this.createActionClick.bind(this,t)},...t};if(t.menu){const a=this.getCreateMenuEntries(t);a.length?i.action.click=this.openCreateMenu.bind(this,t,n,a):delete i.menu}e[n]=i}),e}};Pe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("create")),(0,s.__param)(1,(0,o.Inject)("elementFactory")),(0,s.__param)(2,(0,o.Inject)("palette")),(0,s.__param)(3,(0,o.Inject)("featureProvider")),(0,s.__param)(4,(0,o.Inject)("canvas")),(0,s.__param)(5,(0,o.Inject)("elements")),(0,s.__param)(6,(0,o.Inject)("paletteElements")),(0,s.__param)(7,(0,o.Inject)("rules")),(0,s.__param)(8,(0,o.Inject)("eventBus")),(0,s.__param)(9,(0,o.Inject)("createPopupMenu")),(0,s.__param)(10,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,o.DiagramElements,o.DiagramPaletteElements,Object,Object,ee,Object])],Pe);let Ie=class{constructor(e,t,n,i,a){this.config=e,this.toolManager=t,this.dragging=n,this.lassoTool=i,this.spaceTool=a}getPaletteToolsConfig(){return{arrow:{icon:"icon_arrow_select_24",title:"arrow",click:()=>{this.toolManager.setActive(null),this.dragging.cancel()}},lasso:{icon:"icon_sellect_24",title:"lasso",click:()=>{this.lassoTool.toggle()}},space:{icon:"icon_move_24",title:"space",click:()=>{this.spaceTool.toggle()}}}}getPaletteTools(e=!0){const t={},n=this.getPaletteToolsConfig();return Object.keys(n).forEach(i=>{const{icon:a,title:r,click:c}=n[i];t[i]={group:"tools",html:`<div class="entry material-icons">${a}</div>`,title:this.config.localizableStrings.get(r),action:{click:c}}}),e?{...t,separator:{separator:!0}}:t}};Ie=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config")),(0,s.__param)(1,(0,o.Inject)("toolManager")),(0,s.__param)(2,(0,o.Inject)("dragging")),(0,s.__param)(3,(0,o.Inject)("lassoTool")),(0,s.__param)(4,(0,o.Inject)("spaceTool")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object])],Ie);var hn=l(6226);let Me=class extends hn.A{constructor(e,t,n){super(e,t,n),this.contextPadItemWidth=32,this.padding=10}subscribeEvents(){this.preventScrollParent(this.getContainer());const e=this._eventBus;e.once("createPopupMenu.open",this.close.bind(this)),e.once("element.mousedown",m.nS.HIGH,this.close.bind(this)),e.once("keyboard.keydown",m.nS.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this._eventBus;e.off("createPopupMenu.open",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}fixContainerPosition(e,t){const i=this._canvas.getContainer().getBoundingClientRect(),a=e.getBoundingClientRect(),r=i.y+this.padding;if(a.top<r){const c=this.padding,h=t.x-this.contextPadItemWidth-a.width-this.padding;(0,b.assign)(e.style,{top:`${c}px`,left:`${h}px`})}}getContainer(){return this._current.container}preventScrollParent(e){e.onwheel=t=>this.onWheel(t)}open(e,t,n){super.open(e,t,n);const i=this.getContainer();this.fixContainerPosition(i,n),this.subscribeEvents(),(0,b.assign)(i.style,{opacity:1})}close(){super.close(),this.unsubscribeEvents()}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._current.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};Me=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config.popupMenu")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object])],Me);var gn=l(38134);class mt extends gn.A{addDragger(e,t,n){const i=super.addDragger(e,t,n);return i.classList.add(e.type),i}}var Te=l(95820),pn=l(97975),Re=l(19187);const Y={Connection:{Fill:"none",MarkerShape:"M-10,3 L2,0 L-10,-3 Z",MarkerfillOpacity:1,StrokeLinejoin:"round",StrokeWidth:1,PathStrokeWidth:2}},ke={arrowHoverStrokeColor:"#1186D8",arrowStrokeColor:"#8095b3",connectionMarkerFillColor:"#FFFF",connectionMarkerStrokeColor:"#60779F",connectionStrokeColor:"#8095B3"};class ft{get endMarker(){const e=(0,j.vt)("path");return(0,j.CF)(e,{d:Y.Connection.MarkerShape,"fill-opacity":Y.Connection.MarkerfillOpacity,fill:ke.arrowStrokeColor,stroke:ke.arrowStrokeColor,strokeLinejoin:Y.Connection.StrokeLinejoin,strokeWidth:Y.Connection.StrokeWidth,class:m.Fx.ConnectionEndMarker}),e}_getLastSegment(e){const t=e.length;return{a:e[t-2],b:e[t-1]}}_getFirstSegment(e){return{a:e[1],b:e[0]}}_angle(e){const t=e.b.y-e.a.y,n=e.b.x-e.a.x;return Math.atan2(t,n)}_renderMarker(e,t,n,i){e&&(this._transformMarker(e,i,n),(0,j.BC)(t,e))}_transformMarker(e,t,n){(0,j.pd)(e,(0,j.uK)(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),n.x,n.y))}renderMarkers(e,t){const n=t.waypoints,i=this._getLastSegment(n),a=this._angle(i),r=this._getFirstSegment(n),c=this._angle(r),h=this.startMarker(t);this._renderMarker(h,e,r.b,c),this._renderMarker(this.endMarker,e,i.b,a)}startMarker(e){return null}getConnectionAttributes(e){return{class:m.Fx.Connection,fill:Y.Connection.Fill,stroke:ke.connectionStrokeColor,strokeLinejoin:Y.Connection.StrokeLinejoin,strokeWidth:Y.Connection.PathStrokeWidth}}drawConnection(e,t,n){n.itemName&&(0,j.CF)(t,{"data-item-marker":n.itemName});const i=(0,j.vt)("g"),a=this.getConnectionAttributes(n.type),r=n.waypoints,c=["m"+r[0].x+","+r[0].y];for(let x=1;x<r.length;x++)c.push("L"+r[x].x+","+r[x].y);const h=(0,j.vt)("path");return(0,j.CF)(h,{d:c.join(" ")}),(0,j.CF)(h,a),(0,j.BC)(i,h),this.renderMarkers(i,n),(0,j.BC)(t,i),i}}var Ze=l(66262);class Xe{drawConnection(e,t,n){}}(0,s.__decorate)([(0,Ze._E)(()=>!0,ft),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,Object,Object]),(0,s.__metadata)("design:returntype",Object)],Xe.prototype,"drawConnection",null);var un=l(49096);const mn=4,fn=4,yn=5,Qe=3.5,vn=1,bn=16.8699;let Le=class{constructor(e,t,n,i,a,r,c){this.eventBus=e,this.directEditing=t,this.canvas=n,this.modeling=i,this.diagramText=a,this.selection=r,this.rules=c,this.directEditing.registerProvider(this),this.rules.allowed("canLabelEdit")?this.subscribeEvents():this.subscribeSelectionEvents()}clearLabelTargetsCaption(e){const t=f.compact(f.map(e.elements,n=>n.labelTarget));f.forEach(t,n=>this.clearElementCaption(n))}clearElementCaption(e){e.caption="",this.eventBus.fire(o.Handlers.element.updateLabelExecuted,{context:{element:e,text:""}})}onKeyDown({keyEvent:e}){const t=this.selection.get(),n=t.length===1&&t[0];if(n){if(te(e)===m.GS.Enter.keyCode)return f.defer(()=>this.editElementLabel(n)),!1;if(dt(e))return n.needClearCaption=!0,this.editElementLabel(n),!1}}_copySelectedLabelText(){const e=this.selection.get(),t=e.length===1&&e[0];if(!t)return;const n=t.labelTarget.caption,i=a=>{(a.clipboardData||window.clipboardData).setData("text",n),a.preventDefault()};document.addEventListener("copy",i,!1),document.execCommand("copy"),document.removeEventListener("copy",i,!1)}_selectLabelText(e){const t=document.createRange(),n=document.querySelector(`[data-element-id="${e.id}"] .foreign-text`);t.selectNodeContents(n);const i=window.getSelection();i.removeAllRanges(),i.addRange(t)}showElementLabel(e){const t=e.active&&e.active.element.label;t&&this.canvas.removeMarker(t,"djs-element-hidden")}subscribeSelectionEvents(){this.eventBus.on(["element.dblclick"],({element:e})=>{e.type===o.ElementType.label&&this._selectLabelText(e)}),this.eventBus.on(["keyboard.keydown"],({keyEvent:e})=>{W(e,m.GS.KeyC,{ctrl:!0})&&this._copySelectedLabelText()})}subscribeEvents(){this.eventBus.on(["element.dblclick"],e=>this.editElementLabel(e.element)),this.eventBus.on(["canvas.viewbox.changing","element.mousedown","popupMenu.open"],()=>{this.directEditing.isActive()&&this.directEditing.complete()}),this.eventBus.on(["drag.init"],e=>{if(this.directEditing.isActive()){this.directEditing.complete();const t=e.shape;t&&t.x&&t.y&&this.selection.select(t)}}),this.eventBus.on(["create.end"],m.nS.LOW,e=>this.onCreateEnd(e)),this.eventBus.on(["connect.end"],m.nS.LOW,e=>{const t=e.context.connection;this.editElementLabel(t)}),this.eventBus.on(["directEditing.activate"],e=>{const t=e.active.element.label;t&&this.canvas.addMarker(t,"djs-element-hidden")}),this.eventBus.on(["directEditing.complete","directEditing.cancel"],e=>this.showElementLabel(e)),this.eventBus.on([o.Handlers.element.deleteElementsExecuted],e=>this.clearLabelTargetsCaption(e.context)),this.eventBus.on(["keyboard.keydown"],e=>this.onKeyDown(e))}onCreateEnd(e){const t=e.shape;e.context.canExecute&&this.editElementLabel(t)}editElementLabel(e){e.constructor!==un.bL&&this.directEditing.activate(e.labelTarget||e)}getPadding(e,t){return f.mapValues(e,n=>n*t)}getBoxBounds(e){let t;const n=this.canvas,i=n.zoom(),a=o.Labels.label.width*i,r=this.getPadding(o.Labels.label.padding,i),c=r.paddingTop,h=r.paddingBottom,x=e.label,E=1;if(x){const I=n.getAbsoluteBBox(x);t={height:I.height+c+h,width:a,minHeight:o.Labels.label.minHeight,x:Math.round(I.x+I.width/2-a/2),y:Math.round(I.y-c)}}else{const I=this.diagramText.style,U=I.fontSize*I.lineHeight*i+c+h+E*2,pe={height:U/i,width:a/i},ii=this.diagramText.getLabelPosition(e,pe),Bt=n.getAbsoluteBBox(ii);t={height:U,width:a,x:Math.round(Bt.x-a/2),y:Math.round(Bt.y-c-E)}}const T=e.width?e.width+(Qe+E)*2:o.Labels.label.minWidth;return t.minWidth=T*i,t}getTextStyle(e,t,n){const i=t.fontSize*e;return{...t,fontSize:`${i}px`,padding:`${n.paddingTop}px ${n.paddingRight}px ${n.paddingBottom}px ${n.paddingLeft}px`}}getElementStyle(e){const t=this.canvas.zoom(),n=f.cloneDeep(this.diagramText.style),i=o.Labels.label.padding;return this.getTextStyle(t,n,this.getPadding(i,t))}activate(e){const t=this.getBoxBounds(e),n=this.getElementStyle(e),i=["djs-direct-editing-parent"];let a;return e.needClearCaption?(a="",e.needClearCaption=!1):a=e.caption||"",{autoResize:!0,bounds:t,centerVertically:!0,options:{autoResize:!0,classList:i},style:n,text:a}}update(e,t,n){this.modeling.updateLabel(e,t)}};Le=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("directEditing")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("modeling")),(0,s.__param)(4,(0,o.Inject)("diagramText")),(0,s.__param)(5,(0,o.Inject)("selection")),(0,s.__param)(6,(0,o.Inject)("rules")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,H,Object,Object,Object])],Le);var _n=l(22170);let Be=class extends _n.A{constructor(e,t,n,i){super(e,t,n),this.eventBus=t,this.modeling=n,this.diagramText=i,this.subscribeEvents()}onMoveConnectionLabel(e){const t=e.context,i=t.connection.label;if(i){const a=t.hints.delta;this.modeling.moveShape(i,a)}}onReconnectStart(e){const{connection:t,hints:n,newSource:i,oldSource:a}=e.context,r=t.label,c=n&&n.doUpdateLabelPosition;if(r&&c){const h={x:i.x-a.x,y:i.y-a.y};this.modeling.moveShape(r,h)}}subscribeEvents(){this.eventBus.on([o.Handlers.connection.moveConnectionLabel],this.onMoveConnectionLabel.bind(this)),super.postExecute(["connection.updateWaypoints"],this.onUpdateWaypoints.bind(this)),super.postExecute(["connection.layout"],this.onConnectionLayout.bind(this)),super.postExecute(["connection.reconnectStart"],this.onReconnectStart.bind(this)),super.postExecute(["shape.replace"],e=>{const t=e.context.newShape;this.modeling.updateLabel(t,t.caption)})}onConnectionLayout(e){const n=e.context.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const a=this.getLabelOffset(n.waypoints,i);this.modeling.moveShape(i,a)}getLabelOffset(e,t){const n=this.diagramText.getConnectionLabelPosition(e,t);return{x:n.x-t.x-Math.round(t.width/2),y:n.y-t.y-Math.round(t.height/2)}}canMoveLabel(e,t){const{connection:n,hints:i,oldWaypoints:a,newSource:r}=e.context,c=i&&i.doUpdateLabelPosition;return t&&(!f.isEqual(n.waypoints,a)||r)&&c!==!1}onUpdateWaypoints(e){const t=e.context,n=t.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const a=this.getLabelOffset(n.waypoints,i),r=this.getLabelOffset(t.oldWaypoints,i),c={x:a.x-r.x,y:a.y-r.y};this.modeling.moveShape(i,c)}};Be=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("modeling")),(0,s.__param)(3,(0,o.Inject)("diagramText")),(0,s.__metadata)("design:paramtypes",[Object,Object,H,z])],Be);class yt{constructor(e){this._parent=e.useRtl?(0,g.domify)('<div><textarea rows="1" dir="rtl" style="direction: rtl;" class="djs-direct-editing-content"></textarea></div>'):(0,g.domify)('<div><textarea rows="1" class="djs-direct-editing-content"></textarea></div>'),this.container=e.container,this._textArea=(0,g.query)(".djs-direct-editing-content",this._parent),this.keyHandler=e.keyHandler||(()=>{}),this._mousedown=t=>{t.stopPropagation()},this.resizeHandler=e.resizeHandler||(()=>{}),this.autoResize=this.autoResize.bind(this)}create(e,t,n,i){const a=this._parent,r=this._textArea,c=this.container;i=this._options=i||{},t=this._style=t||{};const h=f.pick(t,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);f.assign(a.style,{boxSizing:"border-box",left:e.x+"px",outline:"none",overflow:"visible",position:"absolute",textAlign:"center",top:e.y+"px",wordWrap:"normal",width:e.width+"px"},h);const x=f.pick(t,["borderLeft","fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return f.assign(r.style,{boxSizing:"border-box",outline:"none",wordWrap:"break-word",width:e.minWidth+"px",maxHeight:e.maxHeight+"px",maxWidth:(e.maxWidth||e.width)+"px",minHeight:e.minHeight+"px",minWidth:e.minWidth+"px"},x),i.centerVertically&&f.assign(r.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},x),r.value=n,g.event.bind(r,"keydown",this.keyHandler),g.event.bind(r,"mousedown",this._mousedown),g.event.bind(r,"paste",this._handlePaste),g.event.bind(r,"keydown",this.autoResize),g.event.bind(r,"blur",this.blur),a.className="djs-direct-editing-parent",i.classList&&a.classList.add(...i.classList),c.appendChild(a),this._textArea.selectionStart=n.length,this._textArea.selectionEnd=n.length,this._textArea.focus(),n&&this.resizeWidth(),this.resizeHeight(),a}resizeHeight(){this._textArea.style.height="auto",this._textArea.style.height=this._textArea.scrollHeight+"px"}resizeWidth(){this._textArea.style.width="auto",this._textArea.style.width=this._textArea.scrollWidth+"px"}autoResize(){f.defer(()=>{if(this._textArea.scrollHeight>0){const e=this._textArea.getBoundingClientRect();this.resizeWidth(),this.resizeHeight(),this.resizeHandler({dx:0,dy:this._textArea.scrollHeight-e.height,height:e.height,width:e.width})}})}destroy(){const e=this._parent,t=this._textArea;t.value="",e.removeAttribute("style"),t.removeAttribute("style"),g.event.unbind(t,"keydown",this.keyHandler),g.event.unbind(t,"mousedown",this._mousedown),g.event.unbind(t,"keydown",this.autoResize),g.event.unbind(t,"blur",this.blur),(0,g.remove)(e)}getValue(){return this._textArea.value}}let Ae=class{constructor(e,t,n,i,a,r,c){this._eventBus=e,this._canvas=t,this._elementRegistry=n,this._graphicsFactory=i,this._diagramText=a,this.config=r,this._providers=[],this._textbox=c||new yt({useRtl:r.isRtl}),this._textbox.container=t.getContainer(),this._textbox.keyHandler=this._handleKey.bind(this),this._textbox.blur=this._blur.bind(this),this._textbox.resizeHandler=this.handleResize.bind(this),this._eventBus.on("diagram.destroy",1e3,this.deactivate,this)}_handleKey(e){if(te(e)===m.GS.Escape.keyCode){e.stopPropagation(),e.preventDefault(),this.cancel();return}ht(e)&&gt(e,()=>this.complete())}_blur(){this.complete()}_fire(e,t){t=t||{active:this.active},this._eventBus.fire("directEditing."+e,t)}handleResize(e){this._fire("resize",e)}getNewBounds(){const e=this.activeTextbox.getBoundingClientRect();return{x:e.top,y:e.left,width:e.width,height:e.height}}registerProvider(e){this._providers.push(e)}isActive(){return!!this.active}cancel(){this.active&&this.close("cancel")}animate(e){const t=this.activeTextbox.classList;if(!(t&&t.contains("djs-direct-editing-rotate-90")))return;const i="djs-direct-editing-rotate-0";e?t.add(i):t.remove(i)}deactivate(){this._textbox.destroy(),this._fire("deactivate",null),this.active=null}close(e){this.animate(!1),this._fire(e,null),this.deactivate()}complete(){const e=this.active;if(!e)return;const t=this.getValue();e.provider.update(e.element,t,this.getNewBounds()),this.close("complete")}getValue(){return this._textbox.getValue()}activate(e){this.isActive()&&this.cancel();let t=null;this.initialHeight=e.height,this.initialWidth=e.width;const n=this._providers.find(i=>(t=i.activate(e),t?i:null));return t&&(this.activeTextbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this.active={element:e,context:t,provider:n},this.animate(!0),this._fire("activate",null)),!!t}};Ae=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__param)(3,(0,o.Inject)("graphicsFactory")),(0,s.__param)(4,(0,o.Inject)("diagramText")),(0,s.__param)(5,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object])],Ae);var vt;let ne=class{constructor(e,t,n,i){this.elements=e,this.styles=t,this.diagramText=n,this.eventBus=i}updateClass(e,t){const n=this.elements.getConfig(t),i=e.parentElement||e.parentNode,a=i.classList;(0,f.forEach)(this.elements.items,r=>{a.remove(r.type),a.remove(r.userTaskType)}),i.classList.add(n.userTaskType||n.type)}createText(e,t,n){const i=this.diagramText.createText(t,n);return(0,j.Ly)(i).add("djs-label"),n.className&&(0,j.Ly)(i).add(n.className),(0,j.BC)(e,i),i}drawRect(e,t,n,i,a,r){(0,f.isObject)(a)&&(r=a,a=0),a=a||0,r=this.styles.computeStyle(r,{fill:"none",stroke:"#EBEBEB",strokeWidth:1});const c=(0,j.vt)("rect");return(0,j.CF)(c,{height:n-a*2,rx:i,ry:i,width:t-a*2,x:a,y:a}),(0,j.CF)(c,r),(0,j.BC)(e,c),c}draw(e,t){return this.updateClass(e,t),null}};ne=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("elements")),(0,s.__param)(1,(0,o.Inject)("styles")),(0,s.__param)(2,(0,o.Inject)("diagramText")),(0,s.__param)(3,(0,o.Inject)("eventBus")),(0,s.__metadata)("design:paramtypes",[Object,typeof(vt=typeof Re.A<"u"&&Re.A)=="function"?vt:Object,z,Object])],ne);const bt={ELLIPSE:"ellipse",RECTANGLE:"rect"};var xn=l(50079);class Je extends ne{getEllipseBackgroundConfig(e){const n=e.backgroundStyle.padding||0,i=Math.round(Math.max(e.width,e.height)/2),a=Math.round(e.height/2);return{rx:i+n,ry:a+n,cx:Math.round(e.width/2),cy:Math.round(e.height/2-1)}}getLabelBackgroundConfig(e){const t=e.backgroundStyle,i=(t&&t.type)===bt.ELLIPSE?this.getEllipseBackgroundConfig(e):this.getDefaultBackgroundConfig(e),a=t&&t.fill;f.assign(i,a?{fill:a}:{style:"fill: transparent;"});const r=t&&t.filter;if(r){const c=xn.Y.createShadowFilter(r);f.assign(i,{filter:c})}return i}setLabelBackground(e,t){const n=t.backgroundStyle,i=n&&n.type||bt.RECTANGLE,a=(0,j.vt)(i),r=this.getLabelBackgroundConfig(t);(0,j.CF)(a,r),(0,j.BC)(e,a)}getDefaultBackgroundConfig(e){return{height:e.height,width:e.width}}getLabelText(e){return e.caption||e.labelTarget&&e.labelTarget.caption||""}getDrawOptions(e){const t=e.caption?0:3,n={box:{height:e.height,width:e.width+t,x:e.x,y:e.y},fitBox:!1,style:{...this.diagramText.style,direction:"ltr"}};return f.assign(n.style,e.style),n}draw(e,t){super.draw(e,t),this.setLabelBackground(e,t);const n=this.getLabelText(t),i=this.getDrawOptions(t),a=this.diagramText.createText(n,i);return(0,j.Ly)(a).add("djs-label"),(0,j.BC)(e,a),a}}let he=class{constructor(e,t){this.renderingLabel=e,this.renderingShape=t}create(e){return e===o.DiagramElementType.label?this.renderingLabel:this.renderingShape}};he=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("renderingLabel")),(0,s.__param)(1,(0,o.Inject)("renderingShape")),(0,s.__metadata)("design:paramtypes",[Je,ne])],he);var _t,xt;let ge=class extends pn.A{constructor(e,t,n,i,a){super(e),this.eventBus=e,this.styles=t,this.diagramText=n,this.renderingFactory=i,this.elementRegistry=a}setDataItemMarker(e,t){let n=t.itemName;if(t.type===o.DiagramElementType.label){const i=t.labelTarget.itemName;n=n||i&&i+"_label"}n&&e.setAttributeNS(null,"data-item-marker",n)}canRender(){return!0}drawShape(e,t){return this.setDataItemMarker(e,t),this.renderingFactory.create(t.type).draw(e,t)}drawConnection(e,t){return super.drawConnection(e,t)}createFeatureContext(){return{styles:this.styles,diagramText:this.diagramText,elementRegistry:this.elementRegistry}}};(0,s.__decorate)([(0,Ze.$8)(Xe,Ze.TG.instead),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,Object]),(0,s.__metadata)("design:returntype",void 0)],ge.prototype,"drawConnection",null),ge=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("styles")),(0,s.__param)(2,(0,o.Inject)("diagramText")),(0,s.__param)(3,(0,o.Inject)("renderingShapeFactory")),(0,s.__param)(4,(0,o.Inject)("elementRegistry")),(0,s.__metadata)("design:paramtypes",[typeof(_t=typeof Te.A<"u"&&Te.A)=="function"?_t:Object,typeof(xt=typeof Re.A<"u"&&Re.A)=="function"?xt:Object,Object,he,Object])],ge);let Ue=class{constructor(e,t,n,i,a){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.config=i,this.diagramUtils=a,this.highlightClassName="animated",this.subscribeEvents()}get supportHighlight(){return this.config.isReadOnly}onSelectionChanged(e){const{newSelection:t,oldSelection:n}=e;n.forEach(i=>this.changeConnectionSelection(i,!1)),t.forEach(i=>this.changeConnectionSelection(i,!0))}changeConnectionSelection(e,t){const n=this.elementRegistry.filter(i=>i.source===e||i.target===e);n.forEach(i=>{t?this.canvas.addMarker(i,this.highlightClassName):this.canvas.removeMarker(i,this.highlightClassName)}),this.bringToFront(n,e)}bringToFrontElement(e){this.canvas.bringToFrontElement(e)}subscribeEvents(){this.supportHighlight&&this.eventBus.on(["selection.changed"],m.nS.LOW,e=>this.onSelectionChanged(e))}bringToFront(e,t){e.forEach(i=>this.bringToFrontElement(i)),this.elementRegistry.filter(i=>!this.diagramUtils.isConnection(i)).forEach(i=>this.bringToFrontElement(i)),this.bringToFrontElement(t)}};Ue=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__param)(3,(0,o.Inject)("config")),(0,s.__param)(4,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,o.DiagramUtils])],Ue);var Cn=l(19506);let Fe=class extends Cn.A{constructor(e,t,n,i,a,r,c,h){super(n,t,e,i,a,r),this.elements=c,this.diagramUtils=h,this.AXIS_TO_DIMENSION={x:"width",y:"height"}}_excludeLabelsWithoutTargets(e){return e.filter(t=>t.type===o.ElementType.label?e.some(n=>n.id===t.labelTarget.id):!0)}calculateAdjustments(e,t,n,i){const a=[],r=[];return e.forEach(c=>{const h=c[t],x=h+c[this.AXIS_TO_DIMENSION[t]];if(c.parent&&!c.waypoints){if(!this.canResizeShape(c,i,t)&&(n>0&&h>i||n<0&&x<i))return a.push(c);if(this.canResizeShape(c,i,t)||h<i&&x>i&&this._rules.allowed("shape.resize",{shape:c}))return r.push(c)}}),{movingShapes:this._excludeLabelsWithoutTargets(a),resizingShapes:this._excludeLabelsWithoutTargets(r)}}init(e,t){const n=super.init(e,t);return n&&(t.minAllowedDelta=this.getMinAllowedDelta(t.resizingShapes,t.direction,t.movingShapes),t.spaceToolConstraints=null),n}getDelta(e){const t=super.getDelta(e);return o.DiagramUtils.getCorrectSpaceToolDelta(t,e)}canResizeShape(e,t,n){return!1}getMinAllowedDelta(e,t,n){return null}};Fe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("dragging")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("modeling")),(0,s.__param)(4,(0,o.Inject)("rules")),(0,s.__param)(5,(0,o.Inject)("toolManager")),(0,s.__param)(6,(0,o.Inject)("elements")),(0,s.__param)(7,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,o.DiagramElements,o.DiagramUtils])],Fe);var jn=l(7264);class Ct extends jn.A{getDelta(e){const t=super.getDelta(e);return o.DiagramUtils.getCorrectSpaceToolDelta(t,e)}}var jt=l(40127),En=l(436),Dn=l(56165),qe=l(62278),et=l(36486),Et,Dt,St;const Sn={min:.2,max:4};let ze=class extends En.A{constructor(e,t,n,i,a,r){super(e,t,n),this.config=e,this.eventBus=t,this.canvas=n,this.createPopupMenu=i,this.popupMenu=a,this.localStorage=r,this.cancelAnimation$=new qe.Subject,this.eventBus.on(["canvas.viewbox.changed"],m.nS.MEDIUM,c=>{this.onCanvasViewBoxChanged(c)})}cancelAnimation(){this.cancelAnimation$.next(!0)}_handleWheel(e){if(this.cancelAnimation(),this.createPopupMenu.isOpen()){this.createPopupMenu.onWheel(e);return}if(this.popupMenu.isOpen()){this.popupMenu.onWheel(e);return}super._handleWheel(e)}onCanvasViewBoxChanged(e){const t=this.canvas.scroll();t.x=Math.round(t.x)||0,t.y=Math.round(t.y)||0;const n=this.getInitScroll();t.x!==n.x||t.y!==n.y?this.localStorage.set("scroll",t):this.localStorage.remove("scroll");const i=e.viewbox.scale;i&&i!==this.getInitScale()?this.localStorage.set("scale",i):this.localStorage.remove("scale")}getInitScale(){return this.config&&this.config.initScale||1}getInitScroll(){return this.config&&this.config.initScroll||{x:0,y:0}}getScale(){return this.canvas.viewbox().scale}getScroll(){return this.canvas.scroll()}setZoom(e){const t=this.canvas.viewbox().outer,n={x:t.width/2,y:t.height/2};this.canvas.zoom((0,Dn.N)(Sn,e),n)}setScroll(e){const t=this.getScroll();this.canvas.scroll({dx:-t.x+e.x,dy:-t.y+e.y})}animateZoomScroll({toScale:e,toScroll:t,fromScale:n=null,fromScroll:i=null,stepCount:a=20,stepPeriod:r=1}){var c=this;return(0,$.A)(function*(){if(c.cancelAnimation(),n=n||c.getScale(),i=i||c.getScroll(),n===e&&i.x===t.x&&i.y===t.y)return;const h=(e-n)/a,x=(t.x-i.x)/a,E=(t.y-i.y)/a;return new Promise(T=>{(0,qe.interval)(r).pipe((0,et.take)(a+1),(0,et.takeUntil)(c.cancelAnimation$),(0,et.finalize)(()=>{c.eventBus.fire("animateZoomScroll.done"),T()})).subscribe(I=>{c.setZoom(n+h*I),c.setScroll({x:i.x+x*I,y:i.y+E*I})})})})()}animateZoom(e){var t=this;return(0,$.A)(function*(){const n=t.getScroll();yield t.animateZoomScroll({toScale:e,toScroll:n,stepCount:5,stepPeriod:1})})()}initZoomScroll(e=null,t=0){const n=e||this.localStorage.get("scroll")||this.getInitScroll(),i=t||this.localStorage.get("scale")||this.getInitScale();this.getScale()!==i&&this.setZoom(i);const r=this.getScroll();(r.x!==n.x||r.y!==n.y)&&this.setScroll(n)}animateResetView(){var e=this;return(0,$.A)(function*(){yield e.animateZoomScroll({toScale:e.getInitScale(),toScroll:e.getInitScroll()})})()}fitToView(){this.cancelAnimation(),this.canvas.zoom("fit-viewport",null);const e=this.getInitScroll();this.canvas.scroll({dx:e.x,dy:e.y})}zoomOut(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()-e)}zoomIn(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()+e)}};ze=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("createPopupMenu")),(0,s.__param)(4,(0,o.Inject)("popupMenu")),(0,s.__param)(5,(0,o.Inject)("localStorage")),(0,s.__metadata)("design:paramtypes",[Object,typeof(Et=typeof Te.A<"u"&&Te.A)=="function"?Et:Object,typeof(Dt=typeof oe.A<"u"&&oe.A)=="function"?Dt:Object,ee,typeof(St=typeof jt.A<"u"&&jt.A)=="function"?St:Object,X])],ze);class tt{constructor(e){this.context=e,this.modeling=e.modeling,this.localizableStrings=e.localizableStrings,this.canvas=e.canvas,this.contextPad=e.contextPad,this.popupMenu=e.popupMenu,this.connect=e.connect,this.create=e.create,this.elementFactory=e.elementFactory,this.elements=e.elements,this.elementToolsConfig=e.elementToolsConfig}getAddItemsConfig(e){const t=this.elementToolsConfig.addItems,n={};return t.forEach(i=>{const a=this.addElementDragStart.bind(this,i);n["add."+i.type]={action:{dragstart:a},imageUrl:i.image,title:i.title}}),n}getDragStartShapeConfig(e){const t=this.elements.getConfig(e);return{type:e.type,width:t.width,height:t.height,caption:""}}addElementDragStart(e,t,n){const i=this.getDragStartShapeConfig(e),a=this.elementFactory.createShape(i);this.create.start(t,a,{source:n})}getDeleteConfig(e){return{delete:{action:{click:()=>{this.modeling.removeElements([e])}},...this.elementToolsConfig.tools.delete}}}getSetupConfig(){return{setup:{action:{click:(e,t)=>{const n=this.getPopupMenuPosition(e,t);this.popupMenu.open(t,"setup",n)}},...this.elementToolsConfig.tools.setup}}}getPopupMenuPosition(e,t){const n=this.canvas.getContainer().getBoundingClientRect(),i=this.contextPad.getPad(t).html.getBoundingClientRect();return{cursor:{x:e.clientX,y:e.clientY},x:i.left+i.width+3-n.left,y:i.top-1-n.top}}getConnectConfig(){return{connect:{action:{dragstart:(e,t,n)=>{this.connect.start(e,t,n)}},...this.elementToolsConfig.tools.connect}}}hasSetupMenu(e){return!this.popupMenu.isEmpty(e,"setup")}hasConnectConfig(e){return e.type&&e.type!==o.DiagramElementType.connection}hasAddItemsMenu(e){return!0}hasDeleteAction(e){return!0}getContextPadEntries(e){const t={};return this.hasDeleteAction(e)&&Object.assign(t,this.getDeleteConfig(e)),this.hasSetupMenu(e)&&Object.assign(t,this.getSetupConfig()),this.hasAddItemsMenu(e)&&Object.assign(t,this.getAddItemsConfig(e)),this.hasConnectConfig(e)&&Object.assign(t,this.getConnectConfig()),t}}class wt extends tt{getContextPadEntries(){return{}}}class Ot{constructor(e){this.context=e}getElementToolsFeature(e){return o.DiagramUtils.isLabel(e)?new wt(this.context):new tt(this.context)}}let He=class{constructor(e,t,n,i,a,r,c,h,x,E){this.elements=x,this.elementToolsConfig=E;const T=h.localizableStrings;t.registerProvider(this);const I={modeling:n,localizableStrings:T,contextPad:t,canvas:c,popupMenu:r,elementFactory:i,create:a,connect:e,elements:x,elementToolsConfig:E};this.initializeElementToolsFactory(I)}initializeElementToolsFactory(e){this.toolsFactory=new Ot(e)}getContextPadEntries(e){return this.toolsFactory.getElementToolsFeature(e).getContextPadEntries(e)}};He=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("connect")),(0,s.__param)(1,(0,o.Inject)("contextPad")),(0,s.__param)(2,(0,o.Inject)("modeling")),(0,s.__param)(3,(0,o.Inject)("elementFactory")),(0,s.__param)(4,(0,o.Inject)("create")),(0,s.__param)(5,(0,o.Inject)("popupMenu")),(0,s.__param)(6,(0,o.Inject)("canvas")),(0,s.__param)(7,(0,o.Inject)("config")),(0,s.__param)(8,(0,o.Inject)("elements")),(0,s.__param)(9,(0,o.Inject)("elementToolsConfig")),(0,s.__metadata)("design:paramtypes",[Object,Object,H,Object,Object,Object,Object,Object,o.DiagramElements,Object])],He);class Pt{constructor(){this._featureService=new qe.ReplaySubject(1)}set featureService(e){this._featureService.next(e)}getFeatureServiceValues(e){return this._featureService.subscribe(t=>{t.getFeatureValues(n=>{e(n)})})}}var wn=l(44777);class It{findIntersectSegment(e,t){const n={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};let i=-1,a;const r=e.waypoints;for(let c=0;c<r.length-1;c++){const h={x1:r[c].x,y1:r[c].y,x2:r[c+1].x,y2:r[c+1].y},x=n,E={x1:Math.min(h.x1,h.x2)-1,y1:Math.min(h.y1,h.y2)-1,x2:Math.max(h.x1,h.x2)+1,y2:Math.max(h.y1,h.y2)+1},T=Math.max(0,Math.min(E.x2,x.x2)-Math.max(E.x1,x.x1)),I=Math.max(0,Math.min(E.y2,x.y2)-Math.max(E.y1,x.y1)),G=T*I;(G>i||i<0)&&(i=G,a=h)}return a}getAlignDelta(e,t){let n=0,i=0;const a=(0,Z.pp)(t);return e.x1===e.x2?n=e.x1-a.x:i=e.y1-a.y,{x:n,y:i}}isForbiddenType(e){return o.DiagramUtils.isLabel(e)}canSplit(e){return e&&e.length===1&&!this.isForbiddenType(e[0])}splitConnection({connection:e,shapes:t,modeling:n}){if(e&&this.canSplit(t)){const i=t[0],a=e.target,r=this.findIntersectSegment(e,i),c=this.getAlignDelta(r,i);n.moveShape(i,c);const h=(0,y.jz)(i);n.reconnectEnd(e,i,h,{isUpdateConnectionType:!1}),n.connect(i,a,{})}}}var On=l(10033),nt=l(74419);let Ke=class extends On.A{constructor(e,t){super(),this.connectionDocking=e,this.config=t}isStraightConnection(e,t,n){return!0}isShapeCenter(e,t){const{height:n,width:i,x:a,y:r}=t,c=Math.floor(e.x-a-i/2),h=Math.floor(e.y-r-n/2);return c===0&&h===0}getPreferredDirectionWithPoint(e,t){const n=t.x+t.width/2,i=t.y+t.height/2,a=e.x-n,r=e.y-i;let c;return a<0?r<0?c=-a>-r?"l":"t":c=-a>r?"l":"b":r<0?c=a>-r?"r":"t":c=a>r?"r":"b",c}getBoundingRect(e){const n=e.y-10,i=e.x+e.width+10,a=e.y+e.height+10,r=e.x-10;return{top:n,right:i,bottom:a,left:r}}findSourceLayout(e,t,n,i){let a;const r=this.getBoundingRect(e),c=this.getBoundingRect(t);switch(n){case"t":a=c.top<=r.bottom?"t":"b";break;case"b":a=c.bottom<=r.top?"t":"b";break;case"l":a=r.right<=c.left?"r":"l";break;case"r":a=c.right<=r.left?"l":"r";break}return a===n&&(i==="h"&&["r","l"].includes(n)&&(r.top>c.bottom?a="t":r.bottom<c.top||r.bottom>=c.bottom?a="b":a="t"),i==="v"&&["t","b"].includes(n)&&(r.left>c.right?a="l":r.right>=c.right||r.right<c.left?a="r":a="l")),a}getPreferredLayouts(e,t,n,i={}){const a=(0,Z.pp)(e),r=(0,Z.pp)(t),c=Math.abs(a.x-r.x),h=Math.abs(a.y-r.y),x=c<h?"v":"h";let E;const T=i.connectionStart;if(T)this.isShapeCenter(T,e)||(E=this.getPreferredDirectionWithPoint(T,e));else{const U=n&&n[0],pe=U&&(U.original||o.DiagramUtils.getOriginalWaypoint(U,e));U&&!this.isShapeCenter(pe,e)&&(E=this.getPreferredDirectionWithPoint(U,e))}let I;const G=i.connectionEnd;if(G)this.isShapeCenter(G,t)||(I=this.getPreferredDirectionWithPoint(G,t));else{const U=n&&n.slice(-1)[0],pe=U&&(U.original||o.DiagramUtils.getOriginalWaypoint(U,t));U&&!this.isShapeCenter(pe,t)&&(I=this.getPreferredDirectionWithPoint(U,t))}return!E&&I&&(E=this.findSourceLayout(e,t,I,x)),E&&!I&&(I=this.findSourceLayout(t,e,E,x)),!E&&!I?[`${x}:${x}`]:[`${E}:${I}`]}layoutConnection(e,t={}){const n=t.source||e.source,i=t.target||e.target;t.startChanged&&!t.connectionStart&&(t.connectionStart=(0,Z.pp)(n)),t.endChanged&&!t.connectionEnd&&(t.connectionEnd=(0,Z.pp)(i));const a=e.waypoints,r=t.connectionStart||a&&a.length&&a[0].original,c=t.connectionEnd||a&&a.length&&a[a.length-1].original;let h;!t.shapeMoving&&!t.startChanged&&!t.endChanged?(t.preferredLayouts=this.getPreferredLayouts(n,i,a,t),h=nt.Z9(n,i,r,c,t)):h=nt.WI(n,i,r,c,a,t),this.isStraightConnection(n,i,e)&&h.length>2&&h.splice(1,h.length-2);const E=Object.assign(e);return E.waypoints=nt.d7(h),this.connectionDocking.getCroppedWaypoints(E,n,i)}};Ke=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("connectionDocking")),(0,s.__param)(1,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object])],Ke);class it{constructor(e,t){this.eventBus=e,this.outlineFactory=t,e.on("shape.added",m.nS.LOW,this.onShapeAdded.bind(this)),e.on("shape.changed",m.nS.LOW,this.onShapeChanged.bind(this)),e.on("connection.added",this.onConnectionAdded.bind(this)),e.on("connection.changed",this.onConnectionChanged.bind(this))}onShapeAdded(e){this.onUpdateOutline(e)}onShapeChanged(e){this.onUpdateOutline(e)}onConnectionAdded(e){this.onUpdateOutline(e)}onConnectionChanged(e){this.onUpdateOutline(e)}onUpdateOutline(e){const t=e.element;this.outlineFactory.getOutline(t).draw(t,e.gfx)}}class ie{constructor(e){this.config=e}findOutline(e){return(0,g.query)("."+this.config.outlineClassName,e)}getOutline(e){let t=this.findOutline(e);if(!t){const n=e;t=this.createOutline(n)}return t}createOutline(e){const t=this.getSvgName(),n=(0,j.vt)(t),i=this.getCreateOutlineConfig();return(0,j.CF)(n,i),(0,j.BC)(e,n),n}getSvgName(){return"rect"}getCreateOutlineConfig(){return{...this.config.outlineStyle,shapeRendering:"geometricPrecision"}}draw(e,t){const n=this.getOutline(t);this.updateOutline(n,e)}erase(e,t){const n=this.findOutline(t);n&&n.remove()}}class Pn extends ie{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{cx:10,cy:10,r:30})}getSvgName(){return"circle"}updateOutline(e,t){const n=t.width/2;(0,j.CF)(e,{cx:n,cy:n,r:n+this.config.offset})}}class Mt extends ie{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){const n=(0,$e.U7)(t,!1),i=this.config.offset;(0,j.CF)(e,{height:n.height+i*2,width:n.width+i*2,x:n.x-i,y:n.y-i})}draw(e,t){this.config.rules.allowed("canShowConnectionOutline")&&super.draw(e,t)}}class Tt extends ie{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{x:10,y:10,width:100,height:100,rx:5})}updateOutline(e,t){const n=this.config.offset;(0,j.CF)(e,{x:-n,y:-n,width:t.width+n*2,height:t.height+n*2})}}class Rt extends ie{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){this.config.rules.allowed("canShowLabelOutline")&&(0,j.CF)(e,{x:-2,y:-2,width:t.width+2*2,height:t.height+2})}draw(e,t){this.config.rules.allowed("canShowLabelOutline")&&super.draw(e,t)}}let se=class{constructor(e,t,n,i){this.styles=e,this.rules=t,this.elements=n,this.diagramUtils=i,this.config=this.getConfig()}getConfig(){const e="djs-outline",t={...this.styles.cls(e,["no-fill"],null),strokeDasharray:"4,2",strokeWidth:"1px"};return{outlineClassName:e,outlineStyle:t,offset:Qe,elements:this.elements,rules:this.rules}}getOutline(e){switch(!0){case o.DiagramUtils.isLabel(e):return new Rt(this.config);case this.diagramUtils.isConnection(e):return new Mt(this.config);default:return new Tt(this.config)}}};se=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("styles")),(0,s.__param)(1,(0,o.Inject)("rules")),(0,s.__param)(2,(0,o.Inject)("elements")),(0,s.__param)(3,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,o.DiagramElements,o.DiagramUtils])],se);let We=class extends it{constructor(e,t){super(e,t),this.outlineFactory=t}};We=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("outlineFactory")),(0,s.__metadata)("design:paramtypes",[Object,se])],We);class In extends ie{constructor(){super(...arguments),this._factor45Angle=Math.sqrt(1/2)}getDefaultHeight(){return 55}getCreateOutlineConfig(){const e=this._factor45Angle,t=this.getDefaultHeight()/2,n=super.getCreateOutlineConfig();return f.assign(n,{x:10,y:10,width:100,height:100,transform:`matrix(${e} -${e} ${e} ${e} 0 ${t})`})}updateOutline(e,t){const n=this._factor45Angle,i=t.height/2,a=this.config.offset;(0,j.CF)(e,{x:-a,y:-a,width:t.width*n+a*2,height:t.height*n+a*2,transform:`matrix(${n} -${n} ${n} ${n} 0 ${i})`})}}let st=class extends it{constructor(e,t,n){super(e,t),this.outlineFactory=t,this.registry=n,this.notValidElements=new Set,e.on(["element.validation"],this.onElementIsValidChanged.bind(this))}onElementIsValidChanged(e){const t=e.id;e.isValid?this.removeElement(t):this.addElement(t)}addElement(e){if(!this.notValidElements.has(e)&&this.registry.get(e)){this.notValidElements.add(e);const t=this.registry.get(e),n=this.registry.getGraphics(t);this.onUpdateOutline({element:t,gfx:n})}}removeElement(e){if(this.notValidElements.has(e)){this.notValidElements.delete(e);const t=this.registry.get(e),n=this.registry.getGraphics(t);this.outlineFactory.getOutline(t).erase(t,n)}}onUpdateOutline(e){const t=e.element;this.notValidElements.has(t.id)&&super.onUpdateOutline(e)}};st=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("validationOutlineFactory")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__metadata)("design:paramtypes",[Object,se,Object])],st);class kt extends ne{getSizeConfig(e){const t=this.elements.getConfig(e);return this.styles.style({height:e.height||t.height,width:e.width||t.width})}getImageSource(e){const t=this.elements.getConfig(e);return e.largeImage||t.largeImage}draw(e,t){super.draw(e,t);const n=this.elements.getConfig(t);if(!n)throw new Error(`Element type ${t.type} not supported`);const i=(0,j.vt)("image"),a=this.getSizeConfig(t),r=this.getImageSource(t);return(0,j.CF)(i,a),i.setAttributeNS("http://www.w3.org/1999/xlink","href",r),i.setAttributeNS(null,"type",n.type),i.setAttributeNS(null,"preserveAspectRatio","none"),(0,j.BC)(e,i),i}}let Ve=class{constructor(e){this.popupMenu=e,this.popupMenu.registerProvider("setup",this)}getPopupMenuEntries(e){return{}}getHeaderEntries(e){return[]}};Ve=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("popupMenu")),(0,s.__metadata)("design:paramtypes",[Object])],Ve);class Mn{constructor(e,t){this.width=e,this.height=t}}var Tn=l(41666),Rn=l(20418),kn=l(39255),Ln=l(54100),Bn=l(95576),An=l(85284),Un=l(26316),Fn=l(78768),zn=l(54559),Lt=l(46902),Hn=l(50317),Kn=l(50101),Wn=l(77648),Vn=l(79691),Nn=l(85868),$n=l(73229),Gn=l(25342),Yn=l(88729),Zn=l(56773),Xn=l(28400),Qn=l(23550),Jn=l(64916),qn=l(32959),ei=l(81284);let at=class{constructor(e,t){this.eventBus=e,this.canvas=t,this._isOpen=!1,this._init()}_init(){this._popupContainer=(0,g.domify)('<div class="djs-diagram-popup"></div>');const e=this.canvas.getContainer();this._popup=e.appendChild(this._popupContainer),this._subscribeEvents()}_subscribeEvents(){this._subscribeEventBusEvents(),this._subscribeDomEvents()}_subscribeDomEvents(){this._popup.onwheel=e=>this._onWheel(e)}_onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._popup.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}_onViewBoxChanged(){this._state&&this._state.parentContainer&&this.open({parentContainer:this._state.parentContainer,html:this._state.html,width:this._state.width,options:this._state.options})}_subscribeEventBusEvents(){this.eventBus.on(["canvas.resized","zoom.changed","selection.changed"],()=>this.close()),this.eventBus.on("popup.open",e=>this.open(e)),this.eventBus.on("canvas.viewbox.changing",()=>this.hide()),this.eventBus.on("canvas.viewbox.changed",()=>this._onViewBoxChanged())}getPopupPosition(e){const{parentContainer:t}=e,{e:n,f:i}=t.getCTM(),{height:a}=t.getBoundingClientRect(),r=5,c=i+a+r,{width:h}=t.getBoundingClientRect(),x=e.options?.direction||"right";let E=n;return x==="right"&&(E+=h-e.width),x==="left"&&(E-=h),{x:E,y:c}}open(e){if(!e.width)throw new Error("width must be > 0");this._state={parentContainer:e.parentContainer,html:e.html,width:e.width,options:e.options};const{x:t,y:n}=this.getPopupPosition(e);return(0,f.assign)(this._popupContainer.style,{left:`${t}px`,top:`${n}px`,visibility:"visible",width:`${e.width}px`}),this._isOpen=!0,this._popupContainer.innerHTML=e.html,this._popupContainer}close(){this._isOpen&&(this.hide(),this._state={})}hide(){(0,f.assign)(this._popupContainer.style,{visibility:"hidden"}),this._popupContainer.innerHTML=""}};at=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],at);let ot=class{constructor(e,t,n){this.eventBus=e,this.Tooltips=t,this.canvas=n,this.tooltipTimeout=400,e.on("element.hover",this.onElementHover.bind(this)),this.Tooltips._updateRoot=()=>{}}onElementHover(e){clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(()=>{const{element:t,gfx:n}=e;this.elementId!==t.id&&this.tooltipId&&this.removeTooltip(),t.tooltip&&!this.tooltipId&&this.addTooltip(n,t)},this.tooltipTimeout)}removeTooltip(){this.Tooltips.remove(this.tooltipId),this.tooltipId=null}addTooltip(e,t){this.elementId=t.id;const n=t.tooltipConfig||{};this.tooltipId=this.Tooltips.add({position:{x:0,y:0},type:n.type,html:this.getTemplate(t.tooltip)}),this.setPosition(e,t)}getTemplate(e){return`<div class="tooltip">${e}</div>`}getDiagramSize(){const t=this.canvas.getContainer().getBoundingClientRect();return{width:t.width,height:t.height}}getHtmlContainer(){return this.Tooltips.get(this.tooltipId).htmlContainer}setPosition(e,t){const{a:n,e:i,f:a}=e.getCTM();let r=i+t.width*n,c=a+t.height*n;const h=this.getDiagramSize(),x=this.getHtmlContainer(),{width:E,height:T}=x.getBoundingClientRect();r+E>h.width&&(r=i-E),c+T>h.height&&(c=a-T),Object.assign(x.style,{left:r+"px",top:c+"px"})}};ot=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("tooltips")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object])],ot);var ti=l(5440);const ni={__depends__:[Tn.A,Rn.A,kn.A,Ln.A,Bn.A,Un.A,Fn.A,zn.A,Hn.A,Kn.A,Wn.A,Jn.A,Vn.A,Lt.A,Nn.A,Zn.A,ei.A,V,qn.A,An.A,de,Xn.A],__init__:["canvas","commandStack","contextPad","contextPadProvider","copyPaste","labelSupport","diagramLoader","diagramRenderer","diagramRules","diagramEventHandlerController","diagramText","directEditing","editorActions","elementFactory","elementRegistry","keyboardBindings","labelEdit","layouter","localStorage","outline","resize","resizeHandles","resizePreview","setupMenuProvider","handTool","spaceToolPreview","bendpointMove","bendpoints","featureProvider","connectionPreview","connectionSegmentMove","paletteProvider","paletteElements","elementToolsConfig","createPopupMenu","palette","connectionHighlight","minimap","diagramPopup","lassoTool","diagramUtils","diagramPaletteTools","diagramTooltips"],canvas:["type",Q],commandStack:["type",N],connectionDocking:["type",Qn.A],contextPad:["type",be],contextPadProvider:["type",He],copyPaste:["type",_e],labelSupport:["type",Be],diagramLoader:["type",De],diagramRenderer:["type",ge],diagramRules:["type",S],diagramEventHandlerController:["type",ti.LV],directEditing:["type",Ae],editorActions:["type",xe],elementFactory:["type",ct],elementRegistry:["type",Ce],keyboardBindings:["type",pt],localStorage:["type",X],modeling:["type",H],outline:["type",We],resize:["type",$n.A],resizeHandles:["type",Gn.A],resizePreview:["type",Yn.A],setupMenuProvider:["type",Ve],handTool:["type",Lt.A],spaceToolPreview:["type",Ct],bendpoints:["type",V],featureProvider:["type",Pt],connectionPreview:["type",u],popupMenu:["type",Me],connectionSegmentMove:["type",de],labelEdit:["type",Le],diagramText:["type",z],outlineFactory:["type",se],renderingShapeFactory:["type",he],renderingLabel:["type",Je],renderingShape:["type",kt],layouter:["type",Ke],elements:["type",o.DiagramElements],paletteProvider:["type",Pe],splitConnectionHelper:["type",It],spaceTool:["type",Fe],paletteElements:["type",o.DiagramPaletteElements],elementToolsConfig:["type",je],createPopupMenu:["type",ee],palette:["type",Oe],replaceMenuGroups:["type",function(){return{}}],zoomScroll:["type",ze],connectionHighlight:["type",Ue],minimap:["type",we],diagramPopup:["type",at],lassoTool:["type",Ee],previewSupport:["type",mt],diagramUtils:["type",o.DiagramUtils],diagramPaletteTools:["type",Ie],diagramTooltips:["type",ot]}},9224:(A,P,l)=>{l.d(P,{L:()=>s});class s{stopSync(){}startSync(){}subscribeServerChanges(){return[]}}},5440:(A,P,l)=>{l.d(P,{hN:()=>o,LV:()=>_.L,K$:()=>S,B6:()=>y,Gz:()=>d.G,G6:()=>m});var s=l(59131);class o{static{this.\u0275fac=function(M){return new(M||o)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}}var _=l(9224),D=l(73308),C=l(62278);class S{constructor(){this.error$=new C.Subject,this.updateElementCaption$=new C.Subject,this.updateConnectionCaption$=new C.Subject,this.updateCaption$=new C.Subject,this.changed$=new C.Subject,this.startLoading$=new C.Subject,this.endLoading$=new C.ReplaySubject(1)}init(){}bufferiseOps(O,M,L){}load(O,M){return(0,D.A)(function*(){return Promise.resolve(null)})()}getDiagramConfig(){return(0,D.A)(function*(){return Promise.resolve()})()}diagramInitialized(){}commit(O){return(0,D.A)(function*(){})()}undo(){}redo(){}clearCash(){}static{this.\u0275fac=function(M){return new(M||S)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac})}}class y{get data(){return this.diagramData}set data(O){this.diagramData=O}get diagram(){return this.internalDiagram}set diagram(O){this.internalDiagram=O}getDiagramDataId(){return this.diagramData?this.diagramData.id:null}getDiagramDataCaption(){return this.diagramData?this.diagramData.caption:null}hasDiagramData(){return!!this.diagramData}static{this.\u0275fac=function(M){return new(M||y)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac,providedIn:"root"})}}var d=l(66435);class m{generate(O,M,L,k="{prefix} {index}"){let f=0,F="",B;do f=f+1,F=k.replace("{prefix}",L).replace("{index}",f.toString()),B=O.find(ae=>(ae[M]||"").toLowerCase()===F.toLowerCase());while(B);return F}static{this.\u0275fac=function(M){return new(M||m)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},66435:(A,P,l)=>{l.d(P,{G:()=>C});var s=l(15534),o=l.n(s),_=l(28399),D=l.n(_);class C{constructor(y){this.utils=y}_setAbsolutePosition(y,d,m){if(m.includes(y.id)||_.isUndefined(y.rx)||_.isUndefined(y.ry))return;const R=y.parent;let O=d.elements[R]||d.connections[R];O?(this.utils.isConnection(O)&&(O=d.elements[O.source]),this._setAbsolutePosition(O,d,m),y.x=O.x+y.rx,y.y=O.y+y.ry):(y.x=y.rx,y.y=y.ry),m.push(y.id)}setRelativePosition(y,d=null){let m=d||y.labelTarget||y.parent;m.id===s.Roots.root.id?(y.rx=y.x,y.ry=y.y):(this.utils.isConnection(m)&&(m=m.source),y.rx=y.x-m.x,y.ry=y.y-m.y)}setShapeAbsolutePosition(y,d=null){let m=d||y.labelTarget||y.parent;m.id===s.Roots.root.id?(_.isUndefined(y.rx)||(y.x=y.rx),_.isUndefined(y.ry)||(y.y=y.ry)):(this.utils.isConnection(m)&&(m=m.source),_.isUndefined(y.rx)||(y.x=m.x+y.rx),_.isUndefined(y.ry)||(y.y=m.y+y.ry))}setAbsolutePosition(y){if(!y)return;const d=[];_.forEach(y.elements,m=>{this._setAbsolutePosition(m,y,d)}),_.forEach(y.labels,m=>{this._setAbsolutePosition(m,y,d)})}}},27449:(A,P,l)=>{l.d(P,{Y:()=>s.Y});var s=l(50079)},50079:(A,P,l)=>{l.d(P,{Y:()=>s});class s{static{this.xmlns="http://www.w3.org/2000/svg"}static createFeFlood(_,D="#000",C=0){return this.createElement(_,{"flood-color":D,"flood-opacity":C||0,result:"colorResult"},"feFlood")}static createFeComposite(_){return this.createElement(_,{operator:"in",in:"colorResult",in2:"blurResult",result:"shadowResult"},"feComposite")}static createFeGaussianBlur(_,D=0){return this.createElement(_,{result:"blurResult",in:"offsetResult",stdDeviation:D},"feGaussianBlur")}static createFeBlend(_){return this.createElement(_,{in:"SourceGraphic",in2:"shadowResult",mode:"normal"},"feBlend")}static setAttribute(_,D){const C=Object.keys(D);for(const S of C)_.setAttribute(S.toString(),D[S])}static createElement(_,D,C){let S;return D&&D.id&&(S=_.getElementById(D.id)),S||(S=document.createElementNS(this.xmlns,C)),D&&this.setAttribute(S,D),S}static createFilter(_,D){return this.createElement(_,{id:D,width:"200%",height:"200%"},"filter")}static createFeOffset(_,D=0,C=0){return this.createElement(_,{result:"offsetResult",in:"SourceAlpha",dx:D,dy:C},"feOffset")}static addDefs(){const _=document.querySelector("svg"),D=_.getElementsByTagName("defs")[0];if(D==null){const C=document.createElementNS(this.xmlns,"defs");return _.appendChild(C)}return D}static createShadowFilter(_){const D=document.querySelector("svg"),C=_.name;if(!C)throw new Error("ArgumentNullOrEmptyException");const S=D.getElementById(C),y="url(#"+C+")";if(S)return y;const d=this.addDefs(),m=this.createFilter(D,C),R=this.createFeOffset(D,_.offsetX,_.offsetY);m.appendChild(R);const O=this.createFeGaussianBlur(D,_.blur);m.appendChild(O);const M=this.createFeFlood(D,_.color,_.opacity);m.appendChild(M);const L=this.createFeComposite(D);m.appendChild(L);const k=this.createFeBlend(D);return m.appendChild(k),d.appendChild(m),y}}}}]);
