(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[67545],{67545:(S,d,i)=>{i.r(d),i.d(d,{BaseAudienceHandler:()=>g,BaseAudienceNotificationHandler:()=>a});var c=i(73308),r=i(38495),f=i(79772),m=i(59564),v=i(20822),h=i(28399),u=i(62278);class g extends r.BaseRequestHandler{constructor(e){super(),this.injector=e,this.injectDependencies()}injectDependencies(){this._notifyService=this.injector.get(m.NotifyService),this._translateService=this.injector.get(f.TranslateService),this._messageDialogProvider=this.injector.get(v.MessageDialogProvider)}getItemsCollection(e){return Array.isArray(e)?e.map(t=>typeof t=="string"?t:t.value):e?.value?[e.value]:[]}isValidFilter(e){return(0,h.isObject)(e)&&"items"in e&&!(0,h.isEmpty)(e.items)}isEmptyFilter(e){let t=!0;return Object.entries(e.items).forEach(([n,s])=>{s.isEnabled&&(s.filterType===r.FilterType.FilterGroup&&!this.isEmptyFilter(s)||s.filterType!==r.FilterType.FilterGroup)&&(t=!1)}),t}showNotification(e,t){var n=this;return(0,c.A)(function*(){yield n._notifyService.show({message:e,duration:t})})()}showConfirmationDialog(e){return(0,u.lastValueFrom)(this._messageDialogProvider.confirmation(e))}translate(e){return this._translateService.instant(`${this.translationPrefix}.${e}`)}}var p=i(21018),y=i(59131);class a extends r.BaseRequestHandler{constructor(e){super(),this.messageChannelService=e}_tryReloadAudienceDetail(e,t,n){var s=this;return(0,c.A)(function*(){if(e.toLowerCase()!==(yield t).toLowerCase())return;const o={type:"crt.LoadDataRequest",config:{loadType:r.DataSourceLoadType.Reload},$context:n,dataSourceName:s.audienceDataSourceName};yield s.handlerChain.process(o)})()}_subscribeOnChannelMessages(e){var t=this;return(0,c.A)(function*(){const n=yield e.getPrimaryModelName(),s=e.getViewModelAttributePath(n,"Id");t.channelSubscription=t.messageChannelService.messageEvent$.pipe((0,u.filter)(o=>{const l=o?.body?.Notifications;return l?.length>0?!!l[0].EntityId:!1})).subscribe(o=>{const l=e[s],j=o?.body?.Notifications[0]?.EntityId;t._tryReloadAudienceDetail(j,l,e)})})()}handle(e){var t=this;return(0,c.A)(function*(){const n=e.$context;yield t._subscribeOnChannelMessages(n),yield t.next?.handle(e)})()}ngOnDestroy(){this.channelSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||a)(y.\u0275\u0275inject(p.MessageChannelService))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac})}}}}]);
