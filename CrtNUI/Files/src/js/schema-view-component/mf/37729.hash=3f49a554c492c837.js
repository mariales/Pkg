(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[37729],{37729:(p,o,a)=>{a.r(o),a.d(o,{AddonDesignerApiService:()=>n.jc,AddonInfoFactory:()=>n.hm,AddonMetadataNormalizerFactory:()=>n.Fv,AddonSchemaService:()=>_.p,BaseAddonMetadataNormalizer:()=>n.qQ,BaseDesignerApiService:()=>n.km,BaseSchemaConverterService:()=>n.O,BusinessRulesMetadataNormalizer:()=>n.q4,CurrentPackageApiService:()=>n.zf,OPTIONS_SKIP_UNSUCCESSFUL_RESPONSE_HANDLING:()=>n.tE,SCHEMA_DESIGNER_API_URL:()=>n.Du,SchemaDesignerApiModule:()=>s.$,SchemaImageUploaderService:()=>n.ew,SchemaTemplateApiService:()=>n.VR,getSchemaDesignerApiUrlProvider:()=>n.lm,getSchemaImageUploaderApiUrlProvider:()=>n.Ps,getServiceApiUrl:()=>n.ZN,getServiceApiUrlProvider:()=>n.yR});var s=a(89277),n=a(32779),c=a(45688),l={};for(const h in c)["default","SchemaDesignerApiModule","AddonDesignerApiService","AddonInfoFactory","AddonMetadataNormalizerFactory","BaseAddonMetadataNormalizer","BaseDesignerApiService","BaseSchemaConverterService","BusinessRulesMetadataNormalizer","CurrentPackageApiService","OPTIONS_SKIP_UNSUCCESSFUL_RESPONSE_HANDLING","SCHEMA_DESIGNER_API_URL","SchemaImageUploaderService","SchemaTemplateApiService","getSchemaDesignerApiUrlProvider","getSchemaImageUploaderApiUrlProvider","getServiceApiUrl","getServiceApiUrlProvider"].indexOf(h)<0&&(l[h]=()=>c[h]);a.d(o,l);var _=a(74136)},74136:(p,o,a)=>{a.d(o,{p:()=>s});class s{}},97983:(p,o,a)=>{a.d(o,{R:()=>n,g:()=>s});var s;(function(c){c[c.NO=0]="NO",c[c.YES=1]="YES"})(s||(s={}));const n={[s.NO]:{type:s.NO,name:"No"},[s.YES]:{type:s.YES,name:"Yes"}}},1529:(p,o,a)=>{a.d(o,{A:()=>s});var s;(function(n){n[n.Success=0]="Success",n[n.Error=1]="Error",n[n.NoChanges=2]="NoChanges"})(s||(s={}))},45688:(p,o,a)=>{a.r(o),a.d(o,{ATTRIBUTE_REQUIREMENT_TYPE_ITEMS:()=>_.R,AttributeRequirementType:()=>_.g,BuildResultType:()=>c.A,ManagerItem:()=>s.$,ParentItem:()=>n.O,SCHEMA_DESIGNER_CONVERTER:()=>l.f});var s=a(8271),n=a(61163),c=a(1529),l=a(13264),_=a(97983),h=a(25678),m=a.n(h),g={};for(const E in h)["default","ManagerItem","ParentItem","BuildResultType","SCHEMA_DESIGNER_CONVERTER","ATTRIBUTE_REQUIREMENT_TYPE_ITEMS","AttributeRequirementType"].indexOf(E)<0&&(g[E]=()=>h[E]);a.d(o,g)},8271:(p,o,a)=>{a.d(o,{$:()=>c});var s=a(25678),n=a.n(s);class c extends s.MetaItem{constructor(_){super(_),_&&(this.caption=_.caption)}}},61163:(p,o,a)=>{a.d(o,{O:()=>c});var s=a(25678),n=a.n(s);class c extends s.MetaItem{}},13264:(p,o,a)=>{a.d(o,{f:()=>c});var s=a(59131),n=a.n(s);const c=new s.InjectionToken("SchemaDesignerConverter")},89277:(p,o,a)=>{a.d(o,{$:()=>h});var s=a(40297),n=a.n(s),c=a(32779),l=a(59131),_=a.n(l);class h{static{this.\u0275fac=function(E){return new(E||h)}}static{this.\u0275mod=l.\u0275\u0275defineNgModule({type:h})}static{this.\u0275inj=l.\u0275\u0275defineInjector({providers:[c.jc,c.hm,c.Fv],imports:[s.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&l.\u0275\u0275setNgModuleScope(h,{imports:[s.CommonModule]})})()},32779:(p,o,a)=>{a.d(o,{jc:()=>I,hm:()=>M,Fv:()=>D,qQ:()=>N,km:()=>O,O:()=>k,q4:()=>K,zf:()=>R,tE:()=>g,Du:()=>E,ew:()=>C,VR:()=>U,lm:()=>$,Ps:()=>G,ZN:()=>L,yR:()=>H});var s=a(63721),n=a(59131),c=a(85638),l=a(21018),_=a(28399),h=a(62278),m=a(36486);const g=new n.InjectionToken("OptionsSkipUnsuccessfulResponseHandling"),E=new n.InjectionToken("SchemaDesignerApiUrl");var W=a(45688),F=a(38495),P=a(25678);class I{constructor(e){this.getAddonMethodName="GetSchema",this.getAddonMetadataMethodName="GetSchemaMetadata",this.saveAddonMethodName="SaveSchema",this.serviceEndpoint="/ServiceModel/AddonSchemaDesignerService.svc/",this._httpClient=e.get(s.HttpClient),this._workplaceService=e.get(l.WorkplaceService)}getAddon(e){const t=`${this.serviceEndpoint}${this.getAddonMethodName}`;return this._httpClient.post(t,e)}getAddonMetadata(e){const t=`${this.serviceEndpoint}${this.getAddonMetadataMethodName}`;return this._httpClient.post(t,e)}saveAddon(e){const t=`${this.serviceEndpoint}${this.saveAddonMethodName}`;return this._httpClient.post(t,e).pipe((0,h.switchMap)(r=>this._workplaceService.resetWorkplaceScriptCache().pipe((0,m.map)(()=>r))))}static{this.\u0275fac=function(t){return new(t||I)(n.\u0275\u0275inject(n.Injector))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac})}}class M{constructor(e){this._apiService=e.get(I),this._features=e.get(l.FEATURE_VALUES,{optional:!0})}_getParentSchemaUId(e){const t=e.parentSchema??e.parent;return t?.name===e.name?t.uId:F.EMPTY_GUID}create(e,t){return!e.addonTypes||e.addonTypes.length===0?[]:e.addonTypes.map(r=>{const i=this._getParentSchemaUId(e);return this.createAddonInfo(e,r,i,t)})}createAddonInfo(e,t,r,i){return new P.AddonInfo(t,e.uId,r,e.package.uId,i,this._apiService,e.useFullHierarchy)}static{this.\u0275fac=function(t){return new(t||M)(n.\u0275\u0275inject(n.Injector))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac})}}const L=u=>`/ServiceModel/${u}/`,H=(u,e)=>({multi:!1,provide:e,useValue:L(u)}),$=u=>H(u,E);class O extends c.BaseCachedHttpService{get converter(){return this._converter}constructor(e){super(),this._restErrorHandleOptions={},this.createNewSchemaMethodName="CreateNewSchema",this.getSchemaMethodName="GetSchema",this.saveSchemaMethodName="SaveSchema",this.serviceEndpoint=e.get(E),this._converter=e.get(W.SCHEMA_DESIGNER_CONVERTER,null,{optional:!0}),this._addonInfoFactory=e.get(M),this._errorHandler=e.get(l.RestErrorHandler),this._restErrorHandleOptions.skipUnsuccessfulResponse=e.get(g,!1,{optional:!0})}getSchemaManagerName(){return null}getSchemaFromService(e,t,r=!1){const i=r?{headers:new s.HttpHeaders({"Content-Type":"application/json"})}:{};return this.httpClient.post(e,t,i).pipe((0,m.map)(d=>{if(d.schema){const S=this.getSchemaManagerName();return d.schema=this.convertToObject(d.schema),d.schema.addons=this._addonInfoFactory.create(d.schema,S),d}return d}),(0,m.share)())}getSchemasFromService(e,t,r=!1){const i=r?{headers:new s.HttpHeaders({"Content-Type":"application/json"})}:{};return this.httpClient.post(e,t,i).pipe((0,m.map)(d=>{if(d.schemas){const S=this.getSchemaManagerName();return d.schemas.forEach((f,v)=>{d.schemas[v]=this.convertToObject(f),d.schemas[v].addons=this._addonInfoFactory.create(f,S)}),d}return d}),(0,m.share)())}createObject(e,t){return Object.assign(new e,t)}convertToObject(e){return this._converter.convertToSchema(e)}convertSchemaToDTO(e){return e}_addonSaveHandler(e){const t=e.save();return this._errorHandler.handleRequest(t,this._restErrorHandleOptions).pipe((0,m.catchError)(()=>(0,h.of)(!1)),(0,m.map)(r=>({message:`Addon ${e.addonName} was ${r?"successfully":"not"} saved!`,result:r})))}_saveAddons(e){return(0,h.forkJoin)(e.map(t=>this._addonSaveHandler(t))).pipe((0,m.map)(t=>{const r=t.filter(i=>!i.result).map(i=>i.message);return r.length>0?r:null}))}createSchema(e){const t=`${this.serviceEndpoint}${this.createNewSchemaMethodName}`;return this.getSchemaFromService(t,e)}getSchema(e){const t=`${this.serviceEndpoint}${this.getSchemaMethodName}`;return this.getSchemaFromService(t,e)}saveSchema(e,t=!1){t&&(e.useFullHierarchy=!0);const r=`${this.serviceEndpoint}${this.saveSchemaMethodName}`,i=e.addons?[...e.addons]:null,d=(0,_.omit)(e,["addons"]),S=this.httpClient.post(r,d);return this._errorHandler.handleRequest(S,this._restErrorHandleOptions).pipe((0,m.concatMap)(v=>{const A=i?.filter(T=>T.isChanged);return v.success&&A?.length>0?this._saveAddons(A).pipe((0,m.map)(T=>({...v,addonsErrors:T}))):(0,h.of)(v)}),(0,m.share)())}checkUniqueSchemaName(e,t,r){const i=this.serviceEndpoint+"CheckUniqueSchemaName",d={schemaName:e,excludeUId:t,managerName:r};return this.httpClient.post(i,d,{headers:new s.HttpHeaders({"Content-Type":"application/json"})}).pipe((0,m.share)())}static{this.\u0275fac=function(t){return new(t||O)(n.\u0275\u0275inject(n.Injector))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"})}}class k{constructor(e){this.factory=e}createSchema(e){const t=new this.factory;return Object.assign(t,e),e.package&&(t.package=new P.Package(e.package.name,e.package.uId),t.package.type=e.package.type,t.package.isChanged=e.package.isChanged,t.package.isLocked=e.package.isLocked),t}createLocalizableStrings(e){if(!e)return new P.MetaItemArray;const t=e.map(r=>new P.SchemaLocalizableStringModel(r));return new P.MetaItemArray(t)}}const j=new n.InjectionToken("SchemaImageUploaderApiUrl"),G=u=>({multi:!1,provide:j,useValue:`/ServiceModel/${u}`});class C{constructor(e,t){this._httpClient=e,this._endPointUrl=t}appendImageToSchema(e,t,r){const i=new FormData;return i.append("schemaUId",e),i.append("imageUId",t.uId),i.append("isLastImage",r.toString()),i.append("files",t.data,t.data.name),this._httpClient.post(`${this._endPointUrl}/SaveImage`,i)}static{this.\u0275fac=function(t){return new(t||C)(n.\u0275\u0275inject(s.HttpClient),n.\u0275\u0275inject(j))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac})}}class U{constructor(e){this.httpClient=e,this._getTemplatesEndpoint="rest/schema.template.api/templates"}getTemplates(){return this.httpClient.get(this._getTemplatesEndpoint)}static{this.\u0275fac=function(t){return new(t||U)(n.\u0275\u0275inject(s.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}}class R{constructor(e){this._httpClient=e,this._appInstallerServiceUrl="ServiceModel/AppInstallerService.svc/",this._getDesignPackageUId="GetDesignPackageUId"}getDesignPackageUId(e){const t=`${this._appInstallerServiceUrl}${this._getDesignPackageUId}`;return this._httpClient.post(t,{schemaUId:e})}static{this.\u0275fac=function(t){return new(t||R)(n.\u0275\u0275inject(s.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"})}}class N{copy(e){return{...e}}isEmpty(e){return!1}}var z=a(20442);class K extends N{copy(e){const t=e.metadata,r=[],i=[];return t.rules.forEach(d=>{const S=new z.BusinessRuleDesign(d,new l.LocalizableStringArray,null,null,null),{uId:f,name:v}=S,A=S.copy();A.name=v;const T=A.uId,y=(e.resources||[]).find(B=>B.key?.includes(f));if(y){const B=y.key.replace(f,T);i.push({...y,key:B})}r.push(A.toMetadata())}),{metadata:{...e.metadata,rules:r},name:e.name,resources:i}}isEmpty(e){return!e.metadata?.rules||e.metadata.rules?.length===0}}class D{create(e){return e===l.AddonName.BusinessRule?new K:new N}static{this.\u0275fac=function(t){return new(t||D)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})}}}}]);
