(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[37882],{37882:(Zt,yt,y)=>{y.r(yt),y.d(yt,{BaseDataGridActionsPreprocessor:()=>lt,BulkActionsPostprocessor:()=>H,BulkActionsPreprocessor:()=>B,BulkActionsPreprocessorsModule:()=>G,ChartWidgetAdaptAxesFormattingPreprocessor:()=>Re,ChartWidgetPreprocessor:()=>we,ComboboxPreprocessor:()=>J,ComponentsPreprocessorsModule:()=>nt,DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION:()=>Ft,DataGridActionsPreprocessor:()=>X,DataGridActiveRowPreprocessor:()=>ce,DataGridCancelItemsChangesPreprocessor:()=>te,DataGridColumnsPreprocessor:()=>j,DataGridCreateItemPreprocessor:()=>ie,DataGridDeleteItemPreprocessor:()=>re,DataGridEditingCellViewPreprocessor:()=>K,DataGridFilterOptionsBackwardCompatibilityPreprocessor:()=>Z,DataGridFilterOptionsPostprocessorsModule:()=>dt,DataGridFilterOptionsPreprocessor:()=>Q,DataGridFilterOptionsPreprocessorsModule:()=>ut,DataGridHeaderToolbarPreprocessor:()=>ee,DataGridPagingPreprocessor:()=>se,DataGridPlaceholderPreprocessor:()=>oe,DataGridPreprocessorsModule:()=>Se,DataGridReloadItemsPreprocessor:()=>ne,DataGridRestrictionsPreprocessor:()=>ge,DataGridRowDoubleClickPreprocessor:()=>le,DataGridRowsSelectionPreprocessor:()=>ue,DataGridSaveItemsChangesPreprocessor:()=>ae,DataGridSelectionOptionsBackwardCompatibilityPreprocessor:()=>$,DataGridSelectionOptionsPostprocessorsModule:()=>mt,DataGridSelectionOptionsPreprocessorsModule:()=>fe,DataGridStageCellViewPreprocessor:()=>pe,SearchFilterPreprocessor:()=>Pe,SearchFilterPreprocessorService:()=>U,SelectionOptionsPreprocessor:()=>de,SelectionOptionsPreprocessorService:()=>F,SelectionOptionsPreprocessorsModule:()=>me,ShellHeaderPreprocessor:()=>st,WidgetDataProvidingPostprocessor:()=>Me,WidgetDataProvidingPostprocessorModule:()=>Fe,WidgetDataProvidingPreprocessor:()=>Oe,WidgetDataProvidingPreprocessorModule:()=>w,WidgetPreprocessorsModule:()=>q,getDefaultPagingConfig:()=>At,getPaginationChange:()=>_t,getSearchFilterAttributeName:()=>It});var ct=y(40297),v=y(96590),C=y(85638),Vt=y(61073),u=y(20822),P=y(52552),pt=y(94973),Bt=y(27331),W=y(26222),p=y(21018),f=y(10850),l=y(73308),h=y(22438),A=y(62278),o=y(59131);class Ve{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._actionDashboardPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._dcmSettingsService=t,this._actionDashboardPreprocessingDisableFeature="DisableActionDashboardPreprocessing"}_addStageAttribute(e,t,i){const r=e.viewModelConfig.attributes||{},a=`${i}.${t}`;if(!(0,h.findViewModelAttributeByModelPath)(r,a)){const n=`LookupAttribute_${t}`;r[n]={modelConfig:{path:a}},e.viewModelConfig.attributes=r}}_extendWithDcmStageAttribute(e,t){var i=this;return(0,l.A)(function*(){const r=yield(0,A.lastValueFrom)(i._dcmSettingsService.getStageColumnName(t.viewConfig.entitySchemaName),{defaultValue:null});r&&i._addStageAttribute(e,r,t.viewConfig.dataSourceName)})()}_extendWithPrimaryValueAttribute(e,t,i,r){const a=e.viewModelConfig.attributes||{},n=`${i}.${r}`;let s=(0,h.findViewModelAttributeByModelPath)(a,n);s||(s=`ActionDashboard_${r}`,a[s]={modelConfig:{path:n}},e.viewModelConfig.attributes=a),t.viewConfig.primaryColumnValue=`$${s}`}processItemsAsync(e,t,i){var r=this;return(0,l.A)(function*(){if(!t)return;const a=e.map(function(){var n=(0,l.A)(function*(s){const c=t.getDataSource(),d=yield(0,A.lastValueFrom)(t.getSchema());s.viewConfig.dataSourceName=c.dataSourceName,s.viewConfig.entitySchemaName=d.name,s.viewConfig.primaryDisplayColumnValue=`$${d.primaryDisplayAttributeName}`,yield r._extendWithDcmStageAttribute(i,s),r._extendWithPrimaryValueAttribute(i,s,c.dataSourceName,d.primaryAttributeName||"Id")});return function(s){return n.apply(this,arguments)}}());yield Promise.all(a)})()}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",i.viewConfig).forEach(a=>{a.viewConfig.allowedActions||(a.viewConfig.allowedActions=(0,u.getDefaultDashboardActions)())}),e})()}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if((yield i.isProcessingDisabled)||t.length===0)return e;const r=e,a=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",r.viewConfig),n=r.modelConfig?.primaryDataSourceName,s=t.find(c=>c.name===n);return yield i.processItemsAsync(a,s,r),e})()}static{this.\u0275fac=function(t){return new(t||Ve)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(C.DcmSettingsService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ve,factory:Ve.\u0275fac})}}var T=y(38495),_=y(28399);class V{_getSpecificPageRecordId(e){if(!e.specificPageRecordId||e.specificPageRecordId===e.itemConfig.templateValuesMapping?.id){const{itemIdBoundedAttribute:r}=this._getItemAttributes(e);return r}const{items:t}=e;return`$${this._getBoundAttributeName(t)}.${e.specificPageRecordId} | crt.ToObjectProp: 'value'`}_hasSpecificPage(e){return!!e.useSpecificPage&&!!e.specificPage}_getOpenPageBySpecificPage(e){const{specificPage:t}=e,i=this._getSpecificPageRecordId(e);return{request:"crt.OpenPageRequest",params:{schemaName:t,modelInitConfigs:[{recordId:i,action:T.ModelInPageAction.Edit}]}}}_getLinkViewConfigBySpecificPage(e,t){const{specificPage:i}=e,{itemCaptionBoundedAttribute:r}=this._getItemAttributes(e),a=this._getSpecificPageRecordId(e);return{...this._getBaseLinkViewConfig(r),href:`${a} | crt.ToOpenPageLink : '${i}'`,clicked:t}}_processItemDblClick(e,t){e.itemDblClick||(e.itemDblClick={request:"crt.BaseImageListItemClickRequest",params:{item:"@event",clickRequestConfig:t}})}_isValidGalleryItemConfig(e){return!!(e&&!e.captionViewConfig&&e.templateValuesMapping?.caption&&e.templateValuesMapping?.id)}_getCollectionAttributeName(e){return this._getBoundAttributeName((0,_.get)(e,"items"))}_getBoundAttributeName(e){return e?.startsWith("$")?e.slice(1):e}_hasEntityEditPage(e,t){if(!e)return Promise.resolve(!1);const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return T.HandlerChainService.instance.process(i)}_getCollectionEntitySchemaName(e,t){var i=this;return(0,l.A)(function*(){const r=i._getCollectionAttributeName(e);return(yield(0,f.getEntitySchemaAttribute)(t,r))?.referenceSchemaName})()}_getOpenPageByEntityName(e,t){const{itemIdBoundedAttribute:i}=this._getItemAttributes(e);return{request:"crt.UpdateRecordRequest",params:{entityName:t,recordId:i}}}_getLinkViewConfigByEntityName(e,t){const{itemConfig:i}=e,r=i.templateValuesMapping?.id,{itemIdBoundedAttribute:a,itemCaptionBoundedAttribute:n}=this._getItemAttributes(e);return{...this._getBaseLinkViewConfig(n),href:`${a} | crt.ToRecordLinkAsync : '${r}'`,clicked:t}}_processCaptionViewConfig(e,t){e.itemConfig.captionViewConfig=this._getLinkViewConfig(e,t)}_getBaseLinkViewConfig(e){return{type:"crt.Link",mode:"preventDefault",underlining:"hover",caption:`${e}`}}_getItemAttributes(e){const{itemConfig:t,items:i}=e,r=t.templateValuesMapping?.caption,a=t.templateValuesMapping?.id,n=this._getBoundAttributeName(i),s=`$${n}.${a}`,c=`$${n}.${r}`;return{itemIdBoundedAttribute:s,itemCaptionBoundedAttribute:c}}_hasAnyPage(e,t,i){return this._hasSpecificPage(e)?Promise.resolve(!0):this._hasEntityEditPage(t,i)}_getLinkViewConfig(e,t){return this._hasSpecificPage(e)?this._getLinkViewConfigBySpecificPage(e,t):this._getLinkViewConfigByEntityName(e,t)}_getOpenPageRequest(e,t){return this._hasSpecificPage(e)?Promise.resolve(this._getOpenPageBySpecificPage(e)):Promise.resolve(this._getOpenPageByEntityName(e,t))}_processViewConfigRequest(e,t){this._processCaptionViewConfig(e,t),this._processItemDblClick(e,t)}processOpenPageHandles(e,t){var i=this;return(0,l.A)(function*(){if(!i._isValidGalleryItemConfig(e.itemConfig))return;const r=yield i._getCollectionEntitySchemaName(e,t);if(!(yield i._hasAnyPage(e,r,t)))return;const n=yield i._getOpenPageRequest(e,r);i._processViewConfigRequest(e,n)})()}static{this.\u0275fac=function(t){return new(t||V)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}const gt=new o.InjectionToken("Represents a list of view element types that support bulk actions.");class B{constructor(){this._availableViewElementTypes=(0,o.inject)(gt),this._bulkActionsCreatorFactory=(0,o.inject)(u.BULK_ACTIONS_VIEW_ELEMENT_CREATOR_FACTORY)}_createDefaultBulkActions(e,t){return this._bulkActionsCreatorFactory?.create(t?.type)?.createDefaultBulkActions(e,t)}_setDefaultBulkActions(e,t){const i=(0,h.parseExpression)(e.items).attributePath;if(!i)return;const a=t[i]?.modelConfig?.path;a&&(e.bulkActions=this._createDefaultBulkActions(a,e))}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes??{};return(0,h.getCollectionViewConfigsWithItemsBinding)(t,this._availableViewElementTypes).filter(r=>r.bulkActions===void 0).forEach(r=>this._setDefaultBulkActions(r,i)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||B)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac})}}class H{constructor(){this._availableViewElementTypes=(0,o.inject)(gt),this._bulkActionsCreatorFactory=(0,o.inject)(u.BULK_ACTIONS_VIEW_ELEMENT_CREATOR_FACTORY)}_createDefaultBulkActions(e,t){return this._bulkActionsCreatorFactory?.create(t?.type)?.createDefaultBulkActions(e,t)}_clearDefaultBulkActions(e,t){const i=(0,h.parseExpression)(e.items).attributePath;if(!i)return;const a=t[i]?.modelConfig?.path;if(!a)return;const n=this._createDefaultBulkActions(a,e);n&&(0,_.isEqual)(e.bulkActions,n)&&(e.bulkActions=void 0)}crtOnMetaDataChanged(e){const t=e,i=t.viewModelConfig.attributes??{};return(0,h.getCollectionViewConfigsWithItemsBinding)(t,this._availableViewElementTypes).forEach(r=>this._clearDefaultBulkActions(r,i)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||H)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac})}}function Gt(N,e){const t=new Map(e.map(([i,r])=>[i,{injectable:r}]));return new v.Factory(N,t)}class G{static withCreators(e){return{ngModule:G,providers:e.map(t=>[{provide:u.BULK_ACTIONS_VIEW_ELEMENT_CREATORS,useValue:t,multi:!0},{provide:gt,useValue:t[0],multi:!0}]).flat()}}static{this.\u0275fac=function(t){return new(t||G)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:G})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:B,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useClass:H,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:B,multi:!0},{provide:u.BULK_ACTIONS_VIEW_ELEMENT_CREATOR_FACTORY,useFactory:Gt,deps:[o.Injector,u.BULK_ACTIONS_VIEW_ELEMENT_CREATORS]}]})}}var z=y(23958);class Be{_getMenuItem(e,t,i){return{type:"crt.MenuItem",caption:e.caption||e.captionLcz,clicked:{request:"crt.CreateRecordRequest",params:{entityName:t,defaultValues:i}}}}_getDefaultValues(e,t,i){const r=i?[{attributeName:i,value:e.UId}]:[];return t.length&&r.splice(0,0,...t),r}_getEntityName(e,t){const i=e.viewConfig.clicked.params;let r=i.entityName||"";if(!r){const a=i.itemsAttributeName;if(a){const n=t.getBoundDataSourceNameByAttributePath(a);r=t.dataSchemas[n]?.name}}return r}_getButtonsWithCreateRecordRequest(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>{const r=i.viewConfig.clicked;return r?.params&&r.request==="crt.CreateRecordRequest"})}_fillMenuItems(e,t){const i=this._getEntityName(e,t);if(!i)return;const r=z.NavigationUtils.getEntityStructure(i,z.UITypePriority.PreferFreedomUI);if(!r)return;const a=z.NavigationUtils.getPagesForAddAction(r.pages);if(!a?.length)return;const n=r.attribute,s=e.viewConfig.clicked.params?.defaultValues||[];if(!s.find(d=>d.attributeName===n)?.value){if(a.length>1){e.viewConfig.clickMode="menu";const d=a.map(m=>{const g=this._getDefaultValues(m,s,n);return this._getMenuItem(m,i,g)});e.viewConfig.menuItems??=[],e.viewConfig.menuItems.splice(0,0,...d)}else if(n){const d=this._getDefaultValues(a[0],s,n);e.viewConfig.clicked.params.defaultValues=d}}}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){return r._getButtonsWithCreateRecordRequest(e).forEach(a=>{r._fillMenuItems(a,i)}),e})()}static{this.\u0275fac=function(t){return new(t||Be)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Be,factory:Be.\u0275fac})}}class Ge{constructor(e){this.crtRoute=e}_getButtonsWithDefaultPageRequest(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>i?.viewConfig?.clicked?.request==="crt.ContinueInOtherPageRequest")}_prepareButton(e,t){const i=e.viewConfig;(0,_.isString)(i.visible)||(i.visible=t)}_getEntityNavigationOptions(e){const t=(0,h.resolveSchemaPrimaryEntityName)(e),i=this.crtRoute.getState(),r=(0,_.last)(i?.children),a=(0,_.last)(r?.modelInitConfigs),n=(0,_.last)(i?.modelInitConfigs);return{defaultValues:a?.defaultValues||n?.defaultValues||[],entityName:t,recordId:a?.recordId}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=t._getEntityNavigationOptions(i);if(!r.entityName)return Promise.resolve(e);const a=t._getButtonsWithDefaultPageRequest(i),n=yield z.NavigationUtils.getPageForActionAsync({action:T.ModelInPageAction.Edit,...r}),s=yield z.NavigationUtils.getPageForActionAsync({action:T.ModelInPageAction.Add,...r}),c=n?.cardSchema===s?.cardSchema,d=n?.cardSchema===i.name,m=!!(!c&&!d&&s&&n?.cardSchema);return a.forEach(g=>{t._prepareButton(g,m)}),Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||Ge)(o.\u0275\u0275inject(z.LocationStrategy))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ge,factory:Ge.\u0275fac})}}const Et="Telephony.Use",Dt="MailboxSynchronization.Use",Tt="Chats.Use",Lt="SelectedItem";class Le{constructor(e,t,i){this._userInfo=e,this._profileAttributeService=t,this._licenseOperationValues=i}_getButtonToggleGroups(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ButtonToggleGroup",e.viewConfig).filter(i=>i.viewConfig.for)}_getDefaultSelectedTabValue(e){return e.selectedTab?{value:e.selectedTab}:{}}_removeTab(e,t){const i=e.findIndex(r=>r.name===t);i!==-1&&e.splice(i,1)}_isRemoveTab(e){return!this._licenseOperationValues[e]}_getLicenseOperations(){const e=new Map;return e.set(Et,"CtiTab"),e.set(Dt,"EmailsTab"),e.set(Tt,"ChatsTab"),e}_filterTabs(e){return this._userInfo.isSSP?e.filter(i=>i.name==="FeedsTab"):(this._getLicenseOperations().forEach((i,r)=>{this._isRemoveTab(r)&&this._removeTab(e,i)}),e)}crtOnModelInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=i?.viewModelConfig?.attributes,a=t._getButtonToggleGroups(i);for(const n of a){const s=n.viewConfig,c=s.for,m=p.MetadataSchemaUtils.getViewConfigInfoByFilter(I=>I.name===c,i.viewConfig)?.[0]?.viewConfig,g=`${c}_Items`;s.items=`$${g}`;let S=m?.items??[];m.name==="CommunicationsPanelItemsTabPanel"&&(S=t._filterTabs(S));const b=(0,u.mapTabItemsToToggleValues)(S);r[g]={value:b};const D=`${c}_${Lt}`;r[D]=r[D]||t._getDefaultSelectedTabValue(m),s.value=`$${D}`,m.selectedTab=`$${D}`,m.visible=`$${D} | crt.ToBoolean`,yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,m,"selectedTab",D,"DisableSaveToProfileToggleGroupSelectedTab"),m?.allowToggleClose!==void 0&&(s.allowUntoggle=m?.allowToggleClose)}return Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||Le)(o.\u0275\u0275inject(p.UserInfo),o.\u0275\u0275inject(u.ProfileAttributeService),o.\u0275\u0275inject(C.LICENSE_RESTRICTION_OPERATION_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac})}}class J{constructor(e){this._comboboxPreprocessorService=e}_getComboboxesViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ComboBox",e.viewConfig).map(t=>t.viewConfig)}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes,r=this._getComboboxesViewConfigs(t);return this._comboboxPreprocessorService.crtOnMetaDataInit(r,i),Promise.resolve(e)}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){const r=e,a=r.viewModelConfig.attributes,n=i._getComboboxesViewConfigs(r);return yield i._comboboxPreprocessorService.crtOnModelInit(n,a,t),e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,n=a.viewModelConfig.attributes,s=r._getComboboxesViewConfigs(a);return yield r._comboboxPreprocessorService.crtOnViewModelInit(s,n,t,i),e})()}static{this.\u0275fac=function(t){return new(t||J)(o.\u0275\u0275inject(W.ComboboxPreprocessorService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}var Y=y(79772);class lt{hasEntityEditPage(e,t){return(0,l.A)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:e,payload:{entityName:t}};return yield T.HandlerChainService.instance.process(i)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){return yield Promise.all((0,u.getDataGridViewConfigsWithItemsBinding)(e,r.viewItemTypes).filter(a=>!a.rowToolbarItems).map(a=>r.setRowToolbarMenuItems(a,i))),e})()}}class X extends lt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,l.A)(function*(){const r=e.items.slice(1),a=t.getBoundDataSourceNameByAttributePath(r),n=t.getBoundDataSchemaByAttributePath(r)?.name,s=yield i.hasEntityEditPage(t,n),c=`$${r}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:s,disabled:c,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Copy"),icon:"copy-row-action",visible:s,disabled:c,clicked:{request:"crt.CopyRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!1}}]})()}static{this.\u0275fac=function(t){return new(t||X)(o.\u0275\u0275inject(Y.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac})}}var ht=y(47742);const jt={[T.DataValueType.Integer]:0,[T.DataValueType.FLOAT1]:1,[T.DataValueType.FLOAT2]:2,[T.DataValueType.FLOAT3]:3,[T.DataValueType.FLOAT4]:4,[T.DataValueType.FLOAT8]:8,[T.DataValueType.Money]:2};class L{process(e,t){const i=jt[t]??null;i!==null&&!e.format&&(e.format={decimalPrecision:i})}static{this.\u0275fac=function(t){return new(t||L)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac})}}class je{constructor(e){this._numberInputPreprocessorService=e}_process(e,t){if(!(0,h.isBindingExpression)(e.control))return;const i=(0,h.parseExpression)(e.control).attributePath;if(!i)return;const a=t.getBoundDataSchemaAttributeByAttributePath(i)?.dataValueType;a&&this._numberInputPreprocessorService.process(e,a)}crtOnViewModelInit(e,t,i){const r=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.NumberInput",r.viewConfig).forEach(n=>{this._process(n.viewConfig,i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||je)(o.\u0275\u0275inject(L))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:je,factory:je.\u0275fac})}}class K{constructor(e,t,i,r,a){this._editingCellViewConfigCreatorFactory=e,this._featureService=t,this._metadataModifierService=i,this._comboboxPreprocessorService=r,this._numberInputPreprocessorService=a}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(P.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_updateAttributeProperties(e,t,i){ht.ViewElementConfigUtils.updateCollectionAttributeProperties(t,e,i,[{name:"readonly",defaultValue:!1}])}_getDesignOptionsEditingCellView(e,t){return e?._designOptions?.columns?.editingCellViews?.[t]}_getDefaultEditingCellView(e,t,i){const r=t.items;return this._editingCellViewConfigCreatorFactory.create({dataValueType:e.dataValueType,columnName:e.code}).getViewElementConfig({column:e,itemsAttributeName:r,context:i})}_setEditingCellViewToColumnDefinition(e,t){this._metadataModifierService.addProperty(e,"editingCellView",t)}_addColumnsEditingCellViewConfigs(e,t,i,r=!1){var a=this;return(0,l.A)(function*(){const n=e.columns;if(!Array.isArray(n))return;const s=e.items,c=n.filter(d=>!d.editingCellView);for(const d of c){const m=a._getDesignOptionsEditingCellView(e,d.code);if(m){a._setEditingCellViewToColumnDefinition(d,m);continue}const g=yield a._getDefaultEditingCellView(d,e,t);r&&g&&a._updateAttributeProperties(i,g,s),g&&a._setEditingCellViewToColumnDefinition(d,g)}})()}_getColumnDefinitionByPredicate(e,t){return Array.isArray(e.columns)?(e.columns||[]).filter(t):[]}_getComboboxesViewConfigsFromDataGridViewConfig(e){return this._getDataGridComboBoxColumnDefinitions(e).map(t=>t.editingCellView)}_getDataGridComboBoxColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>!!(t.dataValueType===T.DataValueType.Lookup&&t.editingCellView))}_getDataGridNumberInputColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>t.editingCellView?.type==="crt.DataTableEditNumericCell")}_getDataGridItemsAttributeConfig(e,t){const i=(0,u.getViewModelItemsAttributeName)(e);return i?t.viewModelConfig.attributes[i]?.viewModelConfig?.attributes:void 0}_addEditableFeature(e,t){const i=e.features;if((0,h.isBindingExpression)(i))return;const r=(0,u.fullInDataTableEditingFeatures)(i?.editable,!t);if(!i)return this._metadataModifierService.addProperty(e,"features",{editable:r});const a=i.editable;if(a==null)return this._metadataModifierService.addProperty(i,"editable",r);typeof a!="boolean"&&(a.enable==null&&this._metadataModifierService.addProperty(a,"enable",r.enable),a.itemsCreation==null&&this._metadataModifierService.addProperty(a,"itemsCreation",a.enable&&r.itemsCreation),a.floatingEditPanel==null&&this._metadataModifierService.addProperty(a,"floatingEditPanel",a.enable&&r.floatingEditPanel),a.lookupItemsCreation==null&&this._metadataModifierService.addProperty(a,"lookupItemsCreation",a.enable&&r.lookupItemsCreation))}_comboboxesOnViewModelInit(e,t,i,r){var a=this;return(0,l.A)(function*(){const n=a._getComboboxesViewConfigsForOnViewModelInit(e,t);yield a._comboboxPreprocessorService.crtOnViewModelInit(n,t,i,r)})()}_getComboboxesViewConfigsForOnViewModelInit(e,t){return e.map(i=>{const r=this._getComboboxesViewConfigsFromDataGridViewConfig(i);return this._addActionAddRecordToListActionsIfNeed(r,t,i),r}).flat(1)}_addActionAddRecordToListActionsIfNeed(e,t,i){const r=this._getLookupItemsCreationFeatureValue(i);(!(0,_.isBoolean)(r)||r)&&e.forEach(n=>this._addActionAddRecordToListActions(n,t))}_getLookupItemsCreationFeatureValue(e){return e.features?.editable?.lookupItemsCreation}_addActionAddRecordToListActions(e,t){const i=t[`${e.attributeName}_List`],r=i&&"embeddedModel"in i&&i.embeddedModel?.config?.config?.entitySchemaName;if(!r)return;const a=e.control.split(".").pop(),n={...W.defaultAddRecordActionConfig,clicked:{request:"crt.CreateRecordFromEditLookupCellRequest",params:{schemaName:r,attributeName:a,detail:"@event.detail"},useRelativeContext:!0},name:v.NameGenerator.generateUnique("ListAction")};this._addComboboxActionIfNotExist(e,W.ComboboxActionCodeEnum.AddRecord,n)}_addComboboxActionIfNotExist(e,t,i){e.listActions||(e.listActions=[]),!e.listActions.some(a=>a.code===t)&&e.listActions.push(i)}_numbersOnViewModelInit(e){this._getDataGridNumberInputColumnDefinitions(e).forEach(i=>{const r=i.dataValueType,a=i.editingCellView;this._numberInputPreprocessorService.process(a,r)})}_updateCellPropertiesOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e.items,n=r._getColumnDefinitionByPredicate(e,s=>s.editingCellView?.type===i);for(const s of n){const d=yield r._editingCellViewConfigCreatorFactory.create({dataValueType:s.dataValueType,columnName:s.code}).getViewElementConfig({column:s,itemsAttributeName:a,context:t});r._metadataModifierService.addProperty(s,"editingCellView",d)}})()}_phoneOnViewModelInit(e,t){var i=this;return(0,l.A)(function*(){yield i._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditPhoneCell")})()}_emailOnViewModelInit(e,t){var i=this;return(0,l.A)(function*(){yield i._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditEmailCell")})()}_isDataGridEditingEnabled(e){const t=e.features;return(0,h.isBindingExpression)(t)?!0:(0,u.fullInDataTableEditingFeatures)(t?.editable).enable}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=yield t._isEditingModeDisabled(),a=(0,u.getDataGridViewConfigs)(e);for(const n of a){if(t._addEditableFeature(n,r),!t._isDataGridEditingEnabled(n)||r)continue;yield t._addColumnsEditingCellViewConfigs(n,null,i,!0);const s=t._getDataGridItemsAttributeConfig(n,e);if(!s)continue;const c=t._getComboboxesViewConfigsFromDataGridViewConfig(n);t._comboboxPreprocessorService.crtOnMetaDataInit(c,s)}return e})()}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if(yield i._isEditingModeDisabled())return e;const r=(0,u.getDataGridViewConfigs)(e);for(const a of r){if(!i._isDataGridEditingEnabled(a))continue;const n=i._getDataGridItemsAttributeConfig(a,e);if(!n)continue;const s=i._getComboboxesViewConfigsFromDataGridViewConfig(a);yield i._comboboxPreprocessorService.crtOnModelInit(s,n,t)}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield r._isEditingModeDisabled())return e;const a=e,n=(0,u.getDataGridViewConfigs)(e);let s={};const c=[];for(const d of n){if(!r._isDataGridEditingEnabled(d))continue;const m=r._getDataGridItemsAttributeConfig(d,e);m&&(s={...s,...m},c.push(d),yield r._addColumnsEditingCellViewConfigs(d,i,a),r._numbersOnViewModelInit(d),yield r._phoneOnViewModelInit(d,i),yield r._emailOnViewModelInit(d,i))}return yield r._comboboxesOnViewModelInit(c,s,t,i),e})()}static{this.\u0275fac=function(t){return new(t||K)(o.\u0275\u0275inject(P.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY),o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService),o.\u0275\u0275inject(W.ComboboxPreprocessorService),o.\u0275\u0275inject(L))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac})}}var R=y(36486);class j{constructor(e,t,i){this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this.featureName="DisableDataGridColumnsPreprocessing",this.viewItemTypes=["crt.DataGrid"]}_getColumnDefinitions(e,t){var i=this;return(0,l.A)(function*(){const r=e.columns,a=yield i.getGenerateCellViewConfig(e,t);return a?(0,A.lastValueFrom)(i.dataGridColumnDefinitionService.processDataGridColumnDefinitions(a,r)):[]})()}_addColumnsCellViewConfigs(e,t){var i=this;return(0,l.A)(function*(){const r=e.columns;if(!Array.isArray(r)||r.length===0)return;const a=yield i._getColumnDefinitions(e,t);i._addColumnProperty(r,a,"cellView"),i._addColumnProperty(r,a,"readonly"),r.forEach(n=>{delete n.path,delete n.referenceSchemaName})})()}_addColumnProperty(e,t,i){e.filter(r=>!r[i]).map(r=>[r,t.find(a=>a.code===r.code)]).forEach(([r,a])=>this.metadataModifierService.addProperty(r,i,a?.[i]))}getGenerateCellViewConfig(e,t){const i=(0,A.of)(t),r=(0,u.getViewModelItemsAttributeName)(e);if(!r)return Promise.resolve(null);const a=i.pipe((0,R.map)(c=>c?.getBoundDataSourceNameByAttributePath(r))),n=i.pipe((0,R.map)(c=>c?.getBoundDataSchemaByAttributePath(r))),s=e.items;return(0,A.lastValueFrom)((0,A.forkJoin)([a,n]).pipe((0,R.switchMap)(([c,d])=>c&&d?(0,A.of)({dataSchema:d,dataSourceName:c,itemsAttributeName:s,viewModel:t,viewConfig:e}):(0,A.of)(null))))}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(r.featureService.getFeatureState(r.featureName),{defaultValue:null}))return e;const n=p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",r.viewItemTypes,e.viewConfig);for(const s of n)yield r._addColumnsCellViewConfigs(s.viewConfig,i);return e})()}static{this.\u0275fac=function(t){return new(t||j)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService),o.\u0275\u0275inject(P.DataGridColumnDefinitionService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac})}}class Z{constructor(e){this._filterOptionsBackwardCompatibilityModifier=e}_isEmptyExposeFilters(e){const t=e?._filterOptions;return t?!t.expose?.length:!1}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(t=>this._isEmptyExposeFilters(t)).forEach(t=>this._filterOptionsBackwardCompatibilityModifier.modify(t)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Z)(o.\u0275\u0275inject(u.DataGridFilterOptionsBackwardCompatibilityModifier))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac})}}class Q{_setInitialFilterOptions(e){e.items??=`$${(0,u.createDataGridItemsAttributeName)(e)}`,e.activeRow??=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;const t=(0,u.createDataGridInitialFilterOptions)(e);t&&(e._filterOptions=t)}_canSetInitialFilterOptions(e){return(0,_.isEmpty)(e?._filterOptions)&&(0,u.canDataGridContainsFilterOptions)(e)}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(this._canSetInitialFilterOptions).forEach(t=>this._setInitialFilterOptions(t)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Q)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac})}}class ut{static{this.\u0275fac=function(t){return new(t||ut)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:ut})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[u.DataGridFilterOptionsBackwardCompatibilityModifier,{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:Q,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:Z,multi:!0}]})}}class $e{_cleanupDefaultFilterOptionsMetadata(e){const t=e._filterOptions;if(!t)return this._cleanupDefaultActiveRow(e);const i=(0,_.cloneDeep)(e),r=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;i.activeRow??=r;const a=(0,u.createDataGridInitialFilterOptions)(i);(0,_.isEqual)(t,a)&&(delete e._filterOptions,this._cleanupDefaultActiveRow(e))}_cleanupDefaultActiveRow(e){const t=e.activeRow,i=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;(0,_.isEqual)(t,i)&&delete e.activeRow}crtOnMetaDataChanged(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultFilterOptionsMetadata(t)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||$e)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:$e,factory:$e.\u0275fac})}}class dt{static{this.\u0275fac=function(t){return new(t||dt)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:dt})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useClass:$e,multi:!0}]})}}class ee{constructor(e,t,i,r,a){this._defaultFeatures=e,this._featureValues=t,this._translateService=i,this._dataGridFolderTreeRelationsProvider=r,this._licenseOperationValues=a}_createGeneralListSettingsMenuItems(e,t){const i=`$${t} | crt.ToBoolean | crt.InvertBooleanValue`,r=this._defaultFeatures?.operations?.canCreateDefaultGridSettings,a={type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.SaveForAll"),icon:"save",visible:i,clicked:{request:"crt.DataGridSaveConfigsForAllRequest",params:{dataGridName:e.name}}};return[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.GeneralListSettingsLabel"),visible:i},...r?[a]:[],{type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.ResetToDefault"),icon:"reset",visible:i,clicked:{request:"crt.DataGridResetConfigsToDefaultRequest",params:{dataGridName:e.name}}}]}_setupSaveConfigsForActiveFolderActionVisibleAttribute(e,t,i,r){const a=`${t}_Exist`,n=`${i}_NotExist`;r.viewModelConfig??={},r.viewModelConfig.attributes={...r.viewModelConfig.attributes,[a]:{from:t,converter:"crt.ToBoolean"},[n]:{from:i,converter:"crt.ToBoolean | crt.InvertBooleanValue"},[e]:{from:[a,n],converter:"crt.IsEveryEqualTo : true"}}}_createFolderListSettingsMenuItems(e,t,i){const r=this._licenseOperationValues[u.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridSettingsByFolders||!r)return[];const a=this._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(e,i);if(!a?.name)return[];const n=this._translateService.instant("DataGrid.ActionsToolbar.SaveListSettingsForFolder"),s=this._translateService.instant("DataGrid.ActionsToolbar.ClearListSettingsForFolder"),c=`$${t} | crt.ToBoolean`,{activeFolderFolderTreeIdAttrName:d,activeFolderNameAttrName:m}=(0,p.buildFolderTreeAttributeNames)(a.name),g=`$${m} | crt.InterpolateString : '${n}'`,S=e.name+"_SaveConfigsForActiveFolderAction_Visible";return this._setupSaveConfigsForActiveFolderActionVisibleAttribute(S,d,t,i),[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.FolderListSettingsLabel"),visible:`$${d} | crt.ToBoolean`},{type:"crt.MenuItem",caption:g,icon:"save-for-folder-icon",visible:`$${S}`,clicked:{request:"crt.DataGridSaveConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:g,icon:"save-for-folder-icon",visible:c,clicked:{request:"crt.DataGridUpdateConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:`$${m} | crt.InterpolateString : '${s}'`,icon:"discard-for-folder-icon",visible:c,clicked:{request:"crt.DataGridClearConfigsForActiveFolderRequest",params:{dataGridName:e.name,folderTreeName:a.name}}}]}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e).filter(i=>!i.headerToolbarItems).forEach(i=>{const r=(0,u.createDataGridActiveFolderSettingsAttributeName)(i),a=this._createGeneralListSettingsMenuItems(i,r),n=this._createFolderListSettingsMenuItems(i,r,e);i.headerToolbarItems=[...a,...n]}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||ee)(o.\u0275\u0275inject(u.DATA_GRID_FEATURES,8),o.\u0275\u0275inject(p.FEATURE_VALUES),o.\u0275\u0275inject(Y.TranslateService),o.\u0275\u0275inject(u.DataGridFolderTreeRelationsProvider),o.\u0275\u0275inject(C.LICENSE_RESTRICTION_OPERATION_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac})}}class te{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(P.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setCancelItemsChangesOutput(e){const t=e.items.slice(1);e.cancelItemsChanges={request:"crt.DataGridCancelItemsChangesRequest",params:{itemsAttributeName:t,changedItems:"@event"}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){return(yield t._isEditingModeDisabled())||(0,u.getDataGridViewConfigsWithItemsBinding)(e).filter(i=>i.cancelItemsChanges==null).forEach(i=>t._setCancelItemsChangesOutput(i)),e})()}static{this.\u0275fac=function(t){return new(t||te)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac})}}class ie{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(P.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_isItemsCreationEnabled(e){const t=e.features;return(0,h.isBindingExpression)(t)?!0:!!(0,u.fullInDataTableEditingFeatures)(t?.editable,!0).itemsCreation}_bindEditingCellsInput(e,t){if(e.editingCells)return;const i=e.name&&`${e.name}_EditingCells`;i&&(t[i]||(t[i]={value:null}),e.editingCells=`$${i}`)}_bindItemCreatingOutput(e,t,i){if(e.createItem)return;const r=this._getDefaultValuesFromDependencies(e,t,i);e.createItem={request:"crt.DataGridCreateItemRequest",params:{dataGridName:e.name,insertionIndex:"@event.index",defaultValues:r.map(({attributeName:a,value:n})=>({attributeName:a,value:n}))}}}_getDefaultValuesFromDependencies(e,t,i){const r=i.dependencies,a=i.dataSources,n=i.primaryDataSourceName||"",s=e.items.slice(1),d=t[s]?.modelConfig?.path,m=d&&r?.[d];return m?m.filter(g=>this._isDependOnPageDataSource(g,a)).map(g=>this._getDependencyAttributeName(g,t,n)).map((g,S)=>g||`${e.name}_DependencyValue_${S}`).map((g,S)=>{const b=m[S];return this._setDependencyViewModelAttribute(g,b,t),this._getDefaultValue(g,b,a)}):[]}_getRelatedDataSourceName(e){return e.relationPath.split(".").shift()??""}_isDependOnPageDataSource(e,t){const i=this._getRelatedDataSourceName(e);return t?.[i]?.scope===T.DataSourceScope.Page}_getDefaultValue(e,t,i){const r=this._getRelatedDataSourceName(t),a=i?.[r]?.config||{},n=a.entitySchemaName?`$${e} | crt.ToLookup : '${a.entitySchemaName}'`:`$${e}`;return{attributeName:t.attributePath,value:n}}_setDependencyViewModelAttribute(e,t,i){i[e]||(i[e]={modelConfig:{path:t.relationPath}})}_getDependencyAttributeName(e,t,i){return Object.keys(t).find(r=>(t[r]?.modelConfig?.path||"").replace("#PrimaryDataSourceName()#",i)===e.relationPath)}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isEditingModeDisabled())return e;const i=e;i.viewModelConfig=i.viewModelConfig??{};const r=i.viewModelConfig.attributes=i.viewModelConfig.attributes||{},a=i.modelConfig||{};return(0,u.getDataGridViewConfigsWithItemsBinding)(i).filter(n=>t._isItemsCreationEnabled(n)).forEach(n=>{t._bindEditingCellsInput(n,r),t._bindItemCreatingOutput(n,r,a)}),e})()}static{this.\u0275fac=function(t){return new(t||ie)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac})}}class re{_bindItemDeletionOutput(e){const t=e.items.slice(1);e.deleteItem||!t||(e.deleteItem={request:"crt.DeleteRecordRequest",params:{itemsAttributeName:t,recordId:"@event.rowId"}})}crtOnMetaDataInit(e){const t=e;return t.viewModelConfig=t.viewModelConfig??{},(0,u.getDataGridViewConfigsWithItemsBinding)(t).forEach(i=>{this._bindItemDeletionOutput(i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||re)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac})}}class ae{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_isEditingModeDisabled(){return(0,A.firstValueFrom)(this._featureService.getFeatureState(P.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setSaveItemsChangesOutput(e){const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveRecordsRequest",params:{itemsAttributeName:t}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){return(yield t._isEditingModeDisabled())||(0,u.getDataGridViewConfigsWithItemsBinding)(e).filter(i=>i.saveItemsChanges==null).forEach(i=>t._setSaveItemsChangesOutput(i)),e})()}static{this.\u0275fac=function(t){return new(t||ae)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac})}}class ne{constructor(e){this._featureValues=e}_createActivateRowBusinessRulesRequest(e,t){return{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:e,dataGridViewElementName:t.name}}}_getActiveRowAttributeName(e){let t=e.activeRow;return t==null&&(t=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`),(0,h.isBindingExpression)(t)?(0,h.parseExpression)(t).attributePath:""}crtOnMetaDataInit(e){if(this._featureValues.DisableActivateGridRowOnReload)return Promise.resolve(e);const t=e;return(0,u.getDataGridViewConfigsWithItemsBinding)(e).forEach(i=>{const r=this._getActiveRowAttributeName(i);if(r){const a=(0,u.getDataGridItemsAttributeName)(i);p.MetadataSchemaUtils.addViewModelAttributeChangeRequest(t,{attributeName:a,requests:[this._createActivateRowBusinessRulesRequest(r,i)]})}}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||ne)(o.\u0275\u0275inject(p.FEATURE_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}}function _t(N){return{request:"crt.LoadDataRequest",params:{dataSourceName:N,parameters:[]}}}function At(){return{rowCount:30}}class se{constructor(e){this._featureService=e,this._featureName="DisableDataGridPagingPreprocessing"}_setPaginationChange(e,t){if(e.paginationChange)return;const i=e.items?.slice(1),r=t.getBoundDataSourceNameByAttributePath(i);e.paginationChange=_t(r)}_setPagingConfig(e,t){const i=e.items?.slice(1),r=(t?.viewModelConfig?.attributes)[i]??{};if(!(0,f.isModelAttributeConfig)(r))return;const a=r.modelConfig;!a||a?.pagingConfig||(a.pagingConfig=At())}get _isFeatureDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._featureName))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isFeatureDisabled)return e;const i=e,r=(0,u.getDataGridViewConfigsWithItemsBinding)(e);for(const a of r)t._setPagingConfig(a,i);return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield r._isFeatureDisabled)return e;const a=(0,u.getDataGridViewConfigsWithItemsBinding)(e);for(const n of a)r._setPaginationChange(n,i);return e})()}static{this.\u0275fac=function(t){return new(t||se)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac})}}function It(N,e){return`${N}_${e}`}class oe{constructor(e){this._featureService=e,this._featureName="DisableDataGridPlaceholderPreprocessing"}_setNoConfiguredPlaceholder(e){e.skeleton==null&&(e.skeleton=[{type:"crt.Placeholder",image:{type:"icon",icon:"data-table",width:null,height:null,padding:null},title:"",subhead:""}])}_setNoItemsPlaceholders(e,t,i){const r=t.placeholder,a=t.items?.split("$")?.pop(),n=this._getSearchFilterAttributesNames(i,a),c=[...this._getFilterAttributesNames(e,a),...n];if(!r?.length||!c.length)return;r.map(m=>m.visible).map(m=>(m??"")?.split("$")?.pop()).filter(Boolean).map(m=>e[m]).filter(Boolean).forEach(m=>m.from=(0,_.uniq)([...m.from,...c]))}_getFilterAttributesNames(e,t){const r=e[t]?.modelConfig?.filterAttributes??[];return Object.values(r).filter(a=>a.loadOnChange).filter(a=>!a.name.endsWith("_PredefinedFilter")).map(a=>a.name)}_getSearchFilterAttributesNames(e,t){return e.filter(i=>i.targetAttributes?.includes(t)).map(({name:i})=>It(i,t))}_getSearchFilterViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const r=e;r.viewModelConfig.attributes=r.viewModelConfig.attributes??{};const a=r.viewModelConfig.attributes,n=t._getSearchFilterViewConfigs(r);return(0,u.getDataGridViewConfigs)(e).forEach(s=>{(0,h.isBindToViewModelAttribute)(s.items,a)?t._setNoItemsPlaceholders(a,s,n):t._setNoConfiguredPlaceholder(s)}),e})()}static{this.\u0275fac=function(t){return new(t||oe)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac})}}class ce{_bindActiveRow(e,t,i){if(t.activeRow===void 0&&(t.activeRow=`$${(0,u.createDataGridActiveRowAttributeName)(t)}`),!(0,h.isBindingExpression)(t.activeRow))return;const r=(0,h.parseExpression)(t.activeRow).attributePath;i[r]??={value:null},p.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:r,dataGridViewElementName:t.name}}]})}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes??={};return(0,u.getDataGridViewConfigs)(e).forEach(r=>this._bindActiveRow(t,r,i)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||ce)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac})}}class le{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowDoubleClickPreprocessing"}_hasSectionEditPage(e,t){return(0,l.A)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return yield T.HandlerChainService.instance.process(i)})()}_getReferenceSchemaName(e,t){return(0,l.A)(function*(){return(yield(0,f.getEntitySchemaAttribute)(t,e))?.referenceSchemaName})()}_getPrimaryAttributeName(e,t){const i=(0,u.getViewModelItemsAttributeName)(e),r=t.getBoundDataSourceNameByAttributePath(i),a=t.getBoundDataSchemaByAttributePath(i),{primaryAttributeName:n}=a??{};return n?`${r}_${n}`:""}_isPageExists(e,t){var i=this;return(0,l.A)(function*(){const r=i._getPrimaryAttributeName(e,t),a=yield i._getReferenceSchemaName(r,t);return i._hasSectionEditPage(a,t)})()}_getDataGridViewConfigs(e,t){var i=this;return(0,l.A)(function*(){const r=(0,u.getDataGridViewConfigsWithItemsBinding)(e);return(yield Promise.all(r.map(n=>i._isPageExists(n,t)))).reduce((n,s,c)=>(s&&!r[c].rowDoubleClick&&n.push(r[c]),n),[])})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(r._featureService.getFeatureState(r._featureName),{defaultValue:null}))return e;const n=yield r._getDataGridViewConfigs(e,i);for(const s of n)s.rowDoubleClick={request:"crt.DataGridRowDoubleClickRequest",params:{itemsAttributeName:(0,u.getViewModelItemsAttributeName)(s),rowId:"@event.rowId"}};return e})()}static{this.\u0275fac=function(t){return new(t||le)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac})}}class ue{constructor(e){this._featureService=e}_isSelectionPreprocessingDisabled(){const e=this._featureService.getFeatureState("DisableDataGridRowsSelectionPreprocessing");return(0,A.lastValueFrom)(e,{defaultValue:!1})}_bindSelectedRows(e,t){if(e.selectedRows??=`$${(0,u.createDataGridSelectedRowsAttributeName)(e)}`,!(0,h.isBindingExpression)(e.selectedRows))return;const i=(0,h.parseExpression)(e.selectedRows).attributePath;t[i]||(t[i]={value:null})}_bindSelectionState(e,t,i){if(t.selectionState??=`$${(0,u.createDataGridSelectionStateAttributeName)(t)}`,!(0,h.isBindingExpression)(t.selectionState))return;const r=(0,h.parseExpression)(t.selectionState).attributePath;if(i[r]??={value:null},!(0,h.isBindingExpression)(t.items))return;const a=(0,h.parseExpression)(t.items).attributePath;if(t.totalItemsCount??=`$${a}_TotalItemsCount`,!(0,h.isBindingExpression)(t.totalItemsCount))return;const n=(0,h.parseExpression)(t.totalItemsCount).attributePath,s=`${a}_SelectedItemsCount`;if(this._createTotalItemsCountAttribute(n,{itemsAttributeName:a,selectionStateAttributeName:r},i),this._createSelectedItemsCountAttribute(s,{itemsAttributeName:a,selectionStateAttributeName:r,totalItemsCountAttributeName:n},i),p.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridCleanupCachedItemsCountLoadParametersRequest",params:{itemsAttributeName:a,selectionStateAttributeName:r}},{request:"crt.DataGridRunSelectedItemsCountAttributeCalculationRequest",params:{selectionStateAttributeName:r,selectedItemsCountAttributeName:s}}]}),!(0,h.isBindingExpression)(t.selectedRows))return;const c=(0,h.parseExpression)(t.selectedRows).attributePath;p.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridSetSelectedRowsFromSelectionStateRequest",params:{selectedRowsAttributeName:c,selectionStateAttributeName:r}}]})}_createTotalItemsCountAttribute(e,t,i){const{itemsAttributeName:r,selectionStateAttributeName:a}=t,n=`${e}_Actualization`;i[e]??={from:[r,n],converter:`crt.ToCollectionItemsCount : '${r}' : '${e}'`},i[n]??={from:a,converter:"crt.IsAnySelected"}}_createSelectedItemsCountAttribute(e,t,i){const{itemsAttributeName:r,selectionStateAttributeName:a,totalItemsCountAttributeName:n}=t;i[e]??={from:[r,a,n],converter:`crt.ToCollectionSelectedItemsCount : '${r}' : '${e}'`,change:{request:"crt.DataGridSetSelectedCountToRowsSelectionStateRequest",params:{selectionStateAttributeName:a,selectedItemsCountAttributeName:e}}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isSelectionPreprocessingDisabled())return e;const i=e,r=i.viewModelConfig.attributes??={};return(0,u.getDataGridViewConfigs)(e).forEach(a=>{t._bindSelectedRows(a,r),t._bindSelectionState(i,a,r)}),e})()}static{this.\u0275fac=function(t){return new(t||ue)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ue,factory:ue.\u0275fac})}}class de{constructor(e){this._exposeAttributeConverterMetadataGenerator=e}_getSelectionElementViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>!!t?._selectionOptions,e).map(t=>t.viewConfig)}_generateSelectionAttributes(e){const t=e._selectionOptions.attribute;if(typeof t=="string")return{[t]:{value:null}};const{from:i,expose:r}=t??{};if((0,_.isEmpty)(i)||(0,_.isEmpty)(r))return{};const a=r.attribute;if(!a)return{};const n=this._exposeAttributeConverterMetadataGenerator.generate(r);return n?{[a]:{from:i,converter:n.converterExpression},...n.converterArgsAttributes}:{[a]:{from:i}}}_setSelectionAttributes(e,t){const i=e.viewModelConfig.attributes??={};Object.entries(t).filter(([r,a])=>!!r).forEach(([r,a])=>{i[r]??=a})}crtOnMetaDataInit(e){const t=e;return this._getSelectionElementViewConfigs(t.viewConfig).map(i=>this._generateSelectionAttributes(i)).forEach(i=>{this._setSelectionAttributes(t,i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||de)(o.\u0275\u0275inject(h.ExposeAttributeConverterMetadataGenerator))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac})}}class me{static{this.\u0275fac=function(t){return new(t||me)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:me})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[h.ExposeAttributeConverterMetadataGenerator,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:de,multi:!0}]})}}class F{_canSetSelectionOptions(e){return(0,_.isEmpty)(e?._selectionOptions)&&(0,h.canComponentContainSelectionOptions)(e)}_setSelectionOptions(e,t){e.selectionState??=`$${(0,h.createComponentSelectionStateAttributeName)(t)}`;const i=(0,h.createComponentInitialSelectionOptions)(e);i&&(e._selectionOptions=i)}setInitialSelectionOptions(e,t){this._canSetSelectionOptions(e)&&this._setSelectionOptions(e,t)}static{this.\u0275fac=function(t){return new(t||F)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac})}}class ${constructor(e=!1){this._isDesignTime=e,this._selectionOptionsPreprocessorService=(0,o.inject)(F)}_setInitialSelectionOptions(e){(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._selectionOptionsPreprocessorService.setInitialSelectionOptions(t,t.name||"DataGrid"))}_setExportToExcelRequestFiltersParameter(e){(0,ht.getRequestBindingConfigs)(e.viewConfig,"crt.ExportDataGridToExcelRequest",this._canSetExportToExcelRequestFiltersParameter).forEach(t=>{const i=t.params.viewName,r=this._getExportToExcelRequestFiltersParameter(e,i);r&&(t.params={...t.params,filters:r})})}_canSetExportToExcelRequestFiltersParameter(e){const{viewName:t,filters:i}=e?.params??{};return!!t&&i===void 0}_getExportToExcelRequestFiltersParameter(e,t){const i=p.MetadataSchemaUtils.getViewConfigInfoByName(e,t);if(!i?.viewConfig)return null;const{items:r,_selectionOptions:a}=i.viewConfig,n=(0,h.isBindingExpression)(r)&&(0,h.parseExpression)(r).attributePath,s=a?(0,h.getSelectionStateAttributeName)(a):null;return!n||!s?null:(0,h.createCollectionFiltersBindingExpression)(n,{selectionStateAttributeName:s,supportEmptySelection:!0})}crtOnMetaDataInit(e){const t=e;return this._setInitialSelectionOptions(t),this._isDesignTime||this._setExportToExcelRequestFiltersParameter(t),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||$)(o.\u0275\u0275inject(p.IS_DESIGN_TIME,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac})}}class fe{static{this.\u0275fac=function(t){return new(t||fe)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:fe})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:$,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:$,multi:!0}]})}}class xe{_isSelectionStateAttributeBound(e,t,i){const r=(0,_.cloneDeep)(i),n=p.MetadataSchemaUtils.getViewConfigInfoByName(r,e).viewConfig;return delete n._selectionOptions,delete n.selectionState,p.MetadataSchemaUtils.isViewModelAttributeBound(r,t)}_cleanupDefaultSelectionOptionsMetadata(e,t){const i=e._selectionOptions;if(!i)return this._cleanupDefaultSelectionState(e,t);const r=(0,_.cloneDeep)(e),a=`$${(0,u.createDataGridSelectionStateAttributeName)(e)}`;r.selectionState??=a;const n=(0,h.createComponentInitialSelectionOptions)(r);if(!(0,_.isEqual)(i,n))return;const s=(0,h.getSelectionStateAttributeName)(i);e.name&&this._isSelectionStateAttributeBound(e.name,s,t)||(delete e._selectionOptions,this._cleanupDefaultSelectionState(e,t))}_cleanupDefaultSelectionState(e,t){const i=e.selectionState,r=`$${(0,u.createDataGridSelectionStateAttributeName)(e)}`;if(!(0,_.isEqual)(i,r))return;const a=(0,h.parseExpression)(i).attributePath;e.name&&this._isSelectionStateAttributeBound(e.name,a,t)||delete e.selectionState}crtOnMetaDataChanged(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultSelectionOptionsMetadata(t,e)),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||xe)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:xe,factory:xe.\u0275fac})}}class mt{static{this.\u0275fac=function(t){return new(t||mt)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:mt})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useClass:xe,multi:!0}]})}}class pe{constructor(e,t,i){this._featureService=e,this._dcmSchemaManagerService=t,this._entitySchemaRepository=i,this._dcmDataAttributePostfix="_DCMData",this._dcmSchemas=[],this._dataGridToDataSourceMap=[],this._dataSourceSchemas=[]}_getDataGridToDataSourceMap(e,t){return e.map(i=>{const r=i.primaryColumnName?.split("_");r?.pop();const a=r?.join("_")||"",n=t[a];return{dataGridName:i.name,dataSource:n,dataSourceName:a}}).filter(({dataSource:i})=>i!=null)}_getEntitySchemaFromDataSourceSchemas(e){return this._dataSourceSchemas.find(t=>t.name===e?.config?.entitySchemaName)}_getFilterColumnPath(e){const t=e.find(r=>r.filters&&r.isActive&&r.isActiveVersion)?.filters;let i="";if(t){const r=JSON.parse(t);i=`${Object.values(r.items)[0].leftExpression.columnPath}`}return i}_fillDataGridModelConfig(e,t,i,r){var a=this;return(0,l.A)(function*(){const n=a._dcmSchemas.filter(b=>b.entitySchemaUId===e);if(!n?.length)return;const s=a._getFilterColumnPath(n),c=a._dcmSchemaManagerService.getDcmSchemaDataItems(e),d=yield(0,A.firstValueFrom)(c),m=`${t.name}${a._dcmDataAttributePostfix}`;r[m]={value:{schemas:n,schemasData:d,filterColumnAttributePath:`${i?.dataSourceName}_${s}`}};const g=t.items.substring(1),S=r[g].viewModelConfig;s&&g&&!S.attributes[s]&&(S.attributes[`${i?.dataSourceName}_${s}`]={modelConfig:{path:`${i?.dataSourceName}.${s}`}})})()}_initDataGridViewConfigAttributes(e,t){var i=this;return(0,l.A)(function*(){const r=i._dataGridToDataSourceMap.find(n=>n.dataGridName===e.name);if(!r)return;const a=i._getEntitySchemaFromDataSourceSchemas(r.dataSource);a&&(yield i._fillDataGridModelConfig(a?.uId,e,r,t))})()}_getDataSourceSchemas(){var e=this;return(0,l.A)(function*(){const t=e._dataGridToDataSourceMap.map(i=>({name:i?.dataSource?.config?.entitySchemaName,loadLookupColumns:!0}));return yield(0,A.firstValueFrom)(e._entitySchemaRepository.getSchemes(t))})()}get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState("DisableDataGridProgressBarStageCell"))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=(0,u.getDataGridViewConfigs)(e);if(!i?.length)return e;const r=e.modelConfig.dataSources||{};t._dcmSchemas=yield(0,A.firstValueFrom)(t._dcmSchemaManagerService.getDcmSchemaDataCollection()),t._dataGridToDataSourceMap=t._getDataGridToDataSourceMap(i,r),t._dataSourceSchemas=yield t._getDataSourceSchemas();const a=e,n=a.viewModelConfig.attributes=a.viewModelConfig.attributes||{};return yield Promise.all(i.map(s=>t._initDataGridViewConfigAttributes(s,n))),e})()}static{this.\u0275fac=function(t){return new(t||pe)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(C.DcmSchemaManagerService),o.\u0275\u0275inject(p.EntitySchemaRepository))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:pe,factory:pe.\u0275fac})}}class ge{constructor(e,t){this._featureValues=e,this._licenseOperationValues=t}crtOnMetaDataInit(e){const t=this._licenseOperationValues[u.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridRestrictionsPreprocessing||t)return Promise.resolve(e);const i={columns:{editing:!1,adding:!1}};return(0,u.getDataGridViewConfigs)(e).filter(r=>typeof r.features!="string").forEach(r=>{r.features??={},(0,_.merge)(r.features,i)}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||ge)(o.\u0275\u0275inject(p.FEATURE_VALUES),o.\u0275\u0275inject(C.LICENSE_RESTRICTION_OPERATION_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac})}}var M=y(50456),vt=y(8654);const Pt=new o.InjectionToken("Represents a handler to process data grid metadata on metadata init"),Nt=new o.InjectionToken("Represents a handler to process data grid metadata on view model init");class ke extends vt.HandlerBasedPreprocessor{constructor(e,t){super(),this._dataGridOnMetadataInitHandler=e,this._dataGridOnViewModelInitHandler=t}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e;if(!t._dataGridOnMetadataInitHandler)return Promise.resolve(e);for(const r of M.GRID_VIEW_ELEMENT_TYPES)yield t.processElementsOnMetadataInit(r,t._dataGridOnMetadataInitHandler,i);return Promise.resolve(e)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e;if(!r._dataGridOnViewModelInitHandler)return Promise.resolve(e);for(const n of M.GRID_VIEW_ELEMENT_TYPES)yield r.processElementsOnViewModelInit(n,r._dataGridOnViewModelInitHandler,a,t,i);return Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||ke)(o.\u0275\u0275inject(Pt,8),o.\u0275\u0275inject(Nt,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ke,factory:ke.\u0275fac})}}var $t=y(45447),Rt=y.n($t);class he{constructor(e,t){this._userInfo=e,this._entityDataSourceAttributeConfigConverterFactory=t}_applyResources(e,t){(0,_.isEmpty)(e?.localizableStrings)||(t.resources??={strings:{}},t.resources.strings??={},(0,_.merge)(t.resources.strings,e?.localizableStrings),this._fullResourcesForCurrentCulture(t.resources.strings))}_fullResourcesForCurrentCulture(e){const t=this._userInfo.cultureInfo.sysCultureName;Object.values(e).filter(i=>!(t in i)).forEach(i=>{const r=Object.values(i).find(Boolean);r&&(i[t]=r)})}_applyDataGridColumns(e,t,i){if(!t)return;const r=(0,u.getDataGridItemsAttributeConfig)(e,i);if(!r)return;const a=r.modelConfig?.path;if(!a)return;const n=(0,u.getDataGridItemsDataSourceConfig)(a,i);if(!n)return;const s=e.columns=[],c=r.viewModelConfig.attributes??={},d=n.attributes??={};t.forEach(({viewMetadata:m,viewModelMetadata:g,modelMetadata:S})=>{if(m&&s.push(m),!S)return;const b=this._createEntityDataSourceAttribute(S),D=g?.attributeName||m?.code;if(!D||!b)return;const I={modelConfig:{path:`${a}.${b.name}`}},ot=c[D]??{},bt=d[b.name]??{};c[D]=Rt()(I,ot),d[b.name]=Rt()(b.config,bt)})}_createEntityDataSourceAttribute(e){const t=this._entityDataSourceAttributeConfigConverterFactory.create(e?.type).toEntityDataSourceAttribute(e),i=e.name;return!i||!t?null:{name:i,config:t}}_applyDataGridSortingConfig(e,t,i){if(!t)return;const r=(0,u.getDataGridItemsAttributeConfig)(e,i);if(!r)return;const a=r.modelConfig?.sortingConfig;a&&delete a.default;const n=a?.attributeName??(0,u.createDataGridSortingAttributeName)(e),s=i.viewModelConfig.attributes,c=s[n]??={};(0,f.isCalculatedAttributeConfig)(c)||(c.value=(0,u.toSortColumnsOptions)(t,r))}apply(e,t,i){const{resources:r,columns:a,sorting:n}=t;this._applyResources(r,i),this._applyDataGridColumns(e,a,i),this._applyDataGridSortingConfig(e,n,i)}static{this.\u0275fac=function(t){return new(t||he)(o.\u0275\u0275inject(p.UserInfo),o.\u0275\u0275inject(p.ENTITY_DATA_SOURCE_ATTRIBUTE_CONFIG_CONVERTER_FACTORY))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac,providedIn:"root"})}}class _e extends v.AbstractHandler{constructor(e,t,i,r,a){super(),this._dataGridDesignSettingsApplier=e,this._dataGridFolderTreeRelationsProvider=t,this._folderTreeRelatedElementConfigsProvider=i,this._folderTreeIdResolver=r,this._featureValues=a}_setDataGridActiveFolderSettingsAttribute(e,t,i){const r=i.viewModelConfig.attributes,a=(0,u.createDataGridActiveFolderSettingsAttributeName)(e);r[a]={value:t}}handle(e){var t=()=>super.handle,i=this;return(0,l.A)(function*(){if(i._featureValues.DisableDataGridSettingsByFolders)return t().call(i,e);const{metadata:r,viewConfig:a}=e??{};if(!r?.name||!a?.name)return t().call(i,e);const n=i._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(a,r);if(!n)return t().call(i,e);const s=yield i._folderTreeIdResolver.getActiveFolderFolderTreeId(n,r);if(!s)return i._setDataGridActiveFolderSettingsAttribute(a,null,r),t().call(i,e);const c={folderId:s,schemaName:r.name,elementName:a.name},d=yield(0,A.firstValueFrom)(i._folderTreeRelatedElementConfigsProvider.get(c));return d&&i._dataGridDesignSettingsApplier.apply(a,(0,_.cloneDeep)(d),r),i._setDataGridActiveFolderSettingsAttribute(a,d,r),t().call(i,e)})()}static{this.\u0275fac=function(t){return new(t||_e)(o.\u0275\u0275inject(he),o.\u0275\u0275inject(u.DataGridFolderTreeRelationsProvider),o.\u0275\u0275inject(C.FolderTreeRelatedElementConfigsProvider),o.\u0275\u0275inject(pt.FolderTreeIdResolver),o.\u0275\u0275inject(p.FEATURE_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac})}}class Ae extends v.AbstractHandler{constructor(e){super(),this._dataGridDesignSettingsApplier=e}handle(e){const{metadata:t,viewConfig:i}=e??{};if(!t?.name||!i?.name)return super.handle(e);const r=i._designOptions?.designSettings;return r&&this._dataGridDesignSettingsApplier.apply(i,(0,_.cloneDeep)(r),t),super.handle(e)}static{this.\u0275fac=function(t){return new(t||Ae)(o.\u0275\u0275inject(he))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ae,factory:Ae.\u0275fac})}}const xt="DisableDataGridSortingPreprocessing";class Ce extends v.AbstractHandler{constructor(e){super(),this._isSortingPreprocessingDisabled=!!e[xt]}_getSortingAttributeName(e,t){const i=(0,u.getDataGridItemsAttributeName)(e);if(!i)return null;const r=t.viewModelConfig?.attributes?.[i];if(!r||!("modelConfig"in r))return null;let a=r.modelConfig?.sortingConfig?.attributeName;if(a)return a;a=(0,u.createDataGridSortingAttributeName)(e);const n={modelConfig:{sortingConfig:{attributeName:a}}};return(0,_.merge)(r,n),a}_setSorting(e,t,i){if(t.sorting)return;i.viewModelConfig.attributes||={},i.viewModelConfig.attributes[e]||={};const r=(0,u.getDataGridItemsAttributeName)(t);t.sorting=`$${e} | crt.ToDataTableSortingConfig: '${r}'`}_setSortingChange(e){e.sortingChange||(e.sortingChange={request:"crt.DataGridSortDataRequest",params:{itemsAttributeName:(0,u.getDataGridItemsAttributeName)(e),sorting:"@event"}})}handle(e){const{metadata:t,viewConfig:i}=e??{};if(!t||!i||this._isSortingPreprocessingDisabled)return super.handle(e);const r=this._getSortingAttributeName(i,t);return r?(this._setSorting(r,i,t),this._setSortingChange(i),super.handle(e)):super.handle(e)}static{this.\u0275fac=function(t){return new(t||Ce)(o.\u0275\u0275inject(p.FEATURE_VALUES,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ce,factory:Ce.\u0275fac})}}class x extends v.AbstractHandler{handle(e){const{viewConfig:t,viewModel:i}=e??{};if(!t?.name||t?.title)return super.handle(e);const r=(0,u.getDataGridItemsAttributeName)(t);return r?(t.title=i.getBoundDataSchemaByAttributePath(r)?.caption,super.handle(e)):super.handle(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(x)))(i||x)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}class Se{static{this.\u0275fac=function(t){return new(t||Se)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Se})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ke,multi:!0},{provide:Pt,useFactory:e=>{const t=e.get(Ae);return t.setNext(e.get(_e)).setNext(e.get(Ce)),t},deps:[o.Injector]},{provide:Nt,useFactory:e=>e.get(x),deps:[o.Injector]},Ae,_e,x,Ce]})}}class Ue{crtOnMetaDataInit(e){return(0,l.A)(function*(){const t=e;return t.name==="Playbooks_FormPage"&&(t.viewModelConfig.attributes.DcmStages={from:"CrtPlaybookDS_DcmCase",converter:"crt.ToDcmStageValue"}),Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||Ue)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ue,factory:Ue.\u0275fac})}}class kt{_getDetailViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Angular7XDetail",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processDetail(e){this._processDetailOutputs(e)}_processDetailOutputs(e){this._processDetailChangedOutput(e)}_processDetailChangedOutput(e){e.detailChanged||(e.detailChanged={request:"crt.DetailChangedRequest",params:{detailId:"@event.detail.detailId",saveChanges:"@event.detail.saveChanges",discardChanges:"@event.detail.discardChanges",destroyed:"@event.detail.destroyed"}})}_processSchema(e){this._processViewModelAttributes(e),this._changeViewConfigsBindings(e)}_processViewModelAttributes(e){this._processUnSaveDetailsDataViewModelAttributes(e),this._processHasUnsavedDataAndDetailsViewModelAttributes(e)}_processUnSaveDetailsDataViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[f.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]||(t[f.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]={value:[]})}_processHasUnsavedDataAndDetailsViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[f.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]||(t[f.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]={from:[f.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME,f.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME],converter:"crt.HasUnsavedDataOr7XDetails"})}_getSchemaViewModelAttributes(e){const t=e.viewModelConfig=e.viewModelConfig||{};return t.attributes=t.attributes||{}}_changeViewConfigsBindings(e){const t=e.viewConfig||[],i=`(^|\\W)(${f.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME})($|\\W)`,r=`$1${f.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME}$3`;t.forEach(a=>this._replaceStringsRecursive(a,i,r))}_replaceStringsRecursive(e,t,i){(0,_.forOwn)(e,(r,a)=>{if((0,_.isObject)(r))this._replaceStringsRecursive(r,t,i);else if((0,_.isString)(r)){const n=new RegExp(t,"g");if(!r.match(n))return;e[a]=r.replace(n,i)}})}crtOnMetaDataInit(e){const t=e,i=this._getDetailViewConfigs(t);return i.forEach(r=>this._processDetail(r)),i.length&&this._processSchema(t),Promise.resolve(e)}}class qe{_modifyInputType(e,t,i){const r=e.control.replace("$",""),a=t.attributes[r]?.modelConfig?.path;if(a){const n=this._getDataSchemaAttributeByPath(a,i);T.DataValueType.EMAIL_TEXT&&n?.dataValueType===T.DataValueType.EMAIL_TEXT&&(e.type="crt.EmailInput",e.isFormatValidated=n.isFormatValidated)}}_getDataSchemaAttributeByPath(e,t){const[i,r]=e.split("."),a=t.dataSchemas[i]?.attributes;let n;for(const s in a)if(a[s].path===r){n=a[s];break}return n}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,n=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),s=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.EmailInput",a.viewConfig);return n.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),s.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),e})()}static{this.\u0275fac=function(t){return new(t||qe)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac})}}const Ut=32,qt=81;class be{constructor(e){this._featureValues=e,this._supportDataGridFullSize=!this._featureValues?.["Runtime.DisableDataGridFullSize"]}_getDataGridViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.DataGrid",e?.items)}_setDataGridMaxHeight(e){if(!e.layoutConfig?.rowSpan||e?.maxHeight!=null||e?.styles?.["max-height"]!=null)return;const i=e.layoutConfig.rowSpan*Ut,r=Math.max(i,qt);e.layoutConfig.rowSpan=1,this._supportDataGridFullSize?(e.placeholderSize={height:`${r}px`},e.maxHeight=`${r}px`):e.styles=(0,_.merge)(e.styles,{"max-height":`${r}px`})}_replaceLegacyGridContainerRowsConfig(e){const t=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.GridContainer",e).shift();t?.viewConfig?.rows?.replace(/\s/g,"")==="minmax(32px,32px)"&&(t.viewConfig.rows="minmax(max-content, 32px)")}setDataGridMaxHeight(e){const t=this._getDataGridViewConfigs(e);t.forEach(i=>{this._setDataGridMaxHeight(i.viewConfig)}),t.length&&this._replaceLegacyGridContainerRowsConfig(e?.items)}static{this.\u0275fac=function(t){return new(t||be)(o.\u0275\u0275inject(p.FEATURE_VALUES,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:be,factory:be.\u0275fac})}}class We{constructor(e,t,i){this._featureService=e,this._expandedListLayoutService=t,this._profileAttributeService=i,this._expPanelActionsProcessingDisableFeature="DisableExpansionPanelPreprocessing"}_filterItemsByGridType(e){if(!e.items||e.items.length===0)return;const t=e?.tools??[],i=e.items.filter(r=>r.gridContainerType===u.ExpansionPanelGridContainerType.TOOLS);t?.length===0&&i?.length>0&&(e.items=e.items.filter(r=>r.gridContainerType!==u.ExpansionPanelGridContainerType.TOOLS),e.tools=i)}_processPaddings(e){e.padding||(e.padding={top:M.SizeEnum.Small,bottom:M.SizeEnum.Small,left:M.SizeEnum.Medium,right:M.SizeEnum.Medium})}get _isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._expPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ExpansionPanel",i.viewConfig).forEach(function(){var a=(0,l.A)(function*(n){t._expandedListLayoutService.setDataGridMaxHeight(n.viewConfig),t._filterItemsByGridType(n.viewConfig),t._processPaddings(n.viewConfig),yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,n.viewConfig,"expanded","","DisableSaveToProfileExpPanelExpanded")});return function(n){return a.apply(this,arguments)}}()),e})()}static{this.\u0275fac=function(t){return new(t||We)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(be),o.\u0275\u0275inject(u.ProfileAttributeService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac})}}class He{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._fileInputPreprocessingDisableFeature))}constructor(e){this._featureService=e,this._fileInputPreprocessingDisableFeature="DisableFileInputPreprocessing"}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileInput",i.viewConfig).forEach(a=>{if(!a.viewConfig.upload){const s=a.viewConfig.control.slice(1);a.viewConfig.upload={request:"crt.UploadDataAttributeFileRequest",params:{fileAttributeName:s,detail:"@event.detail"}}}a.viewConfig.download||(a.viewConfig.download={request:"crt.DownloadEntityFileRequest",params:{detail:"@event.detail"}})}),e})()}static{this.\u0275fac=function(t){return new(t||He)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:He,factory:He.\u0275fac})}}class ze extends lt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.FileList"]}setRowToolbarMenuItems(e,t){const i=e.items.slice(1),r=t.getBoundDataSourceNameByAttributePath(i);return e.rowToolbarItems=[{type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${r}_Id`},useRelativeContext:!1}}],Promise.resolve(void 0)}static{this.\u0275fac=function(t){return new(t||ze)(o.\u0275\u0275inject(Y.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ze,factory:ze.\u0275fac})}}class Je extends j{constructor(e,t,i,r){super(e,t,i),this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this._cellViewConfigCreatorFactory=r,this._predefinedColumns={},this.viewItemTypes=["crt.FileList"]}_setPredefinedColumnDefinitions(e){for(const t of e){const i=t.viewConfig,r=i.name,a=i.columns,n=[];for(const s of a)s.cellView&&n.push(s.code);this._predefinedColumns[r]=n}}_processFileListColumnDefinitions(e,t,i){var r=this;return(0,l.A)(function*(){const{dataSourceName:a,dataSchema:n,itemsAttributeName:s,viewModel:c}=t,{primaryAttributeName:d,primaryDisplayAttributeName:m}=n??{},g=n.name,S=d&&`${a}_${d}`;for(const b of i){const D=n.attributes.find(Kt=>(0,p.removeSpecialSymbols)(`${a}_${Kt.name}`)===b.code);if(!D)continue;const I=D.name,ot={columnName:I,dataValueType:D.dataValueType,primaryDisplayAttributeName:m},bt={column:b,context:c,itemsAttributeName:s,primaryAttributeName:S,dataSchemaName:g,columnName:I},wt=yield r._cellViewConfigCreatorFactory.create(ot)?.getViewElementConfig(bt);wt&&!r._predefinedColumns[e]?.includes(b.code)&&r.metadataModifierService.addProperty(b,"cellView",wt)}})()}crtOnViewModelInit(e,t,i){var r=()=>super.crtOnViewModelInit,a=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(a.featureService.getFeatureState(a.featureName),{defaultValue:null}))return e;const s=p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",a.viewItemTypes,e.viewConfig);a._setPredefinedColumnDefinitions(s),e=yield r().call(a,e,t,i);for(const c of s){const d=c.viewConfig.columns,m=c.viewConfig.name,g=yield a.getGenerateCellViewConfig(c.viewConfig,i);g&&(yield a._processFileListColumnDefinitions(m,g,d))}return e})()}static{this.\u0275fac=function(t){return new(t||Je)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService),o.\u0275\u0275inject(P.DataGridColumnDefinitionService),o.\u0275\u0275inject(P.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac})}}class k{get order(){return this.index||0}constructor(e){this.featureService=e,this.componentTypes=[]}getComponentsToProcess(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this.componentTypes,e.viewConfig)}process(e,t){var i=this;return(0,l.A)(function*(){const r=i.getComponentsToProcess(e);return yield i.innerProcess(r,e,t)})()}static{this.\u0275fac=function(t){return new(t||k)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac})}}class ye extends k{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=2,this.defaultFilesEntitySchemaName="SysFile",this._galleryColumnNames=["Name","CreatedOn","Size"]}_addDataSourceAttributes(e,t){let i=e[t];i||(i=h.DataSourceUtils.createDataSourceConfig(this.defaultFilesEntitySchemaName),e[t]=i);const r=i.config||{attributes:{}};r.attributes=r.attributes||{},this._galleryColumnNames.forEach(a=>{r?.attributes[a]||(r.attributes[a]={path:a})}),i.config=r}_addViewModelAttributes(e,t,i){if(!e?.attributes)return;const a=e.attributes[t]?.viewModelConfig?.attributes;a&&this._galleryColumnNames.forEach(n=>{const s=`${i}_${n}`;a[s]||(a[s]={modelConfig:{path:`${i}.${n}`}})})}_applyGalleryConfig(e,t){t.viewConfig.galleryItemConfig||(t.viewConfig.galleryItemConfig={templateValuesMapping:{fileId:`${e}_Id`,fileName:`${e}_Name`,fileCreatedOn:`${e}_CreatedOn`,fileSize:`${e}_Size`}}),t.viewConfig.galleryItemConfig.defaultSize=t.viewConfig.tileSize||M.SizeEnum.Medium}_getAttributeDSName(e){return`${e}${f.DATA_SOURCE_PREFIX}`}innerProcess(e,t,i){var r=this;return(0,l.A)(function*(){return e.forEach(a=>{const n=a.viewConfig.items;if(typeof n!="string")return;const s=n.split("$")[1];if(!s)return;const c=r._getAttributeDSName(s);r._addDataSourceAttributes(t.modelConfig?.dataSources||{},c),r._addViewModelAttributes(t.viewModelConfig,s,c),r._applyGalleryConfig(c,a)}),yield Promise.resolve(t)})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(ye)))(i||ye)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac})}}class Ee extends k{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=1,this.defaultPrimaryColumnName="Id",this.defaultFilesEntitySchemaName="SysFile",this.defaultRecordColumnName="RecordId",this._fileDropDisableFeature="DisableFileListDropPreprocessing"}_getAdditionalFilterName(e){return`${e}_PredefinedFilter`}_createViewModelAttribute(e){return{isCollection:!0,modelConfig:{path:e},viewModelConfig:{attributes:{}}}}_getUploadFileRequest(e){return{request:"crt.UploadFileRequest",params:{viewElementName:e}}}_setFileListDropZoneParameters(e,t){t&&(e.viewConfig.droppable=!1,e.viewConfig.fileDropped=void 0),e.viewConfig.droppable!==!1&&(e.viewConfig.droppable=!0,e.viewConfig.fileDropped||(e.viewConfig.fileDropped=this._getUploadFileRequest(e.viewConfig.name??"")))}_setFileListUploadButtonParameters(e){e.viewConfig.uploadClicked||(e.viewConfig.uploadClicked=this._getUploadFileRequest(e.viewConfig.name??""))}_tryAddFileListProperties(e){if(e.viewConfig.items||(e.viewConfig.items=`$${e.viewConfig.name}`),!e.viewConfig.primaryColumnName){const t=e.viewConfig.name??"",r=`${h.DataSourceUtils.getAttributeDSName(t)}_${this.defaultPrimaryColumnName}`;e.viewConfig.primaryColumnName=r}}_linkFilterToAttribute(e,t){if(e=e??{},!(0,f.isModelAttributeConfig)(e)||!e.modelConfig)return;const i=e.modelConfig.filterAttributes??[];i.find(r=>r.name===t)||i.push({loadOnChange:!0,name:t}),e.modelConfig.filterAttributes=i}tryAddAttributeAndDataSource(e,t,i){var r=this;return(0,l.A)(function*(){const a=i.viewConfig.items;if(typeof a!="string")return;const n=a.split("$")[1];if(!n)return;const s=h.DataSourceUtils.getAttributeDSName(n),c=r._getAdditionalFilterName(n);e.modelConfig||(e.modelConfig={});const d=e.modelConfig.dataSources??{},m=e.viewModelConfig.attributes??{};if(d[s]||(d[s]=h.DataSourceUtils.createDataSourceConfig(r.defaultFilesEntitySchemaName),e.modelConfig.dataSources=d),h.DataSourceUtils.addDependencies(e,i.viewConfig,s),m[n]||(m[n]=r._createViewModelAttribute(s),e.viewModelConfig.attributes=m),!m[c]){const g=i.viewConfig.fileGroups,S=i.viewConfig.tag??"",b=d[s].config?.entitySchemaName,D=yield h.DataSourceUtils.getRecordEntitySchemaName(i.viewConfig.items,i.viewConfig?.masterRecordColumnValue,e,t),I=(0,h.getDataSourceFilterAttribute)(g,S,b,D);I&&(m[c]=I,r._linkFilterToAttribute(m[n],c),e.viewModelConfig.attributes=m)}})()}innerProcess(e,t,i){var r=this;return(0,l.A)(function*(){const a=r.featureService.getFeatureState(r._fileDropDisableFeature),n=yield(0,A.lastValueFrom)(a);for(const s of e)r._tryAddFileListProperties(s),r._setFileListDropZoneParameters(s,n),r._setFileListUploadButtonParameters(s),yield r.tryAddAttributeAndDataSource(t,i,s);return t})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Ee)))(i||Ee)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ee,factory:Ee.\u0275fac})}}const ft=new o.InjectionToken("FILE_UPLOAD_METADATA_WORKER");class Ye{constructor(e){this._workers=e??[]}run(e,t){var i=this;return(0,l.A)(function*(){const r=[...i._workers].sort((a,n)=>a.order-n.order);for(const a of r)yield a.process(e,t)})()}static{this.\u0275fac=function(t){return new(t||Ye)(o.\u0275\u0275inject(ft,8))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ye,factory:Ye.\u0275fac,providedIn:"root"})}}class De extends k{constructor(){super(...arguments),this.index=3,this._uploadFileRequestName="crt.UploadFileRequest",this._defaultFilesEntitySchemaName="SysFile",this._defaultRecordColumnName="RecordId"}_getUploadFileRequestConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._uploadFileRequestName).map(t=>t.viewConfig.clicked)}_getFileLists(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileList",e.viewConfig)}_getFileDropRequestConfigs(e){const t=this._getFileLists(e);return t.filter(i=>i.viewConfig.fileDropped?.request===this._uploadFileRequestName).map(i=>i.viewConfig.fileDropped).concat(t.filter(i=>i.viewConfig.uploadClicked?.request===this._uploadFileRequestName).map(i=>i.viewConfig.uploadClicked))}getFilesEntitySchemaName(e,t,i){const r=h.DataSourceUtils.getDataSourceNameByAttribute(e);return r?h.DataSourceUtils.getDataSchemaName({models:i,schema:t,dataSourceName:r}):Promise.resolve(null)}setRequestParam(e,t,i){!e[t]&&i&&(e[t]=i)}getBaseRequestParams(){return{fileGroup:f.FileGroupEnum.Attachments,tag:"",files:"@event.files"}}getDefaultRequestParams(e){const t=h.DataSourceUtils.getDataSourcePrimaryAttribute(e);return{...this.getBaseRequestParams(),recordId:`$${t}`,fileEntitySchemaName:this._defaultFilesEntitySchemaName,recordColumnName:this._defaultRecordColumnName}}getRequestParams(e,t,i){var r=this;return(0,l.A)(function*(){const a=r.getBaseRequestParams(),n=e.items,s=(yield r.getFilesEntitySchemaName(n,t,i))||r._defaultFilesEntitySchemaName,c=e?.masterRecordColumnValue,d=yield h.DataSourceUtils.getRecordEntitySchemaName(n,c,t,i);return{...a,fileGroup:e?.fileGroups?.[0],tag:e?.tag,recordId:c,itemsAttributeName:e.name,fileEntitySchemaName:s,recordEntitySchemaName:d,recordColumnName:e.recordColumnName||r._defaultRecordColumnName}})()}_setRequestParams(e,t){for(const i in t)t[i]&&this.setRequestParam(e.params,i,t[i])}_extendRequestParams(e,t,i,r){var a=this;return(0,l.A)(function*(){e.params=e.params||{};const n=t.find(c=>c.viewConfig.name===e.params.viewElementName),s=n?yield a.getRequestParams(n.viewConfig,i,r):a.getDefaultRequestParams(i);a._setRequestParams(e,s)})()}getComponentsToProcess(e){return[...this._getUploadFileRequestConfigs(e),...this._getFileDropRequestConfigs(e)]}innerProcess(e,t,i){var r=this;return(0,l.A)(function*(){const a=r._getFileLists(t);for(const n of e)yield r._extendRequestParams(n,a,t,i);return t})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(De)))(i||De)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac})}}class Te{static{this.\u0275fac=function(t){return new(t||Te)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Te})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:ft,useClass:ye,multi:!0},{provide:ft,useClass:Ee,multi:!0},{provide:ft,useClass:De,multi:!0}],imports:[ct.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(Te,{imports:[ct.CommonModule]})})();class Xe{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._fileListPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._workersService=t,this._fileListPreprocessingDisableFeature="DisableFileListPreprocessing"}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return yield i._workersService.run(r,t),e})()}static{this.\u0275fac=function(t){return new(t||Xe)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(Ye))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Xe,factory:Xe.\u0275fac})}}const Qt={fileLists:{A:"FileListA",B:"FileListB",C:"FileListC",D:"FileListD",E:"FileListE",F:"FileListF",G:"FileListG",H:"FileListH",I:"FileListI",WithDeepMasterRecordColumn:"FileListWithDeepMasterRecordColumn",WithAttributeWoPath:"FileListWithAttributeWoPath",WithUploadButton:"FileListWithCustomUploadButton",WoMasterRecordColumn:"FileListWoMasterRecordColumn",WoRecordSchemaName:"FileListWoRecordSchemaName",WithRecordSchemaName:"FileListWithRecordSchemaName",WoDropZone:"FileListWoDropZone"},recordColumnNameA:"ColumnA",testFileEntity:"TestFile",testEntityName:"TestEntity",testTag:"TestTag"};function ei(){return{viewConfig:[{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.WithUploadButton,uploadClicked:{request:"crt.UploadFileRequest",params:{viewElementName:"custom"}}},{type:"crt.FileList",droppable:!1,name:TEST_SCHEMA_DATA.fileLists.WoDropZone},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerId",recordColumnName:TEST_SCHEMA_DATA.recordColumnNameA,primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.A,tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListRecordSchemaName",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName},{type:"crt.FileList",items:"$FileListE",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.E,fileGroups:[FileGroupEnum.Attachments]},{type:"crt.FileList",items:"$FileListF",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.F,fileGroups:[FileGroupEnum.Attachments],tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListG",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.G},{type:"crt.FileList",items:TEST_SCHEMA_DATA.fileLists.H,masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.H},{type:"crt.FileList",items:"$FileListI",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.I},{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.B,droppable:!0}],name:"InnerContainer"},{type:"crt.Button",name:"ButtonA",clicked:{request:"crt.UploadFileRequest",params:{maximumAllowedFileSize:null,allowedFileTypes:"",viewElementName:TEST_SCHEMA_DATA.fileLists.A}}},{type:"crt.Button",name:"ButtonB",clicked:{request:"crt.UploadFileRequest",params:{}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName}}},{type:"crt.Button",name:"ButtonC",menuItems:[{type:"crt.MenuItem",name:"MenuItemA",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.B}}},{type:"crt.MenuItem",name:"MenuItemB",clicked:{request:"crt.UpdateRecordRequest",params:{}}},{type:"crt.MenuItem",name:"MenuItemC"}]},{type:"crt.Button",name:"ButtonD",clicked:"$onClick"},{type:"crt.Button",name:"ButtonE"},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountId",name:TEST_SCHEMA_DATA.fileLists.C,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoColumn",name:TEST_SCHEMA_DATA.fileLists.D,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoPath",name:TEST_SCHEMA_DATA.fileLists.WithAttributeWoPath},{type:"crt.FileList",masterRecordColumnValue:"not a master record attribute",name:TEST_SCHEMA_DATA.fileLists.WoMasterRecordColumn},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn,recordColumnName:"RecordId"},{type:"crt.Button",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn}}}],name:"MainContainer"}],viewModelConfig:{attributes:{OwnerId:{modelConfig:{path:"PDS.Id"}},OwnerAccountId:{modelConfig:{path:"PDS.OwnerAccountId"}},FileListA:{isCollection:!0,modelConfig:{path:"FileListADS",filterAttributes:[{loadOnChange:!0,name:"FileListA_PredefinedFilter"}]},viewModelConfig:{attributes:{FileListADS_Name:{modelConfig:{path:"FileListADS.NamePredefined"}},FileListADS_CreatedOn:{modelConfig:{path:"FileListADS.CreatedOnPredefined"}},FileListADS_Size:{modelConfig:{path:"FileListADS.SizePredefined"}}}}},FileListRecordSchemaName:{isCollection:!0,modelConfig:{path:"FileListRecordSchemaNameDS"}},FileListE:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListF:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListG:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListI:{isCollection:!0,modelConfig:null,viewModelConfig:{attributes:{}}},AttributeWoColumn:{modelConfig:{path:"AttributeWoColumn"}},AttributeWoPath:{modelConfig:{path:""}},AttributeWoModelConfig:{modelConfig:void 0},OwnerAccountCreatedBy:{modelConfig:{path:"PDS.OwnerAccountCreatedBy"}}}},modelConfig:{dataSources:{PDS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testEntityName,attributes:{OwnerAccountId:{path:"Owner.Account.Id"},OwnerAccountCreatedBy:{path:"Owner.Account.CreatedBy"}}}},FileListADS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testFileEntity}},FileListRecordSchemaNameDS:{type:"crt.EntityDataSource",config:{entitySchemaName:"ObjectWithoutRecordSchemaName"}}},primaryDataSourceName:"PDS",dependencies:{FileListADS:[{attributePath:"RecordId",relationPath:"PDS.Id"}]}}}}class Ke{constructor(e,t){this._filterViewElementOptionsModifierFactory=e,this._exposeAttributeConverterMetadataGenerator=t}_getFilterViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>!!t?._filterOptions,e).map(t=>t.viewConfig)}_modifyFilterViewConfig(e){return this._filterViewElementOptionsModifierFactory?.create(e?.type)?.modify(e)||e}_generateFiltersAttributes(e){const{from:t,converters:i,expose:r}=e._filterOptions||{};return(0,_.isEmpty)(t)||(0,_.isEmpty)(r)?{}:r.filter(a=>!!a?.attribute).map(a=>({from:t,converters:i,expose:a})).map(a=>this._generateFilterAttributes(a)).reduce((a,n)=>({...a,...n}),{})}_generateFilterAttributes(e){const{from:t,expose:i}=e,r=i.attribute;if(!r)return{};const a=this._exposeAttributeConverterMetadataGenerator.generate({...i,converters:this._getFilterConverters(i.converters,e.converters)});return a?{[r]:{from:t,converter:a.converterExpression},...a.converterArgsAttributes}:{}}_getFilterConverters(e,t){const i=e?.filter(({converter:a})=>!!a)??[],r=t?.filter(({converter:a})=>!!a)??[];return i.length===0?r:i.map(({converter:a,args:n})=>{const s=r.find(c=>c.converter===a);return{converter:a,args:n??s?.args}})}crtOnMetaDataInit(e){const t=e;return this._getFilterViewConfigs(t.viewConfig).map(i=>this._modifyFilterViewConfig(i)).map(i=>this._generateFiltersAttributes(i)).forEach(i=>{t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},...i}}),Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||Ke)(o.\u0275\u0275inject(h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,8),o.\u0275\u0275inject(h.ExposeAttributeConverterMetadataGenerator))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ke,factory:Ke.\u0275fac})}}function Wt(N,e){const t=new Map(e.map(([i,r])=>[i,{injectable:r}]));return new v.Factory(N,t)}class O{static withModifiers(e){return{ngModule:O,providers:e.map(t=>({provide:h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS,useValue:t,multi:!0}))}}static{this.\u0275fac=function(t){return new(t||O)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:O})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[h.ExposeAttributeConverterMetadataGenerator,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ke,multi:!0},{provide:h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,useFactory:Wt,deps:[o.Injector,h.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS]}]})}}class Mt{constructor(){this._pagingConfigPath="modelConfig.pagingConfig",this._selectionOptionsPreprocessorService=(0,o.inject)(F),this.collectionPropertyName="items",this.paginationChangePropertyName="paginationChange"}_normalizeViewConfigName(e){e.name||(e.name=(0,v.getRandomString)(10))}_getCollectionsViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this.viewType,e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_allowSetPagingConfig(e,t){return!!e&&e in t&&!(0,_.has)(t[e],this._pagingConfigPath)}_allowSetPaginationChange(e,t){return!!t&&!(0,_.has)(e,this.paginationChangePropertyName)}_getViewModelConfigAttributes(e){return e?.viewModelConfig?.attributes}processElementsOnMetaDataInit(e,t){var i=this;return(0,l.A)(function*(){return Promise.all(e.map(r=>i.processElementOnMetaDataInit(r,t)))})()}processElementOnMetaDataInit(e,t){this._normalizeViewConfigName(e);const i=t.viewModelConfig.attributes,r=this.getCollectionAttributeName(e);return this.setCollectionAttributePagingConfig(r,i),this.setSelectionOptions(e),Promise.resolve()}setCollectionAttributePagingConfig(e,t){this._allowSetPagingConfig(e,t)&&(0,_.set)(t[e],this._pagingConfigPath,this.getPagingConfig())}setSelectionOptions(e){this._selectionOptionsPreprocessorService.setInitialSelectionOptions(e,e.name)}processElementsOnViewModelInit(e,t,i){return Promise.all(e.map(r=>this.processElementOnViewModelInit(r,t,i)))}processElementOnViewModelInit(e,t,i){const r=this.getCollectionAttributeName(e);return this.setCollectionViewConfigPaginationChange(e,i,r,this.paginationChangePropertyName),Promise.resolve()}setCollectionViewConfigPaginationChange(e,t,i,r){if(!this._allowSetPaginationChange(e,i))return;const a=t.getBoundDataSourceNameByAttributePath(i);(0,_.set)(e,r,this.getPaginationChangeRequest(a))}addViewModelConfigAttribute(e,t,i,r=!1){const a=this.getViewModelConfigAttribute(e,t);if(!r&&a)return;const n=this._getViewModelConfigAttributes(e)||{};(0,_.set)(n,t,i)}getViewModelConfigAttribute(e,t){return(this._getViewModelConfigAttributes(e)||{})[t]}getCollectionAttributeName(e){return this.getBoundAttributeName((0,_.get)(e,this.collectionPropertyName))}getBoundAttributeName(e){return e?.startsWith("$")?e.slice(1):e}getPagingConfig(){return{rowCount:30}}getPaginationChangeRequest(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,parameters:[]}}}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e,r=t._getCollectionsViewConfigs(i);return yield t.processElementsOnMetaDataInit(r,i),Promise.resolve(e)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,n=r._getCollectionsViewConfigs(a);return yield r.processElementsOnViewModelInit(n,a,i),Promise.resolve(e)})()}}class Ie extends Mt{constructor(){super(...arguments),this._baseImageListOpenPagePreprocessorService=(0,o.inject)(V),this.viewType="crt.Gallery"}_setGalleryInputs(e,t){this._setSelectedItemIdAttrValue(e,t)}_setSelectedItemIdAttrValue(e,t){if(e.selectedItemId)return;const i=this._getGallerySelectedItemIdAttributeName(e.name);e.selectedItemId=`$${i}`,this.addViewModelConfigAttribute(t,i,{value:null})}_getGallerySelectedItemIdAttributeName(e){return`${e}_SelectedItemId`}processElementOnMetaDataInit(e,t){var i=()=>super.processElementOnMetaDataInit,r=this;return(0,l.A)(function*(){yield i().call(r,e,t),r._setGalleryInputs(e,t)})()}processElementOnViewModelInit(e,t,i){var r=()=>super.processElementOnViewModelInit,a=this;return(0,l.A)(function*(){yield r().call(a,e,t,i),yield a._baseImageListOpenPagePreprocessorService.processOpenPageHandles(e,i)})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Ie)))(i||Ie)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ie,factory:Ie.\u0275fac})}}class Ze{get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._imageInputPreprocessingDisableFeature))}get isAutobindDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._autoBindToDisabled))}constructor(e,t){this._featureService=e,this._metadataModifierService=t,this._imageInputPreprocessingDisableFeature="DisableImageInputPreprocessing",this._autoBindToDisabled="AutoBindToDisabled"}_addToImageLinkConverter(e,t){const i=t.indexOf("|");if(t.startsWith("$")&&i===-1){const r=t+" | crt.ToImageLink";this._metadataModifierService.updateProperty({source:e,keys:["value"],value:r})}}_addBusinessRulesBinding(e,t,i,r,a){if(r.startsWith("$")&&!e.bindTo&&!a){this._metadataModifierService.addProperty(e,"bindTo",`$${i}`);const n=t.attributes||{};n[i]={...n[i],viewItemName:e.name},t.attributes=n}}_addImageSelectedRequest(e,t){e.imageSelected||this._metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this._metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_setReadonlyByType(e,t,i){var r=this;return(0,l.A)(function*(){const a=t.viewModelConfig.attributes,n=r._getBindingAttributeWoConverters(e.value);if((0,h.isBindToViewModelAttribute)(n,a)){const s=n.slice(1).split(".").pop(),c=a[s]??{};let d="";(0,f.isModelAttributeConfig)(c)&&(d=c.modelConfig?.path.split(".")[0]);let m="";(0,f.isModelAttributeConfig)(c)&&(m=c.modelConfig?.path.split(".").pop());const g=i.find(D=>D.name===d),b=(g?yield(0,A.lastValueFrom)(g.getSchema(),{defaultValue:null}):null)?.findAttributeByName(m);b&&b.dataValueType!==T.DataValueType.IMAGELOOKUP&&(e.readonly||r._metadataModifierService.updateProperty({source:e,keys:["readonly"],value:!0}),r._metadataModifierService.removeProperty(e,"bindTo"))}})()}_getBindingAttributeWoConverters(e){const t=e?.indexOf("|");return t&&t!==-1&&(e=e.substring(0,t-1).trimEnd()),e}_getBindAttributeName(e){return this._getBindingAttributeWoConverters(e).replace("$","")}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t.isProcessingDisabled)return e;const i=e,r=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",i.viewConfig),a=yield t.isAutobindDisabled;return r.forEach(n=>{const s=n.viewConfig.value,c=t._getBindAttributeName(s);t._addToImageLinkConverter(n.viewConfig,s),t._addBusinessRulesBinding(n.viewConfig,i.viewModelConfig,c,s,a),t._addImageSelectedRequest(n.viewConfig,c),t._addimageClearRequest(n.viewConfig,c)}),e})()}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",r.viewConfig).forEach(function(){var n=(0,l.A)(function*(s){yield i._setReadonlyByType(s.viewConfig,r,t)});return function(s){return n.apply(this,arguments)}}()),e})()}static{this.\u0275fac=function(t){return new(t||Ze)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ze,factory:Ze.\u0275fac})}}class Qe{constructor(e){this._featureService=e,this._labelProcessingDisableFeature="DisableLabelPreprocessing"}_actualizeLabelType(e){const t=u.LABEL_TYPE_MAPPING[e.labelType];t&&(e.labelType=t)}get _isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._labelProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Label",i.viewConfig).forEach(a=>{t._actualizeLabelType(a.viewConfig)}),e})()}static{this.\u0275fac=function(t){return new(t||Qe)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Qe,factory:Qe.\u0275fac})}}class ve extends Mt{constructor(){super(...arguments),this._baseViewItemCollectionOpenPageService=(0,o.inject)(V),this.viewType="crt.NextBestOffer"}_setSortingConfig(e,t){const i=t.viewModelConfig.attributes,r=i[e.items?.replace("$","")];if(!r?.modelConfig||r.modelConfig.sortingConfig||!t?.modelConfig?.dataSources||!e?.itemConfig?.templateValuesMapping?.numberTag)return;const a=e.itemConfig.templateValuesMapping.numberTag,n=r.modelConfig.path,d=(t.modelConfig.dataSources[n]?.config?.attributes||{})[a.replace(`${n}_`,"")]?.path,m=e.name+"_ItemsSorting";i[m]={value:[]},r.modelConfig.sortingConfig={attributeName:m,default:[{columnName:d,direction:"desc"}]}}_setPaginationConfig(e,t){const r=t.viewModelConfig.attributes[e.items?.replace("$","")];r?.modelConfig&&(r.modelConfig.pagingConfig={rowCount:30})}_setDatasourceConfigOptions(e,t){this._setSortingConfig(e,t),this._setPaginationConfig(e,t)}processElementOnMetaDataInit(e,t){var i=()=>super.processElementOnMetaDataInit,r=this;return(0,l.A)(function*(){return yield i().call(r,e,t),r._setDatasourceConfigOptions(e,t),Promise.resolve()})()}processElementOnViewModelInit(e,t,i){var r=()=>super.processElementOnViewModelInit,a=this;return(0,l.A)(function*(){yield r().call(a,e,t,i),yield a._baseViewItemCollectionOpenPageService.processOpenPageHandles(e,i)})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(ve)))(i||ve)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:ve,factory:ve.\u0275fac})}}class et{constructor(e,t,i){this._translateService=e,this._printablesService=t,this._rightsService=i,this._translatePrefix="PrintablesMenuItemsPreprocessor",this._canManageReports=!1}_generateMenuItems(e,t,i){var r=this;return(0,l.A)(function*(){const a=e.viewConfig.clicked.params,n=t.modelConfig?.dataSources;if((0,_.isEmpty)(n))return console.warn("There is no datasources in modelConfig."),[];const s=n?.[a.dataSourceName];if(!s)return console.warn(`Datasource '${a.dataSourceName}' specified in the request is not found in the modelConfig.`),[];const c=s.scope===T.DataSourceScope.Page,d=s.config?.entitySchemaName;return(yield r._printablesService.getPrintablesForEntity(d)).filter(g=>c?g.ShowInCard:g.ShowInSection).map(g=>({type:"crt.MenuItem",caption:g.Caption,clicked:{request:"crt.PrintablesRequest",params:{convertInPDF:g.ConvertInPDF===!0,printableCaption:g.Caption,templateId:g.Id,dataSourceName:a.dataSourceName,filters:a?.filters}}}))})()}_getItemsWithPrintablesRequest(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",e,t.viewConfig).filter(r=>{const{clicked:a,menuItems:n}=r.viewConfig||{};return!n?.length&&a?.request==="crt.PrintablesRequest"&&a.params?.dataSourceName&&!a.params.templateId})}_noAvailablePrintablesMenuItem(){return{type:"crt.MenuLabel",caption:this._translateService.instant(this._translatePrefix+".NoAvailablePrintablesCaption")}}_goToPrintablesSetupMenuItems(){return this._canManageReports?[{type:"crt.MenuDivider"},{type:"crt.MenuItem",caption:this._translateService.instant(this._translatePrefix+".GoToPrintablesSetupCaption"),icon:"open-button-icon",handleItemClick:()=>{this._goToPrintables()}}]:[]}_goToPrintables(){const e=(0,p.getWorkspaceBaseUrl)();window.open(`${e}ClientApp#/Printables`,"_blank")}_generateInfoMenuItems(){return[this._noAvailablePrintablesMenuItem(),...this._goToPrintablesSetupMenuItems()]}_prepareItemMenu(e,t,i,r){var a=this;return(0,l.A)(function*(){const n=a._getItemsWithPrintablesRequest(e,i);for(const s of n){let c=yield a._generateMenuItems(s,i,r);c.length===0?c=a._generateInfoMenuItems():c.push(...a._goToPrintablesSetupMenuItems()),s.viewConfig[t]=c,s.viewConfig.clickMode="menu",delete s.viewConfig.clicked}})()}_initCanManageReports(){var e=this;return(0,l.A)(function*(){e._canManageReports=yield(0,A.firstValueFrom)(e._rightsService.getCanExecuteOperation("CanManageReports"))})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e;return yield r._initCanManageReports(),yield r._prepareItemMenu("crt.MenuItem","items",a,i),yield r._prepareItemMenu("crt.Button","menuItems",a,i),e})()}static{this.\u0275fac=function(t){return new(t||et)(o.\u0275\u0275inject(Y.TranslateService),o.\u0275\u0275inject(C.PrintablesService),o.\u0275\u0275inject(C.RightsService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:et,factory:et.\u0275fac})}}class tt{constructor(e){this.featureService=e,this.featureName="DisableDataGridMoveSelectedItemsProcessing"}_getMoveItemsButtons(e){return(0,ht.getRequestBindingConfigs)(e.viewConfig,"crt.MoveSelectedItemsRequest")}_generateViewModelAttribute(e,t,i){const r=e?.viewModelConfig?.attributes||{},a=t?.replace(i+"_","");r[t]||(r[t]={modelConfig:{path:`${i}.${a}`}})}_generateDataSourceAttribute(e,t,i){const n=(e?.modelConfig?.dataSources??{})[i]?.config?.attributes,s=t.replace(i+"_","");n&&!n[s]&&(n[s]={path:s})}_generateMissingAttributes(e,t){const i=e?.params,r=i?.sourceAttribute,a=i?.targetAttribute,n=i?.defaultValues,s=t?.viewModelConfig?.attributes??{},c=s[r],d=s[a],m=c?.modelConfig?.path,g=d?.modelConfig?.path;n?.forEach(S=>{const b=S.attributeName,D=S.value;if(S.type===f.MoveSelectedItemDefaultValueType.Item){const I=typeof S.value=="object"?D.value:D;typeof I=="string"&&this._generateViewModelAttribute(c,I,m),this._generateDataSourceAttribute(t,I,m)}this._generateViewModelAttribute(d,b,g),this._generateDataSourceAttribute(t,b,g)})}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(yield(0,A.lastValueFrom)(t.featureService.getFeatureState(t.featureName),{defaultValue:null}))return e;const r=e;if(!r.viewModelConfig?.attributes)return e;const a=t._getMoveItemsButtons(r);for(const n of a)t._generateMissingAttributes(n,r);return e})()}static{this.\u0275fac=function(t){return new(t||tt)(o.\u0275\u0275inject(C.FeatureService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:tt,factory:tt.\u0275fac})}}class U{constructor(e){this._resourceFinderService=e,this._dataGridType="crt.DataGrid",this._galleryType="crt.Gallery",this._findAttributeInDataSchema=(t,i)=>t?.attributes?.find(r=>r.name===i)}_getBindedViewElementConfigsByAttributeNames(e,t){return p.MetadataSchemaUtils.getViewConfigInfoByFilter(i=>this._isViewConfigInfoBindedByPropertyValues(i,t.map(r=>`$${r}`)),e.viewConfig).map(i=>i.viewConfig)}_isViewConfigInfoBindedByPropertyValues(e,t){const i=Object.values(e);for(const r of i)if(t.includes(r))return!0;return!1}_getColumnByViewType(e,t,i,r){switch(r.type){case this._dataGridType:return this._getColumnsFromDataGridViewConfig(e,t,i,r);case this._galleryType:return Promise.resolve(this._getColumnsFromGalleryViewConfig(e,t,i,r));default:return Promise.resolve(this._getColumnsFromViewModelConfig(e,t,i))}}_getColumnsFromDataGridViewConfig(e,t,i,r){var a=this;return(0,l.A)(function*(){const n=[],s=a._getDataSchema(t,i);if(!s)return Promise.resolve(null);const c=r;if(!c.columns)return a._getColumnsFromViewModelConfig(e,t,i);const d=a._getColumnAttributes(e,i);for(const m of c.columns){const g=m.code,S=d?.[g];yield a._addColumnByResourcesIfNeed(s,t,n,m,S)}return{columns:n,viewName:r.name||i,primaryDisplayName:s.primaryDisplayAttributeName}})()}_addColumnByResourcesIfNeed(e,t,i,r,a){var n=this;return(0,l.A)(function*(){const s=n._getColumnNameFromAttributeConfigPath(a),c=n._findAttributeInDataSchema(e,s);n._isAllowedToAddColumn(c,i,s)&&i.push(yield n._createColumnByResources(t[p.SchemaResourcesSuffix],r.caption,s,c?.path))})()}_getColumnsFromGalleryViewConfig(e,t,i,r){const a=[],n=this._getDataSchema(t,i);if(!n)return null;const s=r?.itemConfig,c=this._getColumnAttributes(e,i);return(0,_.forEach)(s?.templateValuesMapping,(d,m)=>{const g=c?.[d];this._addColumnByDataSchemaIfNeed(n,a,g)}),{columns:a,viewName:r.name||i,primaryDisplayName:n.primaryDisplayAttributeName}}_getColumnsFromViewModelConfig(e,t,i){const r=[],a=this._getDataSchema(t,i);if(!a)return null;const n=this._getColumnAttributes(e,i);return(0,_.forEach)(n,(s,c)=>{this._addColumnByDataSchemaIfNeed(a,r,s)}),{columns:r,viewName:i,primaryDisplayName:a.primaryDisplayAttributeName}}_getDataSchema(e,t){return e.getBoundDataSchemaByAttributePath(t)}_getColumnAttributes(e,t){const i=e.viewModelConfig.attributes;return Object.prototype.hasOwnProperty.call(i,t)?i[t].viewModelConfig?.attributes||{}:{}}_addColumnByDataSchemaIfNeed(e,t,i){const r=this._getColumnNameFromAttributeConfigPath(i),a=this._findAttributeInDataSchema(e,r);this._isAllowedToAddColumn(a,t,r)&&t.push(this._createColumnByDataSchema(a,r))}_getColumnNameFromAttributeConfigPath(e){if(e&&(0,f.isModelAttributeConfig)(e))return e?.modelConfig?.path?.split(".").slice(1).shift()}_isAllowedToAddColumn(e,t,i){return(0,p.isAllowedTypeSearchColumn)(e)&&!!i&&!t.some(r=>r.name===i)}_createColumnByResources(e,t,i,r){var a=this;return(0,l.A)(function*(){return{caption:(yield a._resourceFinderService.findViewModelResourceValue(t,e,t))||i,name:i,path:r||i}})()}_createColumnByDataSchema(e,t){return{caption:e?.caption||t,name:t,path:e?.path||t}}_getUniqueColumns(e){if(!e.length)return null;const t=[];return e.forEach(i=>{i.columns.forEach(r=>{this._isSearchFilterColumnExist(t,r)||t.push(r)})}),{columns:t,viewName:e.slice().shift()?.viewName||"",primaryDisplayName:e.slice().shift()?.primaryDisplayName}}_isSearchFilterColumnExist(e,t){return e.some(i=>i.caption===t.caption&&i.name===t.name)}getColumnsModelByAttributeName(e,t,i){var r=this;return(0,l.A)(function*(){const a=r._getBindedViewElementConfigsByAttributeNames(e,[i]);if(a.length===0)return r._getColumnsFromViewModelConfig(e,t,i);const n=(yield Promise.all(a.map(s=>r._getColumnByViewType(e,t,i,s)))).filter(Boolean);return r._getUniqueColumns(n)})()}static{this.\u0275fac=function(t){return new(t||U)(o.\u0275\u0275inject(p.ResourceFinderService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac})}}class Pe extends vt.BaseFilterPreprocessor{constructor(e,t,i,r){super(),this._featureService=e,this._searchFilterPreprocessorService=t,this._searchFilterQueryAnalyzerService=i,this._translateService=r,this._isTargetAttributesExist=(a,n)=>this._getAvailableTargetAttributes(a,n)?.length>0}_getSearchFilterViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getAvailableTargetAttributes(e,t){return this.isNewStructure(t)?this._getAvailableTargetFromFilterOptions(e,t):this._getAvailableTargetFromTargetAttributes(e,t)}_getAvailableTargetFromTargetAttributes(e,t){return t?.targetAttributes?.map(i=>(0,_.get)(e.viewModelConfig?.attributes||{},i)?i:null).filter(Boolean)||[]}_getAvailableTargetFromFilterOptions(e,t){return t?._filterOptions?.expose?.map(i=>this._getTargetAttributeNameFromConverter(i.converters||[])).filter(Boolean)}_getTargetAttributeNameFromConverter(e){return e.find(i=>i?.args?.length>0)?.args?.find(i=>!!i)??""}_getSearchValueViewModelAttributeName(e){return`${e}_SearchValue`}_getSearchFilteredColumnViewModelAttributeName(e){return`${e}_SearchFilteredColumn`}_getSearchFilteredColumnsGroupsAttributeName(e){return`${e}_FilteredColumnsGroups`}_getSearchMinifySearchAttributeName(e){return`${e}_MinifySearch`}_setDisabledAttribute(e,t){this._isTargetAttributesExist(e,t)||(t.disabled=!0)}_setTooltipAttribute(e){e.tooltip||(e.tooltip=this._translateService.instant("Components.SearchFilter.Tooltip"))}_setSearchValueAttribute(e,t){const i=this._getSearchValueViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.value=`$${i}`}_setSearchFilteredColumnAttribute(e,t){const i=this._getSearchFilteredColumnViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.filteredColumn=`$${i}`}_setSearchMinifySearchAttribute(e,t){const i=this._getSearchMinifySearchAttributeName(t.name);this._createViewModelAttribute(e,i,t.iconOnly||!1),t.minifySearch=`$${i}`}_setSearchFilteredColumnsGroupsAttribute(e,t){const i=this._getSearchFilteredColumnsGroupsAttributeName(t.name);this._createViewModelAttribute(e,i),t.selectedColumnsGroups=`$${i}`}_createViewModelAttribute(e,t,i=""){const r=e.viewModelConfig.attributes;Object.prototype.hasOwnProperty.call(r,t)||(r[t]={value:i})}_setFilterAttribute(e,t){this.isNewStructure(t)||!this._isTargetAttributesExist(e,t)||this._getAvailableTargetAttributes(e,t).forEach(i=>{this._setFilterConverterAttribute(e,t,i),this.setFilterAttribute(e,t.name,i)})}_setFilterConverterAttribute(e,t,i){const r=e.viewModelConfig.attributes,a=this.getFilterAttributeName(t.name,i),n=this._getSearchFilteredColumnsGroupsAttributeName(t.name),s={from:[this._getSearchValueViewModelAttributeName(t.name),n],converter:`crt.SearchFilterAttributeConverter: '${i}'`};this.createAttributeIfNeed(r,n,{value:[]}),this.createAttributeIfNeed(r,a,s)}_setSearchFilterColumnsGroupsRequest(e,t,i){var r=this;return(0,l.A)(function*(){if(i.valueChange||!r._isTargetAttributesExist(e,i))return;const a=(yield r._createSearchFilterTargets(e,t,i)).filter(Boolean);if((0,_.isEmpty)(a))return;const s=(yield r._getIsSearchFilterQueryAnalyzerEnabled())?yield r._getIsNeedShowAllOptionForTargets(e,t,a):!0;r._setSearchFilterConfigIntoView(i,a,s),i.valueChange={request:"crt.SearchFilterColumnsGroupsRequest",params:{value:"@event.value",searchFilterColumnsGroups:"@event.columnsGroups",searchFilterGroups:a.map(c=>({filterAttributeName:c.filterAttributeName,viewAttributeName:c.viewAttribute.name})),searchValueAttributeName:r._getSearchValueViewModelAttributeName(i.name),searchFilteredColumnAttributeName:r._getSearchFilteredColumnViewModelAttributeName(i.name),searchFilteredColumnsGroupsAttributeName:r._getSearchFilteredColumnsGroupsAttributeName(i.name)}}})()}_getIsSearchFilterQueryAnalyzerEnabled(){return this._featureService.getFeatureState("SearchFilterQueryAnalyzerEnabled")}_getIsNeedShowAllOptionForTargets(e,t,i){var r=this;return(0,l.A)(function*(){for(const a of i)if(yield r._getIsNeedOptimization(e,t,a.viewAttribute.name,a.columnsModel.columns))return!1;return!0})()}_getIsNeedOptimization(e,t,i,r){var a=this;return(0,l.A)(function*(){if(a._isCollectionAttributeHasFixedFilter(e,t,i))return!1;const n=t.getBoundDataSchemaByAttributePath(i)?.name,s=r.map(d=>d.path);return(0,_.isEmpty)(n)||r.length===0?!1:(yield(0,A.firstValueFrom)(a._searchFilterQueryAnalyzerService.analyze(n,s))).isNeedOptimization})()}_isCollectionAttributeHasFixedFilter(e,t,i){let r=!1;const a=e.viewModelConfig.attributes;if(this._isDataSourceHasDependencies(e,t,i))return!0;const n=this.getAttributeModelFilters(a,i);return(0,_.each)(n,s=>(r=this._isPredefineFilterAttribute(a,s.name),!r)),r}_isPredefineFilterAttribute(e,t){const r=e[t]?.value?.filterType;return!!r||r===0}_isDataSourceHasDependencies(e,t,i){const r=t.getBoundDataSourceNameByAttributePath(i);return((e.modelConfig?.dependencies||{})[r]||[]).length>0}_createSearchFilterTargets(e,t,i){return Promise.all(this._getAvailableTargetAttributes(e,i).map(r=>this._createSearchFilterTarget(e,t,i.name,r)))}_createSearchFilterTarget(e,t,i,r){var a=this;return(0,l.A)(function*(){const n=yield a._getColumnsModel(e,t,r);if(!n)return Promise.resolve(null);const s=`${i}_${r}`,c=a._getDisplayValueForViewAttributeName(t,r,n.viewName);return{columnsModel:n,filterAttributeName:s,viewAttribute:{caption:c,name:r}}})()}_getColumnsModel(e,t,i){return this._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,t,i)}_getDisplayValueForViewAttributeName(e,t,i){const r=e.getBoundDataSchemaByAttributePath(t);return r?`${r.name}${(0,_.isEmpty)(i)?"":" | "+i}`:i}_setSearchFilterConfigIntoView(e,t,i){e.columnsGroupsConfig={showAllOption:i,columnsGroups:t.map(r=>({group:r.viewAttribute,columns:r.columnsModel.columns})),primaryColumnName:t.slice().shift()?.columnsModel.primaryDisplayName}}crtOnMetaDataInit(e){const t=e;return this._getSearchFilterViewConfigs(t).forEach(r=>{this._setDisabledAttribute(t,r),this._setTooltipAttribute(r),this._setSearchValueAttribute(t,r),this._setSearchFilteredColumnAttribute(t,r),this._setFilterAttribute(t,r),this._setSearchMinifySearchAttribute(t,r),this._setSearchFilteredColumnsGroupsAttribute(t,r)}),Promise.resolve(e)}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,n=i,s=r._getSearchFilterViewConfigs(a);for(const c of s)yield r._setSearchFilterColumnsGroupsRequest(a,n,c);return e})()}static{this.\u0275fac=function(t){return new(t||Pe)(o.\u0275\u0275inject(T.FeatureService),o.\u0275\u0275inject(U),o.\u0275\u0275inject(u.SearchFilterQueryAnalyzerService),o.\u0275\u0275inject(Y.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Pe,factory:Pe.\u0275fac})}}class it extends lt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,l.A)(function*(){const r=e.items.slice(1),a=t.getBoundDataSchemaByAttributePath(r)?.name;if(a!=="SimilarLead")return;const n=t.getBoundDataSourceNameByAttributePath(r),s=yield i.hasEntityEditPage(t,a),c=`$${r}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:s,disabled:c,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${n}_Id`},useRelativeContext:!0}}]})()}static{this.\u0275fac=function(t){return new(t||it)(o.\u0275\u0275inject(Y.TranslateService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:it,factory:it.\u0275fac})}}class rt{constructor(e,t){this._featureService=e,this._profileAttributeService=t,this._tabPanelActionsProcessingDisableFeature="DisableTabPanelPreprocessing"}_updateIconPosition(e){if(e.iconPosition)return;const t=!!e.icon;e.iconPosition=t?M.IconPositionEnum.LeftIcon:M.IconPositionEnum.OnlyText}_updateTabIconSource(e){u.TabItem.updateTabIconSource(e)}_updateTabHint(e){e.hint=e.caption}_getTabContainerHeader(e){const t=this._getTabPanelHeaderItemInputs();return{type:"crt.TabPanelHeader",tabs:e.items?.map(i=>({...Object.fromEntries(t.filter(r=>typeof i[r]<"u").map(r=>[r,i[r]])),type:"crt.TabPanelHeaderItem",name:i.name,titleColor:e.tabTitleColor,selectedTitleColor:e.selectedTabTitleColor,styleType:e.styleType}))}}_getTabContainerBody(e){const t=e.allowToggleClose??!0,i=e.mode==="toggle"?t:!1;return{type:"crt.ToggleContainer",preserveContent:e.preserveContent??!0,slidingAnimation:e.slidingAnimation??!1,items:e.items?.map(r=>({...r,type:"crt.ToggleContainerItem",backgroundColor:e.bodyBackgroundColor,isToggleTabHeaderVisible:r.isToggleTabHeaderVisible??!1,allowToggleClose:i})),visibilityStrategyMode:e.visibilityStrategyMode}}_getTabPanelHeaderItemInputs(){return Object.keys(T.ViewElementRegistry.viewElements.get("crt.TabPanelHeaderItem")?.inputs??{})}get isProcessingDisabled(){return(0,A.lastValueFrom)(this._featureService.getFeatureState(this._tabPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){const i=e;if(!(yield t.isProcessingDisabled)){p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabContainer",i.viewConfig).forEach(n=>{t._updateIconPosition(n.viewConfig),t._updateTabIconSource(n.viewConfig),t._updateTabHint(n.viewConfig)});const a=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabPanel",i.viewConfig);for(const n of a){const s=n.viewConfig;yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,s,"selectedTabIndex","","DisableSaveToProfileSelectedTabIndex");const c=t._getTabContainerBody(s),d=t._getTabContainerHeader(s);if(s.mode==="toggle"){const m={...c,name:s.name,visible:s.visible,selectedTab:s.selectedTab,layoutConfig:s.layoutConfig||{},stretch:s.stretch,classes:s.classes,fitContent:s.fitContent},g=s.isToggleTabHeaderVisible??!0;m.items?.forEach(S=>{S.isToggleTabHeaderVisible=g}),Object.keys(s).forEach(S=>delete s[S]),Object.assign(s,m)}else s.items=[d,c]}}return e})()}static{this.\u0275fac=function(t){return new(t||rt)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(u.ProfileAttributeService))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac})}}class Ne extends u.BaseSelectPreprocessor{constructor(){super(...arguments),this._userInfo=(0,o.inject)(p.UserInfo),this._tagRightsService=(0,o.inject)(u.TagRightsService),this._allowedTagAccessesForTaggingIds=[]}_getTagSelectViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TagSelect",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processTagSelect(e,t,i){var r=this;return(0,l.A)(function*(){if(!r.isRecordIdViewModelAttributeExist(e,t)){r.setSelectDisabled(t);return}yield r._setTagSelectRecordSchemaName(e,t,i),yield r.setupSelect(e,t)})()}_setCreateTagRequest(e){var t=this;return(0,l.A)(function*(){if(e.createTag)return;const i=yield t.getListDataSchema(e),r=t.getListItemsAttributeName(e);e.createTag=(0,u.isOldStructure)(e)?t._getCreateTagRequestForOldtructure(e,i):t._getCreateTagRequestForNewStructure(e,i,r)})()}_getCreateTagRequestForOldtructure(e,t){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:T.ModelInPageAction.Add,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"}]}}}_getCreateTagRequestForNewStructure(e,t,i){return{request:"crt.CreateRecordRequest",params:{itemsAttributeName:i,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"},{attributeName:u.TAG_ENTITY_SCHEMA_NAME_PAGE_ATTRIBUTE_NAME,value:e.recordSchemaName}],skipUnsavedData:!0}}}_setEditTagRequest(e){e.editTag||(e.editTag=(0,u.isOldStructure)(e)?this._getEditTagRequestForOldStructure(e):this._getEditTagRequestForNewStructure(e))}_getEditTagRequestForOldStructure(e){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:T.ModelInPageAction.Edit,recordId:"@event.id"}}}_getEditTagRequestForNewStructure(e){return{request:"crt.UpdateRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e),trackUnsavedData:!1}}}_setDeleteTagRequest(e){e.deleteTag||(e.deleteTag={request:(0,u.isOldStructure)(e)?"crt.DeleteOldTagRecordRequest":"crt.DeleteRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e)}})}_setTagSelectRecordSchemaName(e,t,i){var r=this;return(0,l.A)(function*(){if(r._isTagSelectRecordSchemaNameFilled(t))return;const a=yield r._getRecordSchemaName(e,t,i);a&&(t.recordSchemaName=a)})()}_isTagSelectRecordSchemaNameFilled(e){return!!e.recordSchemaName}_getRecordSchemaName(e,t,i){if(!e?.viewModelConfig?.attributes||!i?.length)return Promise.resolve(null);const[r,a]=this._getRecordIdAttributeModelPaths(e.viewModelConfig.attributes,t.recordId);return this._getRecordSchemaNameFromModel(r,a,i)}_getRecordIdAttributeModelPaths(e,t){const i=this.getAttributeName(t),n=e[i]?.modelConfig?.path?.split(".");return!n||n.length<2?["",""]:[n[0],n[1]]}_getRecordSchemaNameFromModel(e,t,i){var r=this;return(0,l.A)(function*(){if(!e||!t)return null;const a=i.find(m=>m.name===e);if(!a)return null;const n=yield(0,A.lastValueFrom)(a.getSchema()),s=n.findAttributeByName(t);if(!s)return null;const c=s.referenceSchemaName??null,d=n.dataSourceConfig?.config?.entitySchemaName;return c||r._getEntitySchemaNameFromDataSchema(d,s)})()}_getEntitySchemaNameFromDataSchema(e,t){if(t.attributeType===T.DataSchemaAttributeType.OwnAttribute)return Promise.resolve(e);const i=t.path.split(".");return this._findEntitySchemaNameByColumnPath(e,i)}_findEntitySchemaNameByColumnPath(e,t){var i=this;return(0,l.A)(function*(){if(!e)return null;const r=t.shift();if(!r)return e;const n=(yield i.getDataSchema(e)).attributes.find(s=>s.name===r);return n?.referenceSchemaName?i._findEntitySchemaNameByColumnPath(n.referenceSchemaName,t):e})()}_prepareViewConfig(e){e.selectSchemaName=this._getSelectSchemaName(e),e.selectColumnName=u.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA,e.recordRelationColumnName=this._getRecordRelationColumnName(e)}_getSelectSchemaName(e){return(0,u.isOldStructure)(e)?e.tagInRecordSourceSchemaName:u.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME}_getRecordRelationColumnName(e){return(0,u.isOldStructure)(e)?u.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA:u.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA}_prepareAllowedTagAccessesForTagging(){var e=this;return(0,l.A)(function*(){e._allowedTagAccessesForTaggingIds=yield(0,u.getAllowedTagAccessesForTagging)(e._tagRightsService)})()}prepareDataForSelects(e,t){var i=this;return(0,l.A)(function*(){let r=!1;t.forEach(a=>(0,u.isOldStructure)(a)?null:r=!0),r&&(yield i._prepareAllowedTagAccessesForTagging())})()}setupSelect(e,t){var i=()=>super.setupSelect,r=this;return(0,l.A)(function*(){r._prepareViewConfig(t),yield i().call(r,e,t)})()}isCanSetupSelect(e,t){return!!t.selectSchemaName&&!!t.selectColumnName&&this._isTagSelectRecordSchemaNameFilled(t)&&this.isRecordIdViewModelAttributeExist(e,t)}setupRequests(e){var t=()=>super.setupRequests,i=this;return(0,l.A)(function*(){yield t().call(i,e),yield i._setCreateTagRequest(e),i._setEditTagRequest(e),i._setDeleteTagRequest(e)})()}getAllowAnyModelActionsState(e){return!1}selectedItemsChangeRequest(e){if(e.addTagsInRecord)return;const t=this.getItemsDataSourceName(e);e.addTagsInRecord={request:"crt.AddTagsInRecordRequest",params:{dataSourceName:t,tagIds:"@event.tagIds",recordId:e.recordId,recordSchemaName:e.recordSchemaName,tagInRecordSourceSchemaName:e.tagInRecordSourceSchemaName}}}deleteSelectedItemsRequest(e){if(e.deleteTagInRecord)return;const t=this.getItemsDataSourceName(e);e.deleteTagInRecord={request:"crt.DeleteTagInRecordRequest",params:{dataSourceName:t,id:"@event.id"}}}createItemsViewModelFilterAttribute(e){return{from:this.getAttributeName(e.recordId),converter:`crt.TagSelectFilterAttributeConverter: '${e.recordSchemaName}' : ${(0,u.isOldStructure)(e)}`}}createListItemsViewModelFilterAttribute(e){return{value:(0,u.isOldStructure)(e)?(0,u.createOldTagListFilter)(this._userInfo):(0,u.createTagListFilter)([e.recordSchemaName],this._allowedTagAccessesForTaggingIds)}}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){const r=e,a=i._getTagSelectViewConfigs(r);return yield i.prepareDataForSelects(r,a),yield Promise.all(a.map(n=>i._processTagSelect(r,n,t))),e})()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Ne)))(i||Ne)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ne,factory:Ne.\u0275fac})}}class at{_modifyInputType(e,t,i){const r=e.control.replace("$",""),a=t.attributes[r]?.modelConfig?.path;if(a){const n=this._getDataSchemaAttributeByPath(a,i);T.DataValueType.WEB_TEXT&&n?.dataValueType===T.DataValueType.WEB_TEXT&&(e.type="crt.WebInput")}}_getDataSchemaAttributeByPath(e,t){const[i,r]=e.split("."),a=t.dataSchemas[i]?.attributes;let n;for(const s in a)if(a[s].path===r){n=a[s];break}return n}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,n=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),s=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.WebInput",a.viewConfig);return n.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),s.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),e})()}static{this.\u0275fac=function(t){return new(t||at)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:at,factory:at.\u0275fac})}}var E=y(10534);const Ht={type:"string",maxLinesCount:2,maxLineLength:10},zt={type:"number",thousandAbbreviation:{enabled:!0}},Ft="DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION";class Re{constructor(e,t,i){this._entitySchemaService=t,this._entitySchemaProvider=i,this._isAdaptionDisabled=!!e[Ft]}_getWidgetViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.ChartWidget"],e).map(t=>t?.viewConfig)}_adaptAxesFormatting(e){var t=this;return(0,l.A)(function*(){const{scales:i,series:r}=e?.config??{},a=i?.xAxis??{};!t._isDefaultXAxisFormat(a)||!(yield t._isAllSeriesGroupingByNumericColumn(r))||(a.formatting=zt)})()}_isDefaultXAxisFormat(e){return(0,_.isEqual)(e?.formatting,Ht)}_isAllSeriesGroupingByNumericColumn(e){var t=this;return(0,l.A)(function*(){if(!e?.length)return!1;for(const i of e)if(!(yield t._isSeriesGroupingByNumericColumn(i)))return!1;return!0})()}_isSeriesGroupingByNumericColumn(e){var t=this;return(0,l.A)(function*(){const{schemaName:i,grouping:r}=e?.data?.providing??{};if(r?.type!==E.ChartGroupingType.ByValue)return!1;const a=r.column?.expression?.columnPath;if(!i||!a)return!1;const n=yield(0,A.firstValueFrom)(t._entitySchemaProvider.getSchemaByName(i)),s=yield(0,A.firstValueFrom)(t._entitySchemaService.getEntitySchemaColumnsInformationByPath(n.uId,a));return p.NUMERIC_DATA_VALUE_TYPES.includes(s?.dataValueType)})()}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(t._isAdaptionDisabled)return e;const i=e,r=t._getWidgetViewConfigs(i.viewConfig).map(a=>t._adaptAxesFormatting(a));return yield Promise.all(r),e})()}static{this.\u0275fac=function(t){return new(t||Re)(o.\u0275\u0275inject(p.FEATURE_VALUES),o.\u0275\u0275inject(p.EntitySchemaService),o.\u0275\u0275inject(p.EntitySchemaProvider))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Re,factory:Re.\u0275fac})}}const Ct=new o.InjectionToken("Represents a factory of widget data providing metadata compressors"),Ot=new o.InjectionToken("Represents a list of widget element types that support data source");class Me{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataCompressorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(E.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,R.first)(),(0,R.map)(Boolean),(0,R.map)(t=>!t));return(0,A.lastValueFrom)(e)}_getWidgetViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>!!t?.name&&!!t?.config)}_compressWidgetDataProvidingMetadata(e,t){this._widgetDataProvidingMetadataCompressorFactory.create(e.type)?.compress(e.name,t)}crtOnMetaDataChanged(e){var t=this;return(0,l.A)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).forEach(r=>t._compressWidgetDataProvidingMetadata(r,i)),e})()}static{this.\u0275fac=function(t){return new(t||Me)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(Ot,8),o.\u0275\u0275inject(Ct))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Me,factory:Me.\u0275fac})}}function Jt(){return v.FactoryProvider.create({token:Ct,mappings:[{predicate:E.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:E.ChartWidgetDataProvidingMetadataCompressor},{predicate:E.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:E.IndicatorWidgetDataProvidingMetadataCompressor},{predicate:E.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:E.IndicatorWidgetDataProvidingMetadataCompressor}]})}class Fe{static for(...e){return{ngModule:Fe,providers:[{provide:f.CRT_DESIGN_TIME_METADATA_POSTPROCESSOR,useFactory:(t,i)=>new Me(t,e,i),deps:[C.FeatureService,Ct],multi:!0}]}}static{this.\u0275fac=function(t){return new(t||Fe)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:Fe})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[Jt()],imports:[E.ChartWidgetDataProvidingMetadataCompressorModule,E.IndicatorWidgetDataProvidingMetadataCompressorModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(Fe,{imports:[E.ChartWidgetDataProvidingMetadataCompressorModule,E.IndicatorWidgetDataProvidingMetadataCompressorModule]})})();const St=new o.InjectionToken("Represents a factory of widget data providing metadata generators");class Oe{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataGeneratorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(E.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,R.first)(),(0,R.map)(Boolean),(0,R.map)(t=>!t));return(0,A.lastValueFrom)(e)}_getWidgetViewConfigs(e){return p.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>!!t?.name&&!!t?.config)}_generateWidgetDataProvidingMetadata(e,t){return this._widgetDataProvidingMetadataGeneratorFactory.create(e.type).generate(e,t)}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).map(r=>t._generateWidgetDataProvidingMetadata(r,i)).forEach(r=>(0,_.defaultsDeep)(i,r)),e})()}static{this.\u0275fac=function(t){return new(t||Oe)(o.\u0275\u0275inject(C.FeatureService),o.\u0275\u0275inject(Ot,8),o.\u0275\u0275inject(St))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac})}}function Yt(){return v.FactoryProvider.create({token:St,mappings:[{predicate:E.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:E.ChartWidgetDataProvidingMetadataGenerator},{predicate:E.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:E.IndicatorWidgetDataProvidingMetadataGenerator},{predicate:E.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:E.IndicatorWidgetDataProvidingMetadataGenerator}]})}class w{static for(...e){const t=(r,a)=>new Oe(r,e,a),i=[C.FeatureService,St];return{ngModule:w,providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useFactory:t,deps:i,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useFactory:t,deps:i,multi:!0}]}}static{this.\u0275fac=function(t){return new(t||w)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:w})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[Yt()],imports:[E.ChartWidgetDataProvidingMetadataGeneratorModule,E.IndicatorWidgetDataProvidingMetadataGeneratorModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(w,{imports:[E.ChartWidgetDataProvidingMetadataGeneratorModule,E.IndicatorWidgetDataProvidingMetadataGeneratorModule]})})();class we{constructor(e){this.featureValues=e,this._chartWidgetName="crt.ChartWidget",this._indicatorWidgetName="crt.IndicatorWidget",this._gaugeWidgetName="crt.GaugeWidget"}_getWidgetsArray(e){const t=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._chartWidgetName,e.viewConfig),i=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._indicatorWidgetName,e.viewConfig),r=p.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._gaugeWidgetName,e.viewConfig);return[...t,...i,...r]}_getWidgetName(e){return e.name.replace(/\./g,"_")}_getDataSetSortinAttributeName(e){return`${e.split(" ").join("").replace(/\./g,"_")}_ListDataDSSorting`}get _isDrillDownFeatureEnabled(){return this.featureValues[E.CHART_WIDGET_DRILLDOWN_FEATURE_NAME]}_getSeriesDataSourceNames(e){const t=[],i=e?.viewConfig;if(i.type===this._chartWidgetName)i?.config?.series?.forEach(r=>{const a=r?.data?.providing?.attribute;this._addDataSourceName(a,t)});else{const r=i?.config?.data?.providing?.attribute;this._addDataSourceName(r,t)}return t}_addDataSourceName(e,t){e&&t.push(e+"DS")}crtOnModelInit(e,t){var i=this;return(0,l.A)(function*(){const r=e,a=i._getWidgetsArray(r);for(const n of a){const s=n?.viewConfig;let c=r.viewModelConfig.attributes;c||(c=r.viewModelConfig.attributes={});const d=i._getWidgetName(s),m=`${f.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,g=i._getDataSetSortinAttributeName(m),S=`${m}_ListConfig`,b=`${m}_ListData`,D=`${b}_SearchValue`,I=`${b}_SearchFilter`;c[S]={value:[]},c[`${m}_UserProfileData`]={value:[]},c[b]={isCollection:!0,modelConfig:{path:`${m}_ListDataDS`,sortingConfig:{attributeName:g},filterAttributes:[{name:I,loadOnChange:!0}]},viewModelConfig:{attributes:{}}},g&&(c[g]={value:[]}),c[D]={value:""},c[I]={from:D,converter:`crt.WidgetSearchFilterAttributeConverter: '${b}' : '${S}'`}}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.A)(function*(){const a=e,n=r._getWidgetsArray(a);for(const s of n){const c=s?.viewConfig,d=r._getWidgetName(c),m=`${f.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,g=`${m}_ListDataDS`,S=`${m}_ListConfig`,b=`${m}_ListData`,D=`${m}_UserProfileData`,I=`${b}_SearchValue`;c.listData=`$${b}`,c.listConfig=`$${S}`,c.userProfileData=`$${D}`,c.searchValue=`$${I}`;const ot=r.featureValues[E.RELOAD_DRILL_DOWN_DATASOURCE]?{name:d,dataSourceNames:r._getSeriesDataSourceNames(s)}:null;c.drillDown={request:"crt.WidgetDrilldownRequest",params:{dataSourceName:g,listConfigAttributeName:S,listDataAttributeName:b,parameters:[],seriesDataSourceConfig:ot,config:{schemaName:"@event.schemaName",groupByValue:"@event.groupByValue",pagingConfig:"@event.pagingConfig",sortingConfig:"@event.sortingConfig",groupBy:"@event.groupBy",aggregateBy:"@event.aggregateBy",columns:"@event.columns",filters:"@event.filters",dependencies:"@event.dependencies"}}},c.paginationChange=_t(g),c.getProfileColumns={request:"crt.AnalyticsDataGridGetColumnsRequest",params:{userProfileDataAttributeName:D,widgetAttributePrefix:m,drilldownConfig:"@event.drilldownConfig",schemaName:"@event.schemaName",isDefault:!1}},c.columnsChange={request:"crt.AnalyticsDataGridSaveToProfileRequest",params:{schemaName:"@event.schemaName",isDefault:!1,dataTableData:"@event.dataTableData",listConfigAttributeName:S}},c.searchFilterChange={request:"crt.SearchFilterRequest",params:{value:"@event.value",searchValueAttributeName:I}}}return e})()}crtOnMetaDataInit(e){var t=this;return(0,l.A)(function*(){if(!t._isDrillDownFeatureEnabled)return e;const i=e,r=t._getWidgetsArray(i);for(const a of r)!a.viewConfig||a.viewConfig?.pagingConfig||(a.viewConfig.pagingConfig=At(),a.viewConfig.fullScreenStateChanged??={request:"crt.WidgetFullScreenStateChangesRequest",params:{widgetName:a.viewConfig.name,fullScreenState:"@event"}});return e})()}static{this.\u0275fac=function(t){return new(t||we)(o.\u0275\u0275inject(p.FEATURE_VALUES))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:we,factory:we.\u0275fac})}}class q{static{this.\u0275fac=function(t){return new(t||q)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:q})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:we,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Re,multi:!0}],imports:[w.for(E.CHART_WIDGET_VIEW_ELEMENT_TYPE,E.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,E.GAUGE_WIDGET_VIEW_ELEMENT_TYPE)]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(q,{imports:[w]})})();const Xt={"zh-TW":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u6C92\u6709\u53EF\u53D6\u7528\u7684\u5831\u544A","GoToPrintablesSetupCaption":"\u524D\u5F80\u5831\u544A\u8A2D\u5B9A"}}'),"hr-HR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nema dostupnih izvje\u0161taja","GoToPrintablesSetupCaption":"Idi na postavke izvje\u0161taja"}}'),"bg-BG":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u044F\u043C\u0430 \u043D\u0430\u043B\u0438\u0447\u043D\u0438 \u043E\u0442\u0447\u0435\u0442\u0438","GoToPrintablesSetupCaption":"\u041E\u0442\u0438\u0434\u0438 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u043D\u0430 \u043E\u0442\u0447\u0435\u0442\u0430"}}'),"zh-CN":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"vi-VN":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"uk-UA":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u0435\u043C\u0430\u0454 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0438\u0445 \u0437\u0432\u0456\u0442\u0456\u0432","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043E \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u0437\u0432\u0456\u0442\u0443"}}'),"tr-TR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Mevcut rapor yok","GoToPrintablesSetupCaption":"Rapor kurulumuna git"}}'),"th-TH":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"sv-SE":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"sq-AL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nuk ka raporte t\xEB disponueshme","GoToPrintablesSetupCaption":"Shko te krijimi i raportit"}}'),"ro-RO":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nu exist\u0103 rapoarte disponibile","GoToPrintablesSetupCaption":"Merge\u021Bi la configurarea raportului"}}'),"pt-PT":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"pt-BR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"N\xE3o existem relat\xF3rios dispon\xEDveis","GoToPrintablesSetupCaption":"Ir para as configura\xE7\xF5es de relat\xF3rios"}}'),"pl-PL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Brak dost\u0119pnych raport\xF3w","GoToPrintablesSetupCaption":"Przejd\u017A do konfiguracji raportu"}}'),"nl-NL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"lv-LV":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Pieejamu atskai\u0161u nav","GoToPrintablesSetupCaption":"Dodieties uz atskai\u0161u iestat\u012Bjumiem"}}'),"ko-KR":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uBCF4\uACE0\uC11C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4","GoToPrintablesSetupCaption":"\uBCF4\uACE0\uC11C \uC124\uC815\uC73C\uB85C \uC774\uB3D9"}}'),"ja-JP":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u5229\u7528\u53EF\u80FD\u306A\u30EC\u30DD\u30FC\u30C8\u306F\u3042\u308A\u307E\u305B\u3093","GoToPrintablesSetupCaption":"\u30EC\u30DD\u30FC\u30C8\u306E\u8A2D\u5B9A\u306B\u79FB\u52D5"}}'),"it-IT":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Non ci sono report disponibili","GoToPrintablesSetupCaption":"Vai alla configurazione del report"}}'),"id-ID":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Tidak ada laporan yang tersedia","GoToPrintablesSetupCaption":"Pergi ke pengaturan laporan"}}'),"hu-HU":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nincsenek el\xE9rhet\u0151 jelent\xE9sek","GoToPrintablesSetupCaption":"L\xE9pjen a jelent\xE9s be\xE1ll\xEDt\xE1s\xE1hoz"}}'),"he-IL":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u05D0\u05D9\u05DF \u05D3\u05D5\u05D7\u05D5\u05EA \u05D6\u05DE\u05D9\u05E0\u05D9\u05DD","GoToPrintablesSetupCaption":"\u05E2\u05D1\u05D5\u05E8 \u05DC\u05D4\u05D2\u05D3\u05E8\u05D5\u05EA \u05D3\u05D5\u05D7"}}'),"fr-FR":JSON.parse(`{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Il n'y a aucun rapport disponible","GoToPrintablesSetupCaption":"Aller \xE0 la configuration du rapport"}}`),"es-ES":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"No hay informes disponibles","GoToPrintablesSetupCaption":"Ir a la configuraci\xF3n de reportes"}}'),"de-DE":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Es gibt keine verf\xFCgbaren Berichte","GoToPrintablesSetupCaption":"Zum Berichts-Setup"}}'),"cs-CZ":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"ar-SA":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u0644\u0627 \u062A\u0648\u062C\u062F \u062A\u0642\u0627\u0631\u064A\u0631 \u0645\u062A\u0627\u062D\u0629","GoToPrintablesSetupCaption":"\u0627\u0630\u0647\u0628 \u0644\u0644\u0625\u0628\u0644\u0627\u063A \u0639\u0646 \u0625\u0639\u062F\u0627\u062F"}}'),"en-US":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),"ru-RU":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u043E\u0442\u0447\u0435\u0442\u044B \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u0434\u043B\u044F \u043F\u0435\u0447\u0430\u0442\u0438","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \u043E\u0442\u0447\u0435\u0442\u043E\u0432"}}')};class nt{static{this.\u0275fac=function(t){return new(t||nt)}}static{this.\u0275mod=o.\u0275\u0275defineNgModule({type:nt})}static{this.\u0275inj=o.\u0275\u0275defineInjector({providers:[u.DataGridFilterOptionsBackwardCompatibilityModifier,pt.FolderTreeFilterOptionsBackwardCompatibilityModifier,u.DataGridDefaultBulkActionsCreator,u.GalleryDefaultBulkActionsCreator,P.DATA_GRID_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,P.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,P.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:j,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ie,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:re,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:se,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:oe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ee,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ae,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ne,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:te,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ie,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ue,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ce,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:J,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:We,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:rt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ve,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:K,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:pe,multi:!0},C.DcmSettingsService,be,L,U,F,V,C.PrintablesService,p.FileDownloaderService,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Be,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:le,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Qe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:He,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Xe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ze,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:at,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:je,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:qe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:it,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:X,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ze,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Je,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Le,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ge,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Pe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ne,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:et,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:kt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ge,multi:!0},{provide:C.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Bt.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE,multi:!0},{provide:C.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Et,multi:!0},{provide:C.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Dt,multi:!0},{provide:C.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Tt,multi:!0},{provide:C.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Vt.CAN_USE_CALENDAR_SYNC_LICENSE_OPERATION_CODE,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ue,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:tt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ve,multi:!0}],imports:[ct.CommonModule,Te,O.withModifiers([["crt.DataGrid",u.DataGridFilterOptionsBackwardCompatibilityModifier]]),O.withModifiers([["crt.FolderTree",pt.FolderTreeFilterOptionsBackwardCompatibilityModifier]]),q,Se,fe,me,G.withCreators([["crt.DataGrid",u.DataGridDefaultBulkActionsCreator],["crt.Gallery",u.GalleryDefaultBulkActionsCreator]]),v.CrtLibTranslateModule.forRoot({i18n:Xt}),W.ComboboxUtilsModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(nt,{imports:[ct.CommonModule,Te,O,O,q,Se,fe,me,G,v.CrtLibTranslateModule,W.ComboboxUtilsModule]})})();class st{_getHeaders(e){return p.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.HeaderContainer",e.viewConfig)}crtOnModelInit(e,t){const i=e,r=i?.viewModelConfig?.attributes,a=this._getHeaders(i)[0];if(a){const n="HeaderCaption";r[n]={value:""},a.viewConfig.title=`$${n}`,a.viewConfig.styles={"border-top-left-radius":"8px","border-top-right-radius":"8px"},i.tag?.includes("BaseGridSectionTemplate")&&(a.viewConfig.styles["margin-bottom"]="0px")}return Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||st)}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:st,factory:st.\u0275fac})}}}}]);
