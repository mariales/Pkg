(self.webpackChunkapp_studio_enterprise_error_list_dialog=self.webpackChunkapp_studio_enterprise_error_list_dialog||[]).push([[4318,3308,927,8546,1937],{1937:(m,E,i)=>{i.r(E),i.d(E,{ExpressionEngine:()=>_.t,ExpressionEngineModule:()=>c.D,ExpressionMetadataAdapter:()=>_.X});var c=i(50569),_=i(37577),n=i(52972),r=i.n(n),u={};for(const o in n)["default","ExpressionEngineModule","ExpressionEngine","ExpressionMetadataAdapter"].indexOf(o)<0&&(u[o]=()=>n[o]);i.d(E,u)},50569:(m,E,i)=>{i.d(E,{D:()=>s});var c=i(5960),_=i(40297),n=i(38495),r=i(52972);let u=class{convert(t,l){const p={type:"crt.ExecuteExpressionRequest",$context:l,metadata:t};return n.HandlerChainService.instance.process(p).then(y=>y).catch(y=>({success:!1,result:null,errorInfo:y}))}};u=(0,c.__decorate)([(0,n.CrtConverter)({type:"crt.ToExpressionResult"})],u);var o=i(37577);let d=class extends n.BaseRequest{constructor(){super(...arguments),this.type="crt.ExecuteExpressionRequest"}};d=(0,c.__decorate)([(0,n.CrtRequest)({type:"crt.ExecuteExpressionRequest"})],d);let x=class extends n.BaseRequestHandler{constructor(t){super(),this._engine=t}handle(t){return this._engine.safeExecute(t.metadata)}};x=(0,c.__decorate)([(0,n.CrtRequestHandler)({type:"crt.ExecuteExpressionHandler",requestType:"crt.ExecuteExpressionRequest"}),(0,c.__metadata)("design:paramtypes",[o.t])],x);var e=i(59131);let s=class h{static#e=this.\u0275fac=function(l){return new(l||h)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:h});static#s=this.\u0275inj=e.\u0275\u0275defineInjector({providers:[o.t,o.X],imports:[_.CommonModule,r.ExpressionSchemaModule,r.ExpressionSchemaModule]})};s=(0,c.__decorate)([(0,n.CrtModule)({converters:[u],requestHandlers:[x]})],s),function(){(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(s,{imports:[_.CommonModule,r.ExpressionSchemaModule],exports:[r.ExpressionSchemaModule]})}()},37577:(m,E,i)=>{i.d(E,{t:()=>d,X:()=>o});var c=i(73308),_=i(63721),n=i(38495),r=i(62278),u=i(59131);class o{_getDataValueTypeName(e){switch(e){case n.DataValueType.FLOAT1:return"Float1";case n.DataValueType.FLOAT2:return"Float2";case n.DataValueType.FLOAT3:return"Float3";case n.DataValueType.FLOAT4:return"Float4";case n.DataValueType.FLOAT8:return"Float8";case n.DataValueType.CUSTOM_OBJECT:return"Object";case n.DataValueType.COMPOSITE_OBJECT_LIST:return"CompositeObjectList";default:return n.DataValueType[e]}}_getRequestParameterValueDto(e){const s=e.value;if(Array.isArray(s)){const a=s[0];return Array.isArray(a)?s.map(t=>t.map(l=>({...l,value:this._encodeValue(l.value,l.dataValueType),dataValueType:this._getDataValueTypeName(l.dataValueType)}))):s.map(t=>({...t,value:this._encodeValue(t.value,t.dataValueType),dataValueType:this._getDataValueTypeName(t.dataValueType)}))}return this._encodeValue(s,e.dataValueType)}_encodeValue(e,s){return[n.DataValueType.Date,n.DataValueType.Time,n.DataValueType.DateTime].includes(s)?(0,n.toLocalISOString)(e):e}decodeValue(e,s){return[n.DataValueType.Date,n.DataValueType.Time,n.DataValueType.DateTime].includes(s)?new Date(e):e}getExecutionMetadata(e){const s=e.parameters.map(t=>({...t,dataValueType:this._getDataValueTypeName(t.dataValueType),value:this._getRequestParameterValueDto(t)})),a=e.expressionVariables.map(t=>({...t,dataValueType:this._getDataValueTypeName(t.dataValueType)}));return JSON.stringify({...e,parameters:s,expressionVariables:a,resultDataValueType:this._getDataValueTypeName(e.resultDataValueType)})}static#e=this.\u0275fac=function(s){return new(s||o)};static#t=this.\u0275prov=u.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}class d{constructor(e,s,a,t){this._httpClient=e,this._featureService=s,this._sysSettingsService=a,this._expressionMetadataAdapter=t,this._expressionEngineEndpoint="ServiceModel/ExpressionService.svc/Execute",this._expressionsEngineEndpoint="ServiceModel/ExpressionService.svc/ExecuteMany",this._expressionEngineValidationEndpoint="ServiceModel/ExpressionService.svc/Validate",this._defaultDebounceTime=200,this._defaultBundleCount=20,this._debounceTimeSysSettingName="ExpressionEngineDebounceTime",this._bundleCountSysSettingName="ExpressionEngineBundleCount",this._requests=new r.Subject}_executeImmediate(e){const s={metadata:e};return(0,r.lastValueFrom)(this._httpClient.post(this._expressionEngineEndpoint,s,{headers:new _.HttpHeaders({"Content-Type":"application/json"})}))}_getBundleSettings(){var e=this;return(0,c.A)(function*(){const{values:s}=yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName,e._bundleCountSysSettingName]),a=s[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime,t=s[e._bundleCountSysSettingName]?.value||e._defaultBundleCount;return{executionDebounceTime:a,bundleCount:t}})()}_prepareDebouncedResponsesStream(){var e=this;return(0,c.A)(function*(){const{executionDebounceTime:s,bundleCount:a}=yield e._getBundleSettings();if(e._responses)return;const t=new r.BehaviorSubject(0),l=(0,r.merge)(t.pipe((0,r.filter)(p=>p>=a)),e._requests.pipe((0,r.tap)(()=>{t.next(t.value+1)}),(0,r.debounceTime)(s)));e._responses=e._requests.pipe((0,r.buffer)(l),(0,r.filter)(({length:p})=>!!p),(0,r.mergeMap)(p=>(t.next(0),e._httpClient.post(e._expressionsEngineEndpoint,p,{headers:new _.HttpHeaders({"Content-Type":"application/json"})}))),(0,r.share)())})()}_executeThrottled(e){var s=this;return(0,c.A)(function*(){yield s._prepareDebouncedResponsesStream();const a=(0,n.generateGuid)(),t=(0,r.firstValueFrom)(s._responses.pipe((0,r.filter)(l=>l.some(p=>p.executionId===a)),(0,r.map)(l=>l.find(p=>p.executionId===a).result)));return s._requests.next({executionId:a,metadata:e}),t})()}safeExecute(e,s={immediate:!1}){var a=this;return(0,c.A)(function*(){try{return yield a.execute(e,s)}catch(t){return{success:!1,errorInfo:t instanceof _.HttpErrorResponse?{errorCode:t.name,message:t.message,stackTrace:t.url}:t,result:null}}})()}execute(e,s={immediate:!1}){var a=this;return(0,c.A)(function*(){let t;const l=a._expressionMetadataAdapter.getExecutionMetadata(e),p=yield a._featureService.getFeatureState("ExpressionEngineDisableBundling");return s.immediate||p?t=yield a._executeImmediate(l):t=yield a._executeThrottled(l),t.success?{...t,result:a._expressionMetadataAdapter.decodeValue(t.result,e.resultDataValueType)}:Promise.reject(t.errorInfo)})()}validate(e){const s={metadata:this._expressionMetadataAdapter.getExecutionMetadata(e)};return(0,r.lastValueFrom)(this._httpClient.post(this._expressionEngineValidationEndpoint,s))}static#e=this.\u0275fac=function(s){return new(s||d)(u.\u0275\u0275inject(_.HttpClient),u.\u0275\u0275inject(n.FeatureService),u.\u0275\u0275inject(n.SysSettingsService),u.\u0275\u0275inject(o))};static#t=this.\u0275prov=u.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}},73308:(m,E,i)=>{i.d(E,{A:()=>_});function c(n,r,u,o,d,x,e){try{var s=n[x](e),a=s.value}catch(t){u(t);return}s.done?r(a):Promise.resolve(a).then(o,d)}function _(n){return function(){var r=this,u=arguments;return new Promise(function(o,d){var x=n.apply(r,u);function e(a){c(x,o,d,e,s,"next",a)}function s(a){c(x,o,d,e,s,"throw",a)}e(void 0)})}}}}]);
