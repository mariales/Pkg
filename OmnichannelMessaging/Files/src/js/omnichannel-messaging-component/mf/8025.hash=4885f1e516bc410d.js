(self.webpackChunkapp_studio_enterprise_omnichannel_messaging=self.webpackChunkapp_studio_enterprise_omnichannel_messaging||[]).push([[8025,3308,927,8546,6165,2832],{78025:(_e,G,u)=>{u.r(G),u.d(G,{ABSTRACT_DIALOG_PROVIDER_ACTIONS:()=>k,Attachment:()=>Ie,Channel:()=>me,ChannelEntityConverter:()=>E,ChannelService:()=>P,ChannelType:()=>f,ChatEntityConverter:()=>w,ChatMessage:()=>ye,ChatOperator:()=>ge,ChatOperatorStatus:()=>ae,ChatQueueOperator:()=>Se,ChatQueueOperatorEntityConverter:()=>j,ChatQueueOperatorService:()=>W,ChatSettingsPageInitHandler:()=>ee,ChatStatus:()=>Q,CreateQueueAgentHandler:()=>$,CreateQueueAgentRequest:()=>We,CrtChatHistoryComponent:()=>b,CrtChatMessagesComponent:()=>v,CrtOmnichatModule:()=>te,FacebookApiProvider:()=>R,FacebookChannelCreateRecordHandler:()=>J,FacebookChannelErrorDialogComponent:()=>L,FacebookProvider:()=>U,FacebookRegistrationService:()=>H,FacebookSettingsService:()=>x,MessageDirection:()=>Z,MessageType:()=>N,OmnichannelChat:()=>ue,OmnichannelChatService:()=>M,OpenFacebookIntegrationPageRequestHandler:()=>se,RegisterTelegramResponse:()=>Me,RegisterWhatsAppResponse:()=>ve,TelegramChannelAttributeChangedHandler:()=>K,TelegramChannelSaveHandler:()=>q,TelegramRegistrationService:()=>F,WhatsAppChannelSaveHandler:()=>X,WhatsAppRegistrationService:()=>V});var d=u(5960),y=u(40297),I=u(63721),z=u(56711),T=u(23023),S=u(76923),i=u(38495),p=u(79772),C=u(50456),l=u(21018),n=u(59131),c=u(62278),ne=u(29957),Q;(function(r){r.Completed="a1b0184b-0a54-4a47-ba08-a5772105d3b2"})(Q||(Q={}));var ae;(function(r){r[r.Inactive=0]="Inactive",r[r.Active=1]="Active",r[r.ChatsExceeded=2]="ChatsExceeded"})(ae||(ae={}));class ge{}class ue{get chatQueueId(){return this._chatQueueId}set chatQueueId(e){this._chatQueueId=e}}var Z;(function(r){r[r.Incoming=1]="Incoming",r[r.Outcoming=2]="Outcoming"})(Z||(Z={}));var N;(function(r){r[r.Text=0]="Text",r[r.File=1]="File",r[r.Image=2]="Image",r[r.System=5]="System"})(N||(N={}));class Ie{}class ye{}class Me{}class ve{}class Se{}var f;(function(r){r.FacebookMessenger="50491c6c-d82b-4b86-b38c-99262d11a5ac",r.Telegram="645170ab-c67a-4dcc-9def-c0e5236bdfe0",r.WhatsApp="1398dc73-b428-4e21-b97a-c1bb6b4bc621",r.AdaConnector="fd6491c5-0ebe-408a-a4c3-057a1ac79dd4"})(f||(f={}));class me{get type(){switch(this.typeId){case f.FacebookMessenger:return f.FacebookMessenger;case f.Telegram:return f.Telegram;default:throw new Error(`Type with id ${this.typeId} not found`)}}}var Y=u(85638),O=u(35266),_=u(36486);class w{_getChatOperator(e){const t=new ge;return e.Operator&&(t.contact=this._getContact(e["Operator.Contact"]),t.displayValue=e.Operator.displayValue,t.value=e.Operator.value),t}_getContact(e){if(e)return new C.Contact(e.value,e.displayValue,e.primaryImageValue)}_getChannel(e){const t=e.Channel,a=e["Channel.Provider"],s={};return t&&(s.id=t.value,s.name=t.displayValue),a&&(s.provider={id:a.value,name:a.displayValue,icon:(0,l.getImageUrlById)(a.primaryImageValue)}),s.source=e["Channel.Source"],s.msgSettingsId=e["Channel.MsgSettingsId"],s}_getQueue(e){const t=e.Queue,a={};return t&&(a.id=t.value),a}_createChat(e){const t=this._getContact(e.Contact);t.account=e["Contact.Account"];const a=this._getChannel(e),s=this._getQueue(e),o=this._getChatOperator(e);return{id:e.Id,contact:t,lastMessageTime:e.ModifiedOn,status:e.Status,channel:a,chatPreview:e.ChatPreview,operator:o,unprocessedMsgCount:e.UnprocessedMsgCount,chatStartDate:e.ChatStartDate,closeDate:e.CloseDate,completionDate:e.CompletionDate,lastMessageDirection:e.LastMessageDirection,channelId:e.ChannelId,chatQueueId:e.ChatQueueId||s.id}}_getLookupValue(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]?e[t].value:void 0}getEntity(e){return this._createChat(e)}getEntityColumns(e){return[new l.EntityColumn("Id",e.id,i.DataValueType.Guid),new l.EntityColumn("Contact",this._getLookupValue(e,"contact"),i.DataValueType.Lookup),new l.EntityColumn("Contact.Account",this._getLookupValue(e,"account"),i.DataValueType.Lookup),new l.EntityColumn("ModifiedOn",e.lastMessageTime,i.DataValueType.DateTime),new l.EntityColumn("Status",this._getLookupValue(e,"status"),i.DataValueType.Lookup),new l.EntityColumn("Channel",this._getLookupValue(e,"channel"),i.DataValueType.Lookup),new l.EntityColumn("Channel.Provider",this._getLookupValue(e,"channel"),i.DataValueType.Lookup),new l.EntityColumn("Channel.Source",e.channel?.source,i.DataValueType.Text),new l.EntityColumn("Channel.MsgSettingsId",e.channel?.msgSettingsId,i.DataValueType.Text),new l.EntityColumn("ChatPreview",e.chatPreview,i.DataValueType.Text),new l.EntityColumn("Operator",this._getLookupValue(e,"operator"),i.DataValueType.Lookup),new l.EntityColumn("UnprocessedMsgCount",e.unprocessedMsgCount,i.DataValueType.Integer),new l.EntityColumn("ChatStartDate",e.chatStartDate,i.DataValueType.DateTime),new l.EntityColumn("CloseDate",e.closeDate,i.DataValueType.DateTime),new l.EntityColumn("CompletionDate",e.completionDate,i.DataValueType.DateTime),new l.EntityColumn("Operator.Contact",this._getLookupValue(e,"operatorContact"),i.DataValueType.Lookup),new l.EntityColumn("Queue",this._getLookupValue(e,"queue"),i.DataValueType.Lookup)]}static{this.\u0275fac=function(t){return new(t||w)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac})}}var A=u(28399),fe=u.n(A);class j{_createChatQueueOperator(e){return{id:e.Id,operator:e.Operator,chatQueue:e.ChatQueue}}getValueFromLookup(e,t){return e.hasOwnProperty(t)&&!(0,A.isEmpty)(e[t])?e[t].value:void 0}getEntity(e){return this._createChatQueueOperator(e)}getEntityColumns(e){return[new l.EntityColumn("Id",e.id,i.DataValueType.Guid),new l.EntityColumn("Operator",this.getValueFromLookup(e,"operator"),i.DataValueType.Lookup),new l.EntityColumn("ChatQueue",this.getValueFromLookup(e,"chatQueue"),i.DataValueType.Lookup)]}static{this.\u0275fac=function(t){return new(t||j)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac})}}class E{_createChannel(e){const t=e.Provider,a=e.ChatQueue,s=e.Language;return{id:e.Id,name:e.Name,typeId:t.value,typeName:t.displayValue,msgSettingsId:e.MsgSettingsId,queueId:a.value,queueName:a.displayValue,source:e.Source,isActive:e.IsActive,languageId:s.value,languageName:s.displayValue}}getEntity(e){return this._createChannel(e)}getEntityColumns(e){return[new l.EntityColumn("Id",e.id,i.DataValueType.Guid),new l.EntityColumn("Name",e.name,i.DataValueType.Text),new l.EntityColumn("Provider",e.typeId,i.DataValueType.Lookup),new l.EntityColumn("MsgSettingsId",e.msgSettingsId,i.DataValueType.Guid),new l.EntityColumn("ChatQueue",e.queueId,i.DataValueType.Lookup),new l.EntityColumn("Source",e.source,i.DataValueType.Text),new l.EntityColumn("IsActive",e.isActive,i.DataValueType.Boolean),new l.EntityColumn("Language",e.languageId,i.DataValueType.Lookup)]}static{this.\u0275fac=function(t){return new(t||E)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac})}}class M extends O.BaseEntityService{static get rowsCount(){return 30}constructor(e,t,a,s,o,g){super(t,a,s),this.rightsService=e,this.httpClient=o,this.userInfo=g,this._serviceUrl="/rest/OmnichannelChatService/",this._canManageChatsOperationCode="CanManageChats",this._cacheChatActions={},this.entitySchemaName="OmniChat"}_postWithChatId(e,t){const a=this._serviceUrl+t;return this.httpClient.post(a,{chatId:e})}_getMessages(e,t){const a=this._serviceUrl+t;return this.httpClient.post(a,{chatId:e}).pipe((0,_.map)(this._mapChatMessage()))}_getAllConversationMessages(e,t,a){const s=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),o=this._serviceUrl+"GetAllConversation";return this.httpClient.post(o,{contactId:e,channelId:t,rowCount:M.rowsCount,rowOffset:a},{headers:s}).pipe((0,_.map)(this._mapChatMessage()))}_mapChatMessage(){return e=>(e.forEach(t=>{t.time=new Date(t.time),t.author=new C.Contact(t.author.id,t.author.name,t.author.photoId)}),e)}acceptChat(e){return this._postWithChatId(e,"AcceptChat")}getAllConversationByChat(e,t=0){const a=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"GetAllConversationByChat";return this.httpClient.post(s,{chatId:e,rowCount:M.rowsCount,rowOffset:t},{headers:a}).pipe((0,_.map)(this._mapChatMessage()))}getAllConversation(e,t,a=0){return this._getAllConversationMessages(e,t,a)}markAsRead(e){const t=this._serviceUrl+"MarkChatAsRead";this.httpClient.post(t,{chatId:e}).subscribe()}getMessageTemplate(e){const t=this._serviceUrl+"GetUnifiedMessageTemplate";return this.httpClient.post(t,{chatId:e})}sendMessage(e){const t="/rest/OmnichannelOutcomeMessagingService/SendMessage",a={message:e};return this.httpClient.post(t,a)}sendMessageWithAttachments(e,t){const a="/rest/OmnichannelOutcomeMessagingService/SendMessageWithAttachments",s=new FormData;return s.append("message",JSON.stringify(e)),Array.from(t).forEach((o,g)=>{s.append("file"+g,o,o.name)}),this.httpClient.post(a,s)}completeChat(e){return this._postWithChatId(e,"CloseActiveChat")}getOperatorChats(){const e=this._serviceUrl+"GetChats";return this.httpClient.post(e,{operatorId:this.userInfo.id}).pipe((0,_.map)(t=>({success:!0,errorInfo:null,result:t.Chats.map(a=>this.entityConverter.getEntity(a))})),(0,_.catchError)(t=>this.getBaseErrorResponse(t)))}getChatHistory(e){return this._getMessages(e,"GetHistory")}getChatActions(e){if(this._cacheChatActions[e])return(0,c.of)(this._cacheChatActions[e]);const t=this._serviceUrl+"GetChatActions";return this.httpClient.post(t,{chatId:e}).pipe((0,_.tap)(a=>this._cacheChatActions[e]=a))}isOperatorCanManageChats(){return this.rightsService.getCanExecuteOperation(this._canManageChatsOperationCode).pipe((0,_.map)(e=>e))}isOperatorActive(){const e=new i.EntitySchemaQuery("OperatorSession");return e.rowCount=1,e.addSchemaColumn("OperatorState.OperatorAvailable","IsActive"),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Is_null,"SessionEndDate",null),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"SysUser",this.userInfo.id),this.queryExecutor.executeSelectQuery(e).pipe((0,_.map)(t=>t&&t[0].IsActive||!1),(0,_.catchError)(()=>(0,c.of)(!1)))}isOperatorHasActiveChannel(){const e=new i.EntitySchemaQuery("Channel");e.rowCount=1;const t=new i.FilterGroup;return t.logicalOperation=i.LogicalOperatorType.Or,t.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnit:Operator].SysAdminUnit",this.userInfo.id),t.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnitRoleId:Operator].SysAdminUnit",this.userInfo.id),e.filters.add(t),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"IsActive",!0),this.queryExecutor.executeSelectQuery(e).pipe((0,_.map)(a=>a&&a.length>0||!1),(0,_.catchError)(()=>(0,c.of)(!1)))}hasUncompletedChats(e){const t=this._serviceUrl+"GetHasUncompletedChats";return this.httpClient.post(t,{channelId:e})}static{this.\u0275fac=function(t){return new(t||M)(n.\u0275\u0275inject(Y.RightsService),n.\u0275\u0275inject(O.QueryExecutor),n.\u0275\u0275inject(p.TranslateService),n.\u0275\u0275inject(w),n.\u0275\u0275inject(I.HttpClient),n.\u0275\u0275inject(l.UserInfo))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"root"})}}class x{constructor(e,t){this.httpClient=e,this.sysSettingsService=t,this._serviceUrl="/rest/FacebookOmnichannelMessagingService/",this._settingsCodes=["IdentityServerUrl"],this._sysSettingsValues={},this.sysSettingsService.getByCodes(this._settingsCodes).subscribe(a=>{const s=a&&a.success&&a.values&&(0,A.mapValues)(a.values||{},o=>o.value);s&&(this._sysSettingsValues=s)})}getApplicationId(){return this.httpClient.get(this._serviceUrl+"GetCurrentFacebookAppId")}getApiVersion(){return"v20.0"}getIdentityServerUrl(){return this._sysSettingsValues.IdentityServerUrl}getPageName(e,t){return this.httpClient.get(this._serviceUrl+`GetPageName?pageId=${e}&channelId=${t}`).pipe((0,c.map)(a=>JSON.parse(a).name),(0,c.take)(1))}static{this.\u0275fac=function(t){return new(t||x)(n.\u0275\u0275inject(I.HttpClient),n.\u0275\u0275inject(Y.SysSettingsService))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}class U{constructor(e,t){this._settingsService=e,this._window=t,this._permissions="pages_show_list,pages_messaging,pages_manage_metadata,business_management,pages_read_engagement",this._toSubscribeFields="messages,messaging_postbacks,message_echoes,standby,messaging_handovers",this._sdkUrl="https://connect.facebook.net/en_US/sdk.js"}_loadScript(e,t,a=null){const s=document.createElement("script");s.async=!0,s.src=e,s.onload=t,a||(a=document.head),a.appendChild(s)}_innerLogin(e=!1){const t={scope:this._permissions,return_scopes:!0};return e&&(t.auth_type="rerequest"),new c.Observable(a=>{FB.login(s=>{s.authResponse?a.next(!0):a.next(!1)},t)})}_getSubscribed(e,t){FB.api(`/me/subscribed_apps?access_token=${e}`,"GET",{},a=>{t(a?.data?.[0]?.subscribed_fields||[])})}isLoggedIn(){return new c.Observable(e=>{FB.getLoginStatus(t=>{t.status==="connected"?e.next(!0):e.next(!1)})})}login(){return this._innerLogin()}reLogin(){return this._innerLogin(!0)}getPages(){return new c.Observable(e=>{FB.api("me/accounts",t=>{e.next(t)})})}initialize(){return new c.Observable(e=>{this._loadScript(this._sdkUrl,()=>{this._settingsService.getApplicationId().subscribe(t=>{const a=t.replace(/\D+/g,"").trim();FB.init({appId:a,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:this._settingsService.getApiVersion()}),this.isInitialized=!0,e.next(!0)})})})}attachPage(e){return new c.Observable(t=>{this._getSubscribed(e,a=>{const s=(0,A.union)(a,this._toSubscribeFields.split(",")).join(",");FB.api(`/me/subscribed_apps?subscribed_fields=${s}&access_token=${e}`,"POST",{},o=>{t.next(o)})})})}isFacebookSettingValid(){return this._settingsService.getIdentityServerUrl()&&this._window.location.protocol==="https:"}static{this.\u0275fac=function(t){return new(t||U)(n.\u0275\u0275inject(x),n.\u0275\u0275inject("Window"))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac})}}var m=u(73308);class R{constructor(e,t,a){this._sysSettingsService=e,this._facebookSettingsService=t,this._window=a,this._permissions="pages_show_list,pages_messaging,pages_manage_metadata,business_management,pages_read_engagement",this._fieldsToSubscribe="messages,messaging_postbacks,message_echoes,standby,messaging_handovers",this._sdkUrl="https://connect.facebook.net/en_US/sdk.js"}get fbApiLibrary(){return this._window.FB||null}_initApi(e){console.log(`FB.init call for appId:${e}`),this.fbApiLibrary.init({appId:e,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:this._facebookSettingsService.getApiVersion()})}_getSubscribedApps(e){return new c.Observable(t=>{console.log(`FB.api call for path '/me/subscribed_apps?access_token=${e}'`),this.fbApiLibrary.api(`/me/subscribed_apps?access_token=${e}`,"GET",{},a=>{const s=a?.data?.[0]?.subscribed_fields||[];t.next(s),t.complete()})})}isFacebookSettingValid(){var e=this;return(0,m.A)(function*(){return(yield(0,c.firstValueFrom)(e._sysSettingsService.getValueByCode("IdentityServerUrl")))&&e._window.location.protocol==="https:"})()}initApi(){return this.fbApiLibrary?(0,c.of)(!0):this.loadLibrary().pipe((0,c.concatMap)(()=>this._facebookSettingsService.getApplicationId()),(0,c.concatMap)(e=>{const t=e.replace(/\D+/g,"").trim();return this._initApi(t),(0,c.of)(!0)}))}loadLibrary(){return new c.Observable(e=>{console.log("Loading FB SDK...");const t=document.createElement("script");t.src=this._sdkUrl,t.onload=()=>{console.log("FB SDK loaded"),e.next(),e.complete()},t.onerror=a=>{e.error(a)},document.body.appendChild(t)})}login(){const e={scope:this._permissions,return_scopes:!0,auth_type:"rerequest"};return new c.Observable(t=>{console.log("FB.login call"),this.fbApiLibrary.login(a=>{a.authResponse&&a.status==="connected"&&(t.next(),t.complete())},e)})}getPages(){return new c.Observable(e=>{console.log("FB.api call for path 'me/accounts'"),this.fbApiLibrary.api("me/accounts",t=>{const a=[];t.data.forEach(s=>{a.push({id:s.id,name:s.name,token:s.access_token})}),e.next(a),e.complete()})})}subscribeApps(e,t){return new c.Observable(a=>{console.log(`FB.api call for path '/me/subscribed_apps?subscribed_fields=${t}&access_token=${e}'`),this.fbApiLibrary.api(`/me/subscribed_apps?subscribed_fields=${t}&access_token=${e}`,"POST",{},s=>{a.next(!!s),a.complete()})})}attachPage(e){return this._getSubscribedApps(e).pipe((0,c.concatMap)(t=>{const a=(0,A.union)(t,this._fieldsToSubscribe.split(",")).join(",");return this.subscribeApps(e,a)}))}static{this.\u0275fac=function(t){return new(t||R)(n.\u0275\u0275inject(Y.SysSettingsService),n.\u0275\u0275inject(x),n.\u0275\u0275inject("Window"))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac})}}class F{constructor(e){this.httpClient=e,this._serviceUrl="/rest/TelegramOmnichannelMessagingService/"}registerTelegramChannel(e){const t=this._serviceUrl+"RegisterChannel";return this.httpClient.post(t,{token:e})}validateRegisterChannel(e){return[{condition:!e.IsTokenValid,message:"ChatSettings.ChannelPage.Telegram.InvalidTelegramToken"},{condition:e.IsTokenExist,message:"ChatSettings.ChannelPage.Telegram.TelegramTokenAlreadyExists"},{condition:e.IsActiveWebhook,message:"ChatSettings.ChannelPage.Telegram.ActiveWebhookErrorMessageForCreating"}].find(a=>a.condition)?.message||""}getTelegramUserName(e){const t=this._serviceUrl+"GetUserName";return this.httpClient.post(t,{settingsId:e})}removeTelegramChannel(e){const t=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),a=this._serviceUrl+"RemoveChannel";return this.httpClient.post(a,{telegramId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||F)(n.\u0275\u0275inject(I.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac,providedIn:"root"})}}class H{constructor(e){this.httpClient=e,this._serviceUrl="/rest/FacebookOmnichannelMessagingService/"}registerFacebookChannel(e,t){const a=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"Register";return this.httpClient.post(s,{token:e,source:t},{headers:a})}removeFacebookChannel(e){const t=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),a=this._serviceUrl+"RemoveChannel";return this.httpClient.post(a,{facebookId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||H)(n.\u0275\u0275inject(I.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac,providedIn:"root"})}}class V{wrapPhoneNumber(e){return`+${e}`}getRequestData(e,t,a){return{token:e,appId:t,channelPhoneNumber:this.wrapPhoneNumber(a)}}constructor(e){this.httpClient=e,this._serviceUrl="/rest/WhatsAppOmnichannelMessagingService/"}tryConnect(e,t,a){const s=this._serviceUrl+"Validate";return this.httpClient.post(s,this.getRequestData(e,t,a))}register(e,t,a){const s=this._serviceUrl+"RegisterChannel";return this.httpClient.post(s,this.getRequestData(e,t,a))}validateRegisterChannel(e){let t="";if(!e?.IsConnectionSuccess&&e?.errorInfo?.errorCode){const a=e.errorInfo.errorCode;["InvalidAppSidException","InvalidAccountPhoneNumberException","AuthenticateException"].indexOf(a)>-1?t=`ChatSettings.ChannelPage.WhatsApp.ErrorMessages.${a}`:t=e.errorInfo.message}return t}removeWhatsAppChannel(e){const t=new I.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),a=this._serviceUrl+"RemoveChannel";return this.httpClient.post(a,{whatsAppId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||V)(n.\u0275\u0275inject(I.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac,providedIn:"root"})}}class W extends O.BaseEntityService{constructor(e,t,a){super(e,t,a),this.entitySchemaName="ChatQueueOperator"}mapSysAdminUnit(e){return{id:e.Id,name:e.Name,parentRoleId:e.ParentRole&&e.ParentRole.value,sysAdminUnitTypeValue:e.SysAdminUnitTypeValue}}addSysAdminUnitQueryFilters(e){const t=new i.FilterGroup;t.logicalOperation=i.LogicalOperatorType.Or,t.addSchemaColumnFilterWithParameter(i.ComparisonType.Not_equal,"SysAdminUnitTypeValue",4),t.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"Active",1),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ConnectionType",0),e.filters.add(t)}getSysAdminUnitQuery(){const e=new i.EntitySchemaQuery("SysAdminUnit");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name"),e.addSchemaColumn("ParentRole"),e.addSchemaColumn("SysAdminUnitTypeValue"),e.addSchemaColumn("ConnectionType"),e.addSchemaColumn("Active"),this.addSysAdminUnitQueryFilters(e),e}getItemsByChatQueueId(e){const t=this.createGetAllItemsEsq();return t.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"ChatQueue",e),this.queryExecutor.executeSelectQuery(t).pipe((0,_.map)(a=>({success:!0,errorInfo:null,result:a.map(s=>this.entityConverter.getEntity(s))})),(0,_.catchError)(a=>this.getBaseErrorResponse(a)))}getSysAdminUnitList(){const e=this.getSysAdminUnitQuery();return this.queryExecutor.executeSelectQuery(e).pipe((0,_.map)(t=>({success:!0,errorInfo:null,sysAdminUnits:t.map(a=>this.mapSysAdminUnit(a))})))}static{this.\u0275fac=function(t){return new(t||W)(n.\u0275\u0275inject(O.QueryExecutor),n.\u0275\u0275inject(p.TranslateService),n.\u0275\u0275inject(j))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac})}}class P extends O.BaseEntityService{constructor(e,t,a){super(e,t,a),this.entitySchemaName="Channel"}_createNewChannel(e){const t=new me;return t.id=(0,i.generateGuid)(),t.typeId=e,t}getLookupValues(e){const t=new i.EntitySchemaQuery(e);return t.addSchemaColumn("Id"),t.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),this.queryExecutor.executeSelectQuery(t).pipe((0,_.map)(a=>a.map(s=>({value:s.Id,displayValue:s.Name}))))}getChannelTypeItems(){const e=new i.EntitySchemaQuery("ChannelProvider");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),e.addSchemaColumn("PageUrl"),this.queryExecutor.executeSelectQuery(e).pipe((0,_.map)(t=>t.map(a=>({value:a.Id,displayValue:a.Name,pageUrl:a.PageUrl}))))}getChannelQueueItems(){const e=new i.EntitySchemaQuery("ChatQueue");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),e.addSchemaColumn("[ChatQueueOperator:ChatQueue].Id","Operator"),this.queryExecutor.executeSelectQuery(e).pipe((0,_.map)(t=>{const a=t.filter(o=>!!o.Operator);return a.filter((o,g)=>a.findIndex(h=>h.Id===o.Id)===g).map(o=>({value:o.Id,displayValue:o.Name}))}))}getActiveLanguages(){const e=new i.EntitySchemaQuery("SysLanguage");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(i.OrderDirection.Asc,0),e.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"IsUsed",1),this.queryExecutor.executeSelectQuery(e).pipe((0,_.map)(t=>t.map(a=>({value:a.Id,displayValue:a.Name}))))}generateNewChannelResponse(e){return{success:!0,result:[this._createNewChannel(e)]}}checkCanSaveChannel(e,t,a){const s=new i.EntitySchemaQuery("Channel");s.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"Source",e),s.filters.addSchemaColumnFilterWithParameter(i.ComparisonType.Equal,"Provider",t),this.queryExecutor.executeSelectQuery(s).subscribe(o=>{a(!(o&&o[0]))})}static{this.\u0275fac=function(t){return new(t||P)(n.\u0275\u0275inject(O.QueryExecutor),n.\u0275\u0275inject(p.TranslateService),n.\u0275\u0275inject(E))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac})}}const xe=r=>({"bot-message":r}),be=r=>({display:r}),Ae=()=>({}),he=(r,e)=>({"first-in-sequence":r,"last-in-sequence":e}),Pe=(r,e)=>({width:r,height:e});function ke(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",2)(1,"span"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()),r&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(t.firstMessageDate)}}function De(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",10)(1,"span"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()),r&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(t.separatorText)}}function Te(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",11)(1,"label",12),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"ts-contact-photo",13),n.\u0275\u0275listener("contactClick",function(){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext().$implicit,o=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(o.openContact(s.author.id))}),n.\u0275\u0275elementEnd()()}if(r&2){const t=n.\u0275\u0275nextContext().$implicit,a=n.\u0275\u0275nextContext();n.\u0275\u0275property("hidden",!a.isContactChanged(t)),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",t.isBotMessage?a.bot.name:t.author.name," "),n.\u0275\u0275advance(),n.\u0275\u0275property("contact",t.isBotMessage?n.\u0275\u0275pureFunction0(4,Ae):t.author)("contactColor",a.getContactBackground(t))}}function Ne(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",14)(1,"span"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()),r&2){const t=n.\u0275\u0275nextContext().$implicit,a=n.\u0275\u0275nextContext();n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(a.formatSystemMessage(t))}}function Oe(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",15)(1,"span",16),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"span",17),n.\u0275\u0275text(4),n.\u0275\u0275elementEnd()()),r&2){const t=n.\u0275\u0275nextContext().$implicit,a=n.\u0275\u0275nextContext();n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction2(3,he,a.isFirstMessageInSequence(t),a.isLastMessageInSequence(t))),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(t.text),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(a.getLocalTime(t.time))}}function we(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",24)(1,"img",25),n.\u0275\u0275listener("click",function(s){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(4);return n.\u0275\u0275resetView(o.openImage(s))})("load",function(s){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext(4);return n.\u0275\u0275resetView(o.onChatImgLoaded(s))}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(2,"span",26),n.\u0275\u0275text(3),n.\u0275\u0275elementEnd()()}if(r&2){const t=n.\u0275\u0275nextContext().$implicit,a=n.\u0275\u0275nextContext(2).$implicit,s=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("ngStyle",n.\u0275\u0275pureFunction2(3,Pe,s.imageContainerSize.width+"px",s.imageContainerSize.height+"px"))("src",s.getImageUrl(t.fileId),n.\u0275\u0275sanitizeUrl),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(s.getLocalTime(a.time))}}function je(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",27)(1,"span",28)(2,"a",29),n.\u0275\u0275text(3),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(4,"span",17),n.\u0275\u0275text(5),n.\u0275\u0275elementEnd()()),r&2){const t=n.\u0275\u0275nextContext().$implicit,a=n.\u0275\u0275nextContext(2).$implicit,s=n.\u0275\u0275nextContext();n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction2(4,he,s.isFirstMessageInSequence(a),s.isLastMessageInSequence(a))),n.\u0275\u0275advance(2),n.\u0275\u0275property("href",s.getFileUrl(t.fileId),n.\u0275\u0275sanitizeUrl),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate(t.fileName),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(s.getLocalTime(a.time))}}function Ee(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",21),n.\u0275\u0275template(1,we,4,6,"div",22)(2,je,6,7,"div",23),n.\u0275\u0275elementEnd()),r&2){const t=e.$implicit,a=n.\u0275\u0275nextContext(3);n.\u0275\u0275property("ngSwitch",t.fileType),n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitchCase",a.messageType.Image)}}function Re(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",30)(1,"span",16),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"span",17),n.\u0275\u0275text(4),n.\u0275\u0275elementEnd()()),r&2){const t=n.\u0275\u0275nextContext(2).$implicit,a=n.\u0275\u0275nextContext();n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(t.text),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(a.getLocalTime(t.time))}}function Fe(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",18),n.\u0275\u0275template(1,Ee,3,2,"div",19)(2,Re,5,2,"div",20),n.\u0275\u0275elementEnd()),r&2){const t=n.\u0275\u0275nextContext().$implicit,a=n.\u0275\u0275nextContext();n.\u0275\u0275advance(),n.\u0275\u0275property("ngForOf",t.attachments),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",a.showMessageFromAttachment(t))}}function Le(r,e){if(r&1&&(n.\u0275\u0275elementStart(0,"div",3),n.\u0275\u0275text(1),n.\u0275\u0275template(2,De,3,1,"div",4)(3,Te,4,5,"div",5),n.\u0275\u0275elementStart(4,"div",6),n.\u0275\u0275template(5,Ne,3,1,"div",7)(6,Oe,5,6,"div",8)(7,Fe,3,2,"div",9),n.\u0275\u0275elementEnd()()),r&2){const t=e.$implicit,a=e.index,s=n.\u0275\u0275nextContext();n.\u0275\u0275classMap(s.getDirectionName(t.direction)+"-message"),n.\u0275\u0275propertyInterpolate1("id","message_",t.id,""),n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(12,xe,t.isBotMessage))("ngStyle",n.\u0275\u0275pureFunction1(14,be,s.getIsDuplicateMessage(t.id)?"none":"")),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate1(" ",s.cachePreviousMessage(a)," "),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",s.isShowSeparator(t,a)),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",!s.isSystemMessage(t)),n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitch",t.type),n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitchCase",s.messageType.System),n.\u0275\u0275advance(),n.\u0275\u0275property("ngSwitchCase",s.messageType.Text)}}class v{constructor(e,t,a,s,o){this._userInfo=e,this._translateService=t,this.injector=a,this._contactColorService=s,this.featureService=o,this._omnichannelMessageFileSchema={name:"OmnichannelMessageFile",uid:"E6B4C4D4-0A51-4A6D-A8C5-18B63FADDAD4"},this._isFileApiEnabled=!1,this._fileServiceUrl=`rest/FileService/GetFile/${this._omnichannelMessageFileSchema.uid}/`,this._imageUrl=`img/entity/hash/${this._omnichannelMessageFileSchema.name}/Data/`,this._duplicateIds=[],this.messagesCounter=0,this.contactClick=new n.EventEmitter,this.messageType=N,this.bot={name:this._translateService.instant("ChatSettings.ChatWindow.Bots.Name")||"Creatio.ai"},this.imageContainerSize={width:200,height:120},this.lastSystemMessageIndex=0,this.featureService.getFeatureState("UseFileApiInChats").pipe((0,c.shareReplay)({bufferSize:1,refCount:!1})).subscribe(g=>this._isFileApiEnabled=g)}set messages(e){this._messages=e,e&&this._findDuplicateMessagesWithoutAttachments(),this._setLastSystemMessageIndex()}get messages(){return this._messages}static _trimSlashes(e){return e.replace(/(^([/\\])+)|(([/\\])+$)/,"")}static _isLargeImage(e,t){return e.naturalWidth>=t.offsetWidth||e.naturalHeight>=t.offsetHeight}_isNewDay(e){return this._previousMessage&&this._previousMessage.time&&e.time&&this._previousMessage.time.getDay()!==e.time.getDay()}_isNewMessages(e){const t=this.messages.length-this.messagesCounter;return e===t&&t>0}_formatDate(e){return new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName).format(e)}_joinPath(...e){return e.map(t=>v._trimSlashes(t)).join("/")}_setFirstMessageData(){if(this.messages?.length>0){const e=this.messages.find(t=>t.direction===Z.Incoming);if(!e)return;this.firstMessageDate=this._formatDate(e.time),this.contactColor=this._contactColorService.getNextColor(e.author.id)}}_setLastSystemMessageIndex(){this._messages&&(this._messages.length<M.rowsCount?this.lastSystemMessageIndex=0:this._messages.length===M.rowsCount?this.lastSystemMessageIndex=M.rowsCount-1:this.lastSystemMessageIndex=fe().findLastIndex(this._messages,e=>e.type===N.System)+1)}_isAuthorChanged(e,t){return e.author.id!==t.author.id||this.isSystemMessage(t)}_findDuplicateMessagesWithoutAttachments(){const e=this.messages.reduce((s,o)=>{const{text:g,time:h}=o,D=`${g}-${h}`;return s[D]||(s[D]=[]),s[D].push(o),s},{}),a=Object.values(e).flat().filter(s=>{const{text:o,time:g}=s,D=e[`${o}-${g}`].some(B=>!(0,A.isEmpty)(B.attachments));return(0,A.isEmpty)(s.attachments)&&D});this._duplicateIds=a.map(s=>s.id)}getDirectionName(e){return Z[e].toLowerCase()}getContactBackground(e){return e.isBotMessage?"none":e.direction===1?this.contactColor:"#40bf62"}isContactChanged(e){return this._previousMessage?this._previousMessage.author.id!==e.author.id||this._previousMessage.isBotMessage!==e.isBotMessage||this._previousMessage.type===N.System:!0}ngOnChanges(){this._setFirstMessageData()}cachePreviousMessage(e){this._previousMessage=e>0?this.messages[e-1]:void 0}openContact(e){return this.contactClick.emit({contactId:e}),!1}trackMessageById(e,t){return t.id}isShowSeparator(e,t){return this._isNewDay(e)?this.separatorText=this._formatDate(e.time):this.separatorText=this._isNewMessages(t)?this._translateService.instant("ChatSettings.ChatWindow.NewMessages"):"",this.separatorText!==""}openImage(e){const t=e.target,a=document.body,s=document.createElement("div");s.classList.add("full-chat-image-container"),s.style.backgroundImage="url('"+t.src+"')",s.style.backgroundSize=v._isLargeImage(t,a)?"contain":"auto",s.addEventListener("click",function(){a.removeChild(s)}),a.appendChild(s)}getFileUrl(e){return this._joinPath((0,l.getWorkspaceBaseUrl)(),this._fileServiceUrl,e)}getImageUrl(e){return this._isFileApiEnabled?this.getFileUrl(e):this._joinPath((0,l.getWorkspaceBaseUrl)(),this._imageUrl,e)}isFirstMessageInSequence(e){const t=this.messages.findIndex(s=>s.id===e.id);if(t===0)return!0;const a=this.messages[t-1];return this._isAuthorChanged(e,a)}isLastMessageInSequence(e){const t=this.messages.findIndex(s=>s.id===e.id);if(t===this.messages.length-1)return!0;const a=this.messages[t+1];return this._isAuthorChanged(e,a)}isSystemMessage(e){return e.type===N.System}onChatImgLoaded(e){const t=e.target;this.isImageOversize(t.width,t.height)&&t.parentElement.classList.add("img-contain")}isImageOversize(e,t){const a=e/t,s=this.imageContainerSize.width/this.imageContainerSize.height;return Math.max(a,s)/Math.min(a,s)<=2&&e>this.imageContainerSize.width&&t>this.imageContainerSize.height}formatSystemMessage(e){const t=new Date(e.time);(0,l.setTimeZoneOffset)(t,this._userInfo.timeZoneOffsetHours);const a=this._formatDate(t),s=(0,l.getUserCultureTimeFormat)(t,this._userInfo.cultureInfo);return e.text.replace("{datePart}",a).replace("{timePart}",s)}getLocalTime(e){const t=new Date(e);return(0,l.setTimeZoneOffset)(t,this._userInfo.timeZoneOffsetHours),(0,l.getUserCultureTimeFormat)(t,this._userInfo.cultureInfo)}showMessageFromAttachment(e){return e.text}getIsDuplicateMessage(e){return this.messages?this._duplicateIds.indexOf(e)!==-1:!1}static{this.\u0275fac=function(t){return new(t||v)(n.\u0275\u0275directiveInject(l.UserInfo),n.\u0275\u0275directiveInject(p.TranslateService),n.\u0275\u0275directiveInject(n.Injector),n.\u0275\u0275directiveInject(l.ContactColorService),n.\u0275\u0275directiveInject(Y.FeatureService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:v,selectors:[["crt-chat-messages"]],inputs:{messages:"messages",messagesCounter:"messagesCounter",chat:"chat"},outputs:{contactClick:"contactClick"},features:[n.\u0275\u0275NgOnChangesFeature],decls:2,vars:3,consts:[["class","first-message-date-separator messages-separator",4,"ngIf"],["class","message",3,"class","id","ngClass","ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"first-message-date-separator","messages-separator"],[1,"message",3,"id","ngClass","ngStyle"],["class","messages-separator",4,"ngIf"],["class","message-author",3,"hidden",4,"ngIf"],[1,"text-block",3,"ngSwitch"],["class","system-message-type",4,"ngSwitchCase"],["class","message-type text-message-type",3,"ngClass",4,"ngSwitchCase"],["class","attachment-message-type",4,"ngSwitchDefault"],[1,"messages-separator"],[1,"message-author",3,"hidden"],[1,"author-name"],[1,"author-photo",3,"contactClick","contact","contactColor"],[1,"system-message-type"],[1,"message-type","text-message-type",3,"ngClass"],[1,"message-text"],[1,"message-time"],[1,"attachment-message-type"],[3,"ngSwitch",4,"ngFor","ngForOf"],["class","message-type text-message-type",4,"ngIf"],[3,"ngSwitch"],["class","message-type image-message-type",4,"ngSwitchCase"],["class","message-type file-message-type",3,"ngClass",4,"ngSwitchDefault"],[1,"message-type","image-message-type"],["alt","",1,"image-container",3,"click","load","ngStyle","src"],[1,"image-time"],[1,"message-type","file-message-type",3,"ngClass"],[1,"download-file","message-text"],[1,"file-message-type-link",3,"href"],[1,"message-type","text-message-type"]],template:function(t,a){t&1&&n.\u0275\u0275template(0,ke,3,1,"div",0)(1,Le,8,16,"div",1),t&2&&(n.\u0275\u0275property("ngIf",a.firstMessageDate),n.\u0275\u0275advance(),n.\u0275\u0275property("ngForOf",a.messages)("ngForTrackBy",a.trackMessageById))},dependencies:[y.NgClass,y.NgForOf,y.NgIf,y.NgStyle,y.NgSwitch,y.NgSwitchCase,y.NgSwitchDefault,C.ContactPhotoComponent],styles:[".message[_ngcontent-%COMP%]{flex-direction:column;display:flex}.message[_ngcontent-%COMP%]:last-child{animation:_ngcontent-%COMP%_fadein .5s ease 1 alternate}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}.message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{font-family:Open Sans,serif;font-size:11px;text-align:center;letter-spacing:0;color:#999;opacity:1;vertical-align:top}.message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;cursor:pointer}.message[_ngcontent-%COMP%]   .message-author[_ngcontent-%COMP%]{margin-bottom:-13px;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{display:block;position:relative;bottom:-3px;float:right;text-align:center;font-family:Open Sans,serif;letter-spacing:0;color:#999;opacity:1;padding-top:2px;font-size:11px;margin-left:13px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:3px;display:inline-block;padding:8px 10px;margin:1px 0 1px 39px;text-align:left}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{text-align:left;font-family:Open Sans,serif;font-size:15px;letter-spacing:0;color:#444;opacity:1;white-space:pre-wrap;word-break:break-word}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-time[_ngcontent-%COMP%]{position:absolute;right:18px;bottom:18px;color:#fff;background-color:#999;font-size:11px;border-radius:12px;padding-left:5px;padding-right:5px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .message-image-item[_ngcontent-%COMP%]{position:relative}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:auto;background-position:center;object-fit:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .system-message-type[_ngcontent-%COMP%]{font-size:11px;text-align:center;color:#999;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{padding-left:22px;text-decoration:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K);background-repeat:no-repeat;background-position:2px 5px}.message.incoming-message[_ngcontent-%COMP%]{text-align:left}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:0 16px 16px 0;padding-right:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.text-message-type[_ngcontent-%COMP%]{padding-left:14px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 16px 0}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:0 16px 16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#4e7bd8}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K)}.message.incoming-message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{float:left}.message.incoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-left:7px}.message.outcoming-message[_ngcontent-%COMP%]{text-align:right}.message.outcoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-right:7px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:16px 0 0 16px;padding-left:16px;padding-right:14px;margin-right:0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:16px 0 16px 16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#e5e8ee}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGRhdGEtbmFtZT0iQ29tcG9uZW50IDQ2OSDigJMgMSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBzdHlsZT0iIj48cmVjdCBpZD0iYmFja2dyb3VuZHJlY3QiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHg9IjAiIHk9IjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIvPgogIAogIAogIAogIAo8ZyBjbGFzcz0iY3VycmVudExheWVyIiBzdHlsZT0iIj48dGl0bGU+TGF5ZXIgMTwvdGl0bGU+PGcgaWQ9Ikdyb3VwXzc0OTIiIGRhdGEtbmFtZT0iR3JvdXAgNzQ5MiIgY2xhc3M9IiIgc3Ryb2tlPSIjZGFkYWRhIiBzdHJva2Utb3BhY2l0eT0iMSI+CiAgICA8cGF0aCBpZD0iUGF0aF82OTQ0IiBkYXRhLW5hbWU9IlBhdGggNjk0NCIgZD0iTTMuNSw3LjUwMDAwNzgxMjQ5OTk3MyBsNSw0LjUgbDUsLTQuNSAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2RhZGFkYSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjAuOCIgc3Ryb2tlLW9wYWNpdHk9IjEiLz4KICA8L2c+PGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIgeTI9IjAuNSIgeDI9IjguNSIgeDE9IjguNSIgY2xhc3M9IiIvPjxsaW5lIGRhdGEtbmFtZT0iTGluZSA3NzgiIHkxPSIxMS41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMC41IiB4Mj0iOC41IiB4MT0iOC41IiBjbGFzcz0iIiBpZD0ic3ZnXzEiLz48bGluZSBpZD0iTGluZV83NzkiIGRhdGEtbmFtZT0iTGluZSA3NzkiIHgyPSIxNC41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMTQuNDgxNzAxNzM5MTMyNDA0IiB5MT0iMTQuNDgxNzAxNzM5MTMyNDA0IiB4MT0iMi41IiBjbGFzcz0iIi8+PHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIGNsYXNzPSIiIHk9IjIuMTk3ODAyNTQzNjQwMTM2NyIgeD0iNTEuMDk4OTAzNjU2MDA1ODYiIHRyYW5zZm9ybT0icm90YXRlKC0xLjU5MTE0NTE1NzgxNDAyNTkgNTkuMDk4OTAzNjU2MDA2MDE2LDEwLjE5NzgwMjU0MzY0MDAzNCkgIi8+PC9nPjwvc3ZnPg==)}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo[_ngcontent-%COMP%]   .contact-photo.no-photo[_ngcontent-%COMP%]{font-size:12px!important}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]{display:inline-block;width:16px}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{line-height:1.6em;font-size:1em;width:16px;height:16px;min-width:16px;min-height:16px}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]{background:linear-gradient(#fafcfe,#fafcfe) padding-box,linear-gradient(to bottom right,#0077ff40,#8a1fe640,#f1255b40,#ff180040) border-box;border:1px solid transparent}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{color:#444}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#999}.message.bot-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9Ikljb24gfCBBSSBDb3BpbG90IC0gMTZ4MTYgfCBoZWF2eSI+CjxnIGlkPSJTdWJ0cmFjdCI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDBfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjwvZz4KPGcgaWQ9InNoYXBlIj4KPHBhdGggZD0iTTE2IDhMNyAxMS41TDguNSA4TDAgMkwxNiA4WiIgZmlsbD0idXJsKCNwYWludDJfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGQ9Ik0xNiA4TDcgMTEuNUw4LjUgOEwwIDJMMTYgOFoiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyKSIvPgo8L2c+CjwvZz4KPGRlZnM+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQwX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMTg3OTk3IC0wLjgyMjgyOSkgcm90YXRlKDcyLjA0NjgpIHNjYWxlKDM2LjYyNyAxNS43Mzc5KSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQxX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjM1OTE5IC01LjEpIHJvdGF0ZSg1My43Njk0KSBzY2FsZSgzNi45NDMyIDE2LjQ2NSkiPgo8c3RvcCBzdG9wLWNvbG9yPSIjMDgxQTJGIi8+CjxzdG9wIG9mZnNldD0iMC42MSIgc3RvcC1jb2xvcj0iIzhBMUZFNiIvPgo8c3RvcCBvZmZzZXQ9IjAuOTM1IiBzdG9wLWNvbG9yPSIjRjEyNTVCIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGMTgwMCIvPgo8L3JhZGlhbEdyYWRpZW50Pgo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50Ml9yYWRpYWxfNDc0N183ODEwMiIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgwLjIwMTQ3NCAxLjUxMTQ1KSByb3RhdGUoNTkuNjc5NCkgc2NhbGUoMjMuOTY2NiAxNS4zMDQzKSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjYgLTEuMDI4MTMpIHJvdGF0ZSgzNy4wOTQ1KSBzY2FsZSgyOS4zMzY1IDEzLjE5MzQpIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzA4MUEyRiIvPgo8c3RvcCBvZmZzZXQ9IjAuNjEiIHN0b3AtY29sb3I9IiM4QTFGRTYiLz4KPHN0b3Agb2Zmc2V0PSIwLjkzNSIgc3RvcC1jb2xvcj0iI0YxMjU1QiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGRjE4MDAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K)!important;background-size:16px 16px;cursor:default}.messages-separator[_ngcontent-%COMP%]{width:100%;text-align:center;border-bottom:1px solid #e3e6ec;line-height:.1em;margin:17px 0}.messages-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;letter-spacing:0;color:#999;opacity:1;font-family:Open Sans,serif;font-size:11px}.first-message-date-separator[_ngcontent-%COMP%]{border:none;margin-top:8px}.incoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#eaedf3;border:1px solid #e3e6ec;align-self:flex-start}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#006ce0;align-self:flex-end}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%], .outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fff}.text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{position:relative;background-color:#fff;border:none}.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-left:0}.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-right:0}"]})}}(0,d.__decorate)([(0,i.CrtInput)(),(0,d.__metadata)("design:type",Array),(0,d.__metadata)("design:paramtypes",[Array])],v.prototype,"messages",null),(0,d.__decorate)([(0,i.CrtInput)(),(0,d.__metadata)("design:type",Object)],v.prototype,"messagesCounter",void 0),(0,d.__decorate)([(0,i.CrtInput)(),(0,d.__metadata)("design:type",ue)],v.prototype,"chat",void 0),(0,d.__decorate)([(0,i.CrtOutput)(),(0,d.__metadata)("design:type",Object)],v.prototype,"contactClick",void 0);function ze(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",1)(1,"span",2),n.\u0275\u0275text(2),n.\u0275\u0275elementStart(3,"a",3),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(s.contactClicked(s.chat.operator.contact==null?null:s.chat.operator.contact.id))}),n.\u0275\u0275text(4),n.\u0275\u0275elementEnd()()()}if(r&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",t.getEndDateCaption(t.chat.completionDate)," "),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(t.chat.operator.contact==null?null:t.chat.operator.contact.name)}}function Ue(r,e){if(r&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div")(1,"div",1)(2,"span",2),n.\u0275\u0275text(3),n.\u0275\u0275elementStart(4,"a",3),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.contactClicked(s.chat.contact.id))}),n.\u0275\u0275text(5),n.\u0275\u0275elementEnd()()(),n.\u0275\u0275elementStart(6,"div",4)(7,"crt-chat-messages",5),n.\u0275\u0275twoWayListener("chatChange",function(s){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext();return n.\u0275\u0275twoWayBindingSet(o.chat,s)||(o.chat=s),n.\u0275\u0275resetView(s)}),n.\u0275\u0275elementEnd()(),n.\u0275\u0275template(8,ze,5,2,"div",6),n.\u0275\u0275elementEnd()}if(r&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",t.getStartDateCaption(t.chat.chatStartDate)," "),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(t.chat.contact.name),n.\u0275\u0275advance(2),n.\u0275\u0275property("messages",t.messages),n.\u0275\u0275twoWayProperty("chat",t.chat),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",t.isChatCompleted())}}class b{constructor(e,t,a){this.chatService=e,this._userInfo=t,this._translateService=a,this.contactClick=new n.EventEmitter,this.messagesLoaded=new n.EventEmitter}_loadHistory(){this.chatService.getChatHistory(this.chatId).pipe((0,c.tap)(e=>{e&&(this.messages=e,this._setChatInfo())})).subscribe()}_setChatInfo(){this.chatService.getItem(this.chatId).subscribe(e=>{e.success&&(this.chat=e.result[0],this.messagesLoaded.emit())})}getStartDateCaption(e){const t=this._translateService.instant("ChatSettings.History.Captions.StartDate");return ne.String.Format(t,this.formatChatDate(e))}getEndDateCaption(e){const t=this._translateService.instant("ChatSettings.History.Captions.EndDate");return ne.String.Format(t,this.formatChatDate(e))}formatChatDate(e){const t={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},a=e?new Date(e):new Date;return new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName,t).format(a)}ngOnInit(){(0,i.isEmptyGuid)(this.chatId)||this._loadHistory()}contactClicked(e){this.contactClick.emit({contactId:e})}isChatCompleted(){return this.chat.status.value===Q.Completed}static{this.\u0275fac=function(t){return new(t||b)(n.\u0275\u0275directiveInject(M),n.\u0275\u0275directiveInject(l.UserInfo),n.\u0275\u0275directiveInject(p.TranslateService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:b,selectors:[["crt-omnichannel-messaging-chat-history"]],inputs:{chatId:[n.\u0275\u0275InputFlags.None,"chatid","chatId"]},outputs:{contactClick:"contactClick",messagesLoaded:"messagesLoaded"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"chat-status-info-container"],[1,"chat-date"],[1,"contact-name",3,"click"],[1,"chat-history-component-container"],[3,"chatChange","messages","chat"],["class","chat-status-info-container",4,"ngIf"]],template:function(t,a){t&1&&n.\u0275\u0275template(0,Ue,9,5,"div",0),t&2&&n.\u0275\u0275property("ngIf",a.chat)},dependencies:[y.NgIf,v],styles:[`.chat-date{color:#999;font-size:13px;font-family:Open Sans,serif}.chat-history-component-container{margin-bottom:19px}.contact-name{font-size:13px;color:#4e7bd8;cursor:pointer}.contact-name:hover{text-decoration:underline}.full-chat-image-container{top:0;width:100%;height:100%;z-index:999999999999;position:fixed;align-items:center;background-position:center;background-repeat:no-repeat;background-color:#000000b3}
`],encapsulation:2})}}(0,d.__decorate)([(0,i.CrtInput)(),(0,d.__metadata)("design:type",ne.String)],b.prototype,"chatId",void 0),(0,d.__decorate)([(0,i.CrtOutput)(),(0,d.__metadata)("design:type",Object)],b.prototype,"contactClick",void 0),(0,d.__decorate)([(0,i.CrtOutput)(),(0,d.__metadata)("design:type",Object)],b.prototype,"messagesLoaded",void 0);var He=u(33e3);class L{constructor(e){this._academyService=e,this.academyUrl$=new c.BehaviorSubject("")}ngOnInit(){this._academyService.getAcademyHelpUrl("ChatAccess").pipe((0,c.take)(1)).subscribe(e=>{this.academyUrl$.next(e)})}static{this.\u0275fac=function(t){return new(t||L)(n.\u0275\u0275directiveInject(He.AcademyService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:L,selectors:[["ts-facebook-channel-error-dialog"]],decls:12,vars:12,consts:[["mat-dialog-content",""],[1,"message"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,a){t&1&&(n.\u0275\u0275elementStart(0,"div",0)(1,"span",1),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementStart(4,"a",2),n.\u0275\u0275pipe(5,"async"),n.\u0275\u0275text(6),n.\u0275\u0275pipe(7,"translate"),n.\u0275\u0275elementEnd()()(),n.\u0275\u0275elementStart(8,"div",3)(9,"button",4),n.\u0275\u0275text(10),n.\u0275\u0275pipe(11,"translate"),n.\u0275\u0275elementEnd()()),t&2&&(n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(3,4,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Message")," "),n.\u0275\u0275advance(2),n.\u0275\u0275propertyInterpolate("href",n.\u0275\u0275pipeBind1(5,6,a.academyUrl$),n.\u0275\u0275sanitizeUrl),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(7,8,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Link.Text")," "),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(11,10,"InfoDialog.OK")," "))},dependencies:[T.MatLegacyButton,S.MatLegacyDialogClose,S.MatLegacyDialogContent,S.MatLegacyDialogActions,y.AsyncPipe,p.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{float:right;margin-left:auto;border-radius:4px}"]})}}let se=class extends i.BaseRequestHandler{constructor(e){super(),this._facebookProvider=e}handle(e){return this._facebookProvider.initialize().pipe((0,c.take)(1)).subscribe(),this.next?.handle(e)}};se=(0,d.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.OpenFacebookIntegrationPageRequest",type:"crt.OpenFacebookIntegrationPageHandler"}),(0,d.__metadata)("design:paramtypes",[U])],se);const k={OK:{key:"OK",config:{color:"primary",caption:"Dialog.Ok"}},YES:{key:"YES",config:{color:"primary",caption:"Dialog.Yes"}},NO:{key:"NO",config:{color:"default",caption:"Dialog.No"}}};let q=class extends i.BaseRequestHandler{constructor(e,t,a,s){super(),this._telegramService=e,this._messageDialogProvider=t,this._translateService=a,this._maskService=s}_setModelValue(e,t,a,s){const o=e.getViewModelAttributePaths(t,a)[0];e[o]=s}_setModelValues(e,t){var a=this;return(0,m.A)(function*(){const s=yield e.getPrimaryModelName();a._setModelValue(e,s,"Name",t.ChannelName),a._setModelValue(e,s,"Source",t.TelegramId),a._setModelValue(e,s,"MsgSettingsId",t.SettingsId)})()}handle(e){var t=this;return(0,m.A)(function*(){const a=e.$context,s=yield a.validate();if(Object.keys(s).length>0)return;yield t._maskService.showBodyMask();const o=yield a.TelegramToken,g=yield(0,c.firstValueFrom)(t._telegramService.registerTelegramChannel(o)),h=t._telegramService.validateRegisterChannel(g);if(yield t._maskService.hideBodyMask(),h?.length>0)t._messageDialogProvider.open({data:{message:t._translateService.instant(h),actions:[k.OK]}});else return yield t._setModelValues(a,g),t.next?.handle(e)})()}};q=(0,d.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.TelegramChannelSaveHandler",scopes:["TelegramChannel_AddingPage"]}),(0,d.__metadata)("design:paramtypes",[F,C.MessageDialogProviderAbstract,p.TranslateService,i.MaskService])],q);let J=class extends i.BaseRequestHandler{constructor(e,t,a,s,o,g){super(),this._facebookApiProvider=e,this._channelService=t,this._facebookRegistrationService=a,this._maskService=s,this._dialogProvider=o,this._messageDialogProvider=g}_isCreateFacebookChannelRequest(e){return e.entityName==="Channel"&&this._getDefaultValue(e,"Provider")===f.FacebookMessenger}_getDefaultValue(e,t){return e.defaultValues.find(a=>a.attributeName===t)?.value}_getChannel(e){return{id:(0,i.generateGuid)(),name:e.name,typeId:f.FacebookMessenger,source:e.id,isActive:!1}}_addFacebookMessengerChannels(e){var t=this;return(0,m.A)(function*(){if(!(yield t._facebookApiProvider.isFacebookSettingValid())){yield(0,c.firstValueFrom)(t._dialogProvider.open(L,{panelClass:["crt-message-dialog"]}));return}t.initFacebookPages().pipe((0,c.concatMap)(a=>(0,c.from)(a)),(0,c.concatMap)(a=>t._facebookApiProvider.attachPage(a.token).pipe((0,c.concatMap)(()=>{const s=t._getChannel(a);return t._maskService.showBodyMask(),t._facebookRegistrationService.registerFacebookChannel(a.token,a.id).pipe((0,c.concatMap)(o=>o?.success?(s.msgSettingsId=o.SettingsId,s.id=(0,i.generateGuid)(),s.isActive=!0,(0,c.from)(t._channelService.insertItem(s)).pipe((0,c.concatMap)(()=>t._openChannelEditingPage(e,a.id,a.name,s.id)))):(t._messageDialogProvider.open({data:{message:o?.errorInfo?.message||"An unknown error occurred during the operation.",actions:[k.OK]}}),c.EMPTY)))})))).subscribe(()=>{console.log("FB channel connected")},null,()=>{(0,c.from)(t._reloadChannelsList(e)),t._maskService.hideBodyMask()})})()}_reloadChannelsList(e){return(0,m.A)(function*(){const{$context:t,scopes:a}=e,s=e.$context.models.find(g=>g.dataSource.initialConfig.entitySchemaName==="Channel"),o={type:"crt.LoadDataRequest",scopes:a,config:{loadType:i.DataSourceLoadType.Reload},$context:t,dataSourceName:s.dataSource.dataSourceName};yield i.HandlerChainService.instance.process(o)})()}_openChannelEditingPage(e,t,a,s){return(0,m.A)(function*(){const o=e.$context;yield o.executeRequest({type:"crt.OpenPageRequest",schemaName:"FBMessengerChannel_EditPage",modelInitConfigs:[{recordId:s,action:i.ModelInPageAction.Edit}],$context:o})})()}initFacebookPages(){return this._facebookApiProvider.initApi().pipe((0,c.concatMap)(()=>this._facebookApiProvider.login()),(0,c.concatMap)(()=>this._facebookApiProvider.getPages()))}handle(e){var t=this;return(0,m.A)(function*(){if(!t._isCreateFacebookChannelRequest(e))return t.next?.handle(e);yield t._addFacebookMessengerChannels(e)})()}};J=(0,d.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.FacebookChannelCreateRecordHandler",scopes:["ChatSettingsPage"]}),(0,d.__metadata)("design:paramtypes",[R,P,H,i.MaskService,C.DialogProviderAbstract,C.MessageDialogProviderAbstract])],J);let X=class extends i.BaseRequestHandler{constructor(e,t,a,s,o){super(),this._whatsAppService=e,this._channelService=t,this._messageDialogProvider=a,this._translateService=s,this._maskService=o}_handleConnectError(e){if(e?.errorInfo?.errorCode){const t=this._whatsAppService.validateRegisterChannel(e);this._messageDialogProvider.open({data:{message:this._translateService.instant(t),actions:[k.OK]}})}}_getDigits(e){return e.replace(/\D+/g,"")}_setModelValue(e,t,a,s){const o=e.getViewModelAttributePaths(t,a)[0];e[o]=s}_setModelValues(e,t,a){var s=this;return(0,m.A)(function*(){const o=yield e.getPrimaryModelName();s._setModelValue(e,o,"MsgSettingsId",t.SettingsId),s._setModelValue(e,o,"Source",a),s._setModelValue(e,o,"Name",a)})()}handle(e){var t=this;return(0,m.A)(function*(){const a=e.$context,s=yield a.validate();if(Object.keys(s).length>0)return;yield t._maskService.showBodyMask();const o=yield a.TwilioToken,g=yield a.ApplicationId,h=t._getDigits(yield a.PhoneNumber);if(yield(0,c.firstValueFrom)(t.validateIntegration(h,o,g))){const B=yield(0,c.firstValueFrom)(t._whatsAppService.register(o,g,h)),Ce=t._whatsAppService.validateRegisterChannel(B);if(yield t._maskService.hideBodyMask(),Ce?.length>0)t._messageDialogProvider.open({data:{message:t._translateService.instant(Ce),actions:[k.OK]}});else return yield t._setModelValues(e.$context,B,h),t.next?.handle(e)}})()}validateIntegration(e,t,a){return new c.Observable(s=>{this._channelService.checkCanSaveChannel(e,f.WhatsApp,o=>{o?this._whatsAppService.tryConnect(t,a,e).subscribe(g=>{g?.IsConnectionSuccess?s.next(!0):(this._maskService.hideBodyMask(),this._handleConnectError(g),s.next(!1)),s.complete()}):(this._maskService.hideBodyMask(),this._messageDialogProvider.open({data:{message:this._translateService.instant("ChatSettings.ChannelPage.WhatsApp.ChannelDuplicatedErrorMessage"),actions:[k.OK]}}),s.next(!1),s.complete())})})}};X=(0,d.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.WhatsAppSaveChannelHandler",scopes:["WhatsAppChannel_AddingPage"]}),(0,d.__metadata)("design:paramtypes",[V,P,C.MessageDialogProviderAbstract,p.TranslateService,i.MaskService])],X);var Ve=u(59564),pe=u(10850);class We extends pe.CreateRecordRequest{}let $=class extends i.BaseRequestHandler{constructor(e,t,a){super(),this.dialogService=e,this.queryExecutor=t,this.translateService=a,this._dataSourceName="QueueAgentsListDS"}_getEntityName(e){return e.$context.dataSchemas[this._dataSourceName]?.dataSourceConfig?.config?.entitySchemaName}_getInsertQuery(e,t){var a=this;return(0,m.A)(function*(){const s=a._getEntityName(e),o=new i.InsertQuery(s);return[{path:"Operator",value:t,type:i.DataValueType.Guid},{path:"ChatQueue",value:yield e.$context.Id,type:i.DataValueType.Guid}].forEach(h=>{o.addColumn(h.path,h.value,h.type)}),o})()}_createDuplicationsValidator(e){return t=>{const a=e.find(s=>s.attributes.QueueAgentsListDS_Operator.value===t.id);return{success:(0,A.isEmpty)(a),message:this.translateService.instant("ChatSettings.ChatQueueOperatorDetail.DuplicationMessage")}}}_saveViewModel(e){return(0,m.A)(function*(){const{$context:t,scopes:a}=e,s={type:"crt.SaveRecordRequest",preventCardClose:!0,scopes:a,$context:t};return yield i.HandlerChainService.instance.process(s)})()}_reloadAgentDetail(e){return(0,m.A)(function*(){const t=e.$context,a=yield t.getPrimaryModelName(),s=yield t.getPrimaryDataSchema(),o={type:"crt.LoadDataRequest",config:{loadType:i.DataSourceLoadType.Reload},$context:t,parameters:[{type:"primaryColumnValue",value:s.primaryAttributeName}],dataSourceName:a};yield i.HandlerChainService.instance.process(o)})()}handle(e){var t=this;return(0,m.A)(function*(){if(e.$context.PrimaryModelMode===l.ModelMode.Create&&!(yield t._saveViewModel(e)))return;const s=yield e.$context.QueueAgentsList,o=yield(0,c.lastValueFrom)(t.dialogService.open(C.SelectSysAdminUnitDialogComponent,{data:{validator:t._createDuplicationsValidator(s)}}));if(o?.id){const g=yield t._getInsertQuery(e,o.id),h=t.queryExecutor.executeInsertQuery(g);yield(0,c.lastValueFrom)(h),yield t._reloadAgentDetail(e)}yield t.next?.handle(e)})()}};$=(0,d.__decorate)([(0,i.CrtRequestHandler)({type:"crt.CreateQueueAgentHandler",requestType:"crt.CreateQueueAgentHandlerRequest"}),(0,d.__metadata)("design:paramtypes",[Ve.DialogService,O.QueryExecutor,p.TranslateService])],$);let K=class extends i.BaseRequestHandler{constructor(e){super(),this.telegramService=e,this._telegramBotAttrName="TelegramBot"}_setTelegramBotLink(e,t){const a=`<a target='_blank' href='https://t.me/${e}'>${e}</a>`;t[this._telegramBotAttrName]=a}handle(e){var t=this;return(0,m.A)(function*(){const a=e.$context,s=a.getViewModelAttributePaths(yield a.getPrimaryModelName(),"MsgSettingsId")[0],o=yield a[s],g=yield a[t._telegramBotAttrName];return o&&!g&&!t._getUserName$&&(t._getUserName$=t.telegramService.getTelegramUserName(o).subscribe(h=>{t._setTelegramBotLink(h,a),t._getUserName$.unsubscribe()})),yield t.next?.handle(e)})()}};K=(0,d.__decorate)([(0,i.CrtRequestHandler)({type:"crt.TelegramChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["TelegramChannel_EditPage"]}),(0,d.__metadata)("design:paramtypes",[F])],K);var Be=u(23958);let ee=class extends Be.CanOpenPageHandler{constructor(e){super(e)}getOperation(){return"CanManageChats"}};ee=(0,d.__decorate)([(0,i.CrtRequestHandler)({type:"crt.ChatSettingsPageInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["ChatSettingsPage"]}),(0,d.__metadata)("design:paramtypes",[n.Injector])],ee);let ie=class extends i.BaseRequestHandler{constructor(e,t,a,s){super(),this._chatService=e,this._maskService=t,this._messageDialogProvider=a,this._translateService=s,this._channelsListName="ChannelsList",this._activeChatsValidationErrorMsgCode="ChatSettings.Channel.ActiveChatsValidationError"}_validateForActiveChats(e){var t=this;return(0,m.A)(function*(){yield t._maskService.showBodyMask();const a=yield(0,c.lastValueFrom)(t._chatService.hasUncompletedChats(e));if(yield t._maskService.hideBodyMask(),a){const s=t._translateService.instant(t._activeChatsValidationErrorMsgCode);return t._messageDialogProvider.open({data:{message:s,actions:[k.OK]}}),!1}return!0})()}_isValid(e){return this._validateForActiveChats(e)}handle(e){var t=this;return(0,m.A)(function*(){if(e.itemsAttributeName===t._channelsListName){const a=e.recordId;if(!(yield t._isValid(a)))return}t.next?.handle(e)})()}};ie=(0,d.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.DeleteRecordRequest",type:"crt.ChanelDeleteRecordHandler",scopes:["ChatSettingsPage"]}),(0,d.__metadata)("design:paramtypes",[M,i.MaskService,C.MessageDialogProviderAbstract,p.TranslateService])],ie);let oe=class extends i.BaseRequestHandler{constructor(e){super(),this._translateService=e,this._channelsListAttribute="ChannelsList",this._validationImageAttribute="ValidationImage"}_getAttributeValue(e,t,a){const s=e.getViewModelAttributePaths(t,a);return!s||s.length===0?"":e.attributes[s[0]]}_setupValidationError(e,t,a,s){const o=this._getAttributeValue(e,t,"Name"),g=this._translateService.instant(`ChatSettings.ChannelPage.ErrorCodes.${a}`,{channelName:o});s.tooltip=g,e.set(this._validationImageAttribute,s)}_resetValidationError(e){e.set(this._validationImageAttribute,null)}_validateChannelRecord(e){var t=this;return(0,m.A)(function*(){const a=e.attributes[t._validationImageAttribute];if(!a)return;const s=yield e.getPrimaryModelName(),o=t._getAttributeValue(e,s,"ErrorCode");return o?t._setupValidationError(e,s,o,a):t._resetValidationError(e)})()}_subscribeViewModelEvents(e){var t=this;const a=new c.Subscription;a.add(e.events$.pipe((0,c.filter)(({type:s,payload:o})=>s===pe.ViewModelEventType.FinishLoadModelAttributes&&o&&o[this._channelsListAttribute])).subscribe({next:function(){var s=(0,m.A)(function*(){const o=e.attributes[t._channelsListAttribute];for(const g of o)yield t._validateChannelRecord(g)});return function(){return s.apply(this,arguments)}}(),complete:()=>{a.unsubscribe()}}))}handle(e){var t=this;return(0,m.A)(function*(){yield t.next?.handle(e),t._subscribeViewModelEvents(e.$context)})()}};oe=(0,d.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.HandleViewModelInitRequest",type:"crt.ChannelErrorValidationHandler",scopes:["ChatSettingsPage"]}),(0,d.__metadata)("design:paramtypes",[p.TranslateService])],oe);let re=class extends i.BaseRequestHandler{_setFacebookPageLink(e,t,a){const s=`<a target='_blank' href='https://facebook.com/${t}'>${e}</a>`;a[this._facebookPageLinkAttrName]=s}constructor(e){super(),this._facebookSettingsService=e,this._facebookPageLinkAttrName="FacebookLink"}handle(e){var t=this;return(0,m.A)(function*(){const a=e.$context,s=a.getViewModelAttributePaths(yield a.getPrimaryModelName(),"Source")[0],o=yield a[s],g=yield a[t._facebookPageLinkAttrName];if(o&&!g&&!t._pageRequested){t._pageRequested=!0;const h=a.getViewModelAttributePaths(yield a.getPrimaryModelName(),"Id")[0],D=yield a[h];t._getPageName$=t._facebookSettingsService.getPageName(o,D).subscribe(B=>{t._setFacebookPageLink(B,o,a),t._getPageName$.unsubscribe()})}return yield t.next?.handle(e)})()}};re=(0,d.__decorate)([(0,i.CrtRequestHandler)({type:"crt.FacebookChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["FBMessengerChannel_EditPage"]}),(0,d.__metadata)("design:paramtypes",[x])],re);let ce=class extends i.BaseRequestHandler{constructor(e,t,a){super(),this._messageDialogProvider=e,this._translateService=t,this._maskService=a}_savePrimaryData(e){var t=this;return(0,m.A)(function*(){const a={type:"crt.SavePrimaryDataRequest",$context:e.$context,scopes:e.scopes},s=yield t.handlerChain.process(a);return s.find(g=>g.success===!1)||s[0]})()}handle(e){var t=this;return(0,m.A)(function*(){const s=yield e.$context.validate();if(!(Object.keys(s).length>0)){yield t._maskService.showBodyMask();try{const o=yield t._savePrimaryData(e);if(!o.success)throw new Error(o.errorInfo);yield t.handlerChain.process({$context:e.$context,type:"crt.ClosePageRequest"})}catch(o){t._messageDialogProvider.open({data:{message:t._translateService.instant(o?.message),actions:[k.OK]}})}finally{t._maskService.hideBodyMask()}}})()}};ce=(0,d.__decorate)([(0,i.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.TelegramUpdateChannelHandler",scopes:["TelegramChannel_EditPage"]}),(0,d.__metadata)("design:paramtypes",[C.MessageDialogProviderAbstract,p.TranslateService,i.MaskService])],ce);let le=class extends i.BaseRequestHandler{constructor(){super(...arguments),this._whatsappAttrName="WhatsAppLink"}_setWhatsAppLink(e,t){const a=`<a target='_blank' href='https://wa.me/${e}'>${e}</a>`;t[this._whatsappAttrName]=a}handle(e){var t=this;return(0,m.A)(function*(){const a=e.$context,s=a.getViewModelAttributePaths(yield a.getPrimaryModelName(),"Source")[0],o=yield a[s],g=yield a[t._whatsappAttrName];return o&&!g&&t._setWhatsAppLink(o,a),yield t.next?.handle(e)})()}};le=(0,d.__decorate)([(0,i.CrtRequestHandler)({type:"crt.WhatsAppChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["WhatsAppChannel_EditPage"]})],le);let te=class de{static{this.\u0275fac=function(t){return new(t||de)}}static{this.\u0275mod=n.\u0275\u0275defineNgModule({type:de})}static{this.\u0275inj=n.\u0275\u0275defineInjector({providers:[P,E,M,w,R,x,j,l.USER_INFO_PROVIDER,{provide:C.RightManagementService,useClass:W}],imports:[y.CommonModule,C.ContactPhotoModule,z.FormsModule,I.HttpClientModule,p.TranslateModule,T.MatLegacyButtonModule,S.MatLegacyDialogModule]})}};te=(0,d.__decorate)([(0,i.CrtModule)({requestHandlers:[q,X,$,K,J,ie,oe,re,le,ee,ce]})],te),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(te,{declarations:[b,v,L],imports:[y.CommonModule,C.ContactPhotoModule,z.FormsModule,I.HttpClientModule,p.TranslateModule,T.MatLegacyButtonModule,S.MatLegacyDialogModule],exports:[b,v,L]})}()},73308:(_e,G,u)=>{u.d(G,{A:()=>y});function d(I,z,T,S,i,p,C){try{var l=I[p](C),n=l.value}catch(c){T(c);return}l.done?z(n):Promise.resolve(n).then(S,i)}function y(I){return function(){var z=this,T=arguments;return new Promise(function(S,i){var p=I.apply(z,T);function C(n){d(p,S,i,C,l,"next",n)}function l(n){d(p,S,i,C,l,"throw",n)}C(void 0)})}}}}]);
