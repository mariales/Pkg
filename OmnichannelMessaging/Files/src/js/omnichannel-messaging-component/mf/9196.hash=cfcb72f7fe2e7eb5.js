(self.webpackChunkapp_studio_enterprise_omnichannel_messaging=self.webpackChunkapp_studio_enterprise_omnichannel_messaging||[]).push([[9196],{49196:(A,p,l)=>{l.r(p),l.d(p,{NavigationUtils:()=>u,SchemaStructureUtils:()=>d,UITypePriority:()=>s});var c=l(73308),o=l(38495),m=l(28399),s;(function(y){y.Auto="auto",y.PreferFreedomUI="freedom-ui"})(s||(s={}));var P=l(23710);class h{static initialize(){P.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),P.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(e,t="",r="_"){const n=new RegExp(`^${t}`);return t+e.replace(n,"")+r+P.generate()}}h.initialize();class d{static getSchemaRequire(e){return new Promise(t=>{Terrasoft.require([e],r=>t(r))})}static isSchemaInheritedFrom(e,t){var r=this;return(0,c.A)(function*(){let n=Terrasoft.configuration.Structures[t];n||(yield r.getSchemaRequire(t),n=Terrasoft.configuration.Structures[t]);const a=n?.structureParent;return a?a===e||r.isSchemaInheritedFrom(e,a):!1})()}}class u{static{this._angularSchemaType=9}static get angularSchemaType(){return u._angularSchemaType}static{this._angularModules=["PageSchemaViewModule","CardSchemaViewModule","HomePage","Desktop","SectionSchemaViewModule"]}static _getTypeColumnName(e,t){return u.getEntityStructure(e,t??s.Auto)?.pages.find(a=>a.typeColumnName)?.typeColumnName}static _getTypeColumnValue(e){return(0,c.A)(function*(){const{entityName:t,typeColumnValue:r}=e;if(r)return r;const n=u._getTypeColumnName(t,e.uiTypePriority),a=u.getRecordLookupValue(e.recordId);return!n||!a?null:(yield(yield o.Model.create(t)).load({attributes:[n],parameters:[{type:o.ModelParameterType.Filter,value:new o.CompareFilter(o.ComparisonType.Equal,new o.ColumnExpression({columnPath:"Id"}),new o.ParameterExpression({value:a}))}]}))?.[0]?.[n]?.value})()}static _getModuleStructureBySectionSchema(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(t=>t.sectionSchema===e)}static _getSectionModuleName(e){return u._getModuleStructureBySectionSchema(e)?.sectionModule}static _getSectionEditPageModuleName(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(r=>r.cardSchema===e||r.pages?.some(n=>n.cardSchema===e))?.cardModule}static _getModuleName(e){return(0,c.A)(function*(){const t=u._getSectionModuleName(e)??u._getSectionEditPageModuleName(e);if(t)return t;if(yield d.isSchemaInheritedFrom("BasePageV2",e))return"CardModuleV2";switch(!0){case(yield d.isSchemaInheritedFrom("BaseHomePage",e)):return"HomePage";case(yield d.isSchemaInheritedFrom("BaseIntroPageSchema",e)):return"IntroPage";case(yield d.isSchemaInheritedFrom("BaseSectionV2",e)):return"SectionModuleV2";default:return"PageSchemaViewModule"}})()}static _getTypedPage(e,t){if(!t||t.length<=1)return;if(e.entityPageName){const n=t.find(a=>a.cardSchema===e.entityPageName);if(n)return n}let r=e.typeColumnValue;if(!r&&e.entityName){const a=u.getEntityStructure(e.entityName,e.uiTypePriority)?.attribute;if(a){const i=e.defaultValues?.find(g=>g.attributeName===a);r=i?.value?.value||i?.value}}if(r)return t.find(n=>n.UId===r)}static _getDefaultPages(e){return e?.filter(t=>u._isDefaultPage(t))}static _getNotTypedAddPage(e){return e?.find(t=>u._isAddPage(t)&&!t.UId)}static _getTypedAddPage(e){return e?.find(t=>u._isAddPage(t)&&t.UId)}static _getTypedDefaultPage(e){return e?.find(t=>u._isDefaultPage(t)&&t.UId)}static _getNotTypedDefaultPage(e){return e?.find(t=>u._isDefaultPage(t)&&!t.UId)}static _isDefaultPage(e){return e.isDefault||!e.actions}static _isAddPage(e){return e.actions?.add}static _getDefaultPage(e){const t=u.getEntityStructure(e.entityName,e.uiTypePriority);if(!t)return;const r=u._getDefaultPages(t.pages),a=u._getTypedPage(e,r)||u._getNotTypedDefaultPage(r);return!a&&t.pages?.length?(console.warn("Default page not found and random page is given instead. Please, check passed options."),t.pages[0]):a}static _getAddPage(e){const r=u.getEntityStructure(e.entityName,e.uiTypePriority)?.pages,n=u.getPagesForAddAction(r);if(n?.length<=1)return n?.[0];const a=u._getTypedPage(e,n);if(a)return a;const i=u._getNotTypedAddPage(r),g=u._getNotTypedDefaultPage(r);let f=i||g;return f||(console.warn("Add or default page not found and random page is given instead. Please, check options."),console.warn(e),f=r?.[0]),f}static _getEditPage(e){return u._getDefaultPage(e)}static _getGroupedTypedPages(e){const t={};for(const r of e){const{UId:n}=r;n&&(t[n]=t[n]??[],t[n].push(r))}return t}static _getModuleConfig(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(t=>t.cardSchema===e||t.sectionSchema===e||t.pages?.some(r=>r.cardSchema===e))}static getPagesForAddAction(e){if((0,m.isEmpty)(e))return[];const t=u._getGroupedTypedPages(e),r=u._getNotTypedAddPage(e),n=u._getNotTypedDefaultPage(e),a=Object.values(t).map(g=>{const f=u._getTypedAddPage(g);if(f)return f;const S=u._getTypedDefaultPage(g);return S&&r?{...r,...(0,m.pick)(S,["caption","captionLcz","UId"])}:r||S||n});if(!(0,m.isEmpty)(a))return a;const i=r||n;return i?[i]:[]}static getCardSchemaName(e){return e?.cardSchema??e?.cardSchemaName}static getEntityStructure(e,t=s.Auto){if(!e)return;let r;return t===s.PreferFreedomUI&&(r=Object.values(Terrasoft.configuration.EntityStructure).find(n=>n.page8X&&n.entitySchemaName===e)),r??Terrasoft.ModuleUtils.getEntityStructureByName(e)}static getRecordLookupValue(e){return typeof e=="string"?e:e?.value}static getPageForActionAsync(e){return(0,c.A)(function*(){const r={typeColumnValue:yield u._getTypeColumnValue(e),...e};return u.getPageForAction(r)})()}static getPageForAction(e){let t;return e.action===o.ModelInPageAction.Add?t=u._getAddPage(e):t=u._getEditPage(e),t||(t=u._getDefaultPage(e)),t}static getPageSchemaNameForAction(e){return(0,c.A)(function*(){if(e.entityPageName)return e.entityPageName;const t=yield u.getPageForActionAsync(e);return u.getCardSchemaName(t)})()}static isAngularSchema(e){return(0,c.A)(function*(){return yield d.getSchemaRequire(e),(yield d.getSchemaRequire(e+"Structure")).type===u._angularSchemaType})()}static generateChainModuleId(e){return h.generateUnique(e+"_chain")}static getValuePairs(e){return e&&e.map(t=>{let r,n;const a=t.value;return a?.value?(n=a.value,r=a.displayValue):n=a,{name:t.attributeName,value:n,displayValue:r}})}static getModuleName(e,t){return(0,c.A)(function*(){if(!e&&!t)throw new o.ArgumentEmptyException("schemaName");return e&&!t&&(t=yield u._getModuleName(e)),t})()}static getEditPageModuleName(e,t=s.Auto){return u.getEntityStructure(e,t)?.cardModuleName}static hasEntityEditPage(e){return(0,c.A)(function*(){return!!(yield u.getPageForActionAsync(e))})()}static isSectionEditPage(e){return!!u._getSectionEditPageModuleName(e)}static isAngularListPage(e){return(0,c.A)(function*(){return(yield u.isAngularSchema(e))?d.isSchemaInheritedFrom("BaseGridSectionTemplate",e):!1})()}static isAngularRouting(e){return u._angularModules.includes(e)}static getSectionEntityName(e){return u._getModuleStructureBySectionSchema(e)?.entitySchemaName}static getPageEntitySchemaName(e){const t=this._getModuleConfig(e);return t?.entitySchemaName?t.entitySchemaName:Object.values(Terrasoft.configuration.EntityStructure).find(n=>n.pages?.some(a=>a.cardSchema===e))?.entitySchemaName}static getEntityPageStructure(e){return Object.values(Terrasoft.configuration.EntityStructure).find(r=>r.pages.find(n=>n.cardSchema===e))?.pages?.find(r=>r.cardSchema===e)}static isMiniPage(e){const t=u.getEntityPageStructure(e);if(t){const r=t.schemaGroup==="MiniPage";return Promise.resolve(r)}return d.isSchemaInheritedFrom("BaseMiniPageTemplate",e)}static getSysModuleId(e){return(u._getModuleConfig(e)||Object.values(Terrasoft.configuration.ModuleStructure).find(r=>r.sectionModule===e))?.moduleId}}}}]);
